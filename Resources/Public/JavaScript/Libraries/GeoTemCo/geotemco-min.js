/* jQuery v1.7.2 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cu(a){if(!cj[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){ck||(ck=c.createElement("iframe"),ck.frameBorder=ck.width=ck.height=0),b.appendChild(ck);if(!cl||!ck.createElement){cl=(ck.contentWindow||ck.contentDocument).document,cl.write((f.support.boxModel?"<!doctype html>":"")+"<html><body>"),cl.close()}d=cl.createElement(a),cl.body.appendChild(d),e=f.css(d,"display"),b.removeChild(ck)}cj[a]=e}return cj[a]}function ct(a,b){var c={};f.each(cp.concat.apply([],cp.slice(0,b)),function(){c[this]=a});return c}function cs(){cq=b}function cr(){setTimeout(cs,0);return cq=f.now()}function ci(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ch(){try{return new a.XMLHttpRequest}catch(b){}}function cb(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1){for(h in a.converters){typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h])}}l=k,k=d[g];if(k==="*"){k=l}else{if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}}return c}function ca(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g){i in d&&(c[g[i]]=d[i])}while(f[0]==="*"){f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"))}if(h){for(i in e){if(e[i]&&e[i].test(h)){f.unshift(i);break}}}if(f[0] in d){j=f[0]}else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function b_(a,b,c,d){if(f.isArray(b)){f.each(b,function(b,e){c||bD.test(a)?d(a,e):b_(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)})}else{if(!c&&f.type(b)==="object"){for(var e in b){b_(a+"["+e+"]",b[e],c,d)}}else{d(a,b)}}}function b$(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c){c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d])}e&&f.extend(!0,a,e)}function bZ(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bS,l;for(;i<j&&(k||!l);i++){l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bZ(a,c,d,e,l,g)))}(k||!l)&&!g["*"]&&(l=bZ(a,c,d,e,"*",g));return l}function bY(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bO),e=0,g=d.length,h,i,j;for(;e<g;e++){h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}}function bB(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?1:0,g=4;if(d>0){if(c!=="border"){for(;e<g;e+=2){c||(d-=parseFloat(f.css(a,"padding"+bx[e]))||0),c==="margin"?d+=parseFloat(f.css(a,c+bx[e]))||0:d-=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0}}return d+"px"}d=by(a,b);if(d<0||d==null){d=a.style[b]}if(bt.test(d)){return d}d=parseFloat(d)||0;if(c){for(;e<g;e+=2){d+=parseFloat(f.css(a,"padding"+bx[e]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+bx[e]))||0)}}return d+"px"}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio"){a.defaultChecked=a.checked}}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;b.nodeType===1&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?b.outerHTML=a.outerHTML:c!=="input"||a.type!=="checkbox"&&a.type!=="radio"?c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text):(a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)),b.removeAttribute(f.expando),b.removeAttribute("_submit_attached"),b.removeAttribute("_change_attached"))}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i){for(d=0,e=i[c].length;d<e;d++){f.event.add(b,c,i[c][d])}}}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement){while(b.length){c.createElement(b.pop())}}return c}function T(a,b,c){b=b||0;if(f.isFunction(b)){return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c})}if(b.nodeType){return f.grep(a,function(a,d){return a===b===c})}if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b)){return f.filter(b,d,!c)}b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return !a||!a.parentNode||a.parentNode.nodeType===11}function K(){return !0}function J(){return !1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b])){continue}if(b!=="toJSON"){return !1}}return !0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?+d:j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else{d=b}}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++){b[a[c]]=!0}return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a){return this}if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2]){return f.find(a)}this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return !d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a)){return f.ready(a)}a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++){if((a=arguments[j])!=null){for(c in a){d=i[c],f=a[c];if(i===f){continue}l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}}}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body){return setTimeout(e.ready,1)}e.isReady=!0;if(a!==!0&&--e.readyWait>0){return}A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete"){return setTimeout(e.ready,1)}if(c.addEventListener){c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1)}else{if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return !isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a)){return !1}try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf")){return !1}}catch(c){return !1}var d;for(d in a){}return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a){return !1}return !0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b){return null}b=e.trim(b);if(a.JSON&&a.JSON.parse){return a.JSON.parse(b)}if(n.test(b.replace(o,"@").replace(p,"]").replace(q,""))){return(new Function("return "+b))()}e.error("Invalid JSON: "+b)},parseXML:function(c){if(typeof c!="string"||!c){return null}var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a){if(c.apply(a[f],d)===!1){break}}}else{for(;g<h;){if(c.apply(a[g++],d)===!1){break}}}}else{if(i){for(f in a){if(c.call(a[f],f,a[f])===!1){break}}}else{for(;g<h;){if(c.call(a[g],g,a[g++])===!1){break}}}}return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H){return H.call(b,a,c)}d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++){if(c in b&&b[c]===a){return c}}}return -1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number"){for(var f=c.length;e<f;e++){a[d++]=c[e]}}else{while(c[e]!==b){a[d++]=c[e++]}}a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++){e=!!b(a[f],f),c!==e&&d.push(a[f])}return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k){for(;i<j;i++){f=c(a[i],i,d),f!=null&&(h[h.length]=f)}}else{for(g in a){f=c(a[g],g,d),f!=null&&(h[h.length]=f)}}return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a)){return b}var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h,i){var j,k=d==null,l=0,m=a.length;if(d&&typeof d=="object"){for(l in d){e.access(a,c,l,d[l],1,h,f)}g=1}else{if(f!==b){j=i===b&&e.isFunction(f),k&&(j?(j=c,c=function(a,b,c){return j.call(e(a),c)}):(c.call(a,f),c=null));if(c){for(;l<m;l++){c(a[l],d,j?f.call(a[l],l,c(a[l],d)):f,i)}}g=1}}return g?a:k?c.call(a):m?c(a[0],d):h},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m,n=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++){g=b[d],h=f.type(g),h==="array"?n(g):h==="function"&&(!a.unique||!p.has(g))&&c.push(g)}},o=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,j=!0,m=k||0,k=0,l=c.length;for(;c&&m<l;m++){if(c[m].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}}j=!1,c&&(a.once?e===!0?p.disable():c=[]:d&&d.length&&(e=d.shift(),p.fireWith(e[0],e[1])))},p={add:function(){if(c){var a=c.length;n(arguments),j?l=c.length:e&&e!==!0&&(k=a,o(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++){for(var f=0;f<c.length;f++){if(b[d]===c[f]){j&&f<=l&&(l--,f<=m&&m--),c.splice(f--,1);if(a.unique){break}}}}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++){if(a===c[b]){return !0}}}return !1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return !c},lock:function(){d=b,(!e||e===!0)&&p.disable();return this},locked:function(){return !d},fireWith:function(b,c){d&&(j?a.once||d.push([b,c]):(!a.once||!e)&&o(b,c));return this},fire:function(){p.fireWith(this,arguments);return this},fired:function(){return !!i}};return p};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null){a=h}else{for(var b in h){a[b]=h[b]}}return a}},i=h.promise({}),j;for(j in g){i[j]=g[j].fire,i[j+"With"]=g[j].fireWith}i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++){b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g}g||j.resolveWith(j,b)}else{j!==a&&j.resolveWith(j,d?[a]:[])}return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p=c.createElement("div"),q=c.documentElement;p.setAttribute("className","t"),p.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=p.getElementsByTagName("*"),e=p.getElementsByTagName("a")[0];if(!d||!d.length||!e){return{}}g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=p.getElementsByTagName("input")[0],b={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:p.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},f.boxModel=b.boxModel=c.compatMode==="CSS1Compat",i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete p.test}catch(r){b.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",function(){b.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),i.setAttribute("name","t"),p.appendChild(i),j=c.createDocumentFragment(),j.appendChild(p.lastChild),b.checkClone=j.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,j.removeChild(i),j.appendChild(p);if(p.attachEvent){for(n in {submit:1,change:1,focusin:1}){m="on"+n,o=m in p,o||(p.setAttribute(m,"return;"),o=typeof p[m]=="function"),b[n+"Bubbles"]=o}}j.removeChild(p),j=g=h=p=i=null,f(function(){var d,e,g,h,i,j,l,m,n,q,r,s,t,u=c.getElementsByTagName("body")[0];!u||(m=1,t="padding:0;margin:0;border:",r="position:absolute;top:0;left:0;width:1px;height:1px;",s=t+"0;visibility:hidden;",n="style='"+r+t+"5px solid #000;",q="<div "+n+"display:block;'><div style='"+t+"0;display:block;overflow:hidden;'></div></div><table "+n+"' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",d=c.createElement("div"),d.style.cssText=s+"width:0;height:0;position:static;top:0;margin-top:"+m+"px",u.insertBefore(d,u.firstChild),p=c.createElement("div"),d.appendChild(p),p.innerHTML="<table><tr><td style='"+t+"0;display:none'></td><td>t</td></tr></table>",k=p.getElementsByTagName("td"),o=k[0].offsetHeight===0,k[0].style.display="",k[1].style.display="none",b.reliableHiddenOffsets=o&&k[0].offsetHeight===0,a.getComputedStyle&&(p.innerHTML="",l=c.createElement("div"),l.style.width="0",l.style.marginRight="0",p.style.width="2px",p.appendChild(l),b.reliableMarginRight=(parseInt((a.getComputedStyle(l,null)||{marginRight:0}).marginRight,10)||0)===0),typeof p.style.zoom!="undefined"&&(p.innerHTML="",p.style.width=p.style.padding="1px",p.style.border=0,p.style.overflow="hidden",p.style.display="inline",p.style.zoom=1,b.inlineBlockNeedsLayout=p.offsetWidth===3,p.style.display="block",p.style.overflow="visible",p.innerHTML="<div style='width:5px;'></div>",b.shrinkWrapBlocks=p.offsetWidth!==3),p.style.cssText=r+s,p.innerHTML=q,e=p.firstChild,g=e.firstChild,i=e.nextSibling.firstChild.firstChild,j={doesNotAddBorder:g.offsetTop!==5,doesAddBorderForTableAndCells:i.offsetTop===5},g.style.position="fixed",g.style.top="20px",j.fixedPosition=g.offsetTop===20||g.offsetTop===15,g.style.position=g.style.top="",e.style.overflow="hidden",e.style.position="relative",j.subtractsBorderForOverflowNotVisible=g.offsetTop===-5,j.doesNotIncludeMarginInBodyOffset=u.offsetTop!==m,a.getComputedStyle&&(p.style.marginTop="1%",b.pixelMargin=(a.getComputedStyle(p,null)||{marginTop:0}).marginTop!=="1%"),typeof d.style.zoom!="undefined"&&(d.style.zoom=1),u.removeChild(d),l=p=d=null,f.extend(b,j))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return !!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b){return}n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function"){e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c)}g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c]){return g.events}k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k]){return}if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++){delete d[b[e]]}if(!(c?m:f.isEmptyObject)(d)){return}}}if(!c){delete j[k].data;if(!m(j[k])){return}}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b){return b!==!0&&a.getAttribute("classid")===b}}return !0}}),f.fn.extend({data:function(a,c){var d,e,g,h,i,j=this[0],k=0,m=null;if(a===b){if(this.length){m=f.data(j);if(j.nodeType===1&&!f._data(j,"parsedAttrs")){g=j.attributes;for(i=g.length;k<i;k++){h=g[k].name,h.indexOf("data-")===0&&(h=f.camelCase(h.substring(5)),l(j,h,m[h]))}f._data(j,"parsedAttrs",!0)}}return m}if(typeof a=="object"){return this.each(function(){f.data(this,a)})}d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!";return f.access(this,function(c){if(c===b){m=this.triggerHandler("getData"+e,[d[0]]),m===b&&j&&(m=f.data(j,a),m=l(j,a,m));return m===b&&d[1]?this.data(d[0]):m}d[1]=c,this.each(function(){var b=f(this);b.triggerHandler("setData"+e,d),f.data(this,a,c),b.triggerHandler("changeData"+e,d)})},null,c,arguments.length>1,null,!1)},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){var d=2;typeof a!="string"&&(c=a,a="fx",d--);if(arguments.length<d){return f.queue(this[0],a)}return c===b?this:this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--){if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0)){h++,l.add(m)}}m();return d.promise(c)}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,f.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,f.prop,a,b,arguments.length>1)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a)){return this.each(function(b){f(this).addClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1){if(!e.className&&b.length===1){e.className=a}else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++){~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ")}e.className=f.trim(g)}}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a)){return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className){if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++){h=h.replace(" "+c[i]+" "," ")}g.className=f.trim(h)}else{g.className=""}}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a)){return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)})}return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++]){i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}}else{if(c==="undefined"||c==="boolean"){this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""}}})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++){if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1){return !0}}return !1},val:function(a){var c,d,e,g=this[0];if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()];if(!c||!("set" in c)||c.set(this,h,"value")===b){this.value=h}}})}if(g){c=f.valHooks[g.type]||f.valHooks[g.nodeName.toLowerCase()];if(c&&"get" in c&&(d=c.get(g,"value"))!==b){return d}d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return !b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0){return null}c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j){return b}h.push(b)}}if(j&&!h.length&&i.length){return f(i[g]).val()}return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn){return f(a)[c](d)}if(typeof a.getAttribute=="undefined"){return f.prop(a,c,d)}i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set" in h&&i&&(g=h.set(a,d,c))!==b){return g}a.setAttribute(c,""+d);return d}if(h&&"get" in h&&i&&(g=h.get(a,c))!==null){return g}g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h,i=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;i<g;i++){e=d[i],e&&(c=f.propFix[e]||e,h=u.test(e),h||f.attr(a,e,""),a.removeAttribute(v?e:c),h&&c in a&&(a[c]=!1))}}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode){f.error("type property can't be changed")}else{if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button")){return w.get(a,b)}return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button")){return w.set(a,b,c)}a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set" in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get" in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0,coords:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b)){return a.checked=f.inArray(f(a).val(),b)>=0}}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/(?:^|\s)hover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler,g=p.selector),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:g&&G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1){a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o){f.event.remove(a,j+b[h],c,d,!0)}continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++){s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s))}r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered)){return}h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h]){return}c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j){j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0)}return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1){return}r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode){r.push([m,s]),n=m}n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++){m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault()}c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=f.event.special[c.type]||{},j=[],k,l,m,n,o,p,q,r,s,t,u;g[0]=c,c.delegateTarget=this;if(!i.preDispatch||i.preDispatch.call(this,c)!==!1){if(e&&(!c.button||c.type!=="click")){n=f(this),n.context=this.ownerDocument||this;for(m=c.target;m!=this;m=m.parentNode||this){if(m.disabled!==!0){p={},r=[],n[0]=m;for(k=0;k<e;k++){s=d[k],t=s.selector,p[t]===b&&(p[t]=s.quick?H(m,s.quick):n.is(t)),p[t]&&r.push(s)}r.length&&j.push({elem:m,matches:r})}}}d.length>e&&j.push({elem:this,matches:d.slice(e)});for(k=0;k<j.length&&!c.isPropagationStopped();k++){q=j[k],c.currentTarget=q.elem;for(l=0;l<q.matches.length&&!c.isImmediatePropagationStopped();l++){s=q.matches[l];if(h||!c.namespace&&!s.namespace||c.namespace_re&&c.namespace_re.test(s.namespace)){c.data=s.data,c.handleObj=s,o=((f.event.special[s.origType]||{}).handle||s.handler).apply(q.elem,g),o!==b&&(c.result=o,o===!1&&(c.preventDefault(),c.stopPropagation()))}}}i.postDispatch&&i.postDispatch.call(this,c);return c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando]){return a}var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;){e=i[--d],a[e]=g[e]}a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event)){return new f.Event(a,b)}a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d)){a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b}return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form")){return !1}f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),d._submit_attached=!0)})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(f.nodeName(this,"form")){return !1}f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))})}return !1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox"){return a.handleObj.handler.apply(this,arguments)}},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(i in a){this.on(i,c,d,a[i],g)}return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1){e=J}else{if(!e){return this}}g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a){this.off(g,c,a[g])}return this}if(c===!1||typeof c=="function"){d=c,c=b}d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){return f.event.trigger(a,b,this[0],!0)}},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length){b[d++].guid=c}return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else{if(m.filter(b,[j]).length>0){k=j;break}}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9){return[]}if(!b||typeof b!="string"){return e}var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b)){if(w.length===2&&o.relative[w[0]]){j=y(w[0]+w[1],d,f)}else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length){b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}}}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length){q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}}else{k=w=[]}}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]"){if(!u){e.push.apply(e,k)}else{if(d&&d.nodeType===1){for(t=0;k[t]!=null;t++){k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t])}}else{for(t=0;k[t]!=null;t++){k[t]&&k[t].nodeType===1&&e.push(j[t])}}}}else{s(k,e)}l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h){for(var b=1;b<a.length;b++){a[b]===a[b-1]&&a.splice(b--,1)}}}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a){return[]}for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter){if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\"){continue}s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f){g=i=!0}else{if(f===!0){continue}}}if(f){for(n=0;(j=s[n])!=null;n++){j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0))}}if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g){return[]}break}}}if(a===q){if(g==null){m.error(a)}else{break}}q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9||d===11){if(typeof a.textContent=="string"){return a.textContent}if(typeof a.innerText=="string"){return a.innerText.replace(k,"")}for(a=a.firstChild;a;a=a.nextSibling){e+=n(a)}}else{if(d===3||d===4){return a.nodeValue}}}else{for(b=0;c=a[b];b++){c.nodeType!==8&&(e+=n(c))}}return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++){if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1){}a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++){c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b)}d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++){d[e].getAttribute("name")===a[1]&&c.push(d[e])}return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined"){return b.getElementsByTagName(a[1])}}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f){return a}for(var g=0,h;(h=b[g])!=null;g++){h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1))}return !1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else{a[2]&&m.error(a[0])}a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not"){if((a.exec(b[3])||"").length>1||/^\w/.test(b[3])){b[3]=m(b[3],null,null,c)}else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return !1}}else{if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0])){return !0}}return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return !!a.firstChild},empty:function(a){return !a.firstChild},has:function(a,b,c){return !!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f){return f(a,c,b,d)}if(e==="contains"){return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0}if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++){if(g[h]===a){return !1}}return !0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling){if(l.nodeType===1){return !1}}if(k==="first"){return !0}l=a;case"last":while(l=l.nextSibling){if(l.nodeType===1){return !1}}return !0;case"nth":c=b[2],e=b[3];if(c===1&&e===0){return !0}f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling){l.nodeType===1&&(l.nodeIndex=++i)}g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f){return f(a,c,b,d)}}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match){o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q))}o.match.globalPOS=p;var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]"){Array.prototype.push.apply(d,a)}else{if(typeof a.length=="number"){for(var e=a.length;c<e;c++){d.push(a[c])}}else{for(;a[c];c++){d.push(a[c])}}}return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition){return a.compareDocumentPosition?-1:1}return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex}var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i){return v(a,b)}if(!g){return -1}if(!i){return 1}while(j){e.unshift(j),j=j.parentNode}j=i;while(j){f.unshift(j),j=j.parentNode}c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++){if(e[k]!==f[k]){return v(e[k],f[k])}}return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b){return c}var d=a.nextSibling;while(d){if(d===b){return -1}d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++){c[e].nodeType===1&&d.push(c[e])}c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1]){return s(e.getElementsByTagName(b),f)}if(h[2]&&o.find.CLASS&&e.getElementsByClassName){return s(e.getElementsByClassName(h[2]),f)}}if(e.nodeType===9){if(b==="body"&&e.body){return s([e.body],f)}if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode){return s([],f)}if(i.id===h[3]){return s([i],f)}}try{return s(e.querySelectorAll(b),f)}catch(j){}}else{if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p){return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}}catch(r){}finally{l||k.removeAttribute("id")}}}}return a(b,e,f,g)};for(var e in a){m[e]=a[e]}b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a)){try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11){return f}}}catch(g){}}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1){return}o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c){return b.getElementsByClassName(a[1])}},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return !!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return !1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a)){f+=d[0],a=a.replace(o.match.PSEUDO,"")}a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++){m(a,g[h],e,c)}return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.globalPOS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string"){return f(a).filter(function(){for(c=0,d=b.length;c<d;c++){if(f.contains(b[c],this)){return !0}}})}var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0){for(h=g;h<e.length;h++){for(i=0;i<g;i++){if(e[i]===e[h]){e.splice(h--,1);break}}}}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++){if(f.contains(this,b[a])){return !0}}})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return !!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++){f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h})}g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11){break}}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a){return this[0]&&this[0].parentNode?this.prevAll().length:-1}if(typeof a=="string"){return f.inArray(this[0],f(a))}return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d))){g.nodeType===1&&e.push(g),g=g[c]}return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c]){if(a.nodeType===1&&++e===b){break}}return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling){a.nodeType===1&&a!==b&&c.push(a)}return c}});var V="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")[\\s/>]","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){return f.access(this,function(a){return a===b?f.text(this):this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapAll(a.call(this,b))})}if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1){a=a.firstChild}return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapInner(a.call(this,b))})}return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)})}if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)})}if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++){if(!a||f.filter(a,[d]).length){!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d)}}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild){b.removeChild(b.firstChild)}}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){return f.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b){return c.nodeType===1?c.innerHTML.replace(W,""):null}if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(;d<e;d++){c=this[d]||{},c.nodeType===1&&(f.cleanData(c.getElementsByTagName("*")),c.innerHTML=a)}c=0}catch(g){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a)){return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))})}typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j)){return this.each(function(){f(this).domManip(a,c,d,!0)})}if(f.isFunction(j)){return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)})}if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++){d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}}k.length&&f.each(k,function(a,b){b.src?f.ajax({type:"GET",global:!1,url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||f.isXMLDoc(a)||!bc.test("<"+a.nodeName+">")?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g){e[g]&&bk(d[g],e[g])}}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g){bj(d[g],e[g])}}}d=e=null;return h},clean:function(a,b,d,e){var g,h,i,j=[];b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);for(var k=0,l;(l=a[k])!=null;k++){typeof l=="number"&&(l+="");if(!l){continue}if(typeof l=="string"){if(!_.test(l)){l=b.createTextNode(l)}else{l=l.replace(Y,"<$1></$2>");var m=(Z.exec(l)||["",""])[1].toLowerCase(),n=bg[m]||bg._default,o=n[0],p=b.createElement("div"),q=bh.childNodes,r;b===c?bh.appendChild(p):U(b).appendChild(p),p.innerHTML=n[1]+l+n[2];while(o--){p=p.lastChild}if(!f.support.tbody){var s=$.test(l),t=m==="table"&&!s?p.firstChild&&p.firstChild.childNodes:n[1]==="<table>"&&!s?p.childNodes:[];for(i=t.length-1;i>=0;--i){f.nodeName(t[i],"tbody")&&!t[i].childNodes.length&&t[i].parentNode.removeChild(t[i])}}!f.support.leadingWhitespace&&X.test(l)&&p.insertBefore(b.createTextNode(X.exec(l)[0]),p.firstChild),l=p.childNodes,p&&(p.parentNode.removeChild(p),q.length>0&&(r=q[q.length-1],r&&r.parentNode&&r.parentNode.removeChild(r)))}}var u;if(!f.support.appendChecked){if(l[0]&&typeof(u=l.length)=="number"){for(i=0;i<u;i++){bn(l[i])}}else{bn(l)}}l.nodeType?j.push(l):j=f.merge(j,l)}if(d){g=function(a){return !a.type||be.test(a.type)};for(k=0;j[k];k++){h=j[k];if(e&&f.nodeName(h,"script")&&(!h.type||be.test(h.type))){e.push(h.parentNode?h.parentNode.removeChild(h):h)}else{if(h.nodeType===1){var v=f.grep(h.getElementsByTagName("script"),g);j.splice.apply(j,[k+1,0].concat(v))}d.appendChild(h)}}}return j},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()]){continue}c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events){e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle)}b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bp=/alpha\([^)]*\)/i,bq=/opacity=([^)]*)/,br=/([A-Z]|^ms)/g,bs=/^[\-+]?(?:\d*\.)?\d+$/i,bt=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,bu=/^([\-+])=([\-+.\de]+)/,bv=/^margin/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Top","Right","Bottom","Left"],by,bz,bA;f.fn.css=function(a,c){return f.access(this,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)},a,c,arguments.length>1)},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=by(a,"opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get" in k&&(g=k.get(a,!1,e))!==b){return g}return j[c]}h=typeof d,h==="string"&&(g=bu.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d)){return}h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set" in k)||(d=k.set(a,d))!==b){try{j[c]=d}catch(l){}}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get" in g&&(e=g.get(a,!0,d))!==b){return e}if(by){return by(a,c)}},swap:function(a,b,c){var d={},e,f;for(f in b){d[f]=a.style[f],a.style[f]=b[f]}e=c.call(a);for(f in b){a.style[f]=d[f]}return e}}),f.curCSS=f.css,c.defaultView&&c.defaultView.getComputedStyle&&(bz=function(a,b){var c,d,e,g,h=a.style;b=b.replace(br,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b))),!f.support.pixelMargin&&e&&bv.test(b)&&bt.test(c)&&(g=h.width,h.width=c,c=e.width,h.width=g);return c}),c.documentElement.currentStyle&&(bA=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f==null&&g&&(e=g[b])&&(f=e),bt.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),by=bz||bA,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){if(c){return a.offsetWidth!==0?bB(a,b,d):f.swap(a,bw,function(){return bB(a,b,d)})}},set:function(a,b){return bs.test(b)?b+"px":b}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bq.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bp,""))===""){c.removeAttribute("filter");if(d&&!d.filter){return}}c.filter=bp.test(g)?g.replace(bp,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){return f.swap(a,{display:"inline-block"},function(){return b?by(a,"margin-right"):a.style.marginRight})}})}),f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return !f.expr.filters.hidden(a)}),f.each({margin:"",padding:"",border:"Width"},function(a,b){f.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++){f[a+bx[d]+b]=e[d]||e[d-2]||e[0]}return f}}});var bC=/%20/g,bD=/\[\]$/,bE=/\r?\n/g,bF=/#.*$/,bG=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bH=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bI=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bJ=/^(?:GET|HEAD)$/,bK=/^\/\//,bL=/\?/,bM=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bN=/^(?:select|textarea)/i,bO=/\s+/,bP=/([?&])_=[^&]*/,bQ=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bR=f.fn.load,bS={},bT={},bU,bV,bW=["*/"]+["*"];try{bU=e.href}catch(bX){bU=c.createElement("a"),bU.href="",bU=bU.href}bV=bQ.exec(bU.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bR){return bR.apply(this,arguments)}if(!this.length){return this}var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bM,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bN.test(this.nodeName)||bH.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bE,"\r\n")}}):{name:b.name,value:c.replace(bE,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b$(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b$(a,b);return a},ajaxSettings:{url:bU,isLocal:bI.test(bV[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bW},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bY(bS),ajaxTransport:bY(bT),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?ca(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified")){f.lastModified[k]=y}if(z=v.getResponseHeader("Etag")){f.etag[k]=z}}if(a===304){w="notmodified",o=!0}else{try{r=cb(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}}else{u=w;if(!w||a){w="error",a<0&&(a=0)}}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bG.exec(n)){o[c[1].toLowerCase()]=c[2]}}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2){for(b in a){j[b]=[j[b],a[b]]}}else{b=a[v.status],v.then(b,b)}}return this},d.url=((a||d.url)+"").replace(bF,"").replace(bK,bV[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bO),d.crossDomain==null&&(r=bQ.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bV[1]&&r[2]==bV[2]&&(r[3]||(r[1]==="http:"?80:443))==(bV[3]||(bV[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),bZ(bS,d,c,v);if(s===2){return !1}t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bJ.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bL.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bP,"$1_="+x);d.url=y+(y===d.url?(bL.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bW+"; q=0.01":""):d.accepts["*"]);for(u in d.headers){v.setRequestHeader(u,d.headers[u])}if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return !1}for(u in {success:1,error:1,complete:1}){v[u](d[u])}p=bZ(bT,d,c,v);if(!p){w(-1,"No Transport")}else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2){w(-1,z)}else{throw z}}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a)){f.each(a,function(){e(this.name,this.value)})}else{for(var g in a){b_(g,a[g],c,e)}}return d.join("&").replace(bC,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cc=f.now(),cd=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cc++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=typeof b.data=="string"&&/^application\/x\-www\-form\-urlencoded/.test(b.contentType);if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(cd.test(b.url)||e&&cd.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(cd,l),b.url===j&&(e&&(k=k.replace(cd,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState)){d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")}},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var ce=a.ActiveXObject?function(){for(var a in cg){cg[a](0,1)}}:!1,cf=0,cg;f.ajaxSettings.xhr=a.ActiveXObject?function(){return !this.isLocal&&ch()||ci()}:ch,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials" in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields){for(j in c.xhrFields){h[j]=c.xhrFields[j]}}c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e){h.setRequestHeader(j,e[j])}}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,ce&&delete cg[i]);if(e){h.readyState!==4&&h.abort()}else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n);try{m.text=h.responseText}catch(a){}try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cf,ce&&(cg||(cg={},f(a).unload(ce)),cg[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cj={},ck,cl,cm=/^(?:toggle|show|hide)$/,cn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,co,cp=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cq;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0){return this.animate(ct("show",3),a,b,c)}for(var g=0,h=this.length;g<h;g++){d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),(e===""&&f.css(d,"display")==="none"||!f.contains(d.ownerDocument.documentElement,d))&&f._data(d,"olddisplay",cu(d.nodeName)))}for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none"){d.style.display=f._data(d,"olddisplay")||""}}}return this},hide:function(a,b,c){if(a||a===0){return this.animate(ct("hide",3),a,b,c)}var d,e,g=0,h=this.length;for(;g<h;g++){d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e))}for(g=0;g<h;g++){this[g].style&&(this[g].style.display="none")}return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(ct("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o,p,q;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]);if((k=f.cssHooks[g])&&"expand" in k){l=k.expand(a[g]),delete a[g];for(i in l){i in a||(a[i]=l[i])}}}for(g in a){h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d){return b.complete.call(this)}c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cu(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a){j=new f.fx(this,b,i),h=a[i],cm.test(h)?(q=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),q?(f._data(this,"toggle"+i,q==="show"?"hide":"show"),j[q]()):j[h]()):(m=cn.exec(h),n=j.cur(),m?(o=parseFloat(m[2]),p=m[3]||(f.cssNumber[i]?"":"px"),p!=="px"&&(f.style(this,i,(o||1)+p),n=(o||1)/j.cur()*n,f.style(this,i,n+p)),m[1]&&(o=(m[1]==="-="?-1:1)*o+n),j.custom(n,o,p)):j.custom(n,h,""))}return !0}var e=f.speed(b,c,d);if(f.isEmptyObject(a)){return this.each(e.complete,[!1])}a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null){for(b in g){g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b)}}else{g[b=a+".run"]&&g[b].stop&&h(this,g,b)}for(b=e.length;b--;){e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1))}(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:ct("show",1),slideUp:ct("hide",1),slideToggle:ct("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0){d.queue="fx"}d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a){return a},swing:function(a){return -Math.cos(a*Math.PI)/2+0.5}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cq||cr(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){f._data(e.elem,"fxshow"+e.prop)===b&&(e.options.hide?f._data(e.elem,"fxshow"+e.prop,e.start):e.options.show&&f._data(e.elem,"fxshow"+e.prop,e.end))},h()&&f.timers.push(h)&&!co&&(co=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cq||cr(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties){i.animatedProperties[b]!==!0&&(g=!1)}if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show){for(b in i.animatedProperties){f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0)}}d=i.complete,d&&(i.complete=!1,d.call(h))}return !1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return !0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++){a=b[c],!a()&&b[c]===a&&b.splice(c--,1)}b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(co),co=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(cp.concat.apply([],cp),function(a,b){b.indexOf("margin")&&(f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)})}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cv,cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect" in c.documentElement?cv=function(a,b,c,d){try{d=a.getBoundingClientRect()}catch(e){}if(!d||!f.contains(c,a)){return d?{top:d.top,left:d.left}:{top:0,left:0}}var g=b.body,h=cy(b),i=c.clientTop||g.clientTop||0,j=c.clientLeft||g.clientLeft||0,k=h.pageYOffset||f.support.boxModel&&c.scrollTop||g.scrollTop,l=h.pageXOffset||f.support.boxModel&&c.scrollLeft||g.scrollLeft,m=d.top+k-i,n=d.left+l-j;return{top:m,left:n}}:cv=function(a,b,c){var d,e=a.offsetParent,g=a,h=b.body,i=b.defaultView,j=i?i.getComputedStyle(a,null):a.currentStyle,k=a.offsetTop,l=a.offsetLeft;while((a=a.parentNode)&&a!==h&&a!==c){if(f.support.fixedPosition&&j.position==="fixed"){break}d=i?i.getComputedStyle(a,null):a.currentStyle,k-=a.scrollTop,l-=a.scrollLeft,a===e&&(k+=a.offsetTop,l+=a.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(a.nodeName))&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),g=e,e=a.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&d.overflow!=="visible"&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),j=d}if(j.position==="relative"||j.position==="static"){k+=h.offsetTop,l+=h.offsetLeft}f.support.fixedPosition&&j.position==="fixed"&&(k+=Math.max(c.scrollTop,h.scrollTop),l+=Math.max(c.scrollLeft,h.scrollLeft));return{top:k,left:l}},f.fn.offset=function(a){if(arguments.length){return a===b?this:this.each(function(b){f.offset.setOffset(this,a,b)})}var c=this[0],d=c&&c.ownerDocument;if(!d){return null}if(c===d.body){return f.offset.bodyOffset(c)}return cv(c,d,d.documentElement)},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using" in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0]){return null}var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static"){a=a.offsetParent}return a})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);f.fn[a]=function(e){return f.access(this,function(a,e,g){var h=cy(a);if(g===b){return h?c in h?h[c]:f.support.boxModel&&h.document.documentElement[e]||h.document.body[e]:a[e]}h?h.scrollTo(d?f(h).scrollLeft():g,d?g:f(h).scrollTop()):a[e]=g},a,e,arguments.length,null)}}),f.each({Height:"height",Width:"width"},function(a,c){var d="client"+a,e="scroll"+a,g="offset"+a;f.fn["inner"+a]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,c,"padding")):this[c]():null},f.fn["outer"+a]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,c,a?"margin":"border")):this[c]():null},f.fn[c]=function(a){return f.access(this,function(a,c,h){var i,j,k,l;if(f.isWindow(a)){i=a.document,j=i.documentElement[d];return f.support.boxModel&&j||i.body&&i.body[d]||j}if(a.nodeType===9){i=a.documentElement;if(i[d]>=i[e]){return i[d]}return Math.max(a.body[e],i[e],a.body[g],i[g])}if(h===b){k=f.css(a,c),l=parseFloat(k);return f.isNumeric(l)?l:k}f(a).css(c,h)},c,a,arguments.length,null)}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);var arrayIndex=function(c,b){if(Array.indexOf){return c.indexOf(b)}for(var a=0;a<c.length;a++){if(c[a]==b){return a}}return -1};var GeoTemCoMinifier_urlPrefix;for(var i=0;i<document.getElementsByTagName("script").length;i++){var script=document.getElementsByTagName("script")[i];var index=script.src.indexOf("geotemco.js");if(index==-1){index=script.src.indexOf("geotemco-min.js")}if(index!=-1){GeoTemCoMinifier_urlPrefix=script.src.substring(0,index);break}}if(!document.createElement("canvas").getContext){(function(){var w=Math;var x=w.round;var t=w.sin;var F=w.cos;var o=w.abs;var E=w.sqrt;var a=10;var p=a/2;function h(){return this.context_||(this.context_=new r(this))}var v=Array.prototype.slice;function G(m,H,I){var j=v.call(arguments,2);return function(){return m.apply(H,j.concat(v.call(arguments)))}}var k={init:function(j){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var m=j||document;m.createElement("canvas");m.attachEvent("onreadystatechange",G(this.init_,this,m))}},init_:function(I){if(!I.namespaces.g_vml_){I.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")}if(!I.namespaces.g_o_){I.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}if(!I.styleSheets.ex_canvas_){var H=I.createStyleSheet();H.owningElement.id="ex_canvas_";H.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}var m=I.getElementsByTagName("canvas");for(var j=0;j<m.length;j++){this.initElement(m[j])}},initElement:function(m){if(!m.getContext){m.getContext=h;m.innerHTML="";m.attachEvent("onpropertychange",D);m.attachEvent("onresize",b);var j=m.attributes;if(j.width&&j.width.specified){m.style.width=j.width.nodeValue+"px"}else{m.width=m.clientWidth}if(j.height&&j.height.specified){m.style.height=j.height.nodeValue+"px"}else{m.height=m.clientHeight}}return m}};function D(m){var j=m.srcElement;switch(m.propertyName){case"width":j.style.width=j.attributes.width.nodeValue+"px";j.getContext().clearRect();break;case"height":j.style.height=j.attributes.height.nodeValue+"px";j.getContext().clearRect();break}}function b(m){var j=m.srcElement;if(j.firstChild){j.firstChild.style.width=j.clientWidth+"px";j.firstChild.style.height=j.clientHeight+"px"}}k.init();var e=[];for(var A=0;A<16;A++){for(var z=0;z<16;z++){e[A*16+z]=A.toString(16)+z.toString(16)}}function s(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(I,H){var m=s();for(var j=0;j<3;j++){for(var L=0;L<3;L++){var J=0;for(var K=0;K<3;K++){J+=I[j][K]*H[K][L]}m[j][L]=J}}return m}function y(m,j){j.fillStyle=m.fillStyle;j.lineCap=m.lineCap;j.lineJoin=m.lineJoin;j.lineWidth=m.lineWidth;j.miterLimit=m.miterLimit;j.shadowBlur=m.shadowBlur;j.shadowColor=m.shadowColor;j.shadowOffsetX=m.shadowOffsetX;j.shadowOffsetY=m.shadowOffsetY;j.strokeStyle=m.strokeStyle;j.globalAlpha=m.globalAlpha;j.arcScaleX_=m.arcScaleX_;j.arcScaleY_=m.arcScaleY_;j.lineScale_=m.lineScale_}function c(m){var J,I=1;m=String(m);if(m.substring(0,3)=="rgb"){var L=m.indexOf("(",3);var j=m.indexOf(")",L+1);var K=m.substring(L+1,j).split(",");J="#";for(var H=0;H<3;H++){J+=e[Number(K[H])]}if(K.length==4&&m.substr(3,1)=="a"){I=K[3]}}else{J=m}return{color:J,alpha:I}}function u(j){switch(j){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function r(m){this.m_=s();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=a*1;this.globalAlpha=1;this.canvas=m;var j=m.ownerDocument.createElement("div");j.style.width=m.clientWidth+"px";j.style.height=m.clientHeight+"px";j.style.overflow="hidden";j.style.position="absolute";m.appendChild(j);this.element_=j;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1}var l=r.prototype;l.clearRect=function(){this.element_.innerHTML=""};l.beginPath=function(){this.currentPath_=[]};l.moveTo=function(m,j){var H=this.getCoords_(m,j);this.currentPath_.push({type:"moveTo",x:H.x,y:H.y});this.currentX_=H.x;this.currentY_=H.y};l.lineTo=function(m,j){var H=this.getCoords_(m,j);this.currentPath_.push({type:"lineTo",x:H.x,y:H.y});this.currentX_=H.x;this.currentY_=H.y};l.bezierCurveTo=function(H,m,N,M,L,J){var j=this.getCoords_(L,J);var K=this.getCoords_(H,m);var I=this.getCoords_(N,M);q(this,K,I,j)};function q(j,I,H,m){j.currentPath_.push({type:"bezierCurveTo",cp1x:I.x,cp1y:I.y,cp2x:H.x,cp2y:H.y,x:m.x,y:m.y});j.currentX_=m.x;j.currentY_=m.y}l.quadraticCurveTo=function(L,H,m,j){var K=this.getCoords_(L,H);var J=this.getCoords_(m,j);var M={x:this.currentX_+2/3*(K.x-this.currentX_),y:this.currentY_+2/3*(K.y-this.currentY_)};var I={x:M.x+(J.x-this.currentX_)/3,y:M.y+(J.y-this.currentY_)/3};q(this,M,I,J)};l.arc=function(O,M,N,J,m,H){N*=a;var S=H?"at":"wa";var P=O+F(J)*N-p;var R=M+t(J)*N-p;var j=O+F(m)*N-p;var Q=M+t(m)*N-p;if(P==j&&!H){P+=0.125}var I=this.getCoords_(O,M);var L=this.getCoords_(P,R);var K=this.getCoords_(j,Q);this.currentPath_.push({type:S,x:I.x,y:I.y,radius:N,xStart:L.x,yStart:L.y,xEnd:K.x,yEnd:K.y})};l.rect=function(H,m,j,I){this.moveTo(H,m);this.lineTo(H+j,m);this.lineTo(H+j,m+I);this.lineTo(H,m+I);this.closePath()};l.strokeRect=function(H,m,j,I){var J=this.currentPath_;this.beginPath();this.moveTo(H,m);this.lineTo(H+j,m);this.lineTo(H+j,m+I);this.lineTo(H,m+I);this.closePath();this.stroke();this.currentPath_=J};l.fillRect=function(H,m,j,I){var J=this.currentPath_;this.beginPath();this.moveTo(H,m);this.lineTo(H+j,m);this.lineTo(H+j,m+I);this.lineTo(H,m+I);this.closePath();this.fill();this.currentPath_=J};l.createLinearGradient=function(m,I,j,H){var J=new B("gradient");J.x0_=m;J.y0_=I;J.x1_=j;J.y1_=H;return J};l.createRadialGradient=function(I,K,H,m,J,j){var L=new B("gradientradial");L.x0_=I;L.y0_=K;L.r0_=H;L.x1_=m;L.y1_=J;L.r1_=j;return L};l.drawImage=function(V,I){var O,M,Q,ad,T,R,Y,af;var P=V.runtimeStyle.width;var U=V.runtimeStyle.height;V.runtimeStyle.width="auto";V.runtimeStyle.height="auto";var N=V.width;var ab=V.height;V.runtimeStyle.width=P;V.runtimeStyle.height=U;if(arguments.length==3){O=arguments[1];M=arguments[2];T=R=0;Y=Q=N;af=ad=ab}else{if(arguments.length==5){O=arguments[1];M=arguments[2];Q=arguments[3];ad=arguments[4];T=R=0;Y=N;af=ab}else{if(arguments.length==9){T=arguments[1];R=arguments[2];Y=arguments[3];af=arguments[4];O=arguments[5];M=arguments[6];Q=arguments[7];ad=arguments[8]}else{throw Error("Invalid number of arguments")}}}var ae=this.getCoords_(O,M);var J=Y/2;var m=af/2;var ac=[];var j=10;var L=10;ac.push(" <g_vml_:group",' coordsize="',a*j,",",a*L,'"',' coordorigin="0,0"',' style="width:',j,"px;height:",L,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var K=[];K.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",x(ae.x/a),",","Dy=",x(ae.y/a),"");var aa=ae;var Z=this.getCoords_(O+Q,M);var X=this.getCoords_(O,M+ad);var S=this.getCoords_(O+Q,M+ad);aa.x=w.max(aa.x,Z.x,X.x,S.x);aa.y=w.max(aa.y,Z.y,X.y,S.y);ac.push("padding:0 ",x(aa.x/a),"px ",x(aa.y/a),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",K.join(""),", sizingmethod='clip');")}else{ac.push("top:",x(ae.y/a),"px;left:",x(ae.x/a),"px;")}ac.push(' ">','<g_vml_:image src="',V.src,'"',' style="width:',a*Q,"px;"," height:",a*ad,'px;"',' cropleft="',T/N,'"',' croptop="',R/ab,'"',' cropright="',(N-T-Y)/N,'"',' cropbottom="',(ab-R-af)/ab,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",ac.join(""))};l.stroke=function(ah){var M=[];var N=false;var at=c(ah?this.fillStyle:this.strokeStyle);var ad=at.color;var an=at.alpha*this.globalAlpha;var J=10;var P=10;M.push("<g_vml_:shape",' filled="',!!ah,'"',' style="position:absolute;width:',J,"px;height:",P,'px;"',' coordorigin="0 0" coordsize="',a*J," ",a*P,'"',' stroked="',!ah,'"',' path="');var O=false;var ar={x:null,y:null};var Z={x:null,y:null};for(var am=0;am<this.currentPath_.length;am++){var al=this.currentPath_[am];var aq;switch(al.type){case"moveTo":aq=al;M.push(" m ",x(al.x),",",x(al.y));break;case"lineTo":M.push(" l ",x(al.x),",",x(al.y));break;case"close":M.push(" x ");al=null;break;case"bezierCurveTo":M.push(" c ",x(al.cp1x),",",x(al.cp1y),",",x(al.cp2x),",",x(al.cp2y),",",x(al.x),",",x(al.y));break;case"at":case"wa":M.push(" ",al.type," ",x(al.x-this.arcScaleX_*al.radius),",",x(al.y-this.arcScaleY_*al.radius)," ",x(al.x+this.arcScaleX_*al.radius),",",x(al.y+this.arcScaleY_*al.radius)," ",x(al.xStart),",",x(al.yStart)," ",x(al.xEnd),",",x(al.yEnd));break}if(al){if(ar.x==null||al.x<ar.x){ar.x=al.x}if(Z.x==null||al.x>Z.x){Z.x=al.x}if(ar.y==null||al.y<ar.y){ar.y=al.y}if(Z.y==null||al.y>Z.y){Z.y=al.y}}}M.push(' ">');if(!ah){var Y=this.lineScale_*this.lineWidth;if(Y<1){an*=Y}M.push("<g_vml_:stroke",' opacity="',an,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',u(this.lineCap),'"',' weight="',Y,'px"',' color="',ad,'" />')}else{if(typeof this.fillStyle=="object"){var Q=this.fillStyle;var V=0;var ak={x:0,y:0};var ae=0;var T=1;if(Q.type_=="gradient"){var S=Q.x0_/this.arcScaleX_;var m=Q.y0_/this.arcScaleY_;var R=Q.x1_/this.arcScaleX_;var au=Q.y1_/this.arcScaleY_;var ap=this.getCoords_(S,m);var ao=this.getCoords_(R,au);var L=ao.x-ap.x;var K=ao.y-ap.y;V=Math.atan2(L,K)*180/Math.PI;if(V<0){V+=360}if(V<0.000001){V=0}}else{var ap=this.getCoords_(Q.x0_,Q.y0_);var j=Z.x-ar.x;var I=Z.y-ar.y;ak={x:(ap.x-ar.x)/j,y:(ap.y-ar.y)/I};j/=this.arcScaleX_*a;I/=this.arcScaleY_*a;var aj=w.max(j,I);ae=2*Q.r0_/aj;T=2*Q.r1_/aj-ae}var ac=Q.colors_;ac.sort(function(W,H){return W.offset-H.offset});var X=ac.length;var ab=ac[0].color;var aa=ac[X-1].color;var ag=ac[0].alpha*this.globalAlpha;var af=ac[X-1].alpha*this.globalAlpha;var ai=[];for(var am=0;am<X;am++){var U=ac[am];ai.push(U.offset*T+ae+" "+U.color)}M.push('<g_vml_:fill type="',Q.type_,'"',' method="none" focus="100%"',' color="',ab,'"',' color2="',aa,'"',' colors="',ai.join(","),'"',' opacity="',af,'"',' g_o_:opacity2="',ag,'"',' angle="',V,'"',' focusposition="',ak.x,",",ak.y,'" />')}else{M.push('<g_vml_:fill color="',ad,'" opacity="',an,'" />')}}M.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",M.join(""))};l.fill=function(){this.stroke(true)};l.closePath=function(){this.currentPath_.push({type:"close"})};l.getCoords_=function(I,H){var j=this.m_;return{x:a*(I*j[0][0]+H*j[1][0]+j[2][0])-p,y:a*(I*j[0][1]+H*j[1][1]+j[2][1])-p}};l.save=function(){var j={};y(this,j);this.aStack_.push(j);this.mStack_.push(this.m_);this.m_=d(s(),this.m_)};l.restore=function(){y(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function g(H){for(var J=0;J<3;J++){for(var I=0;I<2;I++){if(!isFinite(H[J][I])||isNaN(H[J][I])){return false}}}return true}function C(H,j,I){if(!g(j)){return}H.m_=j;if(I){var J=j[0][0]*j[1][1]-j[0][1]*j[1][0];H.lineScale_=E(o(J))}}l.translate=function(H,m){var j=[[1,0,0],[0,1,0],[H,m,1]];C(this,d(j,this.m_),false)};l.rotate=function(m){var I=F(m);var H=t(m);var j=[[I,H,0],[-H,I,0],[0,0,1]];C(this,d(j,this.m_),false)};l.scale=function(H,m){this.arcScaleX_*=H;this.arcScaleY_*=m;var j=[[H,0,0],[0,m,0],[0,0,1]];C(this,d(j,this.m_),true)};l.transform=function(J,I,L,K,m,j){var H=[[J,I,0],[L,K,0],[m,j,1]];C(this,d(H,this.m_),true)};l.setTransform=function(K,J,M,L,I,H){var j=[[K,J,0],[M,L,0],[I,H,1]];C(this,j,true)};l.clip=function(){};l.arcTo=function(){};l.createPattern=function(){return new f};function B(j){this.type_=j;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[]}B.prototype.addColorStop=function(m,j){j=c(j);this.colors_.push({offset:m,color:j.color,alpha:j.alpha})};function f(){}G_vmlCanvasManager=k;CanvasRenderingContext2D=r;CanvasGradient=B;CanvasPattern=f})()}SimileAjax_urlPrefix=GeoTemCoMinifier_urlPrefix+"lib/simile/ajax/";if(typeof window.SimileAjax=="undefined"){window.SimileAjax={loadingScriptsCount:0,error:null,params:{bundle:"true"}};SimileAjax.Platform=new Object();SimileAjax.includeCssFile=function(c,a){var b=c.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);c.getElementsByTagName("head")[0].appendChild(b)};SimileAjax.urlPrefix=SimileAjax_urlPrefix}SimileAjax.version="2.2.1";SimileAjax.jQuery=jQuery.noConflict(true);if(typeof window["$"]=="undefined"){window.$=SimileAjax.jQuery}SimileAjax.Platform.os={isMac:false,isWin:false,isWin32:false,isUnix:false};SimileAjax.Platform.browser={isIE:false,isNetscape:false,isMozilla:false,isFirefox:false,isOpera:false,isSafari:false,majorVersion:0,minorVersion:0};(function(){var c=navigator.appName.toLowerCase();var a=navigator.userAgent.toLowerCase();SimileAjax.Platform.os.isMac=(a.indexOf("mac")!=-1);SimileAjax.Platform.os.isWin=(a.indexOf("win")!=-1);SimileAjax.Platform.os.isWin32=SimileAjax.Platform.isWin&&(a.indexOf("95")!=-1||a.indexOf("98")!=-1||a.indexOf("nt")!=-1||a.indexOf("win32")!=-1||a.indexOf("32bit")!=-1);SimileAjax.Platform.os.isUnix=(a.indexOf("x11")!=-1);SimileAjax.Platform.browser.isIE=(c.indexOf("microsoft")!=-1);SimileAjax.Platform.browser.isNetscape=(c.indexOf("netscape")!=-1);SimileAjax.Platform.browser.isMozilla=(a.indexOf("mozilla")!=-1);SimileAjax.Platform.browser.isFirefox=(a.indexOf("firefox")!=-1);SimileAjax.Platform.browser.isOpera=(c.indexOf("opera")!=-1);SimileAjax.Platform.browser.isSafari=(c.indexOf("safari")!=-1);var e=function(g){var f=g.split(".");SimileAjax.Platform.browser.majorVersion=parseInt(f[0]);SimileAjax.Platform.browser.minorVersion=parseInt(f[1])};var b=function(h,g,j){var f=h.indexOf(g,j);return f>=0?f:h.length};if(SimileAjax.Platform.browser.isMozilla){var d=a.indexOf("mozilla/");if(d>=0){e(a.substring(d+8,b(a," ",d)))}}if(SimileAjax.Platform.browser.isIE){var d=a.indexOf("msie ");if(d>=0){e(a.substring(d+5,b(a,";",d)))}}if(SimileAjax.Platform.browser.isNetscape){var d=a.indexOf("rv:");if(d>=0){e(a.substring(d+3,b(a,")",d)))}}if(SimileAjax.Platform.browser.isFirefox){var d=a.indexOf("firefox/");if(d>=0){e(a.substring(d+8,b(a," ",d)))}}if(!("localeCompare" in String.prototype)){String.prototype.localeCompare=function(f){if(this<f){return -1}else{if(this>f){return 1}else{return 0}}}}})();SimileAjax.Platform.getDefaultLocale=function(){return SimileAjax.Platform.clientLocale};SimileAjax.Debug={silent:false};SimileAjax.Debug.log=function(b){var a;if("console" in window&&"log" in window.console){a=function(c){console.log(c)}}else{a=function(c){if(!SimileAjax.Debug.silent){alert(c)}}}SimileAjax.Debug.log=a;a(b)};SimileAjax.Debug.warn=function(b){var a;if("console" in window&&"warn" in window.console){a=function(c){console.warn(c)}}else{a=function(c){if(!SimileAjax.Debug.silent){alert(c)}}}SimileAjax.Debug.warn=a;a(b)};SimileAjax.Debug.exception=function(b,d){var a,c=SimileAjax.parseURLParameters();if(c.errors=="throw"||SimileAjax.params.errors=="throw"){a=function(f,e){throw (f)}}else{if("console" in window&&"error" in window.console){a=function(f,e){if(e!=null){console.error(e+" %o",f)}else{console.error(f)}throw (f)}}else{a=function(f,e){if(!SimileAjax.Debug.silent){alert("Caught exception: "+e+"\n\nDetails: "+("description" in f?f.description:f))}throw (f)}}}SimileAjax.Debug.exception=a;a(b,d)};SimileAjax.Debug.objectToString=function(a){return SimileAjax.Debug._objectToString(a,"")};SimileAjax.Debug._objectToString=function(d,a){var c=a+" ";if(typeof d=="object"){var b="{";for(e in d){b+=c+e+": "+SimileAjax.Debug._objectToString(d[e],c)+"\n"}b+=a+"}";return b}else{if(typeof d=="array"){var b="[";for(var e=0;e<d.length;e++){b+=SimileAjax.Debug._objectToString(d[e],c)+"\n"}b+=a+"]";return b}else{return d}}};SimileAjax.XmlHttp=new Object();SimileAjax.XmlHttp._onReadyStateChange=function(a,d,b){switch(a.readyState){case 4:try{if(a.status==0||a.status==200){if(b){b(a)}}else{if(d){d(a.statusText,a.status,a)}}}catch(c){SimileAjax.Debug.exception("XmlHttp: Error handling onReadyStateChange",c)}break}};SimileAjax.XmlHttp._createRequest=function(){if(SimileAjax.Platform.browser.isIE){var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];for(var b=0;b<a.length;b++){try{var c=a[b];var d=function(){return new ActiveXObject(c)};var h=d();SimileAjax.XmlHttp._createRequest=d;return h}catch(g){}}}try{var d=function(){return new XMLHttpRequest()};var h=d();SimileAjax.XmlHttp._createRequest=d;return h}catch(g){throw new Error("Failed to create an XMLHttpRequest object")}};SimileAjax.XmlHttp.get=function(a,d,c){var b=SimileAjax.XmlHttp._createRequest();b.open("GET",a,true);b.onreadystatechange=function(){SimileAjax.XmlHttp._onReadyStateChange(b,d,c)};b.send(null)};SimileAjax.XmlHttp.post=function(b,a,e,d){var c=SimileAjax.XmlHttp._createRequest();c.open("POST",b,true);c.onreadystatechange=function(){SimileAjax.XmlHttp._onReadyStateChange(c,e,d)};c.send(a)};SimileAjax.XmlHttp._forceXML=function(a){try{a.overrideMimeType("text/xml")}catch(b){a.setrequestheader("Content-Type","text/xml")}};SimileAjax.JSON=new Object();(function(){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var s={array:function(x){var a=["["],b,f,i,l=x.length,v;for(i=0;i<l;i+=1){v=x[i];f=s[typeof v];if(f){v=f(v);if(typeof v=="string"){if(b){a[a.length]=","}a[a.length]=v;b=true}}}a[a.length]="]";return a.join("")},"boolean":function(x){return String(x)},"null":function(x){return"null"},number:function(x){return isFinite(x)?String(x):"null"},object:function(x){if(x){if(x instanceof Array){return s.array(x)}var a=["{"],b,f,i,v;for(i in x){v=x[i];f=s[typeof v];if(f){v=f(v);if(typeof v=="string"){if(b){a[a.length]=","}a.push(s.string(i),":",v);b=true}}}a[a.length]="}";return a.join("")}return"null"},string:function(x){if(/["\\\x00-\x1f]/.test(x)){x=x.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c}c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})}return'"'+x+'"'}};SimileAjax.JSON.toJSONString=function(o){if(o instanceof Object){return s.object(o)}else{if(o instanceof Array){return s.array(o)}else{return o.toString()}}};SimileAjax.JSON.parseJSON=function(){try{return !(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(this.replace(/"(\\.|[^"\\])*"/g,"")))&&eval("("+this+")")}catch(e){return false}}})();SimileAjax.DOM=new Object();SimileAjax.DOM.registerEventWithObject=function(c,a,d,b){SimileAjax.DOM.registerEvent(c,a,function(f,e,g){return d[b].call(d,f,e,g)})};SimileAjax.DOM.registerEvent=function(c,b,d){var a=function(e){e=(e)?e:((event)?event:null);if(e){var f=(e.target)?e.target:((e.srcElement)?e.srcElement:null);if(f){f=(f.nodeType==1||f.nodeType==9)?f:f.parentNode}return d(c,e,f)}return true};if(SimileAjax.Platform.browser.isIE){c.attachEvent("on"+b,a)}else{c.addEventListener(b,a,false)}};SimileAjax.DOM.getPageCoordinates=function(b){var e=0;var d=0;if(b.nodeType!=1){b=b.parentNode}var c=b;while(c!=null){e+=c.offsetLeft;d+=c.offsetTop;c=c.offsetParent}var a=document.body;while(b!=null&&b!=a){if("scrollLeft" in b){e-=b.scrollLeft;d-=b.scrollTop}b=b.parentNode}return{left:e,top:d}};SimileAjax.DOM.getSize=function(b){var a=this.getStyle(b,"width");var c=this.getStyle(b,"height");if(a.indexOf("px")>-1){a=a.replace("px","")}if(c.indexOf("px")>-1){c=c.replace("px","")}return{w:a,h:c}};SimileAjax.DOM.getStyle=function(b,a){if(b.currentStyle){var c=b.currentStyle[a]}else{if(window.getComputedStyle){var c=document.defaultView.getComputedStyle(b,null).getPropertyValue(a)}else{var c=""}}return c};SimileAjax.DOM.getEventRelativeCoordinates=function(a,b){if(SimileAjax.Platform.browser.isIE){if(a.type=="mousewheel"){var c=SimileAjax.DOM.getPageCoordinates(b);return{x:a.clientX-c.left,y:a.clientY-c.top}}else{return{x:a.offsetX,y:a.offsetY}}}else{var c=SimileAjax.DOM.getPageCoordinates(b);if((a.type=="DOMMouseScroll")&&SimileAjax.Platform.browser.isFirefox&&(SimileAjax.Platform.browser.majorVersion==2)){return{x:a.screenX-c.left,y:a.screenY-c.top}}else{return{x:a.pageX-c.left,y:a.pageY-c.top}}}};SimileAjax.DOM.getEventPageCoordinates=function(a){if(SimileAjax.Platform.browser.isIE){return{x:a.clientX+document.body.scrollLeft,y:a.clientY+document.body.scrollTop}}else{return{x:a.pageX,y:a.pageY}}};SimileAjax.DOM.hittest=function(a,c,b){return SimileAjax.DOM._hittest(document.body,a,c,b)};SimileAjax.DOM._hittest=function(c,o,m,h){var p=c.childNodes;outer:for(var g=0;g<p.length;g++){var a=p[g];for(var f=0;f<h.length;f++){if(a==h[f]){continue outer}}if(a.offsetWidth==0&&a.offsetHeight==0){var b=SimileAjax.DOM._hittest(a,o,m,h);if(b!=a){return b}}else{var l=0;var e=0;var d=a;while(d){l+=d.offsetTop;e+=d.offsetLeft;d=d.offsetParent}if(e<=o&&l<=m&&(o-e)<a.offsetWidth&&(m-l)<a.offsetHeight){return SimileAjax.DOM._hittest(a,o,m,h)}else{if(a.nodeType==1&&a.tagName=="TR"){var k=SimileAjax.DOM._hittest(a,o,m,h);if(k!=a){return k}}}}}return c};SimileAjax.DOM.cancelEvent=function(a){a.returnValue=false;a.cancelBubble=true;if("preventDefault" in a){a.preventDefault()}};SimileAjax.DOM.appendClassName=function(c,d){var b=c.className.split(" ");for(var a=0;a<b.length;a++){if(b[a]==d){return}}b.push(d);c.className=b.join(" ")};SimileAjax.DOM.createInputElement=function(a){var b=document.createElement("div");b.innerHTML="<input type='"+a+"' />";return b.firstChild};SimileAjax.DOM.createDOMFromTemplate=function(b){var a={};a.elmt=SimileAjax.DOM._createDOMFromTemplate(b,a,null);return a};SimileAjax.DOM._createDOMFromTemplate=function(a,j,e){if(a==null){return null}else{if(typeof a!="object"){var d=document.createTextNode(a);if(e!=null){e.appendChild(d)}return d}else{var c=null;if("tag" in a){var k=a.tag;if(e!=null){if(k=="tr"){c=e.insertRow(e.rows.length)}else{if(k=="td"){c=e.insertCell(e.cells.length)}}}if(c==null){c=k=="input"?SimileAjax.DOM.createInputElement(a.type):document.createElement(k);if(e!=null){e.appendChild(c)}}}else{c=a.elmt;if(e!=null){e.appendChild(c)}}for(var b in a){var g=a[b];if(b=="field"){j[g]=c}else{if(b=="className"){c.className=g}else{if(b=="id"){c.id=g}else{if(b=="title"){c.title=g}else{if(b=="type"&&c.tagName=="input"){}else{if(b=="style"){for(n in g){var h=g[n];if(n=="float"){n=SimileAjax.Platform.browser.isIE?"styleFloat":"cssFloat"}c.style[n]=h}}else{if(b=="children"){for(var f=0;f<g.length;f++){SimileAjax.DOM._createDOMFromTemplate(g[f],j,c)}}else{if(b!="tag"&&b!="elmt"){c.setAttribute(b,g)}}}}}}}}}return c}}};SimileAjax.DOM._cachedParent=null;SimileAjax.DOM.createElementFromString=function(a){if(SimileAjax.DOM._cachedParent==null){SimileAjax.DOM._cachedParent=document.createElement("div")}SimileAjax.DOM._cachedParent.innerHTML=a;return SimileAjax.DOM._cachedParent.firstChild};SimileAjax.DOM.createDOMFromString=function(a,c,d){var b=typeof a=="string"?document.createElement(a):a;b.innerHTML=c;var e={elmt:b};SimileAjax.DOM._processDOMChildrenConstructedFromString(e,b,d!=null?d:{});return e};SimileAjax.DOM._processDOMConstructedFromString=function(d,a,b){var e=a.id;if(e!=null&&e.length>0){a.removeAttribute("id");if(e in b){var c=a.parentNode;c.insertBefore(b[e],a);c.removeChild(a);d[e]=b[e];return}else{d[e]=a}}if(a.hasChildNodes()){SimileAjax.DOM._processDOMChildrenConstructedFromString(d,a,b)}};SimileAjax.DOM._processDOMChildrenConstructedFromString=function(e,b,d){var c=b.firstChild;while(c!=null){var a=c.nextSibling;if(c.nodeType==1){SimileAjax.DOM._processDOMConstructedFromString(e,c,d)}c=a}};SimileAjax.Graphics=new Object();SimileAjax.Graphics.pngIsTranslucent=(!SimileAjax.Platform.browser.isIE)||(SimileAjax.Platform.browser.majorVersion>6);if(!SimileAjax.Graphics.pngIsTranslucent){SimileAjax.includeCssFile(document,SimileAjax.urlPrefix+"styles/graphics-ie6.css")}SimileAjax.Graphics._createTranslucentImage1=function(a,c){var b=document.createElement("img");b.setAttribute("src",a);if(c!=null){b.style.verticalAlign=c}return b};SimileAjax.Graphics._createTranslucentImage2=function(a,c){var b=document.createElement("img");b.style.width="1px";b.style.height="1px";b.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='image')";b.style.verticalAlign=(c!=null)?c:"middle";return b};SimileAjax.Graphics.createTranslucentImage=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImage1:SimileAjax.Graphics._createTranslucentImage2;SimileAjax.Graphics._createTranslucentImageHTML1=function(a,b){return'<img src="'+a+'"'+(b!=null?' style="vertical-align: '+b+';"':"")+" />"};SimileAjax.Graphics._createTranslucentImageHTML2=function(a,c){var b="width: 1px; height: 1px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='image');"+(c!=null?" vertical-align: "+c+";":"");return"<img src='"+a+"' style=\""+b+'" />'};SimileAjax.Graphics.createTranslucentImageHTML=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImageHTML1:SimileAjax.Graphics._createTranslucentImageHTML2;SimileAjax.Graphics.setOpacity=function(b,a){if(SimileAjax.Platform.browser.isIE){b.style.filter="progid:DXImageTransform.Microsoft.Alpha(Style=0,Opacity="+a+")"}else{var c=(a/100).toString();b.style.opacity=c;b.style.MozOpacity=c}};SimileAjax.Graphics.bubbleConfig={containerCSSClass:"simileAjax-bubble-container",innerContainerCSSClass:"simileAjax-bubble-innerContainer",contentContainerCSSClass:"simileAjax-bubble-contentContainer",borderGraphicSize:50,borderGraphicCSSClassPrefix:"simileAjax-bubble-border-",arrowGraphicTargetOffset:33,arrowGraphicLength:100,arrowGraphicWidth:49,arrowGraphicCSSClassPrefix:"simileAjax-bubble-arrow-",closeGraphicCSSClass:"simileAjax-bubble-close",extraPadding:20};SimileAjax.Graphics.createBubbleForContentAndPoint=function(f,d,c,a,b,e){if(typeof a!="number"){a=300}if(typeof e!="number"){e=0}f.style.position="absolute";f.style.left="-5000px";f.style.top="0px";f.style.width=a+"px";document.body.appendChild(f);window.setTimeout(function(){var k=f.scrollWidth+10;var g=f.scrollHeight+10;var j=0;if(e>0&&g>e){g=e;j=k-25}var h=SimileAjax.Graphics.createBubbleForPoint(d,c,k,g,b);document.body.removeChild(f);f.style.position="static";f.style.left="";f.style.top="";if(j>0){var l=document.createElement("div");f.style.width="";l.style.width=j+"px";l.appendChild(f);h.content.appendChild(l)}else{f.style.width=k+"px";h.content.appendChild(f)}},200)};SimileAjax.Graphics.createBubbleForPoint=function(b,a,l,o,d){l=parseInt(l,10);o=parseInt(o,10);var e=SimileAjax.Graphics.bubbleConfig;var p=SimileAjax.Graphics.pngIsTranslucent?"pngTranslucent":"pngNotTranslucent";var m=l+2*e.borderGraphicSize;var r=o+2*e.borderGraphicSize;var q=function(u){return u+" "+u+"-"+p};var h=document.createElement("div");h.className=q(e.containerCSSClass);h.style.width=l+"px";h.style.height=o+"px";var f=document.createElement("div");f.className=q(e.innerContainerCSSClass);h.appendChild(f);var j=function(){if(!k._closed){document.body.removeChild(k._div);k._doc=null;k._div=null;k._content=null;k._closed=true}};var k={_closed:false};var t=SimileAjax.WindowManager.pushLayer(j,true,h);k._div=h;k.close=function(){SimileAjax.WindowManager.popLayer(t)};var g=function(v){var u=document.createElement("div");u.className=q(e.borderGraphicCSSClassPrefix+v);f.appendChild(u)};g("top-left");g("top-right");g("bottom-left");g("bottom-right");g("left");g("right");g("top");g("bottom");var c=document.createElement("div");c.className=q(e.contentContainerCSSClass);f.appendChild(c);k.content=c;var s=document.createElement("div");s.className=q(e.closeGraphicCSSClass);f.appendChild(s);SimileAjax.WindowManager.registerEventWithObject(s,"click",k,"close");(function(){var B=SimileAjax.Graphics.getWindowDimensions();var w=B.w;var u=B.h;var x=Math.ceil(e.arrowGraphicWidth/2);var A=function(C){var D=document.createElement("div");D.className=q(e.arrowGraphicCSSClassPrefix+"point-"+C);f.appendChild(D);return D};if(b-x-e.borderGraphicSize-e.extraPadding>0&&b+x+e.borderGraphicSize+e.extraPadding<w){var z=b-Math.round(l/2);z=b<(w/2)?Math.max(z,e.extraPadding+e.borderGraphicSize):Math.min(z,w-e.extraPadding-e.borderGraphicSize-l);if((d&&d=="top")||(!d&&(a-e.arrowGraphicTargetOffset-o-e.borderGraphicSize-e.extraPadding>0))){var v=A("down");v.style.left=(b-x-z)+"px";h.style.left=z+"px";h.style.top=(a-e.arrowGraphicTargetOffset-o)+"px";return}else{if((d&&d=="bottom")||(!d&&(a+e.arrowGraphicTargetOffset+o+e.borderGraphicSize+e.extraPadding<u))){var v=A("up");v.style.left=(b-x-z)+"px";h.style.left=z+"px";h.style.top=(a+e.arrowGraphicTargetOffset)+"px";return}}}var y=a-Math.round(o/2);y=a<(u/2)?Math.max(y,e.extraPadding+e.borderGraphicSize):Math.min(y,u-e.extraPadding-e.borderGraphicSize-o);if((d&&d=="left")||(!d&&(b-e.arrowGraphicTargetOffset-l-e.borderGraphicSize-e.extraPadding>0))){var v=A("right");v.style.top=(a-x-y)+"px";h.style.top=y+"px";h.style.left=(b-e.arrowGraphicTargetOffset-l)+"px"}else{var v=A("left");v.style.top=(a-x-y)+"px";h.style.top=y+"px";h.style.left=(b+e.arrowGraphicTargetOffset)+"px"}})();document.body.appendChild(h);return k};SimileAjax.Graphics.getWindowDimensions=function(){if(typeof window.innerHeight=="number"){return{w:window.innerWidth,h:window.innerHeight}}else{if(document.documentElement&&document.documentElement.clientHeight){return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}else{if(document.body&&document.body.clientHeight){return{w:document.body.clientWidth,h:document.body.clientHeight}}}}};SimileAjax.Graphics.createMessageBubble=function(h){var g=h.createElement("div");if(SimileAjax.Graphics.pngIsTranslucent){var j=h.createElement("div");j.style.height="33px";j.style.background="url("+SimileAjax.urlPrefix+"images/message-top-left.png) top left no-repeat";j.style.paddingLeft="44px";g.appendChild(j);var c=h.createElement("div");c.style.height="33px";c.style.background="url("+SimileAjax.urlPrefix+"images/message-top-right.png) top right no-repeat";j.appendChild(c);var f=h.createElement("div");f.style.background="url("+SimileAjax.urlPrefix+"images/message-left.png) top left repeat-y";f.style.paddingLeft="44px";g.appendChild(f);var a=h.createElement("div");a.style.background="url("+SimileAjax.urlPrefix+"images/message-right.png) top right repeat-y";a.style.paddingRight="44px";f.appendChild(a);var d=h.createElement("div");a.appendChild(d);var b=h.createElement("div");b.style.height="55px";b.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-left.png) bottom left no-repeat";b.style.paddingLeft="44px";g.appendChild(b);var e=h.createElement("div");e.style.height="55px";e.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-right.png) bottom right no-repeat";b.appendChild(e)}else{g.style.border="2px solid #7777AA";g.style.padding="20px";g.style.background="white";SimileAjax.Graphics.setOpacity(g,90);var d=h.createElement("div");g.appendChild(d)}return{containerDiv:g,contentDiv:d}};SimileAjax.Graphics.createAnimation=function(b,e,d,c,a){return new SimileAjax.Graphics._Animation(b,e,d,c,a)};SimileAjax.Graphics._Animation=function(b,e,d,c,a){this.f=b;this.cont=(typeof a=="function")?a:function(){};this.from=e;this.to=d;this.current=e;this.duration=c;this.start=new Date().getTime();this.timePassed=0};SimileAjax.Graphics._Animation.prototype.run=function(){var b=this;window.setTimeout(function(){b.step()},50)};SimileAjax.Graphics._Animation.prototype.step=function(){this.timePassed+=50;var b=this.timePassed/this.duration;var a=-Math.cos(b*Math.PI)/2+0.5;var d=a*(this.to-this.from)+this.from;try{this.f(d,d-this.current)}catch(c){}this.current=d;if(this.timePassed<this.duration){this.run()}else{this.f(this.to,0);this["cont"]()}};SimileAjax.Graphics.createStructuredDataCopyButton=function(f,d,a,e){var g=document.createElement("div");g.style.position="relative";g.style.display="inline";g.style.width=d+"px";g.style.height=a+"px";g.style.overflow="hidden";g.style.margin="2px";if(SimileAjax.Graphics.pngIsTranslucent){g.style.background="url("+f+") no-repeat"}else{g.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+f+"', sizingMethod='image')"}var c;if(SimileAjax.Platform.browser.isIE){c="filter:alpha(opacity=0)"}else{c="opacity: 0"}g.innerHTML="<textarea rows='1' autocomplete='off' value='none' style='"+c+"' />";var b=g.firstChild;b.style.width=d+"px";b.style.height=a+"px";b.onmousedown=function(h){h=(h)?h:((event)?event:null);if(h.button==2){b.value=e();b.select()}};return g};SimileAjax.Graphics.getWidthHeight=function(c){var a,b;if(c.getBoundingClientRect==null){a=c.offsetWidth;b=c.offsetHeight}else{var d=c.getBoundingClientRect();a=Math.ceil(d.right-d.left);b=Math.ceil(d.bottom-d.top)}return{width:a,height:b}};SimileAjax.Graphics.getFontRenderingContext=function(a,b){return new SimileAjax.Graphics._FontRenderingContext(a,b)};SimileAjax.Graphics._FontRenderingContext=function(a,b){this._elmt=a;this._elmt.style.visibility="hidden";if(typeof b=="string"){this._elmt.style.width=b}else{if(typeof b=="number"){this._elmt.style.width=b+"px"}}};SimileAjax.Graphics._FontRenderingContext.prototype.dispose=function(){this._elmt=null};SimileAjax.Graphics._FontRenderingContext.prototype.update=function(){this._elmt.innerHTML="A";this._lineHeight=this._elmt.offsetHeight};SimileAjax.Graphics._FontRenderingContext.prototype.computeSize=function(d,c){var b=this._elmt;b.innerHTML=d;b.className=c===undefined?"":c;var a=SimileAjax.Graphics.getWidthHeight(b);b.className="";return a};SimileAjax.Graphics._FontRenderingContext.prototype.getLineHeight=function(){return this._lineHeight};SimileAjax.DateTime=new Object();SimileAjax.DateTime.MILLISECOND=0;SimileAjax.DateTime.SECOND=1;SimileAjax.DateTime.MINUTE=2;SimileAjax.DateTime.HOUR=3;SimileAjax.DateTime.DAY=4;SimileAjax.DateTime.WEEK=5;SimileAjax.DateTime.MONTH=6;SimileAjax.DateTime.YEAR=7;SimileAjax.DateTime.DECADE=8;SimileAjax.DateTime.CENTURY=9;SimileAjax.DateTime.MILLENNIUM=10;SimileAjax.DateTime.EPOCH=-1;SimileAjax.DateTime.ERA=-2;SimileAjax.DateTime.gregorianUnitLengths=[];(function(){var c=SimileAjax.DateTime;var b=c.gregorianUnitLengths;b[c.MILLISECOND]=1;b[c.SECOND]=1000;b[c.MINUTE]=b[c.SECOND]*60;b[c.HOUR]=b[c.MINUTE]*60;b[c.DAY]=b[c.HOUR]*24;b[c.WEEK]=b[c.DAY]*7;b[c.MONTH]=b[c.DAY]*31;b[c.YEAR]=b[c.DAY]*365;b[c.DECADE]=b[c.YEAR]*10;b[c.CENTURY]=b[c.YEAR]*100;b[c.MILLENNIUM]=b[c.YEAR]*1000})();SimileAjax.DateTime._dateRegexp=new RegExp("^(-?)([0-9]{4})("+["(-?([0-9]{2})(-?([0-9]{2}))?)","(-?([0-9]{3}))","(-?W([0-9]{2})(-?([1-7]))?)"].join("|")+")?$");SimileAjax.DateTime._timezoneRegexp=new RegExp("Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$");SimileAjax.DateTime._timeRegexp=new RegExp("^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$");SimileAjax.DateTime.setIso8601Date=function(j,g){var k=g.match(SimileAjax.DateTime._dateRegexp);if(!k){throw new Error("Invalid date string: "+g)}var b=(k[1]=="-")?-1:1;var l=b*k[2];var h=k[5];var c=k[7];var f=k[9];var a=k[11];var p=(k[13])?k[13]:1;j.setUTCFullYear(l);if(f){j.setUTCMonth(0);j.setUTCDate(Number(f))}else{if(a){j.setUTCMonth(0);j.setUTCDate(1);var o=j.getUTCDay();var m=(o)?o:7;var e=Number(p)+(7*Number(a));if(m<=4){j.setUTCDate(e+1-m)}else{j.setUTCDate(e+8-m)}}else{if(h){j.setUTCDate(1);j.setUTCMonth(h-1)}if(c){j.setUTCDate(c)}}}return j};SimileAjax.DateTime.setIso8601Time=function(g,c){var h=c.match(SimileAjax.DateTime._timeRegexp);if(!h){SimileAjax.Debug.warn("Invalid time string: "+c);return false}var a=h[1];var f=Number((h[3])?h[3]:0);var e=(h[5])?h[5]:0;var b=h[7]?(Number("0."+h[7])*1000):0;g.setUTCHours(a);g.setUTCMinutes(f);g.setUTCSeconds(e);g.setUTCMilliseconds(b);return g};SimileAjax.DateTime.timezoneOffset=new Date().getTimezoneOffset();SimileAjax.DateTime.setIso8601=function(b,a){var e=null;var f=(a.indexOf("T")==-1)?a.split(" "):a.split("T");SimileAjax.DateTime.setIso8601Date(b,f[0]);if(f.length==2){var c=f[1].match(SimileAjax.DateTime._timezoneRegexp);if(c){if(c[0]=="Z"){e=0}else{e=(Number(c[3])*60)+Number(c[5]);e*=((c[2]=="-")?1:-1)}f[1]=f[1].substr(0,f[1].length-c[0].length)}SimileAjax.DateTime.setIso8601Time(b,f[1])}if(e==null){e=b.getTimezoneOffset()}b.setTime(b.getTime()+e*60000);return b};SimileAjax.DateTime.parseIso8601DateTime=function(a){try{return SimileAjax.DateTime.setIso8601(new Date(0),a)}catch(b){return null}};SimileAjax.DateTime.parseGregorianDateTime=function(j){if(j==null){return null}else{if(j instanceof Date){return j}}var b=j.toString();if(b.length>0&&b.length<8){var c=b.indexOf(" ");if(c>0){var a=parseInt(b.substr(0,c));var g=b.substr(c+1);if(g.toLowerCase()=="bc"){a=1-a}}else{var a=parseInt(b)}var h=new Date(0);h.setUTCFullYear(a);return h}try{return new Date(Date.parse(b))}catch(f){return null}};SimileAjax.DateTime.roundDownToInterval=function(b,h,l,m,a){var e=l*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var k=new Date(b.getTime()+e);var f=function(o){o.setUTCMilliseconds(0);o.setUTCSeconds(0);o.setUTCMinutes(0);o.setUTCHours(0)};var c=function(o){f(o);o.setUTCDate(1);o.setUTCMonth(0)};switch(h){case SimileAjax.DateTime.MILLISECOND:var j=k.getUTCMilliseconds();k.setUTCMilliseconds(j-(j%m));break;case SimileAjax.DateTime.SECOND:k.setUTCMilliseconds(0);var j=k.getUTCSeconds();k.setUTCSeconds(j-(j%m));break;case SimileAjax.DateTime.MINUTE:k.setUTCMilliseconds(0);k.setUTCSeconds(0);var j=k.getUTCMinutes();k.setTime(k.getTime()-(j%m)*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:k.setUTCMilliseconds(0);k.setUTCSeconds(0);k.setUTCMinutes(0);var j=k.getUTCHours();k.setUTCHours(j-(j%m));break;case SimileAjax.DateTime.DAY:f(k);break;case SimileAjax.DateTime.WEEK:f(k);var g=(k.getUTCDay()+7-a)%7;k.setTime(k.getTime()-g*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY]);break;case SimileAjax.DateTime.MONTH:f(k);k.setUTCDate(1);var j=k.getUTCMonth();k.setUTCMonth(j-(j%m));break;case SimileAjax.DateTime.YEAR:c(k);var j=k.getUTCFullYear();k.setUTCFullYear(j-(j%m));break;case SimileAjax.DateTime.DECADE:c(k);k.setUTCFullYear(Math.floor(k.getUTCFullYear()/10)*10);break;case SimileAjax.DateTime.CENTURY:c(k);k.setUTCFullYear(Math.floor(k.getUTCFullYear()/100)*100);break;case SimileAjax.DateTime.MILLENNIUM:c(k);k.setUTCFullYear(Math.floor(k.getUTCFullYear()/1000)*1000);break}b.setTime(k.getTime()-e)};SimileAjax.DateTime.roundUpToInterval=function(d,f,c,a,b){var e=d.getTime();SimileAjax.DateTime.roundDownToInterval(d,f,c,a,b);if(d.getTime()<e){d.setTime(d.getTime()+SimileAjax.DateTime.gregorianUnitLengths[f]*a)}};SimileAjax.DateTime.incrementByInterval=function(b,e,a){a=(typeof a=="undefined")?0:a;var d=a*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var c=new Date(b.getTime()+d);switch(e){case SimileAjax.DateTime.MILLISECOND:c.setTime(c.getTime()+1);break;case SimileAjax.DateTime.SECOND:c.setTime(c.getTime()+1000);break;case SimileAjax.DateTime.MINUTE:c.setTime(c.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:c.setTime(c.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR]);break;case SimileAjax.DateTime.DAY:c.setUTCDate(c.getUTCDate()+1);break;case SimileAjax.DateTime.WEEK:c.setUTCDate(c.getUTCDate()+7);break;case SimileAjax.DateTime.MONTH:c.setUTCMonth(c.getUTCMonth()+1);break;case SimileAjax.DateTime.YEAR:c.setUTCFullYear(c.getUTCFullYear()+1);break;case SimileAjax.DateTime.DECADE:c.setUTCFullYear(c.getUTCFullYear()+10);break;case SimileAjax.DateTime.CENTURY:c.setUTCFullYear(c.getUTCFullYear()+100);break;case SimileAjax.DateTime.MILLENNIUM:c.setUTCFullYear(c.getUTCFullYear()+1000);break}b.setTime(c.getTime()-d)};SimileAjax.DateTime.removeTimeZoneOffset=function(b,a){return new Date(b.getTime()+a*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR])};SimileAjax.DateTime.getTimezone=function(){var a=new Date().getTimezoneOffset();return a/-60};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.startsWith=function(a){return this.length>=a.length&&this.substr(0,a.length)==a};String.prototype.endsWith=function(a){return this.length>=a.length&&this.substr(this.length-a.length)==a};String.substitute=function(b,d){var a="";var f=0;while(f<b.length-1){var c=b.indexOf("%",f);if(c<0||c==b.length-1){break}else{if(c>f&&b.charAt(c-1)=="\\"){a+=b.substring(f,c-1)+"%";f=c+1}else{var e=parseInt(b.charAt(c+1));if(isNaN(e)||e>=d.length){a+=b.substring(f,c+2)}else{a+=b.substring(f,c)+d[e].toString()}f=c+2}}}if(f<b.length){a+=b.substring(f)}return a};SimileAjax.HTML=new Object();SimileAjax.HTML._e2uHash={};(function(){var a=SimileAjax.HTML._e2uHash;a.nbsp="\u00A0[space]";a.iexcl="\u00A1";a.cent="\u00A2";a.pound="\u00A3";a.curren="\u00A4";a.yen="\u00A5";a.brvbar="\u00A6";a.sect="\u00A7";a.uml="\u00A8";a.copy="\u00A9";a.ordf="\u00AA";a.laquo="\u00AB";a.not="\u00AC";a.shy="\u00AD";a.reg="\u00AE";a.macr="\u00AF";a.deg="\u00B0";a.plusmn="\u00B1";a.sup2="\u00B2";a.sup3="\u00B3";a.acute="\u00B4";a.micro="\u00B5";a.para="\u00B6";a.middot="\u00B7";a.cedil="\u00B8";a.sup1="\u00B9";a.ordm="\u00BA";a.raquo="\u00BB";a.frac14="\u00BC";a.frac12="\u00BD";a.frac34="\u00BE";a.iquest="\u00BF";a.Agrave="\u00C0";a.Aacute="\u00C1";a.Acirc="\u00C2";a.Atilde="\u00C3";a.Auml="\u00C4";a.Aring="\u00C5";a.AElig="\u00C6";a.Ccedil="\u00C7";a.Egrave="\u00C8";a.Eacute="\u00C9";a.Ecirc="\u00CA";a.Euml="\u00CB";a.Igrave="\u00CC";a.Iacute="\u00CD";a.Icirc="\u00CE";a.Iuml="\u00CF";a.ETH="\u00D0";a.Ntilde="\u00D1";a.Ograve="\u00D2";a.Oacute="\u00D3";a.Ocirc="\u00D4";a.Otilde="\u00D5";a.Ouml="\u00D6";a.times="\u00D7";a.Oslash="\u00D8";a.Ugrave="\u00D9";a.Uacute="\u00DA";a.Ucirc="\u00DB";a.Uuml="\u00DC";a.Yacute="\u00DD";a.THORN="\u00DE";a.szlig="\u00DF";a.agrave="\u00E0";a.aacute="\u00E1";a.acirc="\u00E2";a.atilde="\u00E3";a.auml="\u00E4";a.aring="\u00E5";a.aelig="\u00E6";a.ccedil="\u00E7";a.egrave="\u00E8";a.eacute="\u00E9";a.ecirc="\u00EA";a.euml="\u00EB";a.igrave="\u00EC";a.iacute="\u00ED";a.icirc="\u00EE";a.iuml="\u00EF";a.eth="\u00F0";a.ntilde="\u00F1";a.ograve="\u00F2";a.oacute="\u00F3";a.ocirc="\u00F4";a.otilde="\u00F5";a.ouml="\u00F6";a.divide="\u00F7";a.oslash="\u00F8";a.ugrave="\u00F9";a.uacute="\u00FA";a.ucirc="\u00FB";a.uuml="\u00FC";a.yacute="\u00FD";a.thorn="\u00FE";a.yuml="\u00FF";a.quot="\u0022";a.amp="\u0026";a.lt="\u003C";a.gt="\u003E";a.OElig="";a.oelig="\u0153";a.Scaron="\u0160";a.scaron="\u0161";a.Yuml="\u0178";a.circ="\u02C6";a.tilde="\u02DC";a.ensp="\u2002";a.emsp="\u2003";a.thinsp="\u2009";a.zwnj="\u200C";a.zwj="\u200D";a.lrm="\u200E";a.rlm="\u200F";a.ndash="\u2013";a.mdash="\u2014";a.lsquo="\u2018";a.rsquo="\u2019";a.sbquo="\u201A";a.ldquo="\u201C";a.rdquo="\u201D";a.bdquo="\u201E";a.dagger="\u2020";a.Dagger="\u2021";a.permil="\u2030";a.lsaquo="\u2039";a.rsaquo="\u203A";a.euro="\u20AC";a.fnof="\u0192";a.Alpha="\u0391";a.Beta="\u0392";a.Gamma="\u0393";a.Delta="\u0394";a.Epsilon="\u0395";a.Zeta="\u0396";a.Eta="\u0397";a.Theta="\u0398";a.Iota="\u0399";a.Kappa="\u039A";a.Lambda="\u039B";a.Mu="\u039C";a.Nu="\u039D";a.Xi="\u039E";a.Omicron="\u039F";a.Pi="\u03A0";a.Rho="\u03A1";a.Sigma="\u03A3";a.Tau="\u03A4";a.Upsilon="\u03A5";a.Phi="\u03A6";a.Chi="\u03A7";a.Psi="\u03A8";a.Omega="\u03A9";a.alpha="\u03B1";a.beta="\u03B2";a.gamma="\u03B3";a.delta="\u03B4";a.epsilon="\u03B5";a.zeta="\u03B6";a.eta="\u03B7";a.theta="\u03B8";a.iota="\u03B9";a.kappa="\u03BA";a.lambda="\u03BB";a.mu="\u03BC";a.nu="\u03BD";a.xi="\u03BE";a.omicron="\u03BF";a.pi="\u03C0";a.rho="\u03C1";a.sigmaf="\u03C2";a.sigma="\u03C3";a.tau="\u03C4";a.upsilon="\u03C5";a.phi="\u03C6";a.chi="\u03C7";a.psi="\u03C8";a.omega="\u03C9";a.thetasym="\u03D1";a.upsih="\u03D2";a.piv="\u03D6";a.bull="\u2022";a.hellip="\u2026";a.prime="\u2032";a.Prime="\u2033";a.oline="\u203E";a.frasl="\u2044";a.weierp="\u2118";a.image="\u2111";a.real="\u211C";a.trade="\u2122";a.alefsym="\u2135";a.larr="\u2190";a.uarr="\u2191";a.rarr="\u2192";a.darr="\u2193";a.harr="\u2194";a.crarr="\u21B5";a.lArr="\u21D0";a.uArr="\u21D1";a.rArr="\u21D2";a.dArr="\u21D3";a.hArr="\u21D4";a.forall="\u2200";a.part="\u2202";a.exist="\u2203";a.empty="\u2205";a.nabla="\u2207";a.isin="\u2208";a.notin="\u2209";a.ni="\u220B";a.prod="\u220F";a.sum="\u2211";a.minus="\u2212";a.lowast="\u2217";a.radic="\u221A";a.prop="\u221D";a.infin="\u221E";a.ang="\u2220";a.and="\u2227";a.or="\u2228";a.cap="\u2229";a.cup="\u222A";a["int"]="\u222B";a.there4="\u2234";a.sim="\u223C";a.cong="\u2245";a.asymp="\u2248";a.ne="\u2260";a.equiv="\u2261";a.le="\u2264";a.ge="\u2265";a.sub="\u2282";a.sup="\u2283";a.nsub="\u2284";a.sube="\u2286";a.supe="\u2287";a.oplus="\u2295";a.otimes="\u2297";a.perp="\u22A5";a.sdot="\u22C5";a.lceil="\u2308";a.rceil="\u2309";a.lfloor="\u230A";a.rfloor="\u230B";a.lang="\u2329";a.rang="\u232A";a.loz="\u25CA";a.spades="\u2660";a.clubs="\u2663";a.hearts="\u2665";a.diams="\u2666"})();SimileAjax.HTML.deEntify=function(c){var d=SimileAjax.HTML._e2uHash;var b=/&(\w+?);/;while(b.test(c)){var a=c.match(b);c=c.replace(b,d[a[1]])}return c};SimileAjax.Set=function(b){this._hash={};this._count=0;if(b instanceof Array){for(var c=0;c<b.length;c++){this.add(b[c])}}else{if(b instanceof SimileAjax.Set){this.addSet(b)}}};SimileAjax.Set.prototype.add=function(a){if(!(a in this._hash)){this._hash[a]=true;this._count++;return true}return false};SimileAjax.Set.prototype.addSet=function(b){for(var a in b._hash){this.add(a)}};SimileAjax.Set.prototype.remove=function(a){if(a in this._hash){delete this._hash[a];this._count--;return true}return false};SimileAjax.Set.prototype.removeSet=function(b){for(var a in b._hash){this.remove(a)}};SimileAjax.Set.prototype.retainSet=function(b){for(var a in this._hash){if(!b.contains(a)){delete this._hash[a];this._count--}}};SimileAjax.Set.prototype.contains=function(a){return(a in this._hash)};SimileAjax.Set.prototype.size=function(){return this._count};SimileAjax.Set.prototype.toArray=function(){var b=[];for(var c in this._hash){b.push(c)}return b};SimileAjax.Set.prototype.visit=function(a){for(var b in this._hash){if(a(b)==true){break}}};SimileAjax.SortedArray=function(b,a){this._a=(a instanceof Array)?a:[];this._compare=b};SimileAjax.SortedArray.prototype.add=function(c){var a=this;var b=this.find(function(d){return a._compare(d,c)});if(b<this._a.length){this._a.splice(b,0,c)}else{this._a.push(c)}};SimileAjax.SortedArray.prototype.remove=function(c){var a=this;var b=this.find(function(d){return a._compare(d,c)});while(b<this._a.length&&this._compare(this._a[b],c)==0){if(this._a[b]==c){this._a.splice(b,1);return true}else{b++}}return false};SimileAjax.SortedArray.prototype.removeAll=function(){this._a=[]};SimileAjax.SortedArray.prototype.elementAt=function(a){return this._a[a]};SimileAjax.SortedArray.prototype.length=function(){return this._a.length};SimileAjax.SortedArray.prototype.find=function(g){var e=0;var d=this._a.length;while(e<d){var f=Math.floor((e+d)/2);var h=g(this._a[f]);if(f==e){return h<0?e+1:e}else{if(h<0){e=f}else{d=f}}}return e};SimileAjax.SortedArray.prototype.getFirst=function(){return(this._a.length>0)?this._a[0]:null};SimileAjax.SortedArray.prototype.getLast=function(){return(this._a.length>0)?this._a[this._a.length-1]:null};SimileAjax.EventIndex=function(b){var a=this;this._unit=(b!=null)?b:SimileAjax.NativeDateUnit;this._events=new SimileAjax.SortedArray(function(d,c){return a._unit.compare(d.getStart(),c.getStart())});this._idToEvent={};this._indexed=true};SimileAjax.EventIndex.prototype.getUnit=function(){return this._unit};SimileAjax.EventIndex.prototype.getEvent=function(a){return this._idToEvent[a]};SimileAjax.EventIndex.prototype.add=function(a){this._events.add(a);this._idToEvent[a.getID()]=a;this._indexed=false};SimileAjax.EventIndex.prototype.removeAll=function(){this._events.removeAll();this._idToEvent={};this._indexed=false};SimileAjax.EventIndex.prototype.getCount=function(){return this._events.length()};SimileAjax.EventIndex.prototype.getIterator=function(a,b){if(!this._indexed){this._index()}return new SimileAjax.EventIndex._Iterator(this._events,a,b,this._unit)};SimileAjax.EventIndex.prototype.getReverseIterator=function(a,b){if(!this._indexed){this._index()}return new SimileAjax.EventIndex._ReverseIterator(this._events,a,b,this._unit)};SimileAjax.EventIndex.prototype.getAllIterator=function(){return new SimileAjax.EventIndex._AllIterator(this._events)};SimileAjax.EventIndex.prototype.getEarliestDate=function(){var a=this._events.getFirst();return(a==null)?null:a.getStart()};SimileAjax.EventIndex.prototype.getLatestDate=function(){var a=this._events.getLast();if(a==null){return null}if(!this._indexed){this._index()}var c=a._earliestOverlapIndex;var b=this._events.elementAt(c).getEnd();for(var d=c+1;d<this._events.length();d++){b=this._unit.later(b,this._events.elementAt(d).getEnd())}return b};SimileAjax.EventIndex.prototype._index=function(){var d=this._events.length();for(var e=0;e<d;e++){var c=this._events.elementAt(e);c._earliestOverlapIndex=e}var g=1;for(var e=0;e<d;e++){var c=this._events.elementAt(e);var b=c.getEnd();g=Math.max(g,e+1);while(g<d){var a=this._events.elementAt(g);var f=a.getStart();if(this._unit.compare(f,b)<0){a._earliestOverlapIndex=e;g++}else{break}}}this._indexed=true};SimileAjax.EventIndex._Iterator=function(b,a,d,c){this._events=b;this._startDate=a;this._endDate=d;this._unit=c;this._currentIndex=b.find(function(e){return c.compare(e.getStart(),a)});if(this._currentIndex-1>=0){this._currentIndex=this._events.elementAt(this._currentIndex-1)._earliestOverlapIndex}this._currentIndex--;this._maxIndex=b.find(function(e){return c.compare(e.getStart(),d)});this._hasNext=false;this._next=null;this._findNext()};SimileAjax.EventIndex._Iterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}else{return null}},_findNext:function(){var b=this._unit;while((++this._currentIndex)<this._maxIndex){var a=this._events.elementAt(this._currentIndex);if(b.compare(a.getStart(),this._endDate)<0&&b.compare(a.getEnd(),this._startDate)>0){this._next=a;this._hasNext=true;return}}this._next=null;this._hasNext=false}};SimileAjax.EventIndex._ReverseIterator=function(b,a,d,c){this._events=b;this._startDate=a;this._endDate=d;this._unit=c;this._minIndex=b.find(function(e){return c.compare(e.getStart(),a)});if(this._minIndex-1>=0){this._minIndex=this._events.elementAt(this._minIndex-1)._earliestOverlapIndex}this._maxIndex=b.find(function(e){return c.compare(e.getStart(),d)});this._currentIndex=this._maxIndex;this._hasNext=false;this._next=null;this._findNext()};SimileAjax.EventIndex._ReverseIterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}else{return null}},_findNext:function(){var b=this._unit;while((--this._currentIndex)>=this._minIndex){var a=this._events.elementAt(this._currentIndex);if(b.compare(a.getStart(),this._endDate)<0&&b.compare(a.getEnd(),this._startDate)>0){this._next=a;this._hasNext=true;return}}this._next=null;this._hasNext=false}};SimileAjax.EventIndex._AllIterator=function(a){this._events=a;this._index=0};SimileAjax.EventIndex._AllIterator.prototype={hasNext:function(){return this._index<this._events.length()},next:function(){return this._index<this._events.length()?this._events.elementAt(this._index++):null}};SimileAjax.NativeDateUnit=new Object();SimileAjax.NativeDateUnit.makeDefaultValue=function(){return new Date()};SimileAjax.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())};SimileAjax.NativeDateUnit.getParser=function(a){if(typeof a=="string"){a=a.toLowerCase()}return(a=="iso8601"||a=="iso 8601")?SimileAjax.DateTime.parseIso8601DateTime:SimileAjax.DateTime.parseGregorianDateTime};SimileAjax.NativeDateUnit.parseFromObject=function(a){return SimileAjax.DateTime.parseGregorianDateTime(a)};SimileAjax.NativeDateUnit.toNumber=function(a){return a.getTime()};SimileAjax.NativeDateUnit.fromNumber=function(a){return new Date(a)};SimileAjax.NativeDateUnit.compare=function(d,c){var b,a;if(typeof d=="object"){b=d.getTime()}else{b=Number(d)}if(typeof c=="object"){a=c.getTime()}else{a=Number(c)}return b-a};SimileAjax.NativeDateUnit.earlier=function(b,a){return SimileAjax.NativeDateUnit.compare(b,a)<0?b:a};SimileAjax.NativeDateUnit.later=function(b,a){return SimileAjax.NativeDateUnit.compare(b,a)>0?b:a};SimileAjax.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};SimileAjax.ListenerQueue=function(a){this._listeners=[];this._wildcardHandlerName=a};SimileAjax.ListenerQueue.prototype.add=function(a){this._listeners.push(a)};SimileAjax.ListenerQueue.prototype.remove=function(c){var b=this._listeners;for(var a=0;a<b.length;a++){if(b[a]==c){b.splice(a,1);break}}};SimileAjax.ListenerQueue.prototype.fire=function(b,a){var d=[].concat(this._listeners);for(var c=0;c<d.length;c++){var f=d[c];if(b in f){try{f[b].apply(f,a)}catch(g){SimileAjax.Debug.exception("Error firing event of name "+b,g)}}else{if(this._wildcardHandlerName!=null&&this._wildcardHandlerName in f){try{f[this._wildcardHandlerName].apply(f,[b])}catch(g){SimileAjax.Debug.exception("Error firing event of name "+b+" to wildcard handler",g)}}}}};SimileAjax.History={maxHistoryLength:10,historyFile:"__history__.html",enabled:true,_initialized:false,_listeners:new SimileAjax.ListenerQueue(),_actions:[],_baseIndex:0,_currentIndex:0,_plainDocumentTitle:document.title};SimileAjax.History.formatHistoryEntryTitle=function(a){return SimileAjax.History._plainDocumentTitle+" {"+a+"}"};SimileAjax.History.initialize=function(){if(SimileAjax.History._initialized){return}if(SimileAjax.History.enabled){var a=document.createElement("iframe");a.id="simile-ajax-history";a.style.position="absolute";a.style.width="10px";a.style.height="10px";a.style.top="0px";a.style.left="0px";a.style.visibility="hidden";a.src=SimileAjax.History.historyFile+"?0";document.body.appendChild(a);SimileAjax.DOM.registerEvent(a,"load",SimileAjax.History._handleIFrameOnLoad);SimileAjax.History._iframe=a}SimileAjax.History._initialized=true};SimileAjax.History.addListener=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.add(a)};SimileAjax.History.removeListener=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.remove(a)};SimileAjax.History.addAction=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.fire("onBeforePerform",[a]);window.setTimeout(function(){try{a.perform();SimileAjax.History._listeners.fire("onAfterPerform",[a]);if(SimileAjax.History.enabled){SimileAjax.History._actions=SimileAjax.History._actions.slice(0,SimileAjax.History._currentIndex-SimileAjax.History._baseIndex);SimileAjax.History._actions.push(a);SimileAjax.History._currentIndex++;var c=SimileAjax.History._actions.length-SimileAjax.History.maxHistoryLength;if(c>0){SimileAjax.History._actions=SimileAjax.History._actions.slice(c);SimileAjax.History._baseIndex+=c}try{SimileAjax.History._iframe.contentWindow.location.search="?"+SimileAjax.History._currentIndex}catch(b){var d=SimileAjax.History.formatHistoryEntryTitle(a.label);document.title=d}}}catch(b){SimileAjax.Debug.exception(b,"Error adding action {"+a.label+"} to history")}},0)};SimileAjax.History.addLengthyAction=function(c,a,b){SimileAjax.History.addAction({perform:c,undo:a,label:b,uiLayer:SimileAjax.WindowManager.getBaseLayer(),lengthy:true})};SimileAjax.History._handleIFrameOnLoad=function(){try{var b=SimileAjax.History._iframe.contentWindow.location.search;var h=(b.length==0)?0:Math.max(0,parseInt(b.substr(1)));var g=function(){var c=h-SimileAjax.History._currentIndex;SimileAjax.History._currentIndex+=c;SimileAjax.History._baseIndex+=c;SimileAjax.History._iframe.contentWindow.location.search="?"+h};if(h<SimileAjax.History._currentIndex){SimileAjax.History._listeners.fire("onBeforeUndoSeveral",[]);window.setTimeout(function(){while(SimileAjax.History._currentIndex>h&&SimileAjax.History._currentIndex>SimileAjax.History._baseIndex){SimileAjax.History._currentIndex--;var c=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{c.undo()}catch(j){SimileAjax.Debug.exception(j,"History: Failed to undo action {"+c.label+"}")}}SimileAjax.History._listeners.fire("onAfterUndoSeveral",[]);g()},0)}else{if(h>SimileAjax.History._currentIndex){SimileAjax.History._listeners.fire("onBeforeRedoSeveral",[]);window.setTimeout(function(){while(SimileAjax.History._currentIndex<h&&SimileAjax.History._currentIndex-SimileAjax.History._baseIndex<SimileAjax.History._actions.length){var c=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{c.perform()}catch(j){SimileAjax.Debug.exception(j,"History: Failed to redo action {"+c.label+"}")}SimileAjax.History._currentIndex++}SimileAjax.History._listeners.fire("onAfterRedoSeveral",[]);g()},0)}else{var a=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1;var f=(a>=0&&a<SimileAjax.History._actions.length)?SimileAjax.History.formatHistoryEntryTitle(SimileAjax.History._actions[a].label):SimileAjax.History._plainDocumentTitle;SimileAjax.History._iframe.contentWindow.document.title=f;document.title=f}}}catch(d){}};SimileAjax.History.getNextUndoAction=function(){try{var a=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1;return SimileAjax.History._actions[a]}catch(b){return null}};SimileAjax.History.getNextRedoAction=function(){try{var a=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex;return SimileAjax.History._actions[a]}catch(b){return null}};SimileAjax.WindowManager={_initialized:false,_listeners:[],_draggedElement:null,_draggedElementCallback:null,_dropTargetHighlightElement:null,_lastCoords:null,_ghostCoords:null,_draggingMode:"",_dragging:false,_layers:[]};SimileAjax.WindowManager.initialize=function(){if(SimileAjax.WindowManager._initialized){return}SimileAjax.DOM.registerEvent(document.body,"mousedown",SimileAjax.WindowManager._onBodyMouseDown);SimileAjax.DOM.registerEvent(document.body,"mousemove",SimileAjax.WindowManager._onBodyMouseMove);SimileAjax.DOM.registerEvent(document.body,"mouseup",SimileAjax.WindowManager._onBodyMouseUp);SimileAjax.DOM.registerEvent(document,"keydown",SimileAjax.WindowManager._onBodyKeyDown);SimileAjax.DOM.registerEvent(document,"keyup",SimileAjax.WindowManager._onBodyKeyUp);SimileAjax.WindowManager._layers.push({index:0});SimileAjax.WindowManager._historyListener={onBeforeUndoSeveral:function(){},onAfterUndoSeveral:function(){},onBeforeUndo:function(){},onAfterUndo:function(){},onBeforeRedoSeveral:function(){},onAfterRedoSeveral:function(){},onBeforeRedo:function(){},onAfterRedo:function(){}};SimileAjax.History.addListener(SimileAjax.WindowManager._historyListener);SimileAjax.WindowManager._initialized=true};SimileAjax.WindowManager.getBaseLayer=function(){SimileAjax.WindowManager.initialize();return SimileAjax.WindowManager._layers[0]};SimileAjax.WindowManager.getHighestLayer=function(){SimileAjax.WindowManager.initialize();return SimileAjax.WindowManager._layers[SimileAjax.WindowManager._layers.length-1]};SimileAjax.WindowManager.registerEventWithObject=function(d,a,e,b,c){SimileAjax.WindowManager.registerEvent(d,a,function(g,f,h){return e[b].call(e,g,f,h)},c)};SimileAjax.WindowManager.registerEvent=function(d,b,e,c){if(c==null){c=SimileAjax.WindowManager.getHighestLayer()}var a=function(g,f,j){if(SimileAjax.WindowManager._canProcessEventAtLayer(c)){SimileAjax.WindowManager._popToLayer(c.index);try{e(g,f,j)}catch(h){SimileAjax.Debug.exception(h)}}SimileAjax.DOM.cancelEvent(f);return false};SimileAjax.DOM.registerEvent(d,b,a)};SimileAjax.WindowManager.pushLayer=function(c,d,b){var a={onPop:c,index:SimileAjax.WindowManager._layers.length,ephemeral:(d),elmt:b};SimileAjax.WindowManager._layers.push(a);return a};SimileAjax.WindowManager.popLayer=function(b){for(var a=1;a<SimileAjax.WindowManager._layers.length;a++){if(SimileAjax.WindowManager._layers[a]==b){SimileAjax.WindowManager._popToLayer(a-1);break}}};SimileAjax.WindowManager.popAllLayers=function(){SimileAjax.WindowManager._popToLayer(0)};SimileAjax.WindowManager.registerForDragging=function(b,c,a){SimileAjax.WindowManager.registerEvent(b,"mousedown",function(e,d,f){SimileAjax.WindowManager._handleMouseDown(e,d,c)},a)};SimileAjax.WindowManager._popToLayer=function(c){while(c+1<SimileAjax.WindowManager._layers.length){try{var a=SimileAjax.WindowManager._layers.pop();if(a.onPop!=null){a.onPop()}}catch(b){}}};SimileAjax.WindowManager._canProcessEventAtLayer=function(b){if(b.index==(SimileAjax.WindowManager._layers.length-1)){return true}for(var a=b.index+1;a<SimileAjax.WindowManager._layers.length;a++){if(!SimileAjax.WindowManager._layers[a].ephemeral){return false}}return true};SimileAjax.WindowManager.cancelPopups=function(a){var f=(a)?SimileAjax.DOM.getEventPageCoordinates(a):{x:-1,y:-1};var e=SimileAjax.WindowManager._layers.length-1;while(e>0&&SimileAjax.WindowManager._layers[e].ephemeral){var d=SimileAjax.WindowManager._layers[e];if(d.elmt!=null){var c=d.elmt;var b=SimileAjax.DOM.getPageCoordinates(c);if(f.x>=b.left&&f.x<(b.left+c.offsetWidth)&&f.y>=b.top&&f.y<(b.top+c.offsetHeight)){break}}e--}SimileAjax.WindowManager._popToLayer(e)};SimileAjax.WindowManager._onBodyMouseDown=function(b,a,c){if(!("eventPhase" in a)||a.eventPhase==a.BUBBLING_PHASE){SimileAjax.WindowManager.cancelPopups(a)}};SimileAjax.WindowManager._handleMouseDown=function(b,a,c){SimileAjax.WindowManager._draggedElement=b;SimileAjax.WindowManager._draggedElementCallback=c;SimileAjax.WindowManager._lastCoords={x:a.clientX,y:a.clientY};SimileAjax.DOM.cancelEvent(a);return false};SimileAjax.WindowManager._onBodyKeyDown=function(c,a,d){if(SimileAjax.WindowManager._dragging){if(a.keyCode==27){SimileAjax.WindowManager._cancelDragging()}else{if((a.keyCode==17||a.keyCode==16)&&SimileAjax.WindowManager._draggingMode!="copy"){SimileAjax.WindowManager._draggingMode="copy";var b=SimileAjax.Graphics.createTranslucentImage(SimileAjax.urlPrefix+"images/copy.png");b.style.position="absolute";b.style.left=(SimileAjax.WindowManager._ghostCoords.left-16)+"px";b.style.top=(SimileAjax.WindowManager._ghostCoords.top)+"px";document.body.appendChild(b);SimileAjax.WindowManager._draggingModeIndicatorElmt=b}}}};SimileAjax.WindowManager._onBodyKeyUp=function(b,a,c){if(SimileAjax.WindowManager._dragging){if(a.keyCode==17||a.keyCode==16){SimileAjax.WindowManager._draggingMode="";if(SimileAjax.WindowManager._draggingModeIndicatorElmt!=null){document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt);SimileAjax.WindowManager._draggingModeIndicatorElmt=null}}}};SimileAjax.WindowManager._onBodyMouseMove=function(a,q,j){if(SimileAjax.WindowManager._draggedElement!=null){var s=SimileAjax.WindowManager._draggedElementCallback;var f=SimileAjax.WindowManager._lastCoords;var p=q.clientX-f.x;var l=q.clientY-f.y;if(!SimileAjax.WindowManager._dragging){if(Math.abs(p)>5||Math.abs(l)>5){try{if("onDragStart" in s){s.onDragStart()}if("ghost" in s&&s.ghost){var m=SimileAjax.WindowManager._draggedElement;SimileAjax.WindowManager._ghostCoords=SimileAjax.DOM.getPageCoordinates(m);SimileAjax.WindowManager._ghostCoords.left+=p;SimileAjax.WindowManager._ghostCoords.top+=l;var r=m.cloneNode(true);r.style.position="absolute";r.style.left=SimileAjax.WindowManager._ghostCoords.left+"px";r.style.top=SimileAjax.WindowManager._ghostCoords.top+"px";r.style.zIndex=1000;SimileAjax.Graphics.setOpacity(r,50);document.body.appendChild(r);s._ghostElmt=r}SimileAjax.WindowManager._dragging=true;SimileAjax.WindowManager._lastCoords={x:q.clientX,y:q.clientY};document.body.focus()}catch(h){SimileAjax.Debug.exception("WindowManager: Error handling mouse down",h);SimileAjax.WindowManager._cancelDragging()}}}else{try{SimileAjax.WindowManager._lastCoords={x:q.clientX,y:q.clientY};if("onDragBy" in s){s.onDragBy(p,l)}if("_ghostElmt" in s){var r=s._ghostElmt;SimileAjax.WindowManager._ghostCoords.left+=p;SimileAjax.WindowManager._ghostCoords.top+=l;r.style.left=SimileAjax.WindowManager._ghostCoords.left+"px";r.style.top=SimileAjax.WindowManager._ghostCoords.top+"px";if(SimileAjax.WindowManager._draggingModeIndicatorElmt!=null){var k=SimileAjax.WindowManager._draggingModeIndicatorElmt;k.style.left=(SimileAjax.WindowManager._ghostCoords.left-16)+"px";k.style.top=SimileAjax.WindowManager._ghostCoords.top+"px"}if("droppable" in s&&s.droppable){var o=SimileAjax.DOM.getEventPageCoordinates(q);var j=SimileAjax.DOM.hittest(o.x,o.y,[SimileAjax.WindowManager._ghostElmt,SimileAjax.WindowManager._dropTargetHighlightElement]);j=SimileAjax.WindowManager._findDropTarget(j);if(j!=SimileAjax.WindowManager._potentialDropTarget){if(SimileAjax.WindowManager._dropTargetHighlightElement!=null){document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement);SimileAjax.WindowManager._dropTargetHighlightElement=null;SimileAjax.WindowManager._potentialDropTarget=null}var g=false;if(j!=null){if((!("canDropOn" in s)||s.canDropOn(j))&&(!("canDrop" in j)||j.canDrop(SimileAjax.WindowManager._draggedElement))){g=true}}if(g){var c=4;var d=SimileAjax.DOM.getPageCoordinates(j);var b=document.createElement("div");b.style.border=c+"px solid yellow";b.style.backgroundColor="yellow";b.style.position="absolute";b.style.left=d.left+"px";b.style.top=d.top+"px";b.style.width=(j.offsetWidth-c*2)+"px";b.style.height=(j.offsetHeight-c*2)+"px";SimileAjax.Graphics.setOpacity(b,30);document.body.appendChild(b);SimileAjax.WindowManager._potentialDropTarget=j;SimileAjax.WindowManager._dropTargetHighlightElement=b}}}}}catch(h){SimileAjax.Debug.exception("WindowManager: Error handling mouse move",h);SimileAjax.WindowManager._cancelDragging()}}SimileAjax.DOM.cancelEvent(q);return false}};SimileAjax.WindowManager._onBodyMouseUp=function(b,a,c){if(SimileAjax.WindowManager._draggedElement!=null){try{if(SimileAjax.WindowManager._dragging){var e=SimileAjax.WindowManager._draggedElementCallback;if("onDragEnd" in e){e.onDragEnd()}if("droppable" in e&&e.droppable){var d=false;var c=SimileAjax.WindowManager._potentialDropTarget;if(c!=null){if((!("canDropOn" in e)||e.canDropOn(c))&&(!("canDrop" in c)||c.canDrop(SimileAjax.WindowManager._draggedElement))){if("onDropOn" in e){e.onDropOn(c)}c.ondrop(SimileAjax.WindowManager._draggedElement,SimileAjax.WindowManager._draggingMode);d=true}}if(!d){}}}}finally{SimileAjax.WindowManager._cancelDragging()}SimileAjax.DOM.cancelEvent(a);return false}};SimileAjax.WindowManager._cancelDragging=function(){var b=SimileAjax.WindowManager._draggedElementCallback;if("_ghostElmt" in b){var a=b._ghostElmt;document.body.removeChild(a);delete b._ghostElmt}if(SimileAjax.WindowManager._dropTargetHighlightElement!=null){document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement);SimileAjax.WindowManager._dropTargetHighlightElement=null}if(SimileAjax.WindowManager._draggingModeIndicatorElmt!=null){document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt);SimileAjax.WindowManager._draggingModeIndicatorElmt=null}SimileAjax.WindowManager._draggedElement=null;SimileAjax.WindowManager._draggedElementCallback=null;SimileAjax.WindowManager._potentialDropTarget=null;SimileAjax.WindowManager._dropTargetHighlightElement=null;SimileAjax.WindowManager._lastCoords=null;SimileAjax.WindowManager._ghostCoords=null;SimileAjax.WindowManager._draggingMode="";SimileAjax.WindowManager._dragging=false};SimileAjax.WindowManager._findDropTarget=function(a){while(a!=null){if("ondrop" in a&&(typeof a.ondrop)=="function"){break}a=a.parentNode}return a};Timeline_urlPrefix=GeoTemCoMinifier_urlPrefix+"lib/simile/timeline/";SimileAjax.History.enabled=false;if(typeof window.Timeline=="undefined"){window.Timeline=new Object();Timeline.urlPrefix=Timeline_urlPrefix;window.Timeline.DateTime=window.SimileAjax.DateTime}(function(){var h=false;if(document.location.search.length>0){var g=document.location.search.substr(1).split("&");for(var c=0;c<g.length;c++){if(g[c]=="timeline-use-local-resources"){h=true}}}var f=function(){if("Timeline" in window){return}if(window.SimileAjax.DateTime==undefined){window.SimileAjax.DateTime=new Object()}window.Timeline=new Object();window.Timeline.DateTime=window.SimileAjax.DateTime;window.Timeline.loaded={core:{},localized:{}};if(!window.console){window.console={log:{},error:{},info:{}}}var z=false;var v=["timeline.js","band.js","themes.js","ethers.js","ether-painters.js","event-utils.js","labellers.js","sources.js","original-painter.js","detailed-painter.js","overview-painter.js","compact-painter.js","decorators.js","units.js"];var q=["timeline.css","ethers.css","events.css"];var t=["timeline.js","labellers.js"];var B=[];var y=["cs","de","en","es","fr","it","nl","ru","se","tr","vi","zh"];try{var m=["en"],k="en",G=null;var o=function(e){var I=e.split("&");for(var l=0;l<I.length;l++){var H=I[l].split("=");if(H[0]=="locales"){m=m.concat(H[1].split(","))}else{if(H[0]=="defaultLocale"){k=H[1]}else{if(H[0]=="forceLocale"){G=H[1];m=m.concat(H[1].split(","))}else{if(H[0]=="bundle"){z=H[1]!="false"}}}}}};(function(){if(typeof Timeline_urlPrefix=="string"){Timeline.urlPrefix=Timeline_urlPrefix;if(typeof Timeline_parameters=="string"){o(Timeline_parameters)}}else{var K=document.documentElement.getElementsByTagName("head");for(var J=0;J<K.length;J++){var e=K[J].getElementsByTagName("script");for(var I=0;I<e.length;I++){var l=e[I].src;var H=l.indexOf("timeline-api.js");if(H>=0){Timeline.urlPrefix=l.substr(0,H);var L=l.indexOf("?");if(L>0){o(l.substr(L+1))}return}}}throw new Error("Failed to derive URL prefix for Timeline API code files")}})();var j=function(e,l){SimileAjax.includeJavascriptFiles(document,e,l)};var F=function(e,l){SimileAjax.includeCssFiles(document,e,l)};var x=(z)?["timeline-bundle.js"]:v;window.SimileAjax_onLoad=function(){Timeline.loaded.core.files=x;Timeline.loaded.core.loaded=true};if(z){j(Timeline.urlPrefix,["timeline-bundle.js"]);F(Timeline.urlPrefix,["timeline-bundle.css"])}else{j(Timeline.urlPrefix+"scripts/",v);F(Timeline.urlPrefix+"styles/",q)}var u=[];var r=function(e){for(var H=0;H<y.length;H++){if(e==y[H]){u[e]=true;return true}}console.error("Timeline locale ["+e+"] is not yet supported");return false};var A=function(e){var l=e.indexOf("-");if(l>0&&r(e.substr(0,l))){return e.substr(0,l)}else{if(r(e)){return e}}return null};if(!r(k)){k="en"}u[k]=true;for(var C=0;C<m.length;C++){A(m[C])}var p=k;var w=("language" in navigator?navigator.language:navigator.browserLanguage).split(";");for(var C=0;C<w.length;C++){var D=A(w[C]);if(D!=null){p=D;break}}(function s(){var J=50;if(!this.iteration){this.iteration=0}this.iteration+=1;if(!Timeline.loaded.core.loaded){if(this.iteration>=J){console.info("could not load Timeline core assets");return}setTimeout(function(){s()},10);return}var I=[];for(var H=0;H<y.length;H++){var e=y[H];if(u[e]){I.push(e);j(Timeline.urlPrefix+"scripts/l10n/"+e+"/",t);F(Timeline.urlPrefix+"styles/l10n/"+e+"/",B)}}SimileAjax_onLoad=function(){Timeline.loaded.localized.loaded=true;Timeline.loaded.localized.locales=I;console.info("Timeline core loaded");console.info("Timeline locales loaded: "+Timeline.loaded.localized.locales)};if(G==null){Timeline.serverLocale=k;Timeline.clientLocale=p}else{if(!r(G)){G="en"}Timeline.serverLocale=G;Timeline.clientLocale=G}}())}catch(E){alert(E)}};if(typeof SimileAjax=="undefined"){window.SimileAjax_onLoad=f;var b=h?"http://127.0.0.1:9999/ajax/api/simile-ajax-api.js?bundle=false":"http://api.simile-widgets.org/ajax/2.2.1/simile-ajax-api.js";if(typeof Timeline_ajax_url=="string"){b=Timeline_ajax_url}var a=function(){var e=document.createElement("script");e.type="text/javascript";e.language="JavaScript";e.src=b;document.getElementsByTagName("head")[0].appendChild(e)};if(document.body==null){try{document.write("<script src='"+b+"' type='text/javascript'><\/script>")}catch(d){a()}}else{a()}}else{f()}})();Timeline.version="2.3.1";Timeline.ajax_lib_version=SimileAjax.version;Timeline.display_version=Timeline.version+" (with Ajax lib "+Timeline.ajax_lib_version+")";Timeline.strings={};Timeline.HORIZONTAL=0;Timeline.VERTICAL=1;Timeline._defaultTheme=null;Timeline.getDefaultLocale=function(){return Timeline.clientLocale};Timeline.create=function(d,c,b,f){if(Timeline.timelines==null){Timeline.timelines=[]}var a=Timeline.timelines.length;Timeline.timelines[a]=null;var e=new Timeline._Impl(d,c,b,f,a);Timeline.timelines[a]=e;return e};Timeline.createBandInfo=function(d){var e=("theme" in d)?d.theme:Timeline.getDefaultTheme();var b=("eventSource" in d)?d.eventSource:null;var f=new Timeline.LinearEther({centersOn:("date" in d)?d.date:new Date(),interval:SimileAjax.DateTime.gregorianUnitLengths[d.intervalUnit],pixelsPerInterval:d.intervalPixels,theme:e});var g=new Timeline.GregorianEtherPainter({unit:d.intervalUnit,multiple:("multiple" in d)?d.multiple:1,theme:e,align:("align" in d)?d.align:undefined});var j={showText:("showEventText" in d)?d.showEventText:true,theme:e};if("eventPainterParams" in d){for(var a in d.eventPainterParams){j[a]=d.eventPainterParams[a]}}if("trackHeight" in d){j.trackHeight=d.trackHeight}if("trackGap" in d){j.trackGap=d.trackGap}var h=("overview" in d&&d.overview)?"overview":("layout" in d?d.layout:"original");var c;if("eventPainter" in d){c=new d.eventPainter(j)}else{switch(h){case"overview":c=new Timeline.OverviewEventPainter(j);break;case"detailed":c=new Timeline.DetailedEventPainter(j);break;default:c=new Timeline.OriginalEventPainter(j)}}return{width:d.width,eventSource:b,timeZone:("timeZone" in d)?d.timeZone:0,ether:f,etherPainter:g,eventPainter:c,theme:e,zoomIndex:("zoomIndex" in d)?d.zoomIndex:0,zoomSteps:("zoomSteps" in d)?d.zoomSteps:null}};Timeline.createHotZoneBandInfo=function(d){var e=("theme" in d)?d.theme:Timeline.getDefaultTheme();var b=("eventSource" in d)?d.eventSource:null;var f=new Timeline.HotZoneEther({centersOn:("date" in d)?d.date:new Date(),interval:SimileAjax.DateTime.gregorianUnitLengths[d.intervalUnit],pixelsPerInterval:d.intervalPixels,zones:d.zones,theme:e});var g=new Timeline.HotZoneGregorianEtherPainter({unit:d.intervalUnit,zones:d.zones,theme:e,align:("align" in d)?d.align:undefined});var j={showText:("showEventText" in d)?d.showEventText:true,theme:e};if("eventPainterParams" in d){for(var a in d.eventPainterParams){j[a]=d.eventPainterParams[a]}}if("trackHeight" in d){j.trackHeight=d.trackHeight}if("trackGap" in d){j.trackGap=d.trackGap}var h=("overview" in d&&d.overview)?"overview":("layout" in d?d.layout:"original");var c;if("eventPainter" in d){c=new d.eventPainter(j)}else{switch(h){case"overview":c=new Timeline.OverviewEventPainter(j);break;case"detailed":c=new Timeline.DetailedEventPainter(j);break;default:c=new Timeline.OriginalEventPainter(j)}}return{width:d.width,eventSource:b,timeZone:("timeZone" in d)?d.timeZone:0,ether:f,etherPainter:g,eventPainter:c,theme:e,zoomIndex:("zoomIndex" in d)?d.zoomIndex:0,zoomSteps:("zoomSteps" in d)?d.zoomSteps:null}};Timeline.getDefaultTheme=function(){if(Timeline._defaultTheme==null){Timeline._defaultTheme=Timeline.ClassicTheme.create(Timeline.getDefaultLocale())}return Timeline._defaultTheme};Timeline.setDefaultTheme=function(a){Timeline._defaultTheme=a};Timeline.loadXML=function(a,c){var d=function(g,e,f){alert("Failed to load data xml from "+a+"\n"+g)};var b=function(f){var e=f.responseXML;if(!e.documentElement&&f.responseStream){e.load(f.responseStream)}c(e,a)};SimileAjax.XmlHttp.get(a,d,b)};Timeline.loadJSON=function(url,f){var fError=function(statusText,status,xmlhttp){alert("Failed to load json data from "+url+"\n"+statusText)};var fDone=function(xmlhttp){f(eval("("+xmlhttp.responseText+")"),url)};SimileAjax.XmlHttp.get(url,fError,fDone)};Timeline.getTimelineFromID=function(a){return Timeline.timelines[a]};Timeline.writeVersion=function(a){document.getElementById(a).innerHTML=this.display_version};Timeline._Impl=function(d,c,b,e,a){SimileAjax.WindowManager.initialize();this._containerDiv=d;this._bandInfos=c;this._orientation=b==null?Timeline.HORIZONTAL:b;this._unit=(e!=null)?e:SimileAjax.NativeDateUnit;this._starting=true;this._autoResizing=false;this.autoWidth=c&&c[0]&&c[0].theme&&c[0].theme.autoWidth;this.autoWidthAnimationTime=c&&c[0]&&c[0].theme&&c[0].theme.autoWidthAnimationTime;this.timelineID=a;this.timeline_start=c&&c[0]&&c[0].theme&&c[0].theme.timeline_start;this.timeline_stop=c&&c[0]&&c[0].theme&&c[0].theme.timeline_stop;this.timeline_at_start=false;this.timeline_at_stop=false;this._initialize()};Timeline._Impl.prototype.dispose=function(){for(var a=0;a<this._bands.length;a++){this._bands[a].dispose()}this._bands=null;this._bandInfos=null;this._containerDiv.innerHTML="";Timeline.timelines[this.timelineID]=null};Timeline._Impl.prototype.getBandCount=function(){return this._bands.length};Timeline._Impl.prototype.getBand=function(a){return this._bands[a]};Timeline._Impl.prototype.finishedEventLoading=function(){this._autoWidthCheck(true);this._starting=false};Timeline._Impl.prototype.layout=function(){this._autoWidthCheck(true);this._distributeWidths()};Timeline._Impl.prototype.paint=function(){for(var a=0;a<this._bands.length;a++){this._bands[a].paint()}};Timeline._Impl.prototype.getDocument=function(){return this._containerDiv.ownerDocument};Timeline._Impl.prototype.addDiv=function(a){this._containerDiv.appendChild(a)};Timeline._Impl.prototype.removeDiv=function(a){this._containerDiv.removeChild(a)};Timeline._Impl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL};Timeline._Impl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL};Timeline._Impl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};Timeline._Impl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};Timeline._Impl.prototype.getUnit=function(){return this._unit};Timeline._Impl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width"};Timeline._Impl.prototype.loadXML=function(b,d){var a=this;var e=function(h,f,g){alert("Failed to load data xml from "+b+"\n"+h);a.hideLoadingMessage()};var c=function(g){try{var f=g.responseXML;if(!f.documentElement&&g.responseStream){f.load(g.responseStream)}d(f,b)}finally{a.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(b,e,c)},0)};Timeline._Impl.prototype.loadJSON=function(url,f){var tl=this;var fError=function(statusText,status,xmlhttp){alert("Failed to load json data from "+url+"\n"+statusText);tl.hideLoadingMessage()};var fDone=function(xmlhttp){try{f(eval("("+xmlhttp.responseText+")"),url)}finally{tl.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(url,fError,fDone)},0)};Timeline._Impl.prototype._autoWidthScrollListener=function(a){a.getTimeline()._autoWidthCheck(false)};Timeline._Impl.prototype._autoWidthCheck=function(c){var e=this;var b=e._starting;var d=0;function a(){var h=e.getWidthStyle();if(b){e._containerDiv.style[h]=d+"px"}else{e._autoResizing=true;var g={};g[h]=d+"px";SimileAjax.jQuery(e._containerDiv).animate(g,e.autoWidthAnimationTime,"linear",function(){e._autoResizing=false})}}function f(){var j=0;var g=e.getPixelWidth();if(e._autoResizing){return}for(var h=0;h<e._bands.length;h++){e._bands[h].checkAutoWidth();j+=e._bandInfos[h].width}if(j>g||c){d=j;a();e._distributeWidths()}}if(!e.autoWidth){return}f()};Timeline._Impl.prototype._initialize=function(){var h=this._containerDiv;var e=h.ownerDocument;h.className=h.className.split(" ").concat("timeline-container").join(" ");var b=(this.isHorizontal())?"horizontal":"vertical";h.className+=" timeline-"+b;while(h.firstChild){h.removeChild(h.firstChild)}var a=SimileAjax.Graphics.createTranslucentImage(Timeline.urlPrefix+(this.isHorizontal()?"images/copyright-vertical.png":"images/copyright.png"));a.className="timeline-copyright";a.title="Timeline copyright SIMILE - www.code.google.com/p/simile-widgets/";SimileAjax.DOM.registerEvent(a,"click",function(){window.location="http://code.google.com/p/simile-widgets/"});h.appendChild(a);this._bands=[];for(var c=0;c<this._bandInfos.length;c++){var g=new Timeline._Band(this,this._bandInfos[c],c);this._bands.push(g)}this._distributeWidths();for(var c=0;c<this._bandInfos.length;c++){var f=this._bandInfos[c];if("syncWith" in f){this._bands[c].setSyncWithBand(this._bands[f.syncWith],("highlight" in f)?f.highlight:false)}}if(this.autoWidth){for(var c=0;c<this._bands.length;c++){this._bands[c].addOnScrollListener(this._autoWidthScrollListener)}}var d=SimileAjax.Graphics.createMessageBubble(e);d.containerDiv.className="timeline-message-container";h.appendChild(d.containerDiv);d.contentDiv.className="timeline-message";d.contentDiv.innerHTML="<img src='"+Timeline.urlPrefix+"images/progress-running.gif' /> Loading...";this.showLoadingMessage=function(){d.containerDiv.style.display="block"};this.hideLoadingMessage=function(){d.containerDiv.style.display="none"}};Timeline._Impl.prototype._distributeWidths=function(){var b=this.getPixelLength();var a=this.getPixelWidth();var c=0;for(var e=0;e<this._bands.length;e++){var j=this._bands[e];var k=this._bandInfos[e];var f=k.width;var d;if(typeof f=="string"){var h=f.indexOf("%");if(h>0){var g=parseInt(f.substr(0,h));d=Math.round(g*a/100)}else{d=parseInt(f)}}else{d=f}j.setBandShiftAndWidth(c,d);j.setViewLength(b);c+=d}};Timeline._Impl.prototype.shiftOK=function(d,b){var c=b>0,a=b<0;if((c&&this.timeline_start==null)||(a&&this.timeline_stop==null)||(b==0)){return(true)}var g=false;for(var f=0;f<this._bands.length&&!g;f++){g=this._bands[f].busy()}if(g){return(true)}if((c&&this.timeline_at_start)||(a&&this.timeline_at_stop)){return(false)}var e=false;for(var f=0;f<this._bands.length&&!e;f++){var h=this._bands[f];if(c){e=(f==d?h.getMinVisibleDateAfterDelta(b):h.getMinVisibleDate())>=this.timeline_start}else{e=(f==d?h.getMaxVisibleDateAfterDelta(b):h.getMaxVisibleDate())<=this.timeline_stop}}if(c){this.timeline_at_start=!e;this.timeline_at_stop=false}else{this.timeline_at_stop=!e;this.timeline_at_start=false}return(e)};Timeline._Impl.prototype.zoom=function(g,b,f,d){var c=new RegExp("^timeline-band-([0-9]+)$");var e=null;var a=c.exec(d.id);if(a){e=parseInt(a[1])}if(e!=null){this._bands[e].zoom(g,b,f,d)}this.paint()};Timeline._Band=function(g,h,c){if(g.autoWidth&&typeof h.width=="string"){h.width=h.width.indexOf("%")>-1?0:parseInt(h.width)}this._timeline=g;this._bandInfo=h;this._index=c;this._locale=("locale" in h)?h.locale:Timeline.getDefaultLocale();this._timeZone=("timeZone" in h)?h.timeZone:0;this._labeller=("labeller" in h)?h.labeller:(("createLabeller" in g.getUnit())?g.getUnit().createLabeller(this._locale,this._timeZone):new Timeline.GregorianDateLabeller(this._locale,this._timeZone));this._theme=h.theme;this._zoomIndex=("zoomIndex" in h)?h.zoomIndex:0;this._zoomSteps=("zoomSteps" in h)?h.zoomSteps:null;this._dragging=false;this._changing=false;this._originalScrollSpeed=5;this._scrollSpeed=this._originalScrollSpeed;this._onScrollListeners=[];var a=this;this._syncWithBand=null;this._syncWithBandHandler=function(b){a._onHighlightBandScroll()};this._selectorListener=function(b){a._onHighlightBandScroll()};var e=this._timeline.getDocument().createElement("div");e.className="timeline-band-input";this._timeline.addDiv(e);this._keyboardInput=document.createElement("input");this._keyboardInput.type="text";e.appendChild(this._keyboardInput);SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keydown",this,"_onKeyDown");SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keyup",this,"_onKeyUp");this._div=this._timeline.getDocument().createElement("div");this._div.id="timeline-band-"+c;this._div.className="timeline-band timeline-band-"+c;this._timeline.addDiv(this._div);SimileAjax.DOM.registerEventWithObject(this._div,"mousedown",this,"_onMouseDown");SimileAjax.DOM.registerEventWithObject(this._div,"mousemove",this,"_onMouseMove");SimileAjax.DOM.registerEventWithObject(this._div,"mouseup",this,"_onMouseUp");SimileAjax.DOM.registerEventWithObject(this._div,"mouseout",this,"_onMouseOut");SimileAjax.DOM.registerEventWithObject(this._div,"dblclick",this,"_onDblClick");var f=this._theme!=null?this._theme.mouseWheel:"scroll";if(f==="zoom"||f==="scroll"||this._zoomSteps){if(SimileAjax.Platform.browser.isFirefox){SimileAjax.DOM.registerEventWithObject(this._div,"DOMMouseScroll",this,"_onMouseScroll")}else{SimileAjax.DOM.registerEventWithObject(this._div,"mousewheel",this,"_onMouseScroll")}}this._innerDiv=this._timeline.getDocument().createElement("div");this._innerDiv.className="timeline-band-inner";this._div.appendChild(this._innerDiv);this._ether=h.ether;h.ether.initialize(this,g);this._etherPainter=h.etherPainter;h.etherPainter.initialize(this,g);this._eventSource=h.eventSource;if(this._eventSource){this._eventListener={onAddMany:function(){a._onAddMany()},onClear:function(){a._onClear()}};this._eventSource.addListener(this._eventListener)}this._eventPainter=h.eventPainter;this._eventTracksNeeded=0;this._eventTrackIncrement=0;h.eventPainter.initialize(this,g);this._decorators=("decorators" in h)?h.decorators:[];for(var d=0;d<this._decorators.length;d++){this._decorators[d].initialize(this,g)}};Timeline._Band.SCROLL_MULTIPLES=5;Timeline._Band.prototype.dispose=function(){this.closeBubble();if(this._eventSource){this._eventSource.removeListener(this._eventListener);this._eventListener=null;this._eventSource=null}this._timeline=null;this._bandInfo=null;this._labeller=null;this._ether=null;this._etherPainter=null;this._eventPainter=null;this._decorators=null;this._onScrollListeners=null;this._syncWithBandHandler=null;this._selectorListener=null;this._div=null;this._innerDiv=null;this._keyboardInput=null};Timeline._Band.prototype.addOnScrollListener=function(a){this._onScrollListeners.push(a)};Timeline._Band.prototype.removeOnScrollListener=function(b){for(var a=0;a<this._onScrollListeners.length;a++){if(this._onScrollListeners[a]==b){this._onScrollListeners.splice(a,1);break}}};Timeline._Band.prototype.setSyncWithBand=function(b,a){if(this._syncWithBand){this._syncWithBand.removeOnScrollListener(this._syncWithBandHandler)}this._syncWithBand=b;this._syncWithBand.addOnScrollListener(this._syncWithBandHandler);this._highlight=a;this._positionHighlight()};Timeline._Band.prototype.getLocale=function(){return this._locale};Timeline._Band.prototype.getTimeZone=function(){return this._timeZone};Timeline._Band.prototype.getLabeller=function(){return this._labeller};Timeline._Band.prototype.getIndex=function(){return this._index};Timeline._Band.prototype.getEther=function(){return this._ether};Timeline._Band.prototype.getEtherPainter=function(){return this._etherPainter};Timeline._Band.prototype.getEventSource=function(){return this._eventSource};Timeline._Band.prototype.getEventPainter=function(){return this._eventPainter};Timeline._Band.prototype.getTimeline=function(){return this._timeline};Timeline._Band.prototype.updateEventTrackInfo=function(b,a){this._eventTrackIncrement=a;if(b>this._eventTracksNeeded){this._eventTracksNeeded=b}};Timeline._Band.prototype.checkAutoWidth=function(){if(!this._timeline.autoWidth){return}var a=this._eventPainter.getType()=="overview";var c=a?this._theme.event.overviewTrack.autoWidthMargin:this._theme.event.track.autoWidthMargin;var b=Math.ceil((this._eventTracksNeeded+c)*this._eventTrackIncrement);b+=a?this._theme.event.overviewTrack.offset:this._theme.event.track.offset;var d=this._bandInfo;if(b!=d.width){d.width=b}};Timeline._Band.prototype.layout=function(){this.paint()};Timeline._Band.prototype.paint=function(){this._etherPainter.paint();this._paintDecorators();this._paintEvents()};Timeline._Band.prototype.softLayout=function(){this.softPaint()};Timeline._Band.prototype.softPaint=function(){this._etherPainter.softPaint();this._softPaintDecorators();this._softPaintEvents()};Timeline._Band.prototype.setBandShiftAndWidth=function(a,d){var c=this._keyboardInput.parentNode;var b=a+Math.floor(d/2);if(this._timeline.isHorizontal()){this._div.style.top=a+"px";this._div.style.height=d+"px";c.style.top=b+"px";c.style.left="-1em"}else{this._div.style.left=a+"px";this._div.style.width=d+"px";c.style.left=b+"px";c.style.top="-1em"}};Timeline._Band.prototype.getViewWidth=function(){if(this._timeline.isHorizontal()){return this._div.offsetHeight}else{return this._div.offsetWidth}};Timeline._Band.prototype.setViewLength=function(a){this._viewLength=a;this._recenterDiv();this._onChanging()};Timeline._Band.prototype.getViewLength=function(){return this._viewLength};Timeline._Band.prototype.getTotalViewLength=function(){return Timeline._Band.SCROLL_MULTIPLES*this._viewLength};Timeline._Band.prototype.getViewOffset=function(){return this._viewOffset};Timeline._Band.prototype.getMinDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset)};Timeline._Band.prototype.getMaxDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset+Timeline._Band.SCROLL_MULTIPLES*this._viewLength)};Timeline._Band.prototype.getMinVisibleDate=function(){return this._ether.pixelOffsetToDate(0)};Timeline._Band.prototype.getMinVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(a)};Timeline._Band.prototype.getMaxVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength)};Timeline._Band.prototype.getMaxVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(this._viewLength+a)};Timeline._Band.prototype.getCenterVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength/2)};Timeline._Band.prototype.setMinVisibleDate=function(a){if(!this._changing){this._moveEther(Math.round(-this._ether.dateToPixelOffset(a)))}};Timeline._Band.prototype.setMaxVisibleDate=function(a){if(!this._changing){this._moveEther(Math.round(this._viewLength-this._ether.dateToPixelOffset(a)))}};Timeline._Band.prototype.setCenterVisibleDate=function(a){if(!this._changing){this._moveEther(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)))}};Timeline._Band.prototype.dateToPixelOffset=function(a){return this._ether.dateToPixelOffset(a)-this._viewOffset};Timeline._Band.prototype.pixelOffsetToDate=function(a){return this._ether.pixelOffsetToDate(a+this._viewOffset)};Timeline._Band.prototype.createLayerDiv=function(d,b){var c=this._timeline.getDocument().createElement("div");c.className="timeline-band-layer"+(typeof b=="string"?(" "+b):"");c.style.zIndex=d;this._innerDiv.appendChild(c);var a=this._timeline.getDocument().createElement("div");a.className="timeline-band-layer-inner";if(SimileAjax.Platform.browser.isIE){a.style.cursor="move"}else{a.style.cursor="-moz-grab"}c.appendChild(a);return a};Timeline._Band.prototype.removeLayerDiv=function(a){this._innerDiv.removeChild(a.parentNode)};Timeline._Band.prototype.scrollToCenter=function(b,c){var a=this._ether.dateToPixelOffset(b);if(a<-this._viewLength/2){this.setCenterVisibleDate(this.pixelOffsetToDate(a+this._viewLength))}else{if(a>3*this._viewLength/2){this.setCenterVisibleDate(this.pixelOffsetToDate(a-this._viewLength))}}this._autoScroll(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(b)),c)};Timeline._Band.prototype.showBubbleForEvent=function(c){var a=this.getEventSource().getEvent(c);if(a){var b=this;this.scrollToCenter(a.getStart(),function(){b._eventPainter.showBubble(a)})}};Timeline._Band.prototype.zoom=function(f,a,e,c){if(!this._zoomSteps){return}a+=this._viewOffset;var d=this._ether.pixelOffsetToDate(a);var b=this._ether.zoom(f);this._etherPainter.zoom(b);this._moveEther(Math.round(-this._ether.dateToPixelOffset(d)));this._moveEther(a)};Timeline._Band.prototype._onMouseDown=function(b,a,c){this.closeBubble();this._dragging=true;this._dragX=a.clientX;this._dragY=a.clientY};Timeline._Band.prototype._onMouseMove=function(d,a,e){if(this._dragging){var c=a.clientX-this._dragX;var b=a.clientY-this._dragY;this._dragX=a.clientX;this._dragY=a.clientY;this._moveEther(this._timeline.isHorizontal()?c:b);this._positionHighlight()}};Timeline._Band.prototype._onMouseUp=function(b,a,c){this._dragging=false;this._keyboardInput.focus()};Timeline._Band.prototype._onMouseOut=function(b,a,d){var c=SimileAjax.DOM.getEventRelativeCoordinates(a,b);c.x+=this._viewOffset;if(c.x<0||c.x>b.offsetWidth||c.y<0||c.y>b.offsetHeight){this._dragging=false}};Timeline._Band.prototype._onMouseScroll=function(g,j,e){var a=new Date();a=a.getTime();if(!this._lastScrollTime||((a-this._lastScrollTime)>50)){this._lastScrollTime=a;var h=0;if(j.wheelDelta){h=j.wheelDelta/120}else{if(j.detail){h=-j.detail/3}}var f=this._theme.mouseWheel;if(this._zoomSteps||f==="zoom"){var d=SimileAjax.DOM.getEventRelativeCoordinates(j,g);if(h!=0){var c;if(h>0){c=true}if(h<0){c=false}this._timeline.zoom(c,d.x,d.y,g)}}else{if(f==="scroll"){var b=50*(h<0?-1:1);this._moveEther(b)}}}if(j.stopPropagation){j.stopPropagation()}j.cancelBubble=true;if(j.preventDefault){j.preventDefault()}j.returnValue=false};Timeline._Band.prototype._onDblClick=function(b,a,d){var c=SimileAjax.DOM.getEventRelativeCoordinates(a,b);var e=c.x-(this._viewLength/2-this._viewOffset);this._autoScroll(-e)};Timeline._Band.prototype._onKeyDown=function(b,a,c){if(!this._dragging){switch(a.keyCode){case 27:break;case 37:case 38:this._scrollSpeed=Math.min(50,Math.abs(this._scrollSpeed*1.05));this._moveEther(this._scrollSpeed);break;case 39:case 40:this._scrollSpeed=-Math.min(50,Math.abs(this._scrollSpeed*1.05));this._moveEther(this._scrollSpeed);break;default:return true}this.closeBubble();SimileAjax.DOM.cancelEvent(a);return false}return true};Timeline._Band.prototype._onKeyUp=function(b,a,c){if(!this._dragging){this._scrollSpeed=this._originalScrollSpeed;switch(a.keyCode){case 35:this.setCenterVisibleDate(this._eventSource.getLatestDate());break;case 36:this.setCenterVisibleDate(this._eventSource.getEarliestDate());break;case 33:this._autoScroll(this._timeline.getPixelLength());break;case 34:this._autoScroll(-this._timeline.getPixelLength());break;default:return true}this.closeBubble();SimileAjax.DOM.cancelEvent(a);return false}return true};Timeline._Band.prototype._autoScroll=function(g,e){var c=this;var d=SimileAjax.Graphics.createAnimation(function(a,b){c._moveEther(b)},0,g,1000,e);d.run()};Timeline._Band.prototype._moveEther=function(a){this.closeBubble();if(!this._timeline.shiftOK(this._index,a)){return}this._viewOffset+=a;this._ether.shiftPixels(-a);if(this._timeline.isHorizontal()){this._div.style.left=this._viewOffset+"px"}else{this._div.style.top=this._viewOffset+"px"}if(this._viewOffset>-this._viewLength*0.5||this._viewOffset<-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1.5)){this._recenterDiv()}else{this.softLayout()}this._onChanging()};Timeline._Band.prototype._onChanging=function(){this._changing=true;this._fireOnScroll();this._setSyncWithBandDate();this._changing=false};Timeline._Band.prototype.busy=function(){return(this._changing)};Timeline._Band.prototype._fireOnScroll=function(){for(var a=0;a<this._onScrollListeners.length;a++){this._onScrollListeners[a](this)}};Timeline._Band.prototype._setSyncWithBandDate=function(){if(this._syncWithBand){var a=this._ether.pixelOffsetToDate(this.getViewLength()/2);this._syncWithBand.setCenterVisibleDate(a)}};Timeline._Band.prototype._onHighlightBandScroll=function(){if(this._syncWithBand){var a=this._syncWithBand.getCenterVisibleDate();var b=this._ether.dateToPixelOffset(a);this._moveEther(Math.round(this._viewLength/2-b));if(this._highlight){this._etherPainter.setHighlight(this._syncWithBand.getMinVisibleDate(),this._syncWithBand.getMaxVisibleDate())}}};Timeline._Band.prototype._onAddMany=function(){this._paintEvents()};Timeline._Band.prototype._onClear=function(){this._paintEvents()};Timeline._Band.prototype._positionHighlight=function(){if(this._syncWithBand){var a=this._syncWithBand.getMinVisibleDate();var b=this._syncWithBand.getMaxVisibleDate();if(this._highlight){this._etherPainter.setHighlight(a,b)}}};Timeline._Band.prototype._recenterDiv=function(){this._viewOffset=-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1)/2;if(this._timeline.isHorizontal()){this._div.style.left=this._viewOffset+"px";this._div.style.width=(Timeline._Band.SCROLL_MULTIPLES*this._viewLength)+"px"}else{this._div.style.top=this._viewOffset+"px";this._div.style.height=(Timeline._Band.SCROLL_MULTIPLES*this._viewLength)+"px"}this.layout()};Timeline._Band.prototype._paintEvents=function(){this._eventPainter.paint()};Timeline._Band.prototype._softPaintEvents=function(){this._eventPainter.softPaint()};Timeline._Band.prototype._paintDecorators=function(){for(var a=0;a<this._decorators.length;a++){this._decorators[a].paint()}};Timeline._Band.prototype._softPaintDecorators=function(){for(var a=0;a<this._decorators.length;a++){this._decorators[a].softPaint()}};Timeline._Band.prototype.closeBubble=function(){SimileAjax.WindowManager.cancelPopups()};Timeline.ClassicTheme=new Object();Timeline.ClassicTheme.implementations=[];Timeline.ClassicTheme.create=function(a){if(a==null){a=Timeline.getDefaultLocale()}var b=Timeline.ClassicTheme.implementations[a];if(b==null){b=Timeline.ClassicTheme._Impl}return new b()};Timeline.ClassicTheme._Impl=function(){this.firstDayOfWeek=0;this.autoWidth=false;this.autoWidthAnimationTime=500;this.timeline_start=null;this.timeline_stop=null;this.ether={backgroundColors:[],highlightOpacity:50,interval:{line:{show:true,opacity:25},weekend:{opacity:30},marker:{hAlign:"Bottom",vAlign:"Right"}}};this.event={track:{height:10,gap:2,offset:2,autoWidthMargin:1.5},overviewTrack:{offset:20,tickHeight:6,height:2,gap:1,autoWidthMargin:5},tape:{height:4},instant:{icon:Timeline.urlPrefix+"images/dull-blue-circle.png",iconWidth:10,iconHeight:10,impreciseOpacity:20,impreciseIconMargin:3},duration:{impreciseOpacity:20},label:{backgroundOpacity:50,offsetFromLine:3},highlightColors:["#FFFF00","#FFC000","#FF0000","#0000FF"],highlightLabelBackground:false,bubble:{width:250,maxHeight:0,titleStyler:function(a){a.className="timeline-event-bubble-title"},bodyStyler:function(a){a.className="timeline-event-bubble-body"},imageStyler:function(a){a.className="timeline-event-bubble-image"},wikiStyler:function(a){a.className="timeline-event-bubble-wiki"},timeStyler:function(a){a.className="timeline-event-bubble-time"}}};this.mouseWheel="scroll"};Timeline.LinearEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval};Timeline.LinearEther.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._unit=a.getUnit();if("startsOn" in this._params){this._start=this._unit.parseFromObject(this._params.startsOn)}else{if("endsOn" in this._params){this._start=this._unit.parseFromObject(this._params.endsOn);this.shiftPixels(-this._timeline.getPixelLength())}else{if("centersOn" in this._params){this._start=this._unit.parseFromObject(this._params.centersOn);this.shiftPixels(-this._timeline.getPixelLength()/2)}else{this._start=this._unit.makeDefaultValue();this.shiftPixels(-this._timeline.getPixelLength()/2)}}}};Timeline.LinearEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.LinearEther.prototype.shiftPixels=function(b){var a=this._interval*b/this._pixelsPerInterval;this._start=this._unit.change(this._start,a)};Timeline.LinearEther.prototype.dateToPixelOffset=function(a){var b=this._unit.compare(a,this._start);return this._pixelsPerInterval*b/this._interval};Timeline.LinearEther.prototype.pixelOffsetToDate=function(b){var a=b*this._interval/this._pixelsPerInterval;return this._unit.change(this._start,a)};Timeline.LinearEther.prototype.zoom=function(d){var b=0;var a=this._band._zoomIndex;var c=a;if(d&&(a>0)){c=a-1}if(!d&&(a<(this._band._zoomSteps.length-1))){c=a+1}this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;b=this._band._zoomSteps[c].unit-this._band._zoomSteps[a].unit;return b};Timeline.HotZoneEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval;this._theme=a.theme};Timeline.HotZoneEther.prototype.initialize=function(h,k){this._band=h;this._timeline=k;this._unit=k.getUnit();this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,magnify:1}];var b=this._params;for(var d=0;d<b.zones.length;d++){var g=b.zones[d];var e=this._unit.parseFromObject(g.start);var f=this._unit.parseFromObject(g.end);for(var c=0;c<this._zones.length&&this._unit.compare(f,e)>0;c++){var a=this._zones[c];if(this._unit.compare(e,a.endTime)<0){if(this._unit.compare(e,a.startTime)>0){this._zones.splice(c,0,{startTime:a.startTime,endTime:e,magnify:a.magnify});c++;a.startTime=e}if(this._unit.compare(f,a.endTime)<0){this._zones.splice(c,0,{startTime:e,endTime:f,magnify:g.magnify*a.magnify});c++;a.startTime=f;e=f}else{a.magnify*=g.magnify;e=a.endTime}}}}if("startsOn" in this._params){this._start=this._unit.parseFromObject(this._params.startsOn)}else{if("endsOn" in this._params){this._start=this._unit.parseFromObject(this._params.endsOn);this.shiftPixels(-this._timeline.getPixelLength())}else{if("centersOn" in this._params){this._start=this._unit.parseFromObject(this._params.centersOn);this.shiftPixels(-this._timeline.getPixelLength()/2)}else{this._start=this._unit.makeDefaultValue();this.shiftPixels(-this._timeline.getPixelLength()/2)}}}};Timeline.HotZoneEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.HotZoneEther.prototype.shiftPixels=function(a){this._start=this.pixelOffsetToDate(a)};Timeline.HotZoneEther.prototype.dateToPixelOffset=function(a){return this._dateDiffToPixelOffset(this._start,a)};Timeline.HotZoneEther.prototype.pixelOffsetToDate=function(a){return this._pixelOffsetToDate(a,this._start)};Timeline.HotZoneEther.prototype.zoom=function(d){var b=0;var a=this._band._zoomIndex;var c=a;if(d&&(a>0)){c=a-1}if(!d&&(a<(this._band._zoomSteps.length-1))){c=a+1}this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;b=this._band._zoomSteps[c].unit-this._band._zoomSteps[a].unit;return b};Timeline.HotZoneEther.prototype._dateDiffToPixelOffset=function(j,d){var b=this._getScale();var h=j;var c=d;var a=0;if(this._unit.compare(h,c)<0){var g=0;while(g<this._zones.length){if(this._unit.compare(h,this._zones[g].endTime)<0){break}g++}while(this._unit.compare(h,c)<0){var e=this._zones[g];var f=this._unit.earlier(c,e.endTime);a+=(this._unit.compare(f,h)/(b/e.magnify));h=f;g++}}else{var g=this._zones.length-1;while(g>=0){if(this._unit.compare(h,this._zones[g].startTime)>0){break}g--}while(this._unit.compare(h,c)>0){var e=this._zones[g];var f=this._unit.later(c,e.startTime);a+=(this._unit.compare(f,h)/(b/e.magnify));h=f;g--}}return a};Timeline.HotZoneEther.prototype._pixelOffsetToDate=function(h,c){var g=this._getScale();var e=c;if(h>0){var f=0;while(f<this._zones.length){if(this._unit.compare(e,this._zones[f].endTime)<0){break}f++}while(h>0){var a=this._zones[f];var d=g/a.magnify;if(a.endTime==Number.POSITIVE_INFINITY){e=this._unit.change(e,h*d);h=0}else{var b=this._unit.compare(a.endTime,e)/d;if(b>h){e=this._unit.change(e,h*d);h=0}else{e=a.endTime;h-=b}}f++}}else{var f=this._zones.length-1;while(f>=0){if(this._unit.compare(e,this._zones[f].startTime)>0){break}f--}h=-h;while(h>0){var a=this._zones[f];var d=g/a.magnify;if(a.startTime==Number.NEGATIVE_INFINITY){e=this._unit.change(e,-h*d);h=0}else{var b=this._unit.compare(e,a.startTime)/d;if(b>h){e=this._unit.change(e,-h*d);h=0}else{e=a.startTime;h-=b}}f--}}return e};Timeline.HotZoneEther.prototype._getScale=function(){return this._interval/this._pixelsPerInterval};Timeline.GregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._unit=a.unit;this._multiple=("multiple" in a)?a.multiple:1};Timeline.GregorianEtherPainter.prototype.initialize=function(c,b){this._band=c;this._timeline=b;this._backgroundLayer=c.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._markerLayer=null;this._lineLayer=null;var d=("align" in this._params&&this._params.align!=undefined)?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];var a=("showLine" in this._params)?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,d,a);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.GregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};Timeline.GregorianEtherPainter.prototype.paint=function(){if(this._markerLayer){this._band.removeLayerDiv(this._markerLayer)}this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";if(this._lineLayer){this._band.removeLayerDiv(this._lineLayer)}this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var c=this._band.getMinDate();var f=this._band.getMaxDate();var b=this._band.getTimeZone();var e=this._band.getLabeller();SimileAjax.DateTime.roundDownToInterval(c,this._unit,b,this._multiple,this._theme.firstDayOfWeek);var d=this;var a=function(g){for(var h=0;h<d._multiple;h++){SimileAjax.DateTime.incrementByInterval(g,d._unit)}};while(c.getTime()<f.getTime()){this._intervalMarkerLayout.createIntervalMarker(c,e,this._unit,this._markerLayer,this._lineLayer);a(c)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.GregorianEtherPainter.prototype.softPaint=function(){};Timeline.GregorianEtherPainter.prototype.zoom=function(a){if(a!=0){this._unit+=a}};Timeline.HotZoneGregorianEtherPainter=function(g){this._params=g;this._theme=g.theme;this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,unit:g.unit,multiple:1}];for(var e=0;e<g.zones.length;e++){var b=g.zones[e];var d=SimileAjax.DateTime.parseGregorianDateTime(b.start).getTime();var f=SimileAjax.DateTime.parseGregorianDateTime(b.end).getTime();for(var c=0;c<this._zones.length&&f>d;c++){var a=this._zones[c];if(d<a.endTime){if(d>a.startTime){this._zones.splice(c,0,{startTime:a.startTime,endTime:d,unit:a.unit,multiple:a.multiple});c++;a.startTime=d}if(f<a.endTime){this._zones.splice(c,0,{startTime:d,endTime:f,unit:b.unit,multiple:(b.multiple)?b.multiple:1});c++;a.startTime=f;d=f}else{a.multiple=b.multiple;a.unit=b.unit;d=a.endTime}}}}};Timeline.HotZoneGregorianEtherPainter.prototype.initialize=function(c,b){this._band=c;this._timeline=b;this._backgroundLayer=c.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._markerLayer=null;this._lineLayer=null;var d=("align" in this._params&&this._params.align!=undefined)?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];var a=("showLine" in this._params)?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,d,a);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.HotZoneGregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};Timeline.HotZoneGregorianEtherPainter.prototype.paint=function(){if(this._markerLayer){this._band.removeLayerDiv(this._markerLayer)}this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";if(this._lineLayer){this._band.removeLayerDiv(this._lineLayer)}this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var d=this._band.getMinDate();var a=this._band.getMaxDate();var l=this._band.getTimeZone();var j=this._band.getLabeller();var b=this;var m=function(p,o){for(var q=0;q<o.multiple;q++){SimileAjax.DateTime.incrementByInterval(p,o.unit)}};var c=0;while(c<this._zones.length){if(d.getTime()<this._zones[c].endTime){break}c++}var e=this._zones.length-1;while(e>=0){if(a.getTime()>this._zones[e].startTime){break}e--}for(var h=c;h<=e;h++){var g=this._zones[h];var k=new Date(Math.max(d.getTime(),g.startTime));var f=new Date(Math.min(a.getTime(),g.endTime));SimileAjax.DateTime.roundDownToInterval(k,g.unit,l,g.multiple,this._theme.firstDayOfWeek);SimileAjax.DateTime.roundUpToInterval(f,g.unit,l,g.multiple,this._theme.firstDayOfWeek);while(k.getTime()<f.getTime()){this._intervalMarkerLayout.createIntervalMarker(k,j,g.unit,this._markerLayer,this._lineLayer);m(k,g)}}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.HotZoneGregorianEtherPainter.prototype.softPaint=function(){};Timeline.HotZoneGregorianEtherPainter.prototype.zoom=function(b){if(b!=0){for(var a=0;a<this._zones.length;++a){if(this._zones[a]){this._zones[a].unit+=b}}}};Timeline.YearCountEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate);this._multiple=("multiple" in a)?a.multiple:1};Timeline.YearCountEtherPainter.prototype.initialize=function(c,b){this._band=c;this._timeline=b;this._backgroundLayer=c.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._markerLayer=null;this._lineLayer=null;var d=("align" in this._params)?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];var a=("showLine" in this._params)?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,d,a);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.YearCountEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};Timeline.YearCountEtherPainter.prototype.paint=function(){if(this._markerLayer){this._band.removeLayerDiv(this._markerLayer)}this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";if(this._lineLayer){this._band.removeLayerDiv(this._lineLayer)}this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var b=new Date(this._startDate.getTime());var f=this._band.getMaxDate();var e=this._band.getMinDate().getUTCFullYear()-this._startDate.getUTCFullYear();b.setUTCFullYear(this._band.getMinDate().getUTCFullYear()-e%this._multiple);var c=this;var a=function(g){for(var h=0;h<c._multiple;h++){SimileAjax.DateTime.incrementByInterval(g,SimileAjax.DateTime.YEAR)}};var d={labelInterval:function(g,j){var h=g.getUTCFullYear()-c._startDate.getUTCFullYear();return{text:h,emphasized:h==0}}};while(b.getTime()<f.getTime()){this._intervalMarkerLayout.createIntervalMarker(b,d,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer);a(b)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.YearCountEtherPainter.prototype.softPaint=function(){};Timeline.QuarterlyEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate)};Timeline.QuarterlyEtherPainter.prototype.initialize=function(c,b){this._band=c;this._timeline=b;this._backgroundLayer=c.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._markerLayer=null;this._lineLayer=null;var d=("align" in this._params)?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];var a=("showLine" in this._params)?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,d,a);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.QuarterlyEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};Timeline.QuarterlyEtherPainter.prototype.paint=function(){if(this._markerLayer){this._band.removeLayerDiv(this._markerLayer)}this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";if(this._lineLayer){this._band.removeLayerDiv(this._lineLayer)}this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var b=new Date(0);var e=this._band.getMaxDate();b.setUTCFullYear(Math.max(this._startDate.getUTCFullYear(),this._band.getMinDate().getUTCFullYear()));b.setUTCMonth(this._startDate.getUTCMonth());var c=this;var a=function(f){f.setUTCMonth(f.getUTCMonth()+3)};var d={labelInterval:function(f,h){var g=(4+(f.getUTCMonth()-c._startDate.getUTCMonth())/3)%4;if(g!=0){return{text:"Q"+(g+1),emphasized:false}}else{return{text:"Y"+(f.getUTCFullYear()-c._startDate.getUTCFullYear()+1),emphasized:true}}}};while(b.getTime()<e.getTime()){this._intervalMarkerLayout.createIntervalMarker(b,d,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer);a(b)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.QuarterlyEtherPainter.prototype.softPaint=function(){};Timeline.EtherIntervalMarkerLayout=function(o,m,c,e,h){var a=o.isHorizontal();if(a){if(e=="Top"){this.positionDiv=function(q,p){q.style.left=p+"px";q.style.top="0px"}}else{this.positionDiv=function(q,p){q.style.left=p+"px";q.style.bottom="0px"}}}else{if(e=="Left"){this.positionDiv=function(q,p){q.style.top=p+"px";q.style.left="0px"}}else{this.positionDiv=function(q,p){q.style.top=p+"px";q.style.right="0px"}}}var d=c.ether.interval.marker;var j=c.ether.interval.line;var b=c.ether.interval.weekend;var l=(a?"h":"v")+e;var g=d[l+"Styler"];var k=d[l+"EmphasizedStyler"];var f=SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY];this.createIntervalMarker=function(v,C,D,E,s){var w=Math.round(m.dateToPixelOffset(v));if(h&&D!=SimileAjax.DateTime.WEEK){var x=o.getDocument().createElement("div");x.className="timeline-ether-lines";if(j.opacity<100){SimileAjax.Graphics.setOpacity(x,j.opacity)}if(a){x.style.left=w+"px"}else{x.style.top=w+"px"}s.appendChild(x)}if(D==SimileAjax.DateTime.WEEK){var p=c.firstDayOfWeek;var y=new Date(v.getTime()+(6-p-7)*f);var B=new Date(y.getTime()+2*f);var z=Math.round(m.dateToPixelOffset(y));var u=Math.round(m.dateToPixelOffset(B));var t=Math.max(1,u-z);var r=o.getDocument().createElement("div");r.className="timeline-ether-weekends";if(b.opacity<100){SimileAjax.Graphics.setOpacity(r,b.opacity)}if(a){r.style.left=z+"px";r.style.width=t+"px"}else{r.style.top=z+"px";r.style.height=t+"px"}s.appendChild(r)}var A=C.labelInterval(v,D);var q=o.getDocument().createElement("div");q.innerHTML=A.text;q.className="timeline-date-label";if(A.emphasized){q.className+=" timeline-date-label-em"}this.positionDiv(q,w);E.appendChild(q);return q}};Timeline.EtherHighlight=function(c,e,d,b){var a=c.isHorizontal();this._highlightDiv=null;this._createHighlightDiv=function(){if(this._highlightDiv==null){this._highlightDiv=c.getDocument().createElement("div");this._highlightDiv.setAttribute("name","ether-highlight");this._highlightDiv.className="timeline-ether-highlight";var f=d.ether.highlightOpacity;if(f<100){SimileAjax.Graphics.setOpacity(this._highlightDiv,f)}b.appendChild(this._highlightDiv)}};this.position=function(f,j){this._createHighlightDiv();var k=Math.round(e.dateToPixelOffset(f));var h=Math.round(e.dateToPixelOffset(j));var g=Math.max(h-k,3);if(a){this._highlightDiv.style.left=k+"px";this._highlightDiv.style.width=g+"px";this._highlightDiv.style.height=(e.getViewWidth()-4)+"px"}else{this._highlightDiv.style.top=k+"px";this._highlightDiv.style.height=g+"px";this._highlightDiv.style.width=(e.getViewWidth()-4)+"px"}}};Timeline.EventUtils={};Timeline.EventUtils.getNewEventID=function(){if(this._lastEventID==null){this._lastEventID=0}this._lastEventID+=1;return"e"+this._lastEventID};Timeline.EventUtils.decodeEventElID=function(b){var d=b.split("-");if(d[1]!="tl"){alert("Internal Timeline problem 101, please consult support");return{band:null,evt:null}}var c=Timeline.getTimelineFromID(d[2]);var e=c.getBand(d[3]);var a=e.getEventSource.getEvent(d[4]);return{band:e,evt:a}};Timeline.EventUtils.encodeEventElID=function(c,d,b,a){return b+"-tl-"+c.timelineID+"-"+d.getIndex()+"-"+a.getID()};Timeline.GregorianDateLabeller=function(a,b){this._locale=a;this._timeZone=b};Timeline.GregorianDateLabeller.monthNames=[];Timeline.GregorianDateLabeller.dayNames=[];Timeline.GregorianDateLabeller.labelIntervalFunctions=[];Timeline.GregorianDateLabeller.getMonthName=function(b,a){return Timeline.GregorianDateLabeller.monthNames[a][b]};Timeline.GregorianDateLabeller.prototype.labelInterval=function(a,c){var b=Timeline.GregorianDateLabeller.labelIntervalFunctions[this._locale];if(b==null){b=Timeline.GregorianDateLabeller.prototype.defaultLabelInterval}return b.call(this,a,c)};Timeline.GregorianDateLabeller.prototype.labelPrecise=function(a){return SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone).toUTCString()};Timeline.GregorianDateLabeller.prototype.defaultLabelInterval=function(b,f){var c;var e=false;b=SimileAjax.DateTime.removeTimeZoneOffset(b,this._timeZone);switch(f){case SimileAjax.DateTime.MILLISECOND:c=b.getUTCMilliseconds();break;case SimileAjax.DateTime.SECOND:c=b.getUTCSeconds();break;case SimileAjax.DateTime.MINUTE:var a=b.getUTCMinutes();if(a==0){c=b.getUTCHours()+":00";e=true}else{c=a}break;case SimileAjax.DateTime.HOUR:c=b.getUTCHours()+"hr";break;case SimileAjax.DateTime.DAY:c=Timeline.GregorianDateLabeller.getMonthName(b.getUTCMonth(),this._locale)+" "+b.getUTCDate();break;case SimileAjax.DateTime.WEEK:c=Timeline.GregorianDateLabeller.getMonthName(b.getUTCMonth(),this._locale)+" "+b.getUTCDate();break;case SimileAjax.DateTime.MONTH:var a=b.getUTCMonth();if(a!=0){c=Timeline.GregorianDateLabeller.getMonthName(a,this._locale);break}case SimileAjax.DateTime.YEAR:case SimileAjax.DateTime.DECADE:case SimileAjax.DateTime.CENTURY:case SimileAjax.DateTime.MILLENNIUM:var d=b.getUTCFullYear();if(d>0){c=b.getUTCFullYear()}else{c=(1-d)+"BC"}e=(f==SimileAjax.DateTime.MONTH)||(f==SimileAjax.DateTime.DECADE&&d%100==0)||(f==SimileAjax.DateTime.CENTURY&&d%1000==0);break;default:c=b.toUTCString()}return{text:c,emphasized:e}};Timeline.DefaultEventSource=function(a){this._events=(a instanceof Object)?a:new SimileAjax.EventIndex();this._listeners=[]};Timeline.DefaultEventSource.prototype.addListener=function(a){this._listeners.push(a)};Timeline.DefaultEventSource.prototype.removeListener=function(b){for(var a=0;a<this._listeners.length;a++){if(this._listeners[a]==b){this._listeners.splice(a,1);break}}};Timeline.DefaultEventSource.prototype.loadXML=function(g,a){var c=this._getBaseURL(a);var h=g.documentElement.getAttribute("wiki-url");var m=g.documentElement.getAttribute("wiki-section");var e=g.documentElement.getAttribute("date-time-format");var f=this._events.getUnit().getParser(e);var d=g.documentElement.firstChild;var j=false;while(d!=null){if(d.nodeType==1){var l="";if(d.firstChild!=null&&d.firstChild.nodeType==3){l=d.firstChild.nodeValue}var b=(d.getAttribute("isDuration")===null&&d.getAttribute("durationEvent")===null)||d.getAttribute("isDuration")=="false"||d.getAttribute("durationEvent")=="false";var k=new Timeline.DefaultEventSource.Event({id:d.getAttribute("id"),start:f(d.getAttribute("start")),end:f(d.getAttribute("end")),latestStart:f(d.getAttribute("latestStart")),earliestEnd:f(d.getAttribute("earliestEnd")),instant:b,text:d.getAttribute("title"),description:l,image:this._resolveRelativeURL(d.getAttribute("image"),c),link:this._resolveRelativeURL(d.getAttribute("link"),c),icon:this._resolveRelativeURL(d.getAttribute("icon"),c),color:d.getAttribute("color"),textColor:d.getAttribute("textColor"),hoverText:d.getAttribute("hoverText"),classname:d.getAttribute("classname"),tapeImage:d.getAttribute("tapeImage"),tapeRepeat:d.getAttribute("tapeRepeat"),caption:d.getAttribute("caption"),eventID:d.getAttribute("eventID"),trackNum:d.getAttribute("trackNum")});k._node=d;k.getProperty=function(o){return this._node.getAttribute(o)};k.setWikiInfo(h,m);this._events.add(k);j=true}d=d.nextSibling}if(j){this._fire("onAddMany",[])}};Timeline.DefaultEventSource.prototype.loadJSON=function(g,b){var d=this._getBaseURL(b);var k=false;if(g&&g.events){var j=("wikiURL" in g)?g.wikiURL:null;var m=("wikiSection" in g)?g.wikiSection:null;var e=("dateTimeFormat" in g)?g.dateTimeFormat:null;var h=this._events.getUnit().getParser(e);for(var f=0;f<g.events.length;f++){var a=g.events[f];var c=a.isDuration||(a.durationEvent!=null&&!a.durationEvent);var l=new Timeline.DefaultEventSource.Event({id:("id" in a)?a.id:undefined,start:h(a.start),end:h(a.end),latestStart:h(a.latestStart),earliestEnd:h(a.earliestEnd),instant:c,text:a.title,description:a.description,image:this._resolveRelativeURL(a.image,d),link:this._resolveRelativeURL(a.link,d),icon:this._resolveRelativeURL(a.icon,d),color:a.color,textColor:a.textColor,hoverText:a.hoverText,classname:a.classname,tapeImage:a.tapeImage,tapeRepeat:a.tapeRepeat,caption:a.caption,eventID:a.eventID,trackNum:a.trackNum});l._obj=a;l.getProperty=function(o){return this._obj[o]};l.setWikiInfo(j,m);this._events.add(l);k=true}}if(k){this._fire("onAddMany",[])}};Timeline.DefaultEventSource.prototype.loadSPARQL=function(h,a){var d=this._getBaseURL(a);var f="iso8601";var g=this._events.getUnit().getParser(f);if(h==null){return}var e=h.documentElement.firstChild;while(e!=null&&(e.nodeType!=1||e.nodeName!="results")){e=e.nextSibling}var k=null;var o=null;if(e!=null){k=e.getAttribute("wiki-url");o=e.getAttribute("wiki-section");e=e.firstChild}var l=false;while(e!=null){if(e.nodeType==1){var c={};var j=e.firstChild;while(j!=null){if(j.nodeType==1&&j.firstChild!=null&&j.firstChild.nodeType==1&&j.firstChild.firstChild!=null&&j.firstChild.firstChild.nodeType==3){c[j.getAttribute("name")]=j.firstChild.firstChild.nodeValue}j=j.nextSibling}if(c.start==null&&c.date!=null){c.start=c.date}var b=(c.isDuration===null&&c.durationEvent===null)||c.isDuration=="false"||c.durationEvent=="false";var m=new Timeline.DefaultEventSource.Event({id:c.id,start:g(c.start),end:g(c.end),latestStart:g(c.latestStart),earliestEnd:g(c.earliestEnd),instant:b,text:c.title,description:c.description,image:this._resolveRelativeURL(c.image,d),link:this._resolveRelativeURL(c.link,d),icon:this._resolveRelativeURL(c.icon,d),color:c.color,textColor:c.textColor,hoverText:c.hoverText,caption:c.caption,classname:c.classname,tapeImage:c.tapeImage,tapeRepeat:c.tapeRepeat,eventID:c.eventID,trackNum:c.trackNum});m._bindings=c;m.getProperty=function(p){return this._bindings[p]};m.setWikiInfo(k,o);this._events.add(m);l=true}e=e.nextSibling}if(l){this._fire("onAddMany",[])}};Timeline.DefaultEventSource.prototype.add=function(a){this._events.add(a);this._fire("onAddOne",[a])};Timeline.DefaultEventSource.prototype.addMany=function(b){for(var a=0;a<b.length;a++){this._events.add(b[a])}this._fire("onAddMany",[])};Timeline.DefaultEventSource.prototype.clear=function(){this._events.removeAll();this._fire("onClear",[])};Timeline.DefaultEventSource.prototype.getEvent=function(a){return this._events.getEvent(a)};Timeline.DefaultEventSource.prototype.getEventIterator=function(a,b){return this._events.getIterator(a,b)};Timeline.DefaultEventSource.prototype.getEventReverseIterator=function(a,b){return this._events.getReverseIterator(a,b)};Timeline.DefaultEventSource.prototype.getAllEventIterator=function(){return this._events.getAllIterator()};Timeline.DefaultEventSource.prototype.getCount=function(){return this._events.getCount()};Timeline.DefaultEventSource.prototype.getEarliestDate=function(){return this._events.getEarliestDate()};Timeline.DefaultEventSource.prototype.getLatestDate=function(){return this._events.getLatestDate()};Timeline.DefaultEventSource.prototype._fire=function(b,a){for(var c=0;c<this._listeners.length;c++){var d=this._listeners[c];if(b in d){try{d[b].apply(d,a)}catch(f){SimileAjax.Debug.exception(f)}}}};Timeline.DefaultEventSource.prototype._getBaseURL=function(a){if(a.indexOf("://")<0){var c=this._getBaseURL(document.location.href);if(a.substr(0,1)=="/"){a=c.substr(0,c.indexOf("/",c.indexOf("://")+3))+a}else{a=c+a}}var b=a.lastIndexOf("/");if(b<0){return""}else{return a.substr(0,b+1)}};Timeline.DefaultEventSource.prototype._resolveRelativeURL=function(a,b){if(a==null||a==""){return a}else{if(a.indexOf("://")>0){return a}else{if(a.substr(0,1)=="/"){return b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a}else{return b+a}}}};Timeline.DefaultEventSource.Event=function(a){function d(e){return(a[e]!=null&&a[e]!="")?a[e]:null}var c=a.id?a.id.trim():"";this._id=c.length>0?c:Timeline.EventUtils.getNewEventID();this._instant=a.instant||(a.end==null);this._start=a.start;this._end=(a.end!=null)?a.end:a.start;this._latestStart=(a.latestStart!=null)?a.latestStart:(a.instant?this._end:this._start);this._earliestEnd=(a.earliestEnd!=null)?a.earliestEnd:this._end;var b=[];if(this._start>this._latestStart){this._latestStart=this._start;b.push("start is > latestStart")}if(this._start>this._earliestEnd){this._earliestEnd=this._latestStart;b.push("start is > earliestEnd")}if(this._start>this._end){this._end=this._earliestEnd;b.push("start is > end")}if(this._latestStart>this._earliestEnd){this._earliestEnd=this._latestStart;b.push("latestStart is > earliestEnd")}if(this._latestStart>this._end){this._end=this._earliestEnd;b.push("latestStart is > end")}if(this._earliestEnd>this._end){this._end=this._earliestEnd;b.push("earliestEnd is > end")}this._eventID=d("eventID");this._text=(a.text!=null)?SimileAjax.HTML.deEntify(a.text):"";if(b.length>0){this._text+=" PROBLEM: "+b.join(", ")}this._description=SimileAjax.HTML.deEntify(a.description);this._image=d("image");this._link=d("link");this._title=d("hoverText");this._title=d("caption");this._icon=d("icon");this._color=d("color");this._textColor=d("textColor");this._classname=d("classname");this._tapeImage=d("tapeImage");this._tapeRepeat=d("tapeRepeat");this._trackNum=d("trackNum");if(this._trackNum!=null){this._trackNum=parseInt(this._trackNum)}this._wikiURL=null;this._wikiSection=null};Timeline.DefaultEventSource.Event.prototype={getID:function(){return this._id},isInstant:function(){return this._instant},isImprecise:function(){return this._start!=this._latestStart||this._end!=this._earliestEnd},getStart:function(){return this._start},getEnd:function(){return this._end},getLatestStart:function(){return this._latestStart},getEarliestEnd:function(){return this._earliestEnd},getEventID:function(){return this._eventID},getText:function(){return this._text},getDescription:function(){return this._description},getImage:function(){return this._image},getLink:function(){return this._link},getIcon:function(){return this._icon},getColor:function(){return this._color},getTextColor:function(){return this._textColor},getClassName:function(){return this._classname},getTapeImage:function(){return this._tapeImage},getTapeRepeat:function(){return this._tapeRepeat},getTrackNum:function(){return this._trackNum},getProperty:function(a){return null},getWikiURL:function(){return this._wikiURL},getWikiSection:function(){return this._wikiSection},setWikiInfo:function(b,a){this._wikiURL=b;this._wikiSection=a},fillDescription:function(a){a.innerHTML=this._description},fillWikiInfo:function(e){e.style.display="none";if(this._wikiURL==null||this._wikiSection==null){return}var d=this.getProperty("wikiID");if(d==null||d.length==0){d=this.getText()}if(d==null||d.length==0){return}e.style.display="inline";d=d.replace(/\s/g,"_");var c=this._wikiURL+this._wikiSection.replace(/\s/g,"_")+"/"+d;var b=document.createElement("a");b.href=c;b.target="new";b.innerHTML=Timeline.strings[Timeline.clientLocale].wikiLinkLabel;e.appendChild(document.createTextNode("["));e.appendChild(b);e.appendChild(document.createTextNode("]"))},fillTime:function(a,b){if(this._instant){if(this.isImprecise()){a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)));a.appendChild(a.ownerDocument.createElement("br"));a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end)))}else{a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)))}}else{if(this.isImprecise()){a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)+" ~ "+b.labelPrecise(this._latestStart)));a.appendChild(a.ownerDocument.createElement("br"));a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._earliestEnd)+" ~ "+b.labelPrecise(this._end)))}else{a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)));a.appendChild(a.ownerDocument.createElement("br"));a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end)))}}},fillInfoBubble:function(b,e,m){var o=b.ownerDocument;var l=this.getText();var j=this.getLink();var d=this.getImage();if(d!=null){var f=o.createElement("img");f.src=d;e.event.bubble.imageStyler(f);b.appendChild(f)}var p=o.createElement("div");var c=o.createTextNode(l);if(j!=null){var k=o.createElement("a");k.href=j;k.appendChild(c);p.appendChild(k)}else{p.appendChild(c)}e.event.bubble.titleStyler(p);b.appendChild(p);var q=o.createElement("div");this.fillDescription(q);e.event.bubble.bodyStyler(q);b.appendChild(q);var h=o.createElement("div");this.fillTime(h,m);e.event.bubble.timeStyler(h);b.appendChild(h);var g=o.createElement("div");this.fillWikiInfo(g);e.event.bubble.wikiStyler(g);b.appendChild(g)}};Timeline.OriginalEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._eventPaintListeners=[];this._filterMatcher=null;this._highlightMatcher=null;this._frc=null;this._eventIdToElmt={}};Timeline.OriginalEventPainter.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._backLayer=null;this._eventLayer=null;this._lineLayer=null;this._highlightLayer=null;this._eventIdToElmt=null};Timeline.OriginalEventPainter.prototype.getType=function(){return"original"};Timeline.OriginalEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.OriginalEventPainter.prototype.removeOnSelectListener=function(b){for(var a=0;a<this._onSelectListeners.length;a++){if(this._onSelectListeners[a]==b){this._onSelectListeners.splice(a,1);break}}};Timeline.OriginalEventPainter.prototype.addEventPaintListener=function(a){this._eventPaintListeners.push(a)};Timeline.OriginalEventPainter.prototype.removeEventPaintListener=function(b){for(var a=0;a<this._eventPaintListeners.length;a++){if(this._eventPaintListeners[a]==b){this._eventPaintListeners.splice(a,1);break}}};Timeline.OriginalEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OriginalEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OriginalEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.OriginalEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};Timeline.OriginalEventPainter.prototype.paint=function(){var b=this._band.getEventSource();if(b==null){return}this._eventIdToElmt={};this._fireEventPaintListeners("paintStarting",null,null);this._prepareForPainting();var j=this._params.theme.event;var g=Math.max(j.track.height,j.tape.height+this._frc.getLineHeight());var f={trackOffset:j.track.offset,trackHeight:g,trackGap:j.track.gap,trackIncrement:g+j.track.gap,icon:j.instant.icon,iconWidth:j.instant.iconWidth,iconHeight:j.instant.iconHeight,labelWidth:j.label.width,maxLabelChar:j.label.maxLabelChar,impreciseIconMargin:j.instant.impreciseIconMargin};var c=this._band.getMinDate();var a=this._band.getMaxDate();var k=(this._filterMatcher!=null)?this._filterMatcher:function(l){return true};var e=(this._highlightMatcher!=null)?this._highlightMatcher:function(l){return -1};var d=b.getEventReverseIterator(c,a);while(d.hasNext()){var h=d.next();if(k(h)){this.paintEvent(h,f,this._params.theme,e(h))}}this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._tracks.length,f.trackIncrement);this._fireEventPaintListeners("paintEnded",null,null)};Timeline.OriginalEventPainter.prototype.softPaint=function(){};Timeline.OriginalEventPainter.prototype._prepareForPainting=function(){var b=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var a=document.createElement("span");a.className="timeline-event-label";this._backLayer.appendChild(a);this._frc=SimileAjax.Graphics.getFontRenderingContext(a)}this._frc.update();this._tracks=[];if(this._highlightLayer!=null){b.removeLayerDiv(this._highlightLayer)}this._highlightLayer=b.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";if(this._lineLayer!=null){b.removeLayerDiv(this._lineLayer)}this._lineLayer=b.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";if(this._eventLayer!=null){b.removeLayerDiv(this._eventLayer)}this._eventLayer=b.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};Timeline.OriginalEventPainter.prototype.paintEvent=function(b,c,d,a){if(b.isInstant()){this.paintInstantEvent(b,c,d,a)}else{this.paintDurationEvent(b,c,d,a)}};Timeline.OriginalEventPainter.prototype.paintInstantEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseInstantEvent(b,c,d,a)}else{this.paintPreciseInstantEvent(b,c,d,a)}};Timeline.OriginalEventPainter.prototype.paintDurationEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseDurationEvent(b,c,d,a)}else{this.paintPreciseDurationEvent(b,c,d,a)}};Timeline.OriginalEventPainter.prototype.paintPreciseInstantEvent=function(o,s,u,t){var x=this._timeline.getDocument();var m=o.getText();var e=o.getStart();var c=Math.round(this._band.dateToPixelOffset(e));var a=Math.round(c+s.iconWidth/2);var l=Math.round(c-s.iconWidth/2);var h=this._getLabelDivClassName(o);var j=this._frc.computeSize(m,h);var y=a+u.event.label.offsetFromLine;var d=y+j.width;var w=d;var q=this._findFreeTrack(o,w);var v=Math.round(s.trackOffset+q*s.trackIncrement+s.trackHeight/2-j.height/2);var b=this._paintEventIcon(o,q,l,s,u,0);var r=this._paintEventLabel(o,m,y,v,j.width,j.height,u,h,t);var f=[b.elmt,r.elmt];var p=this;var k=function(z,A,B){return p._onClickInstantEvent(b.elmt,A,o)};SimileAjax.DOM.registerEvent(b.elmt,"mousedown",k);SimileAjax.DOM.registerEvent(r.elmt,"mousedown",k);var g=this._createHighlightDiv(t,b,u,o);if(g!=null){f.push(g)}this._fireEventPaintListeners("paintedEvent",o,f);this._eventIdToElmt[o.getID()]=b.elmt;this._tracks[q]=l};Timeline.OriginalEventPainter.prototype.paintImpreciseInstantEvent=function(r,v,A,x){var C=this._timeline.getDocument();var p=r.getText();var g=r.getStart();var y=r.getEnd();var d=Math.round(this._band.dateToPixelOffset(g));var b=Math.round(this._band.dateToPixelOffset(y));var a=Math.round(d+v.iconWidth/2);var o=Math.round(d-v.iconWidth/2);var k=this._getLabelDivClassName(r);var l=this._frc.computeSize(p,k);var D=a+A.event.label.offsetFromLine;var e=D+l.width;var B=Math.max(e,b);var t=this._findFreeTrack(r,B);var q=A.event.tape.height;var z=Math.round(v.trackOffset+t*v.trackIncrement+q);var c=this._paintEventIcon(r,t,o,v,A,q);var u=this._paintEventLabel(r,p,D,z,l.width,l.height,A,k,x);var w=r.getColor();w=w!=null?w:A.event.instant.impreciseColor;var f=this._paintEventTape(r,t,d,b,w,A.event.instant.impreciseOpacity,v,A,0);var h=[c.elmt,u.elmt,f.elmt];var s=this;var m=function(E,F,G){return s._onClickInstantEvent(c.elmt,F,r)};SimileAjax.DOM.registerEvent(c.elmt,"mousedown",m);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",m);SimileAjax.DOM.registerEvent(u.elmt,"mousedown",m);var j=this._createHighlightDiv(x,c,A,r);if(j!=null){h.push(j)}this._fireEventPaintListeners("paintedEvent",r,h);this._eventIdToElmt[r.getID()]=c.elmt;this._tracks[t]=o};Timeline.OriginalEventPainter.prototype.paintPreciseDurationEvent=function(m,r,v,t){var y=this._timeline.getDocument();var l=m.getText();var e=m.getStart();var u=m.getEnd();var b=Math.round(this._band.dateToPixelOffset(e));var a=Math.round(this._band.dateToPixelOffset(u));var h=this._getLabelDivClassName(m);var j=this._frc.computeSize(l,h);var z=b;var c=z+j.width;var x=Math.max(c,a);var p=this._findFreeTrack(m,x);var w=Math.round(r.trackOffset+p*r.trackIncrement+v.event.tape.height);var s=m.getColor();s=s!=null?s:v.event.duration.color;var d=this._paintEventTape(m,p,b,a,s,100,r,v,0);var q=this._paintEventLabel(m,l,z,w,j.width,j.height,v,h,t);var f=[d.elmt,q.elmt];var o=this;var k=function(A,B,C){return o._onClickDurationEvent(d.elmt,B,m)};SimileAjax.DOM.registerEvent(d.elmt,"mousedown",k);SimileAjax.DOM.registerEvent(q.elmt,"mousedown",k);var g=this._createHighlightDiv(t,d,v,m);if(g!=null){f.push(g)}this._fireEventPaintListeners("paintedEvent",m,f);this._eventIdToElmt[m.getID()]=d.elmt;this._tracks[p]=b};Timeline.OriginalEventPainter.prototype.paintImpreciseDurationEvent=function(p,u,A,x){var D=this._timeline.getDocument();var o=p.getText();var e=p.getStart();var v=p.getLatestStart();var y=p.getEnd();var C=p.getEarliestEnd();var c=Math.round(this._band.dateToPixelOffset(e));var g=Math.round(this._band.dateToPixelOffset(v));var a=Math.round(this._band.dateToPixelOffset(y));var h=Math.round(this._band.dateToPixelOffset(C));var k=this._getLabelDivClassName(p);var l=this._frc.computeSize(o,k);var E=g;var b=E+l.width;var B=Math.max(b,a);var r=this._findFreeTrack(p,B);var z=Math.round(u.trackOffset+r*u.trackIncrement+A.event.tape.height);var w=p.getColor();w=w!=null?w:A.event.duration.color;var t=this._paintEventTape(p,r,c,a,A.event.duration.impreciseColor,A.event.duration.impreciseOpacity,u,A,0);var d=this._paintEventTape(p,r,g,h,w,100,u,A,1);var s=this._paintEventLabel(p,o,E,z,l.width,l.height,A,k,x);var f=[t.elmt,d.elmt,s.elmt];var q=this;var m=function(F,G,H){return q._onClickDurationEvent(d.elmt,G,p)};SimileAjax.DOM.registerEvent(d.elmt,"mousedown",m);SimileAjax.DOM.registerEvent(s.elmt,"mousedown",m);var j=this._createHighlightDiv(x,d,A,p);if(j!=null){f.push(j)}this._fireEventPaintListeners("paintedEvent",p,f);this._eventIdToElmt[p.getID()]=d.elmt;this._tracks[r]=c};Timeline.OriginalEventPainter.prototype._encodeEventElID=function(b,a){return Timeline.EventUtils.encodeEventElID(this._timeline,this._band,b,a)};Timeline.OriginalEventPainter.prototype._findFreeTrack=function(e,a){var d=e.getTrackNum();if(d!=null){return d}for(var c=0;c<this._tracks.length;c++){var b=this._tracks[c];if(b>a){break}}return c};Timeline.OriginalEventPainter.prototype._paintEventIcon=function(k,f,b,g,e,c){var j=k.getIcon();j=j!=null?j:g.icon;var h;if(c>0){h=g.trackOffset+f*g.trackIncrement+c+g.impreciseIconMargin}else{var l=g.trackOffset+f*g.trackIncrement+g.trackHeight/2;h=Math.round(l-g.iconHeight/2)}var d=SimileAjax.Graphics.createTranslucentImage(j);var a=this._timeline.getDocument().createElement("div");a.className=this._getElClassName("timeline-event-icon",k,"icon");a.id=this._encodeEventElID("icon",k);a.style.left=b+"px";a.style.top=h+"px";a.appendChild(d);if(k._title!=null){a.title=k._title}this._eventLayer.appendChild(a);return{left:b,top:h,width:g.iconWidth,height:g.iconHeight,elmt:a}};Timeline.OriginalEventPainter.prototype._paintEventLabel=function(k,l,c,h,a,m,e,f,b){var j=this._timeline.getDocument();var g=j.createElement("div");g.className=f;g.id=this._encodeEventElID("label",k);g.style.left=c+"px";g.style.width=a+"px";g.style.top=h+"px";g.innerHTML=l;if(k._title!=null){g.title=k._title}var d=k.getTextColor();if(d==null){d=k.getColor()}if(d!=null){g.style.color=d}if(e.event.highlightLabelBackground&&b>=0){g.style.background=this._getHighlightColor(b,e)}this._eventLayer.appendChild(g);return{left:c,top:h,width:a,height:m,elmt:g}};Timeline.OriginalEventPainter.prototype._paintEventTape=function(p,j,f,a,c,h,k,g,q){var b=a-f;var e=g.event.tape.height;var l=k.trackOffset+j*k.trackIncrement;var o=this._timeline.getDocument().createElement("div");o.className=this._getElClassName("timeline-event-tape",p,"tape");o.id=this._encodeEventElID("tape"+q,p);o.style.left=f+"px";o.style.width=b+"px";o.style.height=e+"px";o.style.top=l+"px";if(p._title!=null){o.title=p._title}if(c!=null){o.style.backgroundColor=c}var m=p.getTapeImage();var d=p.getTapeRepeat();d=d!=null?d:"repeat";if(m!=null){o.style.backgroundImage="url("+m+")";o.style.backgroundRepeat=d}SimileAjax.Graphics.setOpacity(o,h);this._eventLayer.appendChild(o);return{left:f,top:l,width:b,height:e,elmt:o}};Timeline.OriginalEventPainter.prototype._getLabelDivClassName=function(a){return this._getElClassName("timeline-event-label",a,"label")};Timeline.OriginalEventPainter.prototype._getElClassName=function(b,a,d){var e=a.getClassName(),c=[];if(e){if(d){c.push(d+"-"+e+" ")}c.push(e+" ")}c.push(b);return(c.join(""))};Timeline.OriginalEventPainter.prototype._getHighlightColor=function(a,c){var b=c.event.highlightColors;return b[Math.min(a,b.length-1)]};Timeline.OriginalEventPainter.prototype._createHighlightDiv=function(a,d,f,b){var g=null;if(a>=0){var e=this._timeline.getDocument();var c=this._getHighlightColor(a,f);g=e.createElement("div");g.className=this._getElClassName("timeline-event-highlight",b,"highlight");g.id=this._encodeEventElID("highlight0",b);g.style.position="absolute";g.style.overflow="hidden";g.style.left=(d.left-2)+"px";g.style.width=(d.width+4)+"px";g.style.top=(d.top-2)+"px";g.style.height=(d.height+4)+"px";g.style.background=c;this._highlightLayer.appendChild(g)}return g};Timeline.OriginalEventPainter.prototype._onClickInstantEvent=function(b,d,a){var e=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(e.left+Math.ceil(b.offsetWidth/2),e.top+Math.ceil(b.offsetHeight/2),a);this._fireOnSelect(a.getID());d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.OriginalEventPainter.prototype._onClickDurationEvent=function(e,d,b){if("pageX" in d){var a=d.pageX;var g=d.pageY}else{var f=SimileAjax.DOM.getPageCoordinates(e);var a=d.offsetX+f.left;var g=d.offsetY+f.top}this._showBubble(a,g,b);this._fireOnSelect(b.getID());d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.OriginalEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var d=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(d.left+b.offsetWidth/2,d.top+b.offsetHeight/2,a)}};Timeline.OriginalEventPainter.prototype._showBubble=function(a,e,b){var d=document.createElement("div");var c=this._params.theme.event.bubble;b.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,e,c.width,null,c.maxHeight)};Timeline.OriginalEventPainter.prototype._fireOnSelect=function(b){for(var a=0;a<this._onSelectListeners.length;a++){this._onSelectListeners[a](b)}};Timeline.OriginalEventPainter.prototype._fireEventPaintListeners=function(d,a,c){for(var b=0;b<this._eventPaintListeners.length;b++){this._eventPaintListeners[b](this._band,d,a,c)}};Timeline.DetailedEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._filterMatcher=null;this._highlightMatcher=null;this._frc=null;this._eventIdToElmt={}};Timeline.DetailedEventPainter.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._backLayer=null;this._eventLayer=null;this._lineLayer=null;this._highlightLayer=null;this._eventIdToElmt=null};Timeline.DetailedEventPainter.prototype.getType=function(){return"detailed"};Timeline.DetailedEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.DetailedEventPainter.prototype.removeOnSelectListener=function(b){for(var a=0;a<this._onSelectListeners.length;a++){if(this._onSelectListeners[a]==b){this._onSelectListeners.splice(a,1);break}}};Timeline.DetailedEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.DetailedEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.DetailedEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.DetailedEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};Timeline.DetailedEventPainter.prototype.paint=function(){var b=this._band.getEventSource();if(b==null){return}this._eventIdToElmt={};this._prepareForPainting();var j=this._params.theme.event;var g=Math.max(j.track.height,this._frc.getLineHeight());var f={trackOffset:Math.round(this._band.getViewWidth()/2-g/2),trackHeight:g,trackGap:j.track.gap,trackIncrement:g+j.track.gap,icon:j.instant.icon,iconWidth:j.instant.iconWidth,iconHeight:j.instant.iconHeight,labelWidth:j.label.width};var c=this._band.getMinDate();var a=this._band.getMaxDate();var k=(this._filterMatcher!=null)?this._filterMatcher:function(l){return true};var e=(this._highlightMatcher!=null)?this._highlightMatcher:function(l){return -1};var d=b.getEventReverseIterator(c,a);while(d.hasNext()){var h=d.next();if(k(h)){this.paintEvent(h,f,this._params.theme,e(h))}}this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._lowerTracks.length+this._upperTracks.length,f.trackIncrement)};Timeline.DetailedEventPainter.prototype.softPaint=function(){};Timeline.DetailedEventPainter.prototype._prepareForPainting=function(){var b=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var a=document.createElement("span");a.className="timeline-event-label";this._backLayer.appendChild(a);this._frc=SimileAjax.Graphics.getFontRenderingContext(a)}this._frc.update();this._lowerTracks=[];this._upperTracks=[];if(this._highlightLayer!=null){b.removeLayerDiv(this._highlightLayer)}this._highlightLayer=b.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";if(this._lineLayer!=null){b.removeLayerDiv(this._lineLayer)}this._lineLayer=b.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";if(this._eventLayer!=null){b.removeLayerDiv(this._eventLayer)}this._eventLayer=b.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};Timeline.DetailedEventPainter.prototype.paintEvent=function(b,c,d,a){if(b.isInstant()){this.paintInstantEvent(b,c,d,a)}else{this.paintDurationEvent(b,c,d,a)}};Timeline.DetailedEventPainter.prototype.paintInstantEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseInstantEvent(b,c,d,a)}else{this.paintPreciseInstantEvent(b,c,d,a)}};Timeline.DetailedEventPainter.prototype.paintDurationEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseDurationEvent(b,c,d,a)}else{this.paintPreciseDurationEvent(b,c,d,a)}};Timeline.DetailedEventPainter.prototype.paintPreciseInstantEvent=function(l,p,s,q){var u=this._timeline.getDocument();var k=l.getText();var e=l.getStart();var c=Math.round(this._band.dateToPixelOffset(e));var a=Math.round(c+p.iconWidth/2);var j=Math.round(c-p.iconWidth/2);var g=this._frc.computeSize(k);var d=this._findFreeTrackForSolid(a,c);var b=this._paintEventIcon(l,d,j,p,s);var v=a+s.event.label.offsetFromLine;var r=d;var f=this._getTrackData(d);if(Math.min(f.solid,f.text)>=v+g.width){f.solid=j;f.text=v}else{f.solid=j;v=c+s.event.label.offsetFromLine;r=this._findFreeTrackForText(d,v+g.width,function(w){w.line=c-2});this._getTrackData(r).text=j;this._paintEventLine(l,c,d,r,p,s)}var t=Math.round(p.trackOffset+r*p.trackIncrement+p.trackHeight/2-g.height/2);var o=this._paintEventLabel(l,k,v,t,g.width,g.height,s);var m=this;var h=function(w,x,y){return m._onClickInstantEvent(b.elmt,x,l)};SimileAjax.DOM.registerEvent(b.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(o.elmt,"mousedown",h);this._createHighlightDiv(q,b,s);this._eventIdToElmt[l.getID()]=b.elmt};Timeline.DetailedEventPainter.prototype.paintImpreciseInstantEvent=function(p,s,x,t){var z=this._timeline.getDocument();var o=p.getText();var h=p.getStart();var u=p.getEnd();var e=Math.round(this._band.dateToPixelOffset(h));var b=Math.round(this._band.dateToPixelOffset(u));var a=Math.round(e+s.iconWidth/2);var m=Math.round(e-s.iconWidth/2);var k=this._frc.computeSize(o);var f=this._findFreeTrackForSolid(b,e);var g=this._paintEventTape(p,f,e,b,x.event.instant.impreciseColor,x.event.instant.impreciseOpacity,s,x);var c=this._paintEventIcon(p,f,m,s,x);var j=this._getTrackData(f);j.solid=m;var y=a+x.event.label.offsetFromLine;var d=y+k.width;var v;if(d<b){v=f}else{y=e+x.event.label.offsetFromLine;d=y+k.width;v=this._findFreeTrackForText(f,d,function(A){A.line=e-2});this._getTrackData(v).text=m;this._paintEventLine(p,e,f,v,s,x)}var w=Math.round(s.trackOffset+v*s.trackIncrement+s.trackHeight/2-k.height/2);var r=this._paintEventLabel(p,o,y,w,k.width,k.height,x);var q=this;var l=function(A,B,C){return q._onClickInstantEvent(c.elmt,B,p)};SimileAjax.DOM.registerEvent(c.elmt,"mousedown",l);SimileAjax.DOM.registerEvent(g.elmt,"mousedown",l);SimileAjax.DOM.registerEvent(r.elmt,"mousedown",l);this._createHighlightDiv(t,c,x);this._eventIdToElmt[p.getID()]=c.elmt};Timeline.DetailedEventPainter.prototype.paintPreciseDurationEvent=function(k,o,u,q){var v=this._timeline.getDocument();var j=k.getText();var d=k.getStart();var r=k.getEnd();var b=Math.round(this._band.dateToPixelOffset(d));var a=Math.round(this._band.dateToPixelOffset(r));var f=this._frc.computeSize(j);var e=this._findFreeTrackForSolid(a);var p=k.getColor();p=p!=null?p:u.event.duration.color;var c=this._paintEventTape(k,e,b,a,p,100,o,u);var h=this._getTrackData(e);h.solid=b;var w=b+u.event.label.offsetFromLine;var s=this._findFreeTrackForText(e,w+f.width,function(x){x.line=b-2});this._getTrackData(s).text=b-2;this._paintEventLine(k,b,e,s,o,u);var t=Math.round(o.trackOffset+s*o.trackIncrement+o.trackHeight/2-f.height/2);var m=this._paintEventLabel(k,j,w,t,f.width,f.height,u);var l=this;var g=function(x,y,z){return l._onClickDurationEvent(c.elmt,y,k)};SimileAjax.DOM.registerEvent(c.elmt,"mousedown",g);SimileAjax.DOM.registerEvent(m.elmt,"mousedown",g);this._createHighlightDiv(q,c,u);this._eventIdToElmt[k.getID()]=c.elmt};Timeline.DetailedEventPainter.prototype.paintImpreciseDurationEvent=function(m,r,y,u){var B=this._timeline.getDocument();var l=m.getText();var d=m.getStart();var s=m.getLatestStart();var v=m.getEnd();var z=m.getEarliestEnd();var b=Math.round(this._band.dateToPixelOffset(d));var f=Math.round(this._band.dateToPixelOffset(s));var a=Math.round(this._band.dateToPixelOffset(v));var g=Math.round(this._band.dateToPixelOffset(z));var h=this._frc.computeSize(l);var e=this._findFreeTrackForSolid(a);var t=m.getColor();t=t!=null?t:y.event.duration.color;var q=this._paintEventTape(m,e,b,a,y.event.duration.impreciseColor,y.event.duration.impreciseOpacity,r,y);var c=this._paintEventTape(m,e,f,g,t,100,r,y);var k=this._getTrackData(e);k.solid=b;var A=f+y.event.label.offsetFromLine;var w=this._findFreeTrackForText(e,A+h.width,function(C){C.line=f-2});this._getTrackData(w).text=f-2;this._paintEventLine(m,f,e,w,r,y);var x=Math.round(r.trackOffset+w*r.trackIncrement+r.trackHeight/2-h.height/2);var p=this._paintEventLabel(m,l,A,x,h.width,h.height,y);var o=this;var j=function(C,D,E){return o._onClickDurationEvent(c.elmt,D,m)};SimileAjax.DOM.registerEvent(c.elmt,"mousedown",j);SimileAjax.DOM.registerEvent(p.elmt,"mousedown",j);this._createHighlightDiv(u,c,y);this._eventIdToElmt[m.getID()]=c.elmt};Timeline.DetailedEventPainter.prototype._findFreeTrackForSolid=function(b,a){for(var d=0;true;d++){if(d<this._lowerTracks.length){var c=this._lowerTracks[d];if(Math.min(c.solid,c.text)>b&&(!(a)||c.line>a)){return d}}else{this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});return d}if(d<this._upperTracks.length){var c=this._upperTracks[d];if(Math.min(c.solid,c.text)>b&&(!(a)||c.line>a)){return -1-d}}else{this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});return -1-d}}};Timeline.DetailedEventPainter.prototype._findFreeTrackForText=function(d,c,h){var f;var g;var b;var k;if(d<0){f=true;b=-d;g=this._findFreeUpperTrackForText(b,c);k=-1-g}else{if(d>0){f=false;b=d+1;g=this._findFreeLowerTrackForText(b,c);k=g}else{var a=this._findFreeUpperTrackForText(0,c);var j=this._findFreeLowerTrackForText(1,c);if(j-1<=a){f=false;b=1;g=j;k=g}else{f=true;b=0;g=a;k=-1-g}}}if(f){if(g==this._upperTracks.length){this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY})}for(var e=b;e<g;e++){h(this._upperTracks[e])}}else{if(g==this._lowerTracks.length){this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY})}for(var e=b;e<g;e++){h(this._lowerTracks[e])}}return k};Timeline.DetailedEventPainter.prototype._findFreeLowerTrackForText=function(a,c){for(;a<this._lowerTracks.length;a++){var b=this._lowerTracks[a];if(Math.min(b.solid,b.text)>=c){break}}return a};Timeline.DetailedEventPainter.prototype._findFreeUpperTrackForText=function(a,c){for(;a<this._upperTracks.length;a++){var b=this._upperTracks[a];if(Math.min(b.solid,b.text)>=c){break}}return a};Timeline.DetailedEventPainter.prototype._getTrackData=function(a){return(a<0)?this._upperTracks[-a-1]:this._lowerTracks[a]};Timeline.DetailedEventPainter.prototype._paintEventLine=function(j,c,f,a,g,d){var h=Math.round(g.trackOffset+f*g.trackIncrement+g.trackHeight/2);var k=Math.round(Math.abs(a-f)*g.trackIncrement);var e="1px solid "+d.event.label.lineColor;var b=this._timeline.getDocument().createElement("div");b.style.position="absolute";b.style.left=c+"px";b.style.width=d.event.label.offsetFromLine+"px";b.style.height=k+"px";if(f>a){b.style.top=(h-k)+"px";b.style.borderTop=e}else{b.style.top=h+"px";b.style.borderBottom=e}b.style.borderLeft=e;this._lineLayer.appendChild(b)};Timeline.DetailedEventPainter.prototype._paintEventIcon=function(j,e,b,f,d){var h=j.getIcon();h=h!=null?h:f.icon;var k=f.trackOffset+e*f.trackIncrement+f.trackHeight/2;var g=Math.round(k-f.iconHeight/2);var c=SimileAjax.Graphics.createTranslucentImage(h);var a=this._timeline.getDocument().createElement("div");a.style.position="absolute";a.style.left=b+"px";a.style.top=g+"px";a.appendChild(c);a.style.cursor="pointer";if(j._title!=null){a.title=j._title}this._eventLayer.appendChild(a);return{left:b,top:g,width:f.iconWidth,height:f.iconHeight,elmt:a}};Timeline.DetailedEventPainter.prototype._paintEventLabel=function(h,j,b,f,a,k,d){var g=this._timeline.getDocument();var l=g.createElement("div");l.style.position="absolute";l.style.left=b+"px";l.style.width=a+"px";l.style.top=f+"px";l.style.height=k+"px";l.style.backgroundColor=d.event.label.backgroundColor;SimileAjax.Graphics.setOpacity(l,d.event.label.backgroundOpacity);this._eventLayer.appendChild(l);var e=g.createElement("div");e.style.position="absolute";e.style.left=b+"px";e.style.width=a+"px";e.style.top=f+"px";e.innerHTML=j;e.style.cursor="pointer";if(h._title!=null){e.title=h._title}var c=h.getTextColor();if(c==null){c=h.getColor()}if(c!=null){e.style.color=c}this._eventLayer.appendChild(e);return{left:b,top:f,width:a,height:k,elmt:e}};Timeline.DetailedEventPainter.prototype._paintEventTape=function(m,h,e,a,c,g,j,f){var b=a-e;var d=f.event.tape.height;var o=j.trackOffset+h*j.trackIncrement+j.trackHeight/2;var k=Math.round(o-d/2);var l=this._timeline.getDocument().createElement("div");l.style.position="absolute";l.style.left=e+"px";l.style.width=b+"px";l.style.top=k+"px";l.style.height=d+"px";l.style.backgroundColor=c;l.style.overflow="hidden";l.style.cursor="pointer";if(m._title!=null){l.title=m._title}SimileAjax.Graphics.setOpacity(l,g);this._eventLayer.appendChild(l);return{left:e,top:k,width:b,height:d,elmt:l}};Timeline.DetailedEventPainter.prototype._createHighlightDiv=function(a,c,e){if(a>=0){var d=this._timeline.getDocument();var g=e.event;var b=g.highlightColors[Math.min(a,g.highlightColors.length-1)];var f=d.createElement("div");f.style.position="absolute";f.style.overflow="hidden";f.style.left=(c.left-2)+"px";f.style.width=(c.width+4)+"px";f.style.top=(c.top-2)+"px";f.style.height=(c.height+4)+"px";f.style.background=b;this._highlightLayer.appendChild(f)}};Timeline.DetailedEventPainter.prototype._onClickInstantEvent=function(b,d,a){var e=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(e.left+Math.ceil(b.offsetWidth/2),e.top+Math.ceil(b.offsetHeight/2),a);this._fireOnSelect(a.getID());d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.DetailedEventPainter.prototype._onClickDurationEvent=function(e,d,b){if("pageX" in d){var a=d.pageX;var g=d.pageY}else{var f=SimileAjax.DOM.getPageCoordinates(e);var a=d.offsetX+f.left;var g=d.offsetY+f.top}this._showBubble(a,g,b);this._fireOnSelect(b.getID());d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.DetailedEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var d=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(d.left+b.offsetWidth/2,d.top+b.offsetHeight/2,a)}};Timeline.DetailedEventPainter.prototype._showBubble=function(a,e,b){var d=document.createElement("div");var c=this._params.theme.event.bubble;b.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,e,c.width,null,c.maxHeight)};Timeline.DetailedEventPainter.prototype._fireOnSelect=function(b){for(var a=0;a<this._onSelectListeners.length;a++){this._onSelectListeners[a](b)}};Timeline.OverviewEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._filterMatcher=null;this._highlightMatcher=null};Timeline.OverviewEventPainter.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._eventLayer=null;this._highlightLayer=null};Timeline.OverviewEventPainter.prototype.getType=function(){return"overview"};Timeline.OverviewEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.OverviewEventPainter.prototype.removeOnSelectListener=function(b){for(var a=0;a<this._onSelectListeners.length;a++){if(this._onSelectListeners[a]==b){this._onSelectListeners.splice(a,1);break}}};Timeline.OverviewEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OverviewEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OverviewEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.OverviewEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};Timeline.OverviewEventPainter.prototype.paint=function(){var b=this._band.getEventSource();if(b==null){return}this._prepareForPainting();var h=this._params.theme.event;var f={trackOffset:h.overviewTrack.offset,trackHeight:h.overviewTrack.height,trackGap:h.overviewTrack.gap,trackIncrement:h.overviewTrack.height+h.overviewTrack.gap};var c=this._band.getMinDate();var a=this._band.getMaxDate();var j=(this._filterMatcher!=null)?this._filterMatcher:function(k){return true};var e=(this._highlightMatcher!=null)?this._highlightMatcher:function(k){return -1};var d=b.getEventReverseIterator(c,a);while(d.hasNext()){var g=d.next();if(j(g)){this.paintEvent(g,f,this._params.theme,e(g))}}this._highlightLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._tracks.length,f.trackIncrement)};Timeline.OverviewEventPainter.prototype.softPaint=function(){};Timeline.OverviewEventPainter.prototype._prepareForPainting=function(){var a=this._band;this._tracks=[];if(this._highlightLayer!=null){a.removeLayerDiv(this._highlightLayer)}this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";if(this._eventLayer!=null){a.removeLayerDiv(this._eventLayer)}this._eventLayer=a.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};Timeline.OverviewEventPainter.prototype.paintEvent=function(b,c,d,a){if(b.isInstant()){this.paintInstantEvent(b,c,d,a)}else{this.paintDurationEvent(b,c,d,a)}};Timeline.OverviewEventPainter.prototype.paintInstantEvent=function(j,h,f,a){var b=j.getStart();var e=Math.round(this._band.dateToPixelOffset(b));var d=j.getColor(),c=j.getClassName();if(c){d=null}else{d=d!=null?d:f.event.duration.color}var g=this._paintEventTick(j,e,d,100,h,f);this._createHighlightDiv(a,g,f)};Timeline.OverviewEventPainter.prototype.paintDurationEvent=function(m,l,k,d){var a=m.getLatestStart();var c=m.getEarliestEnd();var b=Math.round(this._band.dateToPixelOffset(a));var e=Math.round(this._band.dateToPixelOffset(c));var j=0;for(;j<this._tracks.length;j++){if(e<this._tracks[j]){break}}this._tracks[j]=e;var h=m.getColor(),g=m.getClassName();if(g){h=null}else{h=h!=null?h:k.event.duration.color}var f=this._paintEventTape(m,j,b,e,h,100,l,k,g);this._createHighlightDiv(d,f,k)};Timeline.OverviewEventPainter.prototype._paintEventTape=function(m,b,c,l,e,g,h,f,d){var j=h.trackOffset+b*h.trackIncrement;var a=l-c;var o=h.trackHeight;var k=this._timeline.getDocument().createElement("div");k.className="timeline-small-event-tape";if(d){k.className+=" small-"+d}k.style.left=c+"px";k.style.width=a+"px";k.style.top=j+"px";k.style.height=o+"px";if(e){k.style.backgroundColor=e}if(g<100){SimileAjax.Graphics.setOpacity(k,g)}this._eventLayer.appendChild(k);return{left:c,top:j,width:a,height:o,elmt:k}};Timeline.OverviewEventPainter.prototype._paintEventTick=function(k,b,d,f,g,e){var l=e.event.overviewTrack.tickHeight;var h=g.trackOffset-l;var a=1;var j=this._timeline.getDocument().createElement("div");j.className="timeline-small-event-icon";j.style.left=b+"px";j.style.top=h+"px";var c=k.getClassName();if(c){j.className+=" small-"+c}if(f<100){SimileAjax.Graphics.setOpacity(j,f)}this._eventLayer.appendChild(j);return{left:b,top:h,width:a,height:l,elmt:j}};Timeline.OverviewEventPainter.prototype._createHighlightDiv=function(a,c,e){if(a>=0){var d=this._timeline.getDocument();var g=e.event;var b=g.highlightColors[Math.min(a,g.highlightColors.length-1)];var f=d.createElement("div");f.style.position="absolute";f.style.overflow="hidden";f.style.left=(c.left-1)+"px";f.style.width=(c.width+2)+"px";f.style.top=(c.top-1)+"px";f.style.height=(c.height+2)+"px";f.style.background=b;this._highlightLayer.appendChild(f)}};Timeline.OverviewEventPainter.prototype.showBubble=function(a){};Timeline.CompactEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._filterMatcher=null;this._highlightMatcher=null;this._frc=null;this._eventIdToElmt={}};Timeline.CompactEventPainter.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._backLayer=null;this._eventLayer=null;this._lineLayer=null;this._highlightLayer=null;this._eventIdToElmt=null};Timeline.CompactEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.CompactEventPainter.prototype.removeOnSelectListener=function(b){for(var a=0;a<this._onSelectListeners.length;a++){if(this._onSelectListeners[a]==b){this._onSelectListeners.splice(a,1);break}}};Timeline.CompactEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.CompactEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.CompactEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.CompactEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};Timeline.CompactEventPainter.prototype.paint=function(){var s=this._band.getEventSource();if(s==null){return}this._eventIdToElmt={};this._prepareForPainting();var t=this._params.theme;var q=t.event;var k={trackOffset:"trackOffset" in this._params?this._params.trackOffset:10,trackHeight:"trackHeight" in this._params?this._params.trackHeight:10,tapeHeight:t.event.tape.height,tapeBottomMargin:"tapeBottomMargin" in this._params?this._params.tapeBottomMargin:2,labelBottomMargin:"labelBottomMargin" in this._params?this._params.labelBottomMargin:5,labelRightMargin:"labelRightMargin" in this._params?this._params.labelRightMargin:5,defaultIcon:q.instant.icon,defaultIconWidth:q.instant.iconWidth,defaultIconHeight:q.instant.iconHeight,customIconWidth:"iconWidth" in this._params?this._params.iconWidth:q.instant.iconWidth,customIconHeight:"iconHeight" in this._params?this._params.iconHeight:q.instant.iconHeight,iconLabelGap:"iconLabelGap" in this._params?this._params.iconLabelGap:2,iconBottomMargin:"iconBottomMargin" in this._params?this._params.iconBottomMargin:2};if("compositeIcon" in this._params){k.compositeIcon=this._params.compositeIcon;k.compositeIconWidth=this._params.compositeIconWidth||k.customIconWidth;k.compositeIconHeight=this._params.compositeIconHeight||k.customIconHeight}else{k.compositeIcon=k.defaultIcon;k.compositeIconWidth=k.defaultIconWidth;k.compositeIconHeight=k.defaultIconHeight}k.defaultStackIcon="icon" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.icon:k.defaultIcon;k.defaultStackIconWidth="iconWidth" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconWidth:k.defaultIconWidth;k.defaultStackIconHeight="iconHeight" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconHeight:k.defaultIconHeight;var b=this._band.getMinDate();var d=this._band.getMaxDate();var u=(this._filterMatcher!=null)?this._filterMatcher:function(j){return true};var f=(this._highlightMatcher!=null)?this._highlightMatcher:function(j){return -1};var h=s.getEventIterator(b,d);var l="stackConcurrentPreciseInstantEvents" in this._params&&typeof this._params.stackConcurrentPreciseInstantEvents=="object";var g="collapseConcurrentPreciseInstantEvents" in this._params&&this._params.collapseConcurrentPreciseInstantEvents;if(g||l){var p=[];var a=null;while(h.hasNext()){var e=h.next();if(u(e)){if(!e.isInstant()||e.isImprecise()){this.paintEvent(e,k,this._params.theme,f(e))}else{if(a!=null&&a.getStart().getTime()==e.getStart().getTime()){p[p.length-1].push(e)}else{p.push([e]);a=e}}}}for(var o=0;o<p.length;o++){var r=p[o];if(r.length==1){this.paintEvent(r[0],k,this._params.theme,f(e))}else{var c=-1;for(var m=0;c<0&&m<r.length;m++){c=f(r[m])}if(l){this.paintStackedPreciseInstantEvents(r,k,this._params.theme,c)}else{this.paintCompositePreciseInstantEvents(r,k,this._params.theme,c)}}}}else{while(h.hasNext()){var e=h.next();if(u(e)){this.paintEvent(e,k,this._params.theme,f(e))}}}this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block"};Timeline.CompactEventPainter.prototype.softPaint=function(){};Timeline.CompactEventPainter.prototype._prepareForPainting=function(){var b=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var a=document.createElement("span");a.className="timeline-event-label";this._backLayer.appendChild(a);this._frc=SimileAjax.Graphics.getFontRenderingContext(a)}this._frc.update();this._tracks=[];if(this._highlightLayer!=null){b.removeLayerDiv(this._highlightLayer)}this._highlightLayer=b.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";if(this._lineLayer!=null){b.removeLayerDiv(this._lineLayer)}this._lineLayer=b.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";if(this._eventLayer!=null){b.removeLayerDiv(this._eventLayer)}this._eventLayer=b.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};Timeline.CompactEventPainter.prototype.paintEvent=function(b,c,d,a){if(b.isInstant()){this.paintInstantEvent(b,c,d,a)}else{this.paintDurationEvent(b,c,d,a)}};Timeline.CompactEventPainter.prototype.paintInstantEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseInstantEvent(b,c,d,a)}else{this.paintPreciseInstantEvent(b,c,d,a)}};Timeline.CompactEventPainter.prototype.paintDurationEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseDurationEvent(b,c,d,a)}else{this.paintPreciseDurationEvent(b,c,d,a)}};Timeline.CompactEventPainter.prototype.paintPreciseInstantEvent=function(h,f,c,b){var d={tooltip:h.getProperty("tooltip")||h.getText()};var a={url:h.getIcon()};if(a.url==null){a.url=f.defaultIcon;a.width=f.defaultIconWidth;a.height=f.defaultIconHeight;a.className="timeline-event-icon-default"}else{a.width=h.getProperty("iconWidth")||f.customIconWidth;a.height=h.getProperty("iconHeight")||f.customIconHeight}var g={text:h.getText(),color:h.getTextColor()||h.getColor(),className:h.getClassName()};var k=this.paintTapeIconLabel(h.getStart(),d,null,a,g,f,c,b);var j=this;var e=function(l,m,o){return j._onClickInstantEvent(k.iconElmtData.elmt,m,h)};SimileAjax.DOM.registerEvent(k.iconElmtData.elmt,"mousedown",e);SimileAjax.DOM.registerEvent(k.labelElmtData.elmt,"mousedown",e);this._eventIdToElmt[h.getID()]=k.iconElmtData.elmt};Timeline.CompactEventPainter.prototype.paintCompositePreciseInstantEvents=function(m,h,c,b){var k=m[0];var g=[];for(var d=0;d<m.length;d++){g.push(m[d].getProperty("tooltip")||m[d].getText())}var e={tooltip:g.join("; ")};var a={url:h.compositeIcon,width:h.compositeIconWidth,height:h.compositeIconHeight,className:"timeline-event-icon-composite"};var j={text:String.substitute(this._params.compositeEventLabelTemplate,[m.length])};var o=this.paintTapeIconLabel(k.getStart(),e,null,a,j,h,c,b);var l=this;var f=function(p,q,r){return l._onClickMultiplePreciseInstantEvent(o.iconElmtData.elmt,q,m)};SimileAjax.DOM.registerEvent(o.iconElmtData.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(o.labelElmtData.elmt,"mousedown",f);for(var d=0;d<m.length;d++){this._eventIdToElmt[m[d].getID()]=o.iconElmtData.elmt}};Timeline.CompactEventPainter.prototype.paintStackedPreciseInstantEvents=function(z,L,D,e){var u="limit" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.limit:10;var j="moreMessageTemplate" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.moreMessageTemplate:"%0 More Events";var r=u<=z.length-2;var c=this._band;var G=function(S){return Math.round(c.dateToPixelOffset(S))};var p=function(S){var T={url:S.getIcon()};if(T.url==null){T.url=L.defaultStackIcon;T.width=L.defaultStackIconWidth;T.height=L.defaultStackIconHeight;T.className="timeline-event-icon-stack timeline-event-icon-default"}else{T.width=S.getProperty("iconWidth")||L.customIconWidth;T.height=S.getProperty("iconHeight")||L.customIconHeight;T.className="timeline-event-icon-stack"}return T};var g=p(z[0]);var x=5;var f=0;var l=0;var R=0;var y=0;var N=[];for(var Q=0;Q<z.length&&(!r||Q<u);Q++){var C=z[Q];var B=C.getText();var w=p(C);var v=this._frc.computeSize(B);var I={text:B,iconData:w,labelSize:v,iconLeft:g.width+Q*x-w.width};I.labelLeft=g.width+Q*x+L.iconLabelGap;I.top=R;N.push(I);f=Math.min(f,I.iconLeft);R+=v.height;l=Math.max(l,I.labelLeft+v.width);y=Math.max(y,I.top+w.height)}if(r){var m=String.substitute(j,[z.length-u]);var M=this._frc.computeSize(m);var J=g.width+(u-1)*x+L.iconLabelGap;var P=R;R+=M.height;l=Math.max(l,J+M.width)}l+=L.labelRightMargin;R+=L.labelBottomMargin;y+=L.iconBottomMargin;var O=G(z[0].getStart());var t=[];var o=Math.ceil(Math.max(y,R)/L.trackHeight);var F=g.width+(z.length-1)*x;for(var Q=0;Q<o;Q++){t.push({start:f,end:F})}var H=Math.ceil(R/L.trackHeight);for(var Q=0;Q<H;Q++){var q=t[Q];q.end=Math.max(q.end,l)}var h=this._fitTracks(O,t);var A=h*L.trackHeight+L.trackOffset;var a=this._timeline.getDocument().createElement("div");a.className="timeline-event-icon-stack";a.style.position="absolute";a.style.overflow="visible";a.style.left=O+"px";a.style.top=A+"px";a.style.width=F+"px";a.style.height=y+"px";a.innerHTML="<div style='position: relative'></div>";this._eventLayer.appendChild(a);var k=this;var s=function(T){try{var X=parseInt(this.getAttribute("index"));var V=a.firstChild.childNodes;for(var S=0;S<V.length;S++){var W=V[S];if(S==X){W.style.zIndex=V.length}else{W.style.zIndex=V.length-S}}}catch(U){}};var E=function(X){var T=N[X];var S=z[X];var Y=S.getProperty("tooltip")||S.getText();var W=k._paintEventLabel({tooltip:Y},{text:T.text},O+T.labelLeft,A+T.top,T.labelSize.width,T.labelSize.height,D);W.elmt.setAttribute("index",X);W.elmt.onmouseover=s;var V=SimileAjax.Graphics.createTranslucentImage(T.iconData.url);var U=k._timeline.getDocument().createElement("div");U.className="timeline-event-icon"+("className" in T.iconData?(" "+T.iconData.className):"");U.style.left=T.iconLeft+"px";U.style.top=T.top+"px";U.style.zIndex=(N.length-X);U.appendChild(V);U.setAttribute("index",X);U.onmouseover=s;a.firstChild.appendChild(U);var Z=function(aa,ab,ac){return k._onClickInstantEvent(W.elmt,ab,S)};SimileAjax.DOM.registerEvent(U,"mousedown",Z);SimileAjax.DOM.registerEvent(W.elmt,"mousedown",Z);k._eventIdToElmt[S.getID()]=U};for(var Q=0;Q<N.length;Q++){E(Q)}if(r){var d=z.slice(u);var b=this._paintEventLabel({tooltip:m},{text:m},O+J,A+P,M.width,M.height,D);var K=function(S,T,U){return k._onClickMultiplePreciseInstantEvent(b.elmt,T,d)};SimileAjax.DOM.registerEvent(b.elmt,"mousedown",K);for(var Q=0;Q<d.length;Q++){this._eventIdToElmt[d[Q].getID()]=b.elmt}}};Timeline.CompactEventPainter.prototype.paintImpreciseInstantEvent=function(j,g,d,c){var e={tooltip:j.getProperty("tooltip")||j.getText()};var a={start:j.getStart(),end:j.getEnd(),latestStart:j.getLatestStart(),earliestEnd:j.getEarliestEnd(),isInstant:true};var b={url:j.getIcon()};if(b.url==null){b=null}else{b.width=j.getProperty("iconWidth")||g.customIconWidth;b.height=j.getProperty("iconHeight")||g.customIconHeight}var h={text:j.getText(),color:j.getTextColor()||j.getColor(),className:j.getClassName()};var l=this.paintTapeIconLabel(j.getStart(),e,a,b,h,g,d,c);var k=this;var f=b!=null?function(m,o,p){return k._onClickInstantEvent(l.iconElmtData.elmt,o,j)}:function(m,o,p){return k._onClickInstantEvent(l.labelElmtData.elmt,o,j)};SimileAjax.DOM.registerEvent(l.labelElmtData.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(l.impreciseTapeElmtData.elmt,"mousedown",f);if(b!=null){SimileAjax.DOM.registerEvent(l.iconElmtData.elmt,"mousedown",f);this._eventIdToElmt[j.getID()]=l.iconElmtData.elmt}else{this._eventIdToElmt[j.getID()]=l.labelElmtData.elmt}};Timeline.CompactEventPainter.prototype.paintPreciseDurationEvent=function(j,g,d,c){var e={tooltip:j.getProperty("tooltip")||j.getText()};var a={start:j.getStart(),end:j.getEnd(),isInstant:false};var b={url:j.getIcon()};if(b.url==null){b=null}else{b.width=j.getProperty("iconWidth")||g.customIconWidth;b.height=j.getProperty("iconHeight")||g.customIconHeight}var h={text:j.getText(),color:j.getTextColor()||j.getColor(),className:j.getClassName()};var l=this.paintTapeIconLabel(j.getLatestStart(),e,a,b,h,g,d,c);var k=this;var f=b!=null?function(m,o,p){return k._onClickInstantEvent(l.iconElmtData.elmt,o,j)}:function(m,o,p){return k._onClickInstantEvent(l.labelElmtData.elmt,o,j)};SimileAjax.DOM.registerEvent(l.labelElmtData.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(l.tapeElmtData.elmt,"mousedown",f);if(b!=null){SimileAjax.DOM.registerEvent(l.iconElmtData.elmt,"mousedown",f);this._eventIdToElmt[j.getID()]=l.iconElmtData.elmt}else{this._eventIdToElmt[j.getID()]=l.labelElmtData.elmt}};Timeline.CompactEventPainter.prototype.paintImpreciseDurationEvent=function(j,g,d,c){var e={tooltip:j.getProperty("tooltip")||j.getText()};var a={start:j.getStart(),end:j.getEnd(),latestStart:j.getLatestStart(),earliestEnd:j.getEarliestEnd(),isInstant:false};var b={url:j.getIcon()};if(b.url==null){b=null}else{b.width=j.getProperty("iconWidth")||g.customIconWidth;b.height=j.getProperty("iconHeight")||g.customIconHeight}var h={text:j.getText(),color:j.getTextColor()||j.getColor(),className:j.getClassName()};var l=this.paintTapeIconLabel(j.getLatestStart(),e,a,b,h,g,d,c);var k=this;var f=b!=null?function(m,o,p){return k._onClickInstantEvent(l.iconElmtData.elmt,o,j)}:function(m,o,p){return k._onClickInstantEvent(l.labelElmtData.elmt,o,j)};SimileAjax.DOM.registerEvent(l.labelElmtData.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(l.tapeElmtData.elmt,"mousedown",f);if(b!=null){SimileAjax.DOM.registerEvent(l.iconElmtData.elmt,"mousedown",f);this._eventIdToElmt[j.getID()]=l.iconElmtData.elmt}else{this._eventIdToElmt[j.getID()]=l.labelElmtData.elmt}};Timeline.CompactEventPainter.prototype.paintTapeIconLabel=function(D,o,G,e,A,y,F,B){var u=this._band;var l=function(t){return Math.round(u.dateToPixelOffset(t))};var v=l(D);var E=[];var C=0;var q=0;var p=0;if(G!=null){C=y.tapeHeight+y.tapeBottomMargin;q=Math.ceil(y.tapeHeight/y.trackHeight);var a=l(G.end)-v;var d=l(G.start)-v;for(var s=0;s<q;s++){E.push({start:d,end:a})}p=y.trackHeight-(C%y.tapeHeight)}var b=0;var x=0;if(e!=null){if("iconAlign" in e&&e.iconAlign=="center"){b=-Math.floor(e.width/2)}x=b+e.width+y.iconLabelGap;if(q>0){E[q-1].end=Math.max(E[q-1].end,x)}var k=e.height+y.iconBottomMargin+p;while(k>0){E.push({start:b,end:x});k-=y.trackHeight}}var r=A.text;var g=this._frc.computeSize(r);var c=g.height+y.labelBottomMargin+p;var f=x+g.width+y.labelRightMargin;if(q>0){E[q-1].end=Math.max(E[q-1].end,f)}for(var z=0;c>0;z++){if(q+z<E.length){var w=E[q+z];w.end=f}else{E.push({start:0,end:f})}c-=y.trackHeight}var j=this._fitTracks(v,E);var h=j*y.trackHeight+y.trackOffset;var m={};m.labelElmtData=this._paintEventLabel(o,A,v+x,h+C,g.width,g.height,F);if(G!=null){if("latestStart" in G||"earliestEnd" in G){m.impreciseTapeElmtData=this._paintEventTape(o,G,y.tapeHeight,h,l(G.start),l(G.end),F.event.duration.impreciseColor,F.event.duration.impreciseOpacity,y,F)}if(!G.isInstant&&"start" in G&&"end" in G){m.tapeElmtData=this._paintEventTape(o,G,y.tapeHeight,h,v,l("earliestEnd" in G?G.earliestEnd:G.end),G.color,100,y,F)}}if(e!=null){m.iconElmtData=this._paintEventIcon(o,e,h+C,v+b,y,F)}return m};Timeline.CompactEventPainter.prototype._fitTracks=function(a,f){var h;for(h=0;h<this._tracks.length;h++){var e=true;for(var c=0;c<f.length&&(h+c)<this._tracks.length;c++){var g=this._tracks[h+c];var b=f[c];if(a+b.start<g){e=false;break}}if(e){break}}for(var d=0;d<f.length;d++){this._tracks[h+d]=a+f[d].end}return h};Timeline.CompactEventPainter.prototype._paintEventIcon=function(c,d,h,g,e,f){var b=SimileAjax.Graphics.createTranslucentImage(d.url);var a=this._timeline.getDocument().createElement("div");a.className="timeline-event-icon"+("className" in d?(" "+d.className):"");a.style.left=g+"px";a.style.top=h+"px";a.appendChild(b);if("tooltip" in c&&typeof c.tooltip=="string"){a.title=c.tooltip}this._eventLayer.appendChild(a);return{left:g,top:h,width:e.iconWidth,height:e.iconHeight,elmt:a}};Timeline.CompactEventPainter.prototype._paintEventLabel=function(d,g,b,f,a,j,c){var h=this._timeline.getDocument();var e=h.createElement("div");e.className="timeline-event-label";e.style.left=b+"px";e.style.width=(a+1)+"px";e.style.top=f+"px";e.innerHTML=g.text;if("tooltip" in d&&typeof d.tooltip=="string"){e.title=d.tooltip}if("color" in g&&typeof g.color=="string"){e.style.color=g.color}if("className" in g&&typeof g.className=="string"){e.className+=" "+g.className}this._eventLayer.appendChild(e);return{left:b,top:f,width:a,height:j,elmt:e}};Timeline.CompactEventPainter.prototype._paintEventTape=function(g,b,m,k,f,a,d,h,j,e){var c=a-f;var l=this._timeline.getDocument().createElement("div");l.className="timeline-event-tape";l.style.left=f+"px";l.style.top=k+"px";l.style.width=c+"px";l.style.height=m+"px";if("tooltip" in g&&typeof g.tooltip=="string"){l.title=g.tooltip}if(d!=null&&typeof b.color=="string"){l.style.backgroundColor=d}if("backgroundImage" in b&&typeof b.backgroundImage=="string"){l.style.backgroundImage="url("+backgroundImage+")";l.style.backgroundRepeat=("backgroundRepeat" in b&&typeof b.backgroundRepeat=="string")?b.backgroundRepeat:"repeat"}SimileAjax.Graphics.setOpacity(l,h);if("className" in b&&typeof b.className=="string"){l.className+=" "+b.className}this._eventLayer.appendChild(l);return{left:f,top:k,width:c,height:m,elmt:l}};Timeline.CompactEventPainter.prototype._createHighlightDiv=function(a,c,e){if(a>=0){var d=this._timeline.getDocument();var g=e.event;var b=g.highlightColors[Math.min(a,g.highlightColors.length-1)];var f=d.createElement("div");f.style.position="absolute";f.style.overflow="hidden";f.style.left=(c.left-2)+"px";f.style.width=(c.width+4)+"px";f.style.top=(c.top-2)+"px";f.style.height=(c.height+4)+"px";this._highlightLayer.appendChild(f)}};Timeline.CompactEventPainter.prototype._onClickMultiplePreciseInstantEvent=function(e,f,b){var g=SimileAjax.DOM.getPageCoordinates(e);this._showBubble(g.left+Math.ceil(e.offsetWidth/2),g.top+Math.ceil(e.offsetHeight/2),b);var d=[];for(var a=0;a<b.length;a++){d.push(b[a].getID())}this._fireOnSelect(d);f.cancelBubble=true;SimileAjax.DOM.cancelEvent(f);return false};Timeline.CompactEventPainter.prototype._onClickInstantEvent=function(b,d,a){var e=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(e.left+Math.ceil(b.offsetWidth/2),e.top+Math.ceil(b.offsetHeight/2),[a]);this._fireOnSelect([a.getID()]);d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.CompactEventPainter.prototype._onClickDurationEvent=function(e,d,b){if("pageX" in d){var a=d.pageX;var g=d.pageY}else{var f=SimileAjax.DOM.getPageCoordinates(e);var a=d.offsetX+f.left;var g=d.offsetY+f.top}this._showBubble(a,g,[b]);this._fireOnSelect([b.getID()]);d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.CompactEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var d=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(d.left+b.offsetWidth/2,d.top+b.offsetHeight/2,[a])}};Timeline.CompactEventPainter.prototype._showBubble=function(a,f,b){var e=document.createElement("div");b=("fillInfoBubble" in b)?[b]:b;for(var d=0;d<b.length;d++){var c=document.createElement("div");e.appendChild(c);b[d].fillInfoBubble(c,this._params.theme,this._band.getLabeller())}SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(e,a,f,this._params.theme.event.bubble.width)};Timeline.CompactEventPainter.prototype._fireOnSelect=function(b){for(var a=0;a<this._onSelectListeners.length;a++){this._onSelectListeners[a](b)}};Timeline.SpanHighlightDecorator=function(a){this._unit=a.unit!=null?a.unit:SimileAjax.NativeDateUnit;this._startDate=(typeof a.startDate=="string")?this._unit.parseFromObject(a.startDate):a.startDate;this._endDate=(typeof a.endDate=="string")?this._unit.parseFromObject(a.endDate):a.endDate;this._startLabel=a.startLabel!=null?a.startLabel:"";this._endLabel=a.endLabel!=null?a.endLabel:"";this._color=a.color;this._cssClass=a.cssClass!=null?a.cssClass:null;this._opacity=a.opacity!=null?a.opacity:100;this._zIndex=(a.inFront!=null&&a.inFront)?113:10};Timeline.SpanHighlightDecorator.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._layerDiv=null};Timeline.SpanHighlightDecorator.prototype.paint=function(){if(this._layerDiv!=null){this._band.removeLayerDiv(this._layerDiv)}this._layerDiv=this._band.createLayerDiv(this._zIndex);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var f=this._band.getMinDate();var c=this._band.getMaxDate();if(this._unit.compare(this._startDate,c)<0&&this._unit.compare(this._endDate,f)>0){f=this._unit.later(f,this._startDate);c=this._unit.earlier(c,this._endDate);var d=this._band.dateToPixelOffset(f);var l=this._band.dateToPixelOffset(c);var j=this._timeline.getDocument();var h=function(){var m=j.createElement("table");m.insertRow(0).insertCell(0);return m};var b=j.createElement("div");b.className="timeline-highlight-decorator";if(this._cssClass){b.className+=" "+this._cssClass}if(this._color!=null){b.style.backgroundColor=this._color}if(this._opacity<100){SimileAjax.Graphics.setOpacity(b,this._opacity)}this._layerDiv.appendChild(b);var k=h();k.className="timeline-highlight-label timeline-highlight-label-start";var g=k.rows[0].cells[0];g.innerHTML=this._startLabel;if(this._cssClass){g.className="label_"+this._cssClass}this._layerDiv.appendChild(k);var a=h();a.className="timeline-highlight-label timeline-highlight-label-end";var e=a.rows[0].cells[0];e.innerHTML=this._endLabel;if(this._cssClass){e.className="label_"+this._cssClass}this._layerDiv.appendChild(a);if(this._timeline.isHorizontal()){b.style.left=d+"px";b.style.width=(l-d)+"px";k.style.right=(this._band.getTotalViewLength()-d)+"px";k.style.width=(this._startLabel.length)+"em";a.style.left=l+"px";a.style.width=(this._endLabel.length)+"em"}else{b.style.top=d+"px";b.style.height=(l-d)+"px";k.style.bottom=d+"px";k.style.height="1.5px";a.style.top=l+"px";a.style.height="1.5px"}}this._layerDiv.style.display="block"};Timeline.SpanHighlightDecorator.prototype.softPaint=function(){};Timeline.PointHighlightDecorator=function(a){this._unit=a.unit!=null?a.unit:SimileAjax.NativeDateUnit;this._date=(typeof a.date=="string")?this._unit.parseFromObject(a.date):a.date;this._width=a.width!=null?a.width:10;this._color=a.color;this._cssClass=a.cssClass!=null?a.cssClass:"";this._opacity=a.opacity!=null?a.opacity:100};Timeline.PointHighlightDecorator.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._layerDiv=null};Timeline.PointHighlightDecorator.prototype.paint=function(){if(this._layerDiv!=null){this._band.removeLayerDiv(this._layerDiv)}this._layerDiv=this._band.createLayerDiv(10);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var c=this._band.getMinDate();var e=this._band.getMaxDate();if(this._unit.compare(this._date,e)<0&&this._unit.compare(this._date,c)>0){var b=this._band.dateToPixelOffset(this._date);var a=b-Math.round(this._width/2);var d=this._timeline.getDocument();var f=d.createElement("div");f.className="timeline-highlight-point-decorator";f.className+=" "+this._cssClass;if(this._color!=null){f.style.backgroundColor=this._color}if(this._opacity<100){SimileAjax.Graphics.setOpacity(f,this._opacity)}this._layerDiv.appendChild(f);if(this._timeline.isHorizontal()){f.style.left=a+"px";f.style.width=this._width}else{f.style.top=a+"px";f.style.height=this._width}}this._layerDiv.style.display="block"};Timeline.PointHighlightDecorator.prototype.softPaint=function(){};Timeline.NativeDateUnit=new Object();Timeline.NativeDateUnit.createLabeller=function(a,b){return new Timeline.GregorianDateLabeller(a,b)};Timeline.NativeDateUnit.makeDefaultValue=function(){return new Date()};Timeline.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())};Timeline.NativeDateUnit.getParser=function(a){if(typeof a=="string"){a=a.toLowerCase()}return(a=="iso8601"||a=="iso 8601")?Timeline.DateTime.parseIso8601DateTime:Timeline.DateTime.parseGregorianDateTime};Timeline.NativeDateUnit.parseFromObject=function(a){return Timeline.DateTime.parseGregorianDateTime(a)};Timeline.NativeDateUnit.toNumber=function(a){return a.getTime()};Timeline.NativeDateUnit.fromNumber=function(a){return new Date(a)};Timeline.NativeDateUnit.compare=function(d,c){var b,a;if(typeof d=="object"){b=d.getTime()}else{b=Number(d)}if(typeof c=="object"){a=c.getTime()}else{a=Number(c)}return b-a};Timeline.NativeDateUnit.earlier=function(b,a){return Timeline.NativeDateUnit.compare(b,a)<0?b:a};Timeline.NativeDateUnit.later=function(b,a){return Timeline.NativeDateUnit.compare(b,a)>0?b:a};Timeline.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};Timeline.strings.en={wikiLinkLabel:"Discuss"};Timeline.GregorianDateLabeller.monthNames.en=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Timeline.GregorianDateLabeller.dayNames.en=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(typeof window.Timeplot=="undefined"){window.Timeplot={params:{bundle:true,autoCreate:true},namespace:"http://simile.mit.edu/2007/06/timeplot#",importers:{}};Timeplot.urlPrefix=GeoTemCoMinifier_urlPrefix+"lib/simile/timeplot/"}(function(){var local=false;if(document.location.search.length>0){var params=document.location.search.substr(1).split("&");for(var i=0;i<params.length;i++){if(params[i]=="local"){local=true}}}if(!local){var heads=document.documentElement.getElementsByTagName("head");for(var h=0;h<heads.length;h++){var node=heads[h].firstChild;while(node!=null){if(node.nodeType==1&&node.tagName.toLowerCase()=="script"){var url=node.src;if(url.indexOf("timeplot-api")>=0){local=(url.indexOf("local")>=0)}}node=node.nextSibling}}}var loadTimeplot=function(){if(typeof window.Timeplot!="undefined"){return}window.Timeplot={loaded:false,params:{bundle:true,autoCreate:true},namespace:"http://simile.mit.edu/2007/06/timeplot#",importers:{}};var javascriptFiles=["timeplot.js","plot.js","sources.js","geometry.js","color.js","math.js","processor.js"];var cssFiles=["timeplot.css"];var locales=["en"];var defaultClientLocales=("language" in navigator?navigator.language:navigator.browserLanguage).split(";");for(var l=0;l<defaultClientLocales.length;l++){var locale=defaultClientLocales[l];if(locale!="en"){var segments=locale.split("-");if(segments.length>1&&segments[0]!="en"){locales.push(segments[0])}locales.push(locale)}}var paramTypes={bundle:Boolean,js:Array,css:Array,autoCreate:Boolean};if(typeof Timeplot_urlPrefix=="string"){Timeplot.urlPrefix=Timeplot_urlPrefix;if("Timeplot_parameters" in window){SimileAjax.parseURLParameters(Timeplot_parameters,Timeplot.params,paramTypes)}}else{var url=SimileAjax.findScript(document,"/timeplot-api.js");if(url==null){Timeplot.error=new Error("Failed to derive URL prefix for Simile Timeplot API code files");return}Timeplot.urlPrefix=url.substr(0,url.indexOf("timeplot-api.js"));SimileAjax.parseURLParameters(url,Timeplot.params,paramTypes)}if(Timeplot.params.locale){if(Timeplot.params.locale!="en"){var segments=Timeplot.params.locale.split("-");if(segments.length>1&&segments[0]!="en"){locales.push(segments[0])}locales.push(Timeplot.params.locale)}}var timeplotURLPrefix=Timeplot.urlPrefix;if(local&&!("console" in window)){var firebug=[timeplotURLPrefix+"lib/firebug/firebug.js"];SimileAjax.includeJavascriptFiles(document,"",firebug)}var canvas=document.createElement("canvas");if(!canvas.getContext){var excanvas=[timeplotURLPrefix+"lib/excanvas.js"];SimileAjax.includeJavascriptFiles(document,"",excanvas)}var scriptURLs=Timeplot.params.js||[];var cssURLs=Timeplot.params.css||[];if(Timeplot.params.bundle&&!local){scriptURLs.push(timeplotURLPrefix+"timeplot-bundle.js");cssURLs.push(timeplotURLPrefix+"timeplot-bundle.css")}else{SimileAjax.prefixURLs(scriptURLs,timeplotURLPrefix+"scripts/",javascriptFiles);SimileAjax.prefixURLs(cssURLs,timeplotURLPrefix+"styles/",cssFiles)}window.SimileAjax_onLoad=function(){if(local&&window.console.open){window.console.open()}if(Timeplot.params.callback){eval(Timeplot.params.callback+"()")}};SimileAjax.includeJavascriptFiles(document,"",scriptURLs);SimileAjax.includeCssFiles(document,"",cssURLs);Timeplot.loaded=true};var loadTimeline=function(){if(typeof Timeline!="undefined"){loadTimeplot()}else{var timelineURL="http://api.simile-widgets.org/timeline/2.3.1/timeline-api.js?bundle=true";window.SimileAjax_onLoad=loadTimeplot;SimileAjax.includeJavascriptFile(document,timelineURL)}};if(typeof SimileAjax=="undefined"){window.SimileAjax_onLoad=loadTimeline;var url="http://api.simile-widgets.org/ajax/2.2.1/simile-ajax-api.js?bundle=true";var createScriptElement=function(){var script=document.createElement("script");script.type="text/javascript";script.language="JavaScript";script.src=url;document.getElementsByTagName("head")[0].appendChild(script)};if(document.body==null){try{document.write("<script src='"+url+"' type='text/javascript'><\/script>")}catch(e){createScriptElement()}}else{createScriptElement()}}else{loadTimeline()}})();Timeline.Debug=SimileAjax.Debug;var log=SimileAjax.Debug.log;Object.extend=function(a,c){for(var b in c){a[b]=c[b]}return a};Timeplot.create=function(a,b){return new Timeplot._Impl(a,b)};Timeplot.createPlotInfo=function(a){return{id:("id" in a)?a.id:"p"+Math.round(Math.random()*1000000),dataSource:("dataSource" in a)?a.dataSource:null,eventSource:("eventSource" in a)?a.eventSource:null,timeGeometry:("timeGeometry" in a)?a.timeGeometry:new Timeplot.DefaultTimeGeometry(),valueGeometry:("valueGeometry" in a)?a.valueGeometry:new Timeplot.DefaultValueGeometry(),timeZone:("timeZone" in a)?a.timeZone:0,fillColor:("fillColor" in a)?((a.fillColor=="string")?new Timeplot.Color(a.fillColor):a.fillColor):null,fillGradient:("fillGradient" in a)?a.fillGradient:true,fillFrom:("fillFrom" in a)?a.fillFrom:Number.NEGATIVE_INFINITY,lineColor:("lineColor" in a)?((a.lineColor=="string")?new Timeplot.Color(a.lineColor):a.lineColor):new Timeplot.Color("#606060"),lineWidth:("lineWidth" in a)?a.lineWidth:1,dotRadius:("dotRadius" in a)?a.dotRadius:2,dotColor:("dotColor" in a)?a.dotColor:null,eventLineWidth:("eventLineWidth" in a)?a.eventLineWidth:1,showValues:("showValues" in a)?a.showValues:false,roundValues:("roundValues" in a)?a.roundValues:true,valuesOpacity:("valuesOpacity" in a)?a.valuesOpacity:75,bubbleWidth:("bubbleWidth" in a)?a.bubbleWidth:300,bubbleHeight:("bubbleHeight" in a)?a.bubbleHeight:200}};Timeplot._Impl=function(a,b){this._id="t"+Math.round(Math.random()*1000000);this._containerDiv=a;this._plotInfos=b;this._painters={background:[],foreground:[]};this._painter=null;this._active=false;this._upright=false;this._initialize()};Timeplot._Impl.prototype={dispose:function(){for(var a=0;a<this._plots.length;a++){this._plots[a].dispose()}this._plots=null;this._plotsInfos=null;this._containerDiv.innerHTML=""},getElement:function(){return this._containerDiv},getDocument:function(){return this._containerDiv.ownerDocument},add:function(a){this._containerDiv.appendChild(a)},remove:function(a){this._containerDiv.removeChild(a)},addPainter:function(b,a){var d=this._painters[b];if(d){for(var c=0;c<d.length;c++){if(d[c].context._id==a.context._id){return}}d.push(a)}},removePainter:function(b,a){var d=this._painters[b];if(d){for(var c=0;c<d.length;c++){if(d[c].context._id==a.context._id){d.splice(c,1);break}}}},getWidth:function(){return this._containerDiv.clientWidth},getHeight:function(){return this._containerDiv.clientHeight},getCanvas:function(){return this._canvas},loadText:function(a,g,d,c,f){if(this._active){var h=this;var e=function(l,j,k){alert("Failed to load data xml from "+a+"\n"+l);h.hideLoadingMessage()};var b=function(j){try{d.loadText(j.responseText,g,a,c,f)}catch(k){SimileAjax.Debug.exception(k)}finally{h.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,e,b)},0)}},loadXML:function(b,d){if(this._active){var a=this;var e=function(h,f,g){alert("Failed to load data xml from "+b+"\n"+h);a.hideLoadingMessage()};var c=function(g){try{var f=g.responseXML;if(!f.documentElement&&g.responseStream){f.load(g.responseStream)}d.loadXML(f,b)}finally{a.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(b,e,c)},0)}},putText:function(e,c,a,b){var d=this.putDiv(e,"timeplot-div "+a,b);d.innerHTML=c;return d},putDiv:function(f,b,c){var d=this._id+"-"+f;var e=document.getElementById(d);if(!e){var a=this._containerDiv.firstChild;e=document.createElement("div");e.setAttribute("id",d);a.appendChild(e)}e.setAttribute("class","timeplot-div "+b);e.setAttribute("className","timeplot-div "+b);this.placeDiv(e,c);return e},placeDiv:function(b,a){if(a){for(style in a){if(style=="left"){a[style]+=this._paddingX;a[style]+="px"}else{if(style=="right"){a[style]+=this._paddingX;a[style]+="px"}else{if(style=="top"){a[style]+=this._paddingY;a[style]+="px"}else{if(style=="bottom"){a[style]+=this._paddingY;a[style]+="px"}else{if(style=="width"){if(a[style]<0){a[style]=0}a[style]+="px"}else{if(style=="height"){if(a[style]<0){a[style]=0}a[style]+="px"}}}}}}b.style[style]=a[style]}}},locate:function(a){return{x:a.offsetLeft-this._paddingX,y:a.offsetTop-this._paddingY}},update:function(){if(this._active){for(var b=0;b<this._plots.length;b++){var c=this._plots[b];var d=c.getDataSource();if(d){var a=d.getRange();if(a){c._valueGeometry.setRange(a);c._timeGeometry.setRange(a)}}c.hideValues()}this.paint()}},repaint:function(){if(this._active){this._prepareCanvas();for(var a=0;a<this._plots.length;a++){var b=this._plots[a];if(b._timeGeometry){b._timeGeometry.reset()}if(b._valueGeometry){b._valueGeometry.reset()}}this.paint()}},paint:function(){if(this._active&&this._painter==null){var a=this;this._painter=window.setTimeout(function(){a._clearCanvas();var e=function(g,f){try{if(f.setTimeplot){f.setTimeplot(a)}g.apply(f,[])}catch(h){SimileAjax.Debug.exception(h)}};var c=a._painters.background;for(var b=0;b<c.length;b++){e(c[b].action,c[b].context)}var d=a._painters.foreground;for(var b=0;b<d.length;b++){e(d[b].action,d[b].context)}a._painter=null},20)}},_clearCanvas:function(){var b=this.getCanvas();var a=b.getContext("2d");a.clearRect(0,0,b.width,b.height)},_clearLabels:function(){var a=this._containerDiv.firstChild;if(a){this._containerDiv.removeChild(a)}a=document.createElement("div");this._containerDiv.appendChild(a)},_prepareCanvas:function(){var c=this.getCanvas();var b=SimileAjax.jQuery(this._containerDiv);this._paddingX=(parseInt(b.css("paddingLeft"))+parseInt(b.css("paddingRight")))/2;this._paddingY=(parseInt(b.css("paddingTop"))+parseInt(b.css("paddingBottom")))/2;c.width=this.getWidth()-(this._paddingX*2);c.height=this.getHeight()-(this._paddingY*2);var a=c.getContext("2d");this._setUpright(a,c);a.globalCompositeOperation="source-over"},_setUpright:function(a,b){if(!SimileAjax.Platform.browser.isIE){this._upright=false}if(!this._upright){this._upright=true;a.translate(0,b.height);a.scale(1,-1)}},_isBrowserSupported:function(b){var a=SimileAjax.Platform.browser;if((b.getContext&&window.getComputedStyle)||(a.isIE&&a.majorVersion>=6)){return true}else{return false}},_initialize:function(){SimileAjax.WindowManager.initialize();var g=this._containerDiv;var j=g.ownerDocument;g.className="timeplot-container "+g.className;while(g.firstChild){g.removeChild(g.firstChild)}var b=j.createElement("canvas");if(this._isBrowserSupported(b)){this._clearLabels();this._canvas=b;b.className="timeplot-canvas";g.appendChild(b);if(!b.getContext&&G_vmlCanvasManager){b=G_vmlCanvasManager.initElement(this._canvas);this._canvas=b}this._prepareCanvas();var c=SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/copyright.png");c.className="timeplot-copyright";c.title="Timeplot (c) SIMILE - http://simile.mit.edu/timeplot/";SimileAjax.DOM.registerEvent(c,"click",function(){window.location="http://simile.mit.edu/timeplot/"});g.appendChild(c);var e=this;var h={onAddMany:function(){e.update()},onClear:function(){e.update()}};this._plots=[];if(this._plotInfos){for(var d=0;d<this._plotInfos.length;d++){var f=new Timeplot.Plot(this,this._plotInfos[d]);var a=f.getDataSource();if(a){a.addListener(h)}this.addPainter("background",{context:f.getTimeGeometry(),action:f.getTimeGeometry().paint});this.addPainter("background",{context:f.getValueGeometry(),action:f.getValueGeometry().paint});this.addPainter("foreground",{context:f,action:f.paint});this._plots.push(f);f.initialize()}}var k=SimileAjax.Graphics.createMessageBubble(j);k.containerDiv.className="timeplot-message-container";g.appendChild(k.containerDiv);k.contentDiv.className="timeplot-message";k.contentDiv.innerHTML="<img src='"+Timeplot.urlPrefix+"images/progress-running.gif' /> Loading...";this.showLoadingMessage=function(){k.containerDiv.style.display="block"};this.hideLoadingMessage=function(){k.containerDiv.style.display="none"};this._active=true}else{this._message=SimileAjax.Graphics.createMessageBubble(j);this._message.containerDiv.className="timeplot-message-container";this._message.containerDiv.style.top="15%";this._message.containerDiv.style.left="20%";this._message.containerDiv.style.right="20%";this._message.containerDiv.style.minWidth="20em";this._message.contentDiv.className="timeplot-message";this._message.contentDiv.innerHTML="We're terribly sorry, but your browser is not currently supported by <a href='http://simile.mit.edu/timeplot/'>Timeplot</a>.<br><br> We are working on supporting it in the near future but, for now, see the <a href='http://simile.mit.edu/wiki/Timeplot_Limitations'>list of currently supported browsers</a>.";this._message.containerDiv.style.display="block";g.appendChild(this._message.containerDiv)}}};Timeplot.Plot=function(a,b){this._timeplot=a;this._canvas=a.getCanvas();this._plotInfo=b;this._id=b.id;this._timeGeometry=b.timeGeometry;this._valueGeometry=b.valueGeometry;this._theme=new Timeline.getDefaultTheme();this._dataSource=b.dataSource;this._eventSource=b.eventSource;this._bubble=null};Timeplot.Plot.prototype={initialize:function(){if(this._dataSource&&this._dataSource.getValue){this._timeFlag=this._timeplot.putDiv("timeflag","timeplot-timeflag");this._valueFlag=this._timeplot.putDiv(this._id+"valueflag","timeplot-valueflag");this._valueFlagLineLeft=this._timeplot.putDiv(this._id+"valueflagLineLeft","timeplot-valueflag-line");this._valueFlagLineRight=this._timeplot.putDiv(this._id+"valueflagLineRight","timeplot-valueflag-line");if(!this._valueFlagLineLeft.firstChild){this._valueFlagLineLeft.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_left.png"));this._valueFlagLineRight.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_right.png"))}this._valueFlagPole=this._timeplot.putDiv(this._id+"valuepole","timeplot-valueflag-pole");var d=this._plotInfo.valuesOpacity;SimileAjax.Graphics.setOpacity(this._timeFlag,d);SimileAjax.Graphics.setOpacity(this._valueFlag,d);SimileAjax.Graphics.setOpacity(this._valueFlagLineLeft,d);SimileAjax.Graphics.setOpacity(this._valueFlagLineRight,d);SimileAjax.Graphics.setOpacity(this._valueFlagPole,d);var f=this;var g=function(j,h,k){if(f._plotInfo.showValues){f._valueFlag.style.display="block";a(j,h,k)}};var b=24*60*60*1000;var e=30*b;var a=function(k,D,s){if(typeof SimileAjax!="undefined"&&f._plotInfo.showValues){var w=f._canvas;var B=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(D,f._canvas).x);if(B>w.width){B=w.width}if(isNaN(B)||B<0){B=0}var E=f._timeGeometry.fromScreen(B);if(E==0){f._valueFlag.style.display="none";return}var m=f._dataSource.getClosestValidTime(E);B=f._timeGeometry.toScreen(m);var C=f._dataSource.getValue(m);if(f._plotInfo.roundValues){C=Math.round(C)}f._valueFlag.innerHTML=new String(C);var u=new Date(m);var j=f._timeGeometry.getPeriod();if(j<b){f._timeFlag.innerHTML=u.toLocaleTimeString()}else{if(j>e){f._timeFlag.innerHTML=u.toLocaleDateString()}else{f._timeFlag.innerHTML=u.toLocaleString()}}var r=f._timeFlag.clientWidth;var h=f._timeFlag.clientHeight;var l=Math.round(r/2);var A=f._valueFlag.clientWidth;var q=f._valueFlag.clientHeight;var z=f._valueGeometry.toScreen(C);if(B+l>w.width){var o=w.width-l}else{if(B-l<0){var o=l}else{var o=B}}if(f._timeGeometry._timeValuePosition=="top"){f._timeplot.placeDiv(f._valueFlagPole,{left:B,top:h-5,height:w.height-z-h+6,display:"block"});f._timeplot.placeDiv(f._timeFlag,{left:o-l,top:-6,display:"block"})}else{f._timeplot.placeDiv(f._valueFlagPole,{left:B,bottom:h-5,height:z-h+6,display:"block"});f._timeplot.placeDiv(f._timeFlag,{left:o-l,bottom:-6,display:"block"})}if(B+A+14>w.width&&z+q+4>w.height){f._valueFlagLineLeft.style.display="none";f._timeplot.placeDiv(f._valueFlagLineRight,{left:B-14,bottom:z-14,display:"block"});f._timeplot.placeDiv(f._valueFlag,{left:B-A-13,bottom:z-q-13,display:"block"})}else{if(B+A+14>w.width&&z+q+4<w.height){f._valueFlagLineRight.style.display="none";f._timeplot.placeDiv(f._valueFlagLineLeft,{left:B-14,bottom:z,display:"block"});f._timeplot.placeDiv(f._valueFlag,{left:B-A-13,bottom:z+13,display:"block"})}else{if(B+A+14<w.width&&z+q+4>w.height){f._valueFlagLineRight.style.display="none";f._timeplot.placeDiv(f._valueFlagLineLeft,{left:B,bottom:z-13,display:"block"});f._timeplot.placeDiv(f._valueFlag,{left:B+13,bottom:z-13,display:"block"})}else{f._valueFlagLineLeft.style.display="none";f._timeplot.placeDiv(f._valueFlagLineRight,{left:B,bottom:z,display:"block"});f._timeplot.placeDiv(f._valueFlag,{left:B+13,bottom:z+13,display:"block"})}}}}};var c=this._timeplot.getElement();SimileAjax.DOM.registerEvent(c,"mouseover",g);SimileAjax.DOM.registerEvent(c,"mousemove",a)}},dispose:function(){if(this._dataSource){this._dataSource.removeListener(this._paintingListener);this._paintingListener=null;this._dataSource.dispose();this._dataSource=null}},hideValues:function(){if(this._valueFlag){this._valueFlag.style.display="none"}if(this._timeFlag){this._timeFlag.style.display="none"}if(this._valueFlagLineLeft){this._valueFlagLineLeft.style.display="none"}if(this._valueFlagLineRight){this._valueFlagLineRight.style.display="none"}if(this._valueFlagPole){this._valueFlagPole.style.display="none"}},getDataSource:function(){return(this._dataSource)?this._dataSource:this._eventSource},getTimeGeometry:function(){return this._timeGeometry},getValueGeometry:function(){return this._valueGeometry},paint:function(){var p=this._canvas.getContext("2d");p.lineWidth=this._plotInfo.lineWidth;p.lineJoin="miter";if(this._dataSource){if(this._plotInfo.fillColor){if(this._plotInfo.fillGradient){var a=p.createLinearGradient(0,this._canvas.height,0,0);a.addColorStop(0,this._plotInfo.fillColor.toString());a.addColorStop(0.5,this._plotInfo.fillColor.toString());a.addColorStop(1,"rgba(255,255,255,0)");p.fillStyle=a}else{p.fillStyle=this._plotInfo.fillColor.toString()}p.beginPath();p.moveTo(0,0);this._plot(function(c,r){p.lineTo(c,r)});if(this._plotInfo.fillFrom==Number.NEGATIVE_INFINITY){p.lineTo(this._canvas.width,0)}else{if(this._plotInfo.fillFrom==Number.POSITIVE_INFINITY){p.lineTo(this._canvas.width,this._canvas.height);p.lineTo(0,this._canvas.height)}else{p.lineTo(this._canvas.width,this._valueGeometry.toScreen(this._plotInfo.fillFrom));p.lineTo(0,this._valueGeometry.toScreen(this._plotInfo.fillFrom))}}p.fill()}if(this._plotInfo.lineColor){p.strokeStyle=this._plotInfo.lineColor.toString();p.beginPath();var g=true;this._plot(function(c,r){if(g){g=false;p.moveTo(c,r)}p.lineTo(c,r)});p.stroke()}if(this._plotInfo.dotColor){p.fillStyle=this._plotInfo.dotColor.toString();var m=this._plotInfo.dotRadius;this._plot(function(c,r){p.beginPath();p.arc(c,r,m,0,2*Math.PI,true);p.fill()})}}if(this._eventSource){var a=p.createLinearGradient(0,0,0,this._canvas.height);a.addColorStop(1,"rgba(255,255,255,0)");p.strokeStyle=a;p.fillStyle=a;p.lineWidth=this._plotInfo.eventLineWidth;p.lineJoin="miter";var u=this._eventSource.getAllEventIterator();while(u.hasNext()){var t=u.next();var q=t.getColor();q=(q)?new Timeplot.Color(q):this._plotInfo.lineColor;var b=t.getStart().getTime();var v=t.getEnd().getTime();if(b==v){var y=q.toString();a.addColorStop(0,y);var f=this._timeGeometry.toScreen(b);f=Math.floor(f)+0.5;var d=f;p.beginPath();p.moveTo(f,0);p.lineTo(f,this._canvas.height);p.stroke();var h=f-4;var k=7}else{var y=q.toString(0.5);a.addColorStop(0,y);var f=this._timeGeometry.toScreen(b);f=Math.floor(f)+0.5;var d=this._timeGeometry.toScreen(v);d=Math.floor(d)+0.5;p.fillRect(f,0,d-f,this._canvas.height);var h=f;var k=d-f-1}var l=this._timeplot.putDiv(t.getID(),"timeplot-event-box",{left:Math.round(h),width:Math.round(k),top:0,height:this._canvas.height-1});var s=this;var j=function(c){return function(x,r,B){var A=s._timeplot.getDocument();s._closeBubble();var z=SimileAjax.DOM.getEventPageCoordinates(r);var w=SimileAjax.DOM.getPageCoordinates(x);s._bubble=SimileAjax.Graphics.createBubbleForPoint(z.x,w.top+s._canvas.height,s._plotInfo.bubbleWidth,s._plotInfo.bubbleHeight,"bottom");c.fillInfoBubble(s._bubble.content,s._theme,s._timeGeometry.getLabeler())}};var e=function(r,c,w){r.oldClass=r.className;r.className=r.className+" timeplot-event-box-highlight"};var o=function(r,c,w){r.className=r.oldClass;r.oldClass=null};if(!l.instrumented){SimileAjax.DOM.registerEvent(l,"click",j(t));SimileAjax.DOM.registerEvent(l,"mouseover",e);SimileAjax.DOM.registerEvent(l,"mouseout",o);l.instrumented=true}}}},_plot:function(g){var e=this._dataSource.getData();if(e){var h=e.times;var b=e.values;var c=h.length;for(var d=0;d<c;d++){var a=this._timeGeometry.toScreen(h[d]);var j=this._valueGeometry.toScreen(b[d]);g(a,j)}}},_closeBubble:function(){if(this._bubble!=null){this._bubble.close();this._bubble=null}}};Timeplot.DefaultEventSource=function(a){Timeline.DefaultEventSource.apply(this,arguments)};Object.extend(Timeplot.DefaultEventSource.prototype,Timeline.DefaultEventSource.prototype);Timeplot.DefaultEventSource.prototype.loadText=function(o,j,a,c,l){if(o==null){return}this._events.maxValues=new Array();var b=this._getBaseURL(a);if(!l){l="iso8601"}var h=this._events.getUnit().getParser(l);var g=this._parseText(o,j);var k=false;if(c){g=c(g)}if(g){for(var f=0;f<g.length;f++){var p=g[f];if(p.length>1){var e=SimileAjax.jQuery.trim(p[0]);var d=h(e);if(d){var m=new Timeplot.DefaultEventSource.NumericEvent(d,p.slice(1));this._events.add(m);k=true}}}}if(k){this._fire("onAddMany",[])}};Timeplot.DefaultEventSource.prototype._parseText=function(h,c){h=h.replace(/\r\n?/g,"\n");var f=0;var e=h.length;var j=[];while(f<e){var k=[];if(h.charAt(f)!="#"){while(f<e){if(h.charAt(f)=='"'){var a=h.indexOf('"',f+1);while(a<e&&a>-1){if(h.charAt(a+1)!='"'){break}a=h.indexOf('"',a+2)}if(a<0){}else{if(h.charAt(a+1)==c){var b=h.substr(f+1,a-f-1);b=b.replace(/""/g,'"');k[k.length]=b;f=a+2;continue}else{if(h.charAt(a+1)=="\n"||e==a+1){var b=h.substr(f+1,a-f-1);b=b.replace(/""/g,'"');k[k.length]=b;f=a+2;break}else{}}}}var g=h.indexOf(c,f);var d=h.indexOf("\n",f);if(d<0){d=e}if(g>-1&&g<d){k[k.length]=h.substr(f,g-f);f=g+1}else{k[k.length]=h.substr(f,d-f);f=d+1;break}}}else{var d=h.indexOf("\n",f);f=(d>-1)?d+1:cur}if(k.length>0){j[j.length]=k}}if(j.length<0){return}return j};Timeplot.DefaultEventSource.prototype.getRange=function(){var a=this.getEarliestDate();var b=this.getLatestDate();return{earliestDate:(a)?a:null,latestDate:(b)?b:null,min:0,max:0}};Timeplot.DefaultEventSource.NumericEvent=function(b,a){this._id="e"+Math.round(Math.random()*1000000);this._time=b;this._values=a};Timeplot.DefaultEventSource.NumericEvent.prototype={getID:function(){return this._id},getTime:function(){return this._time},getValues:function(){return this._values},getStart:function(){return this._time},getEnd:function(){return this._time}};Timeplot.DataSource=function(b){this._eventSource=b;var a=this;this._processingListener={onAddMany:function(){a._process()},onClear:function(){a._clear()}};this.addListener(this._processingListener);this._listeners=[];this._data=null;this._range=null};Timeplot.DataSource.prototype={_clear:function(){this._data=null;this._range=null},_process:function(){this._data={times:new Array(),values:new Array()};this._range={earliestDate:null,latestDate:null,min:0,max:0}},getRange:function(){return this._range},getData:function(){return this._data},getValue:function(c){if(this._data){for(var b=0;b<this._data.times.length;b++){var a=this._data.times[b];if(a>=c){return this._data.values[b]}}}return 0},getClosestValidTime:function(b){if(this._data){for(var a=0;a<this._data.times.length;a++){var c=this._data.times[a];if(c>=b){if(a<=0){return c}else{var d=this._data.times[a-1];if(b-d<c-b){return d}else{return c}}}}}return 0},addListener:function(a){this._eventSource.addListener(a)},removeListener:function(a){this._eventSource.removeListener(a)},replaceListener:function(a,b){this.removeListener(a);this.addListener(b)}};Timeplot.ColumnSource=function(b,a){Timeplot.DataSource.apply(this,arguments);this._column=a-1};Object.extend(Timeplot.ColumnSource.prototype,Timeplot.DataSource.prototype);Timeplot.ColumnSource.prototype.dispose=function(){this.removeListener(this._processingListener);this._clear()};Timeplot.ColumnSource.prototype._process=function(){var g=this._eventSource.getCount();var a=new Array(g);var k=new Array(g);var d=Number.MAX_VALUE;var h=Number.MIN_VALUE;var e=0;var f=this._eventSource.getAllEventIterator();while(f.hasNext()){var b=f.next();var c=b.getTime();a[e]=c;var j=this._getValue(b);if(!isNaN(j)){if(j<d){d=j}if(j>h){h=j}k[e]=j}e++}this._data={times:a,values:k};if(h==Number.MIN_VALUE){h=1}this._range={earliestDate:this._eventSource.getEarliestDate(),latestDate:this._eventSource.getLatestDate(),min:d,max:h}};Timeplot.ColumnSource.prototype._getValue=function(a){return parseFloat(a.getValues()[this._column])};Timeplot.ColumnDiffSource=function(c,b,a){Timeplot.ColumnSource.apply(this,arguments);this._column2=a-1};Object.extend(Timeplot.ColumnDiffSource.prototype,Timeplot.ColumnSource.prototype);Timeplot.ColumnDiffSource.prototype._getValue=function(e){var d=parseFloat(e.getValues()[this._column]);var c=parseFloat(e.getValues()[this._column2]);return d-c};Timeplot.DefaultValueGeometry=function(a){if(!a){a={}}this._id=("id" in a)?a.id:"g"+Math.round(Math.random()*1000000);this._axisColor=("axisColor" in a)?((typeof a.axisColor=="string")?new Timeplot.Color(a.axisColor):a.axisColor):new Timeplot.Color("#606060"),this._gridColor=("gridColor" in a)?((typeof a.gridColor=="string")?new Timeplot.Color(a.gridColor):a.gridColor):null,this._gridLineWidth=("gridLineWidth" in a)?a.gridLineWidth:0.5;this._axisLabelsPlacement=("axisLabelsPlacement" in a)?a.axisLabelsPlacement:"right";this._gridSpacing=("gridSpacing" in a)?a.gridStep:50;this._gridType=("gridType" in a)?a.gridType:"short";this._gridShortSize=("gridShortSize" in a)?a.gridShortSize:10;this._minValue=("min" in a)?a.min:null;this._maxValue=("max" in a)?a.max:null;this._linMap={direct:function(b){return b},inverse:function(b){return b}};this._map=this._linMap;this._labels=[];this._grid=[]};Timeplot.DefaultValueGeometry.prototype={setTimeplot:function(a){this._timeplot=a;this._canvas=a.getCanvas();this.reset()},setRange:function(a){if((this._minValue==null)||((this._minValue!=null)&&(a.min<this._minValue))){this._minValue=a.min}if((this._maxValue==null)||((this._maxValue!=null)&&(a.max*1.05>this._maxValue))){this._maxValue=a.max*1.05}this._updateMappedValues();if(!(this._minValue==0&&this._maxValue==0)){this._grid=this._calculateGrid()}},reset:function(){this._clearLabels();this._updateMappedValues();this._grid=this._calculateGrid()},toScreen:function(b){if(this._canvas&&this._maxValue){var a=b-this._minValue;return this._canvas.height*(this._map.direct(a))/this._mappedRange}else{return -50}},fromScreen:function(a){if(this._canvas){return this._map.inverse(this._mappedRange*a/this._canvas.height)+this._minValue}else{return 0}},paint:function(){if(this._timeplot){var b=this._canvas.getContext("2d");b.lineJoin="miter";if(this._gridColor){var e=b.createLinearGradient(0,0,0,this._canvas.height);e.addColorStop(0,this._gridColor.toHexString());e.addColorStop(0.3,this._gridColor.toHexString());e.addColorStop(1,"rgba(255,255,255,0.5)");b.lineWidth=this._gridLineWidth;b.strokeStyle=e;for(var d=0;d<this._grid.length;d++){var c=this._grid[d];var g=Math.floor(c.y)+0.5;if(typeof c.label!="undefined"){if(this._axisLabelsPlacement=="left"){var f=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:4,bottom:g+2,color:this._gridColor.toHexString(),visibility:"hidden"});this._labels.push(f)}else{if(this._axisLabelsPlacement=="right"){var f=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{right:4,bottom:g+2,color:this._gridColor.toHexString(),visibility:"hidden"});this._labels.push(f)}}if(g+f.clientHeight<this._canvas.height+10){f.style.visibility="visible"}}b.beginPath();if(this._gridType=="long"||c.label==0){b.moveTo(0,g);b.lineTo(this._canvas.width,g)}else{if(this._gridType=="short"){if(this._axisLabelsPlacement=="left"){b.moveTo(0,g);b.lineTo(this._gridShortSize,g)}else{if(this._axisLabelsPlacement=="right"){b.moveTo(this._canvas.width,g);b.lineTo(this._canvas.width-this._gridShortSize,g)}}}}b.stroke()}}var a=b.createLinearGradient(0,0,0,this._canvas.height);a.addColorStop(0,this._axisColor.toString());a.addColorStop(0.5,this._axisColor.toString());a.addColorStop(1,"rgba(255,255,255,0.5)");b.lineWidth=1;b.strokeStyle=a;b.beginPath();b.moveTo(0,this._canvas.height);b.lineTo(0,0);b.stroke();b.beginPath();b.moveTo(this._canvas.width,0);b.lineTo(this._canvas.width,this._canvas.height);b.stroke()}},_clearLabels:function(){for(var b=0;b<this._labels.length;b++){var a=this._labels[b];var c=a.parentNode;if(c){c.removeChild(a)}}},_calculateGrid:function(){var c=[];if(!this._canvas||this._valueRange==0){return c}var d=0;if(this._valueRange>1){while(Math.pow(10,d)<this._valueRange){d++}d--}else{while(Math.pow(10,d)>this._valueRange){d--}}var e=Math.pow(10,d);var f=e;while(true){var a=this.toScreen(this._minValue+f);while(a<this._gridSpacing){f+=e;a=this.toScreen(this._minValue+f)}if(a>2*this._gridSpacing){e/=10;f=e}else{break}}var b=0;var g=this.toScreen(b);if(this._minValue>=0){while(g<this._canvas.height){if(g>0){c.push({y:g,label:b})}b+=f;g=this.toScreen(b)}}else{if(this._maxValue<=0){while(g>0){if(g<this._canvas.height){c.push({y:g,label:b})}b-=f;g=this.toScreen(b)}}else{while(g<this._canvas.height){if(g>0){c.push({y:g,label:b})}b+=f;g=this.toScreen(b)}b=-f;g=this.toScreen(b);while(g>0){if(g<this._canvas.height){c.push({y:g,label:b})}b-=f;g=this.toScreen(b)}}}return c},_updateMappedValues:function(){this._valueRange=Math.abs(this._maxValue-this._minValue);this._mappedRange=this._map.direct(this._valueRange)}};Timeplot.LogarithmicValueGeometry=function(a){Timeplot.DefaultValueGeometry.apply(this,arguments);this._logMap={direct:function(b){return Math.log(b+1)/Math.log(10)},inverse:function(b){return Math.exp(Math.log(10)*b)-1}};this._mode="log";this._map=this._logMap;this._calculateGrid=this._logarithmicCalculateGrid};Timeplot.LogarithmicValueGeometry.prototype._linearCalculateGrid=Timeplot.DefaultValueGeometry.prototype._calculateGrid;Object.extend(Timeplot.LogarithmicValueGeometry.prototype,Timeplot.DefaultValueGeometry.prototype);Timeplot.LogarithmicValueGeometry.prototype._logarithmicCalculateGrid=function(){var b=[];if(!this._canvas||this._valueRange==0){return b}var a=1;var c=this.toScreen(a);while(c<this._canvas.height||isNaN(c)){if(c>0){b.push({y:c,label:a})}a*=10;c=this.toScreen(a)}return b};Timeplot.LogarithmicValueGeometry.prototype.actLinear=function(){this._mode="lin";this._map=this._linMap;this._calculateGrid=this._linearCalculateGrid;this.reset()};Timeplot.LogarithmicValueGeometry.prototype.actLogarithmic=function(){this._mode="log";this._map=this._logMap;this._calculateGrid=this._logarithmicCalculateGrid;this.reset()};Timeplot.LogarithmicValueGeometry.prototype.toggle=function(){if(this._mode=="log"){this.actLinear()}else{this.actLogarithmic()}};Timeplot.DefaultTimeGeometry=function(b){if(!b){b={}}this._id=("id" in b)?b.id:"g"+Math.round(Math.random()*1000000);this._locale=("locale" in b)?b.locale:"en";this._timeZone=("timeZone" in b)?b.timeZone:SimileAjax.DateTime.getTimezone();this._labeler=("labeller" in b)?b.labeller:null;this._axisColor=("axisColor" in b)?((b.axisColor=="string")?new Timeplot.Color(b.axisColor):b.axisColor):new Timeplot.Color("#606060"),this._gridColor=("gridColor" in b)?((b.gridColor=="string")?new Timeplot.Color(b.gridColor):b.gridColor):null,this._gridLineWidth=("gridLineWidth" in b)?b.gridLineWidth:0.5;this._axisLabelsPlacement=("axisLabelsPlacement" in b)?b.axisLabelsPlacement:"bottom";this._gridStep=("gridStep" in b)?b.gridStep:100;this._gridStepRange=("gridStepRange" in b)?b.gridStepRange:20;this._min=("min" in b)?b.min:null;this._max=("max" in b)?b.max:null;this._timeValuePosition=("timeValuePosition" in b)?b.timeValuePosition:"bottom";this._unit=("unit" in b)?b.unit:Timeline.NativeDateUnit;this._linMap={direct:function(c){return c},inverse:function(c){return c}};this._map=this._linMap;if(!this._labeler){this._labeler=this._unit.createLabeller(this._locale,this._timeZone)}var a=this._unit.getParser("iso8601");if(this._min&&!this._min.getTime){this._min=a(this._min)}if(this._max&&!this._max.getTime){this._max=a(this._max)}this._labels=[];this._grid=[]};Timeplot.DefaultTimeGeometry.prototype={setTimeplot:function(a){this._timeplot=a;this._canvas=a.getCanvas();this.reset()},setRange:function(a){if(this._min){this._earliestDate=this._min}else{if(a.earliestDate&&((this._earliestDate==null)||((this._earliestDate!=null)&&(a.earliestDate.getTime()<this._earliestDate.getTime())))){this._earliestDate=a.earliestDate}}if(this._max){this._latestDate=this._max}else{if(a.latestDate&&((this._latestDate==null)||((this._latestDate!=null)&&(a.latestDate.getTime()>this._latestDate.getTime())))){this._latestDate=a.latestDate}}if(!this._earliestDate&&!this._latestDate){this._grid=[]}else{this.reset()}},reset:function(){this._updateMappedValues();if(this._canvas){this._grid=this._calculateGrid()}},toScreen:function(c){if(this._canvas&&this._latestDate){var a=c-this._earliestDate.getTime();var b=(this._mappedPeriod>0)?this._map.direct(a)/this._mappedPeriod:0;return this._canvas.width*b}else{return -50}},fromScreen:function(a){if(this._canvas){return this._map.inverse(this._mappedPeriod*a/this._canvas.width)+this._earliestDate.getTime()}else{return 0}},getPeriod:function(){return this._period},getLabeler:function(){return this._labeler},getUnit:function(){return this._unit},paint:function(){if(this._canvas){var e=this._unit;var b=this._canvas.getContext("2d");var f=b.createLinearGradient(0,0,0,this._canvas.height);b.strokeStyle=f;b.lineWidth=this._gridLineWidth;b.lineJoin="miter";if(this._gridColor){f.addColorStop(0,this._gridColor.toString());f.addColorStop(1,"rgba(255,255,255,0.9)");for(var d=0;d<this._grid.length;d++){var c=this._grid[d];var a=Math.floor(c.x)+0.5;if(this._axisLabelsPlacement=="top"){var g=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:a+4,top:2,visibility:"hidden"});this._labels.push(g)}else{if(this._axisLabelsPlacement=="bottom"){var g=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:a+4,bottom:2,visibility:"hidden"});this._labels.push(g)}}if(a+g.clientWidth<this._canvas.width+10){g.style.visibility="visible"}b.beginPath();b.moveTo(a,0);b.lineTo(a,this._canvas.height);b.stroke()}}f.addColorStop(0,this._axisColor.toString());f.addColorStop(1,"rgba(255,255,255,0.5)");b.lineWidth=1;f.addColorStop(0,this._axisColor.toString());b.beginPath();b.moveTo(0,0);b.lineTo(this._canvas.width,0);b.stroke()}},_calculateGrid:function(){var a=[];var d=SimileAjax.DateTime;var h=this._unit;var b=this._period;if(b==0){return a}if(b>d.gregorianUnitLengths[d.MILLENNIUM]){g=d.MILLENNIUM}else{for(var g=d.MILLENNIUM;g>0;g--){if(d.gregorianUnitLengths[g-1]<=b&&b<d.gregorianUnitLengths[g]){g--;break}}}var j=h.cloneValue(this._earliestDate);do{d.roundDownToInterval(j,g,this._timeZone,1,0);var f=this.toScreen(h.toNumber(j));switch(g){case d.SECOND:var e=j.toLocaleTimeString();break;case d.MINUTE:var c=j.getMinutes();var e=j.getHours()+":"+((c<10)?"0":"")+c;break;case d.HOUR:var e=j.getHours()+":00";break;case d.DAY:case d.WEEK:case d.MONTH:var e=j.toLocaleDateString();break;case d.YEAR:case d.DECADE:case d.CENTURY:case d.MILLENNIUM:var e=j.getUTCFullYear();break}if(f>0){a.push({x:f,label:e})}d.incrementByInterval(j,g,this._timeZone)}while(j.getTime()<this._latestDate.getTime());return a},_clearLabels:function(){for(var b=0;b<this._labels.length;b++){var a=this._labels[b];var c=a.parentNode;if(c){c.removeChild(a)}}},_updateMappedValues:function(){if(this._latestDate&&this._earliestDate){this._period=this._latestDate.getTime()-this._earliestDate.getTime();this._mappedPeriod=this._map.direct(this._period)}else{this._period=0;this._mappedPeriod=0}}};Timeplot.MagnifyingTimeGeometry=function(b){Timeplot.DefaultTimeGeometry.apply(this,arguments);var a=this;this._MagnifyingMap={direct:function(d){if(d<a._leftTimeMargin){var c=d*a._leftRate}else{if(a._leftTimeMargin<d&&d<a._rightTimeMargin){var c=d*a._expandedRate+a._expandedTimeTranslation}else{var c=d*a._rightRate+a._rightTimeTranslation}}return c},inverse:function(c){if(c<a._leftScreenMargin){var d=c/a._leftRate}else{if(a._leftScreenMargin<c&&c<a._rightScreenMargin){var d=c/a._expandedRate+a._expandedScreenTranslation}else{var d=c/a._rightRate+a._rightScreenTranslation}}return d}};this._mode="lin";this._map=this._linMap};Object.extend(Timeplot.MagnifyingTimeGeometry.prototype,Timeplot.DefaultTimeGeometry.prototype);Timeplot.MagnifyingTimeGeometry.prototype.initialize=function(f){Timeplot.DefaultTimeGeometry.prototype.initialize.apply(this,arguments);if(!this._lens){this._lens=this._timeplot.putDiv("lens","timeplot-lens")}var g=1000*60*60*24*30;var h=this;var b=function(l){var o=l.clientWidth;var m=h._timeplot.locate(l);h.setMagnifyingParams(m.x+o/2,o,g);h.actMagnifying();h._timeplot.paint()};var k=function(m,l,o){h._canvas.startCoords=SimileAjax.DOM.getEventRelativeCoordinates(l,m);h._canvas.pressed=true};var j=function(m,l,p){h._canvas.pressed=false;var o=SimileAjax.DOM.getEventRelativeCoordinates(l,m);if(Timeplot.Math.isClose(o,h._canvas.startCoords,5)){h._lens.style.display="none";h.actLinear();h._timeplot.paint()}else{h._lens.style.cursor="move";b(h._lens)}};var d=function(m,l,p){if(h._canvas.pressed){var o=SimileAjax.DOM.getEventRelativeCoordinates(l,m);if(o.x<0){o.x=0}if(o.x>h._canvas.width){o.x=h._canvas.width}h._timeplot.placeDiv(h._lens,{left:h._canvas.startCoords.x,width:o.x-h._canvas.startCoords.x,bottom:0,height:h._canvas.height,display:"block"})}};var a=function(m,l,o){h._lens.startCoords=SimileAjax.DOM.getEventRelativeCoordinates(l,m);h._lens.pressed=true};var c=function(m,l,o){h._lens.pressed=false};var e=function(o,l,r){if(h._lens.pressed){var p=SimileAjax.DOM.getEventRelativeCoordinates(l,o);var m=h._lens;var q=m.offsetLeft+p.x-m.startCoords.x;if(q<h._timeplot._paddingX){q=h._timeplot._paddingX}if(q+m.clientWidth>h._canvas.width-h._timeplot._paddingX){q=h._canvas.width-m.clientWidth+h._timeplot._paddingX}m.style.left=q;b(m)}};if(!this._canvas.instrumented){SimileAjax.DOM.registerEvent(this._canvas,"mousedown",k);SimileAjax.DOM.registerEvent(this._canvas,"mousemove",d);SimileAjax.DOM.registerEvent(this._canvas,"mouseup",j);SimileAjax.DOM.registerEvent(this._canvas,"mouseup",c);this._canvas.instrumented=true}if(!this._lens.instrumented){SimileAjax.DOM.registerEvent(this._lens,"mousedown",a);SimileAjax.DOM.registerEvent(this._lens,"mousemove",e);SimileAjax.DOM.registerEvent(this._lens,"mouseup",c);SimileAjax.DOM.registerEvent(this._lens,"mouseup",j);this._lens.instrumented=true}};Timeplot.MagnifyingTimeGeometry.prototype.setMagnifyingParams=function(k,g,e){g=g/2;e=e/2;var f=this._canvas.width;var j=this._period;if(k<0){k=0}if(k>f){k=f}if(k-g<0){g=k}if(k+g>f){g=f-k}var h=this.fromScreen(k)-this._earliestDate.getTime();if(h-e<0){e=h}if(h+e>j){e=j-h}this._centerX=k;this._centerTime=h;this._aperture=g;this._aperturePeriod=e;this._leftScreenMargin=this._centerX-this._aperture;this._rightScreenMargin=this._centerX+this._aperture;this._leftTimeMargin=this._centerTime-this._aperturePeriod;this._rightTimeMargin=this._centerTime+this._aperturePeriod;this._leftRate=(k-g)/(h-e);this._expandedRate=g/e;this._rightRate=(f-k-g)/(j-h-e);this._expandedTimeTranslation=this._centerX-this._centerTime*this._expandedRate;this._expandedScreenTranslation=this._centerTime-this._centerX/this._expandedRate;this._rightTimeTranslation=(k+g)-(h+e)*this._rightRate;this._rightScreenTranslation=(h+e)-(k+g)/this._rightRate;this._updateMappedValues()};Timeplot.MagnifyingTimeGeometry.prototype.actLinear=function(){this._mode="lin";this._map=this._linMap;this.reset()};Timeplot.MagnifyingTimeGeometry.prototype.actMagnifying=function(){this._mode="Magnifying";this._map=this._MagnifyingMap;this.reset()};Timeplot.MagnifyingTimeGeometry.prototype.toggle=function(){if(this._mode=="Magnifying"){this.actLinear()}else{this.actMagnifying()}};Timeplot.Color=function(a){this._fromHex(a)};Timeplot.Color.prototype={set:function(f,e,c,d){this.r=f;this.g=e;this.b=c;this.a=(d)?d:1;return this.check()},transparency:function(b){this.a=b;return this.check()},lighten:function(b){var a=new Timeplot.Color();return a.set(this.r+=parseInt(b,10),this.g+=parseInt(b,10),this.b+=parseInt(b,10))},darken:function(b){var a=new Timeplot.Color();return a.set(this.r-=parseInt(b,10),this.g-=parseInt(b,10),this.b-=parseInt(b,10))},check:function(){if(this.r>255){this.r=255}else{if(this.r<0){this.r=0}}if(this.g>255){this.g=255}else{if(this.g<0){this.g=0}}if(this.b>255){this.b=255}else{if(this.b<0){this.b=0}}if(this.a>1){this.a=1}else{if(this.a<0){this.a=0}}return this},toString:function(c){var b=(c)?c:((this.a)?this.a:1);return"rgba("+this.r+","+this.g+","+this.b+","+b+")"},toHexString:function(){return"#"+this._toHex(this.r)+this._toHex(this.g)+this._toHex(this.b)},_fromHex:function(a){if(/^#?([\da-f]{3}|[\da-f]{6})$/i.test(a)){a=a.replace(/^#/,"").replace(/^([\da-f])([\da-f])([\da-f])$/i,"$1$1$2$2$3$3");this.r=parseInt(a.substr(0,2),16);this.g=parseInt(a.substr(2,2),16);this.b=parseInt(a.substr(4,2),16)}else{if(/^rgb *\( *\d{0,3} *, *\d{0,3} *, *\d{0,3} *\)$/i.test(a)){a=a.match(/^rgb *\( *(\d{0,3}) *, *(\d{0,3}) *, *(\d{0,3}) *\)$/i);this.r=parseInt(a[1],10);this.g=parseInt(a[2],10);this.b=parseInt(a[3],10)}}this.a=1;return this.check()},_toHex:function(d){var c="0123456789ABCDEF";if(d<0){return"00"}if(d>255){return"FF"}var b=Math.floor(d/16);var a=d%16;return c.charAt(b)+c.charAt(a)}};Timeplot.Math={range:function(g){var d=g.length;var c=Number.MAX_VALUE;var a=Number.MIN_VALUE;for(var b=0;b<d;b++){var e=g[b];if(e<c){c=e}if(e>a){a=e}}return{min:c,max:a}},movingAverage:function(j,c){var e=j.length;var d=new Array(e);for(var k=0;k<e;k++){var h=0;for(var a=k-c;a<k+c;a++){if(a<0){var b=j[0]}else{if(a>=e){var b=d[k-1]}else{var b=j[a]}}h+=b}d[k]=h/(2*c)}return d},integral:function(e){var d=e.length;var c=new Array(d);var b=0;for(var a=0;a<d;a++){b+=e[a];c[a]=b}return c},normalize:function(d){var c=d.length;var b=0;for(var a=0;a<c;a++){b+=d[a]}for(var a=0;a<c;a++){d[a]/=b}return d},convolution:function(l,k){var t=l.length;var s=k.length;var o=new Array(t);for(var h=0;h<t;h++){var d=0;var j=(h+s<t)?h+s:t;for(var e=h;e<j;e++){var q=l[e-s];var p=k[e-h];d+=q*p}o[h]=d}return o},heavyside:function(b){var d=new Array(b);var c=1/b;for(var a=0;a<b;a++){d[a]=c}return d},gaussian:function(size,threshold){with(Math){var radius=size/2;var variance=radius*radius/log(threshold);var g=new Array(size);for(var t=0;t<size;t++){var l=t-radius;g[t]=exp(-variance*l*l)}}return this.normalize(g)},round:function(x,n){with(Math){if(abs(x)>1){var l=floor(log(x)/log(10));var d=round(exp((l-n+1)*log(10)));var y=round(round(x/d)*d);return y}else{log("FIXME(SM): still to implement for 0 < abs(x) < 1");return x}}},tanh:function(a){if(a>5){return 1}else{if(a<5){return -1}else{var b=Math.exp(2*a);return(b-1)/(b+1)}}},isClose:function(d,c,e){return(d&&c&&Math.abs(d.x-c.x)<e&&Math.abs(d.y-c.y)<e)}};Timeplot.Operator={sum:function(a,b){return Timeplot.Math.integral(a.values)},average:function(c,d){var b=("size" in d)?d.size:30;var a=Timeplot.Math.movingAverage(c.values,b);return a}};Timeplot.Processor=function(d,a,c){this._dataSource=d;this._operator=a;this._params=c;this._data={times:new Array(),values:new Array()};this._range={earliestDate:null,latestDate:null,min:0,max:0};var b=this;this._processingListener={onAddMany:function(){b._process()},onClear:function(){b._clear()}};this.addListener(this._processingListener)};Timeplot.Processor.prototype={_clear:function(){this.removeListener(this._processingListener);this._dataSource._clear()},_process:function(){var d=this._dataSource.getData();var a=this._dataSource.getRange();var b=this._operator(d,this._params);var c=Timeplot.Math.range(b);this._data={times:d.times,values:b};this._range={earliestDate:a.earliestDate,latestDate:a.latestDate,min:c.min,max:c.max}},getRange:function(){return this._range},getData:function(){return this._data},getValue:Timeplot.DataSource.prototype.getValue,getClosestValidTime:Timeplot.DataSource.prototype.getClosestValidTime,addListener:function(a){this._dataSource.addListener(a)},removeListener:function(a){this._dataSource.removeListener(a)}};function Range(){this._value=0;this._minimum=0;this._maximum=100;this._extent=0;this._isChanging=false}Range.prototype.setValue=function(a){a=Math.round(parseFloat(a));if(isNaN(a)){return}if(this._value!=a){if(a+this._extent>this._maximum){this._value=this._maximum-this._extent}else{if(a<this._minimum){this._value=this._minimum}else{this._value=a}}if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getValue=function(){return this._value};Range.prototype.setExtent=function(a){if(this._extent!=a){if(a<0){this._extent=0}else{if(this._value+a>this._maximum){this._extent=this._maximum-this._value}else{this._extent=a}}if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getExtent=function(){return this._extent};Range.prototype.setMinimum=function(a){if(this._minimum!=a){var b=this._isChanging;this._isChanging=true;this._minimum=a;if(a>this._value){this.setValue(a)}if(a>this._maximum){this._extent=0;this.setMaximum(a);this.setValue(a)}if(a+this._extent>this._maximum){this._extent=this._maximum-this._minimum}this._isChanging=b;if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getMinimum=function(){return this._minimum};Range.prototype.setMaximum=function(b){if(this._maximum!=b){var a=this._isChanging;this._isChanging=true;this._maximum=b;if(b<this._value){this.setValue(b-this._extent)}if(b<this._minimum){this._extent=0;this.setMinimum(b);this.setValue(this._maximum)}if(b<this._minimum+this._extent){this._extent=this._maximum-this._minimum}if(b<this._value+this._extent){this._extent=this._maximum-this._value}this._isChanging=a;if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getMaximum=function(){return this._maximum};Slider.isSupported=typeof document.createElement!="undefined"&&typeof document.documentElement!="undefined"&&typeof document.documentElement.offsetWidth=="number";function Slider(b,d,c){if(!b){return}this._orientation=c||"horizontal";this._range=new Range();this._range.setExtent(0);this._blockIncrement=10;this._unitIncrement=1;this._timer=new Timer(100);if(Slider.isSupported&&b){this.document=b.ownerDocument||b.document;this.element=b;this.element.slider=this;this.element.unselectable="on";this.element.className=this._orientation+" "+this.classNameTag+" "+this.element.className;this.line=this.document.createElement("DIV");this.line.className="line";this.line.unselectable="on";this.line.appendChild(this.document.createElement("DIV"));this.element.appendChild(this.line);this.handle=this.document.createElement("DIV");this.handle.className="handle";this.handle.unselectable="on";this.handle.appendChild(this.document.createElement("DIV"));this.handle.firstChild.appendChild(this.document.createTextNode(String.fromCharCode(160)));this.element.appendChild(this.handle)}this.input=d;var a=this;this._range.onchange=function(){a.recalculate();if(typeof a.onchange=="function"){a.onchange()}};if(Slider.isSupported&&b){this.element.onfocus=Slider.eventHandlers.onfocus;this.element.onblur=Slider.eventHandlers.onblur;this.element.onmousedown=Slider.eventHandlers.onmousedown;this.element.onmouseover=Slider.eventHandlers.onmouseover;this.element.onmouseout=Slider.eventHandlers.onmouseout;this.element.onkeydown=Slider.eventHandlers.onkeydown;this.element.onkeypress=Slider.eventHandlers.onkeypress;this.element.onmousewheel=Slider.eventHandlers.onmousewheel;this.handle.onselectstart=this.element.onselectstart=function(){return false};this._timer.ontimer=function(){a.ontimer()};window.setTimeout(function(){a.recalculate()},1)}else{this.input.onchange=function(f){a.setValue(a.input.value)}}}Slider.eventHandlers={getEvent:function(b,a){if(!b){if(a){b=a.document.parentWindow.event}else{b=window.event}}if(!b.srcElement){var a=b.target;while(a!=null&&a.nodeType!=1){a=a.parentNode}b.srcElement=a}if(typeof b.offsetX=="undefined"){b.offsetX=b.layerX;b.offsetY=b.layerY}return b},getDocument:function(a){if(a.target){return a.target.ownerDocument}return a.srcElement.document},getSlider:function(b){var a=b.target||b.srcElement;while(a!=null&&a.slider==null){a=a.parentNode}if(a){return a.slider}return null},getLine:function(b){var a=b.target||b.srcElement;while(a!=null&&a.className!="line"){a=a.parentNode}return a},getHandle:function(c){var b=c.target||c.srcElement;var a=/handle/;while(b!=null&&!a.test(b.className)){b=b.parentNode}return b},onfocus:function(b){var a=this.slider;a._focused=true;a.handle.className="handle hover"},onblur:function(b){var a=this.slider;a._focused=false;a.handle.className="handle"},onmouseover:function(b){b=Slider.eventHandlers.getEvent(b,this);var a=this.slider;if(b.srcElement==a.handle){a.handle.className="handle hover"}},onmouseout:function(b){b=Slider.eventHandlers.getEvent(b,this);var a=this.slider;if(b.srcElement==a.handle&&!a._focused){a.handle.className="handle"}},onmousedown:function(d){d=Slider.eventHandlers.getEvent(d,this);var a=this.slider;if(a.element.focus){a.element.focus()}Slider._currentInstance=a;var c=a.document;if(c.addEventListener){c.addEventListener("mousemove",Slider.eventHandlers.onmousemove,true);c.addEventListener("mouseup",Slider.eventHandlers.onmouseup,true)}else{if(c.attachEvent){c.attachEvent("onmousemove",Slider.eventHandlers.onmousemove);c.attachEvent("onmouseup",Slider.eventHandlers.onmouseup);c.attachEvent("onlosecapture",Slider.eventHandlers.onmouseup);a.element.setCapture()}}if(Slider.eventHandlers.getHandle(d)){Slider._sliderDragData={screenX:d.screenX,screenY:d.screenY,dx:d.screenX-a.handle.offsetLeft,dy:d.screenY-a.handle.offsetTop,startValue:a.getValue(),slider:a}}else{return;var b=Slider.eventHandlers.getLine(d);a._mouseX=d.offsetX+(b?a.line.offsetLeft:0);a._mouseY=d.offsetY+(b?a.line.offsetTop:0);a._increasing=null;a.ontimer()}},onmousemove:function(g){g=Slider.eventHandlers.getEvent(g,this);if(Slider._sliderDragData){var c=Slider._sliderDragData.slider;var a=c.getMaximum()-c.getMinimum();var b,h,f;if(c._orientation=="horizontal"){b=c.element.offsetWidth-c.handle.offsetWidth;h=g.screenX-Slider._sliderDragData.dx;f=Math.abs(g.screenY-Slider._sliderDragData.screenY)>100}else{b=c.element.offsetHeight-c.handle.offsetHeight;h=c.element.offsetHeight-c.handle.offsetHeight-(g.screenY-Slider._sliderDragData.dy);f=Math.abs(g.screenX-Slider._sliderDragData.screenX)>100}c.setValue(f?Slider._sliderDragData.startValue:c.getMinimum()+a*h/b);return false}else{return;var c=Slider._currentInstance;if(c!=null){var d=Slider.eventHandlers.getLine(g);c._mouseX=g.offsetX+(d?c.line.offsetLeft:0);c._mouseY=g.offsetY+(d?c.line.offsetTop:0)}}},onmouseup:function(c){c=Slider.eventHandlers.getEvent(c,this);var a=Slider._currentInstance;var b=a.document;if(b.removeEventListener){b.removeEventListener("mousemove",Slider.eventHandlers.onmousemove,true);b.removeEventListener("mouseup",Slider.eventHandlers.onmouseup,true)}else{if(b.detachEvent){b.detachEvent("onmousemove",Slider.eventHandlers.onmousemove);b.detachEvent("onmouseup",Slider.eventHandlers.onmouseup);b.detachEvent("onlosecapture",Slider.eventHandlers.onmouseup);a.element.releaseCapture()}}if(Slider._sliderDragData){Slider._sliderDragData=null}else{return;a._timer.stop();a._increasing=null}Slider._currentInstance=null},onkeydown:function(c){return;c=Slider.eventHandlers.getEvent(c,this);var b=this.slider;var a=c.keyCode;switch(a){case 33:b.setValue(b.getValue()+b.getBlockIncrement());break;case 34:b.setValue(b.getValue()-b.getBlockIncrement());break;case 35:b.setValue(b.getOrientation()=="horizontal"?b.getMaximum():b.getMinimum());break;case 36:b.setValue(b.getOrientation()=="horizontal"?b.getMinimum():b.getMaximum());break;case 38:case 39:b.setValue(b.getValue()+b.getUnitIncrement());break;case 37:case 40:b.setValue(b.getValue()-b.getUnitIncrement());break}if(a>=33&&a<=40){return false}},onkeypress:function(b){return;b=Slider.eventHandlers.getEvent(b,this);var a=b.keyCode;if(a>=33&&a<=40){return false}},onmousewheel:function(b){return;b=Slider.eventHandlers.getEvent(b,this);var a=this.slider;if(a._focused){a.setValue(a.getValue()+b.wheelDelta/120*a.getUnitIncrement());return false}}};Slider.prototype.classNameTag="dynamic-slider-control",Slider.prototype.setValue=function(a){this._range.setValue(a);this.input.value=this.getValue()};Slider.prototype.getValue=function(){return this._range.getValue()};Slider.prototype.setMinimum=function(a){this._range.setMinimum(a);this.input.value=this.getValue()};Slider.prototype.getMinimum=function(){return this._range.getMinimum()};Slider.prototype.setMaximum=function(a){this._range.setMaximum(a);this.input.value=this.getValue()};Slider.prototype.getMaximum=function(){return this._range.getMaximum()};Slider.prototype.setUnitIncrement=function(a){this._unitIncrement=a};Slider.prototype.getUnitIncrement=function(){return this._unitIncrement};Slider.prototype.setBlockIncrement=function(a){this._blockIncrement=a};Slider.prototype.getBlockIncrement=function(){return this._blockIncrement};Slider.prototype.getOrientation=function(){return this._orientation};Slider.prototype.setOrientation=function(a){if(a!=this._orientation){if(Slider.isSupported&&this.element){this.element.className=this.element.className.replace(this._orientation,a)}this._orientation=a;this.recalculate()}};Slider.prototype.recalculate=function(){if(!Slider.isSupported||!this.element){return}var c=this.element.offsetWidth;var e=this.element.offsetHeight;var a=this.handle.offsetWidth;var d=this.handle.offsetHeight;var f=this.line.offsetWidth;var b=this.line.offsetHeight;if(this._orientation=="horizontal"){this.handle.style.left=(c-a)*(this.getValue()-this.getMinimum())/(this.getMaximum()-this.getMinimum())+"px";this.handle.style.top=(e-d)/2+"px";this.line.style.top=(e-b)/2+"px";this.line.style.left=a/2+"px";this.line.style.width=Math.max(0,c-a-2)+"px";this.line.firstChild.style.width=Math.max(0,c-a-4)+"px"}else{this.handle.style.left=(c-a)/2+"px";this.handle.style.top=e-d-(e-d)*(this.getValue()-this.getMinimum())/(this.getMaximum()-this.getMinimum())+"px";this.line.style.left=(c-f)/2+"px";this.line.style.top=d/2+"px";this.line.style.height=Math.max(0,e-d-2)+"px";this.line.firstChild.style.height=Math.max(0,e-d-4)+"px"}};Slider.prototype.ontimer=function(){var b=this.handle.offsetWidth;var d=this.handle.offsetHeight;var a=this.handle.offsetLeft;var c=this.handle.offsetTop;if(this._orientation=="horizontal"){if(this._mouseX>a+b&&(this._increasing==null||this._increasing)){this.setValue(this.getValue()+this.getBlockIncrement());this._increasing=true}else{if(this._mouseX<a&&(this._increasing==null||!this._increasing)){this.setValue(this.getValue()-this.getBlockIncrement());this._increasing=false}}}else{if(this._mouseY>c+d&&(this._increasing==null||!this._increasing)){this.setValue(this.getValue()-this.getBlockIncrement());this._increasing=false}else{if(this._mouseY<c&&(this._increasing==null||this._increasing)){this.setValue(this.getValue()+this.getBlockIncrement());this._increasing=true}}}this._timer.start()};function Timer(a){this._pauseTime=typeof a=="undefined"?1000:a;this._timer=null;this._isStarted=false}Timer.prototype.start=function(){if(this.isStarted()){this.stop()}var a=this;this._timer=window.setTimeout(function(){if(typeof a.ontimer=="function"){a.ontimer()}},this._pauseTime);this._isStarted=false};Timer.prototype.stop=function(){if(this._timer!=null){window.clearTimeout(this._timer)}this._isStarted=false};Timer.prototype.isStarted=function(){return this._isStarted};Timer.prototype.getPauseTime=function(){return this._pauseTime};Timer.prototype.setPauseTime=function(a){this._pauseTime=a};SimileAjax.DateTime.MILLISECOND=0;SimileAjax.DateTime.SECOND=1;SimileAjax.DateTime.MINUTE=2;SimileAjax.DateTime.HOUR=3;SimileAjax.DateTime.DAY=4;SimileAjax.DateTime.WEEK=5;SimileAjax.DateTime.MONTH=6;SimileAjax.DateTime.QUARTER=7;SimileAjax.DateTime.SEMESTER=8;SimileAjax.DateTime.YEAR=9;SimileAjax.DateTime.LUSTRUM=10;SimileAjax.DateTime.DECADE=11;SimileAjax.DateTime.HALFCENTURY=12;SimileAjax.DateTime.CENTURY=13;SimileAjax.DateTime.HALFMILLENNIUM=14;SimileAjax.DateTime.MILLENNIUM=15;SimileAjax.DateTime.Strings={en:["milliseconds","seconds","minutes","hours","days","weeks","months","quarters","semester","years","5 years","decades","50 years","centuries","500 years","millenniums"],de:["Millisekunden","Sekunden","Minuten","Stunden","Tage","Wochen","Monate","Quartale","Semester","Jahre","5 Jahre","Dekaden","50 Jahre","Jahrhunderte","500 Jahre","Jahrtausende"]};SimileAjax.DateTime.gregorianUnitLengths=[];(function(){var c=SimileAjax.DateTime;var b=c.gregorianUnitLengths;b[c.MILLISECOND]=1;b[c.SECOND]=1000;b[c.MINUTE]=b[c.SECOND]*60;b[c.HOUR]=b[c.MINUTE]*60;b[c.DAY]=b[c.HOUR]*24;b[c.WEEK]=b[c.DAY]*7;b[c.MONTH]=b[c.DAY]*31;b[c.QUARTER]=b[c.DAY]*91;b[c.SEMESTER]=b[c.DAY]*182;b[c.YEAR]=b[c.DAY]*365;b[c.LUSTRUM]=b[c.YEAR]*5;b[c.DECADE]=b[c.YEAR]*10;b[c.HALFCENTURY]=b[c.YEAR]*50;b[c.CENTURY]=b[c.YEAR]*100;b[c.HALFMILLENNIUM]=b[c.YEAR]*500;b[c.MILLENNIUM]=b[c.YEAR]*1000})();SimileAjax.DateTime.roundDownToInterval=function(b,f,j,l,a){j=(typeof j=="undefined")?0:j;var d=j*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var h=new Date(b.getTime()+d);var e=function(m){m.setUTCMilliseconds(0);m.setUTCSeconds(0);m.setUTCMinutes(0);m.setUTCHours(0)};var k=function(p){e(p);var m=p.getDay();var o=p.getTime();o-=m*1000*60*60*24;p.setTime(o)};var c=function(m){e(m);m.setUTCDate(1);m.setUTCMonth(0)};switch(f){case SimileAjax.DateTime.MILLISECOND:var g=h.getUTCMilliseconds();h.setUTCMilliseconds(g-(g%l));break;case SimileAjax.DateTime.SECOND:h.setUTCMilliseconds(0);var g=h.getUTCSeconds();h.setUTCSeconds(g-(g%l));break;case SimileAjax.DateTime.MINUTE:h.setUTCMilliseconds(0);h.setUTCSeconds(0);var g=h.getUTCMinutes();h.setTime(h.getTime()-(g%l)*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:h.setUTCMilliseconds(0);h.setUTCSeconds(0);h.setUTCMinutes(0);var g=h.getUTCHours();h.setUTCHours(g-(g%l));break;case SimileAjax.DateTime.DAY:e(h);break;case SimileAjax.DateTime.WEEK:k(h);break;case SimileAjax.DateTime.MONTH:e(h);h.setUTCDate(1);var g=h.getUTCMonth();h.setUTCMonth(g-(g%l));break;case SimileAjax.DateTime.QUARTER:e(h);h.setUTCDate(1);var g=h.getUTCMonth();h.setUTCMonth(g-(g%3));break;case SimileAjax.DateTime.SEMESTER:e(h);h.setUTCDate(1);var g=h.getUTCMonth();h.setUTCMonth(g-(g%6));break;case SimileAjax.DateTime.YEAR:c(h);var g=h.getUTCFullYear();h.setUTCFullYear(g-(g%l));break;case SimileAjax.DateTime.LUSTRUM:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/5)*5);break;case SimileAjax.DateTime.DECADE:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/10)*10);break;case SimileAjax.DateTime.HALFCENTURY:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/50)*50);break;case SimileAjax.DateTime.CENTURY:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/100)*100);break;case SimileAjax.DateTime.HALFMILLENNIUM:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/500)*500);break;case SimileAjax.DateTime.MILLENNIUM:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/1000)*1000);break}b.setTime(h.getTime()-d)};SimileAjax.DateTime.incrementByInterval=function(b,e,a){a=(typeof a=="undefined")?0:a;var d=a*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var c=new Date(b.getTime()+d);switch(e){case SimileAjax.DateTime.MILLISECOND:c.setTime(c.getTime()+1);break;case SimileAjax.DateTime.SECOND:c.setTime(c.getTime()+1000);break;case SimileAjax.DateTime.MINUTE:c.setTime(c.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:c.setTime(c.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR]);break;case SimileAjax.DateTime.DAY:c.setUTCDate(c.getUTCDate()+1);break;case SimileAjax.DateTime.WEEK:c.setUTCDate(c.getUTCDate()+7);break;case SimileAjax.DateTime.MONTH:c.setUTCMonth(c.getUTCMonth()+1);break;case SimileAjax.DateTime.QUARTER:c.setUTCMonth(c.getUTCMonth()+3);break;case SimileAjax.DateTime.SEMESTER:c.setUTCMonth(c.getUTCMonth()+6);break;case SimileAjax.DateTime.YEAR:c.setUTCFullYear(c.getUTCFullYear()+1);break;case SimileAjax.DateTime.LUSTRUM:c.setUTCFullYear(c.getUTCFullYear()+5);break;case SimileAjax.DateTime.DECADE:c.setUTCFullYear(c.getUTCFullYear()+10);break;case SimileAjax.DateTime.HALFCENTURY:c.setUTCFullYear(c.getUTCFullYear()+50);break;case SimileAjax.DateTime.CENTURY:c.setUTCFullYear(c.getUTCFullYear()+100);break;case SimileAjax.DateTime.HALFMILLENNIUM:c.setUTCFullYear(c.getUTCFullYear()+500);break;case SimileAjax.DateTime.MILLENNIUM:c.setUTCFullYear(c.getUTCFullYear()+1000);break}b.setTime(c.getTime()-d)};SimileAjax.DateTime.getTimeLabel=function(h,j){var b=SimileAjax.DateTime;var a=j.getUTCSeconds();var c=j.getUTCMinutes();var d=j.getUTCHours();var g=j.getUTCDate();var e=j.getUTCMonth()+1;var f=j.getUTCFullYear();switch(h){case b.SECOND:return d+":"+((c<10)?"0":"")+c+":"+((a<10)?"0":"")+a;case b.MINUTE:return d+":"+((c<10)?"0":"")+c;case b.HOUR:return d+":00";case b.DAY:case b.WEEK:case b.MONTH:case b.QUARTER:case b.SEMESTER:return f+"-"+((e<10)?"0":"")+e+"-"+((g<10)?"0":"")+g;case b.YEAR:case b.LUSTRUM:case b.DECADE:case b.HALFCENTURY:case b.CENTURY:case b.HALFMILLENNIUM:case b.MILLENNIUM:return f}};SimileAjax.DateTime.getTimeString=function(g,c){var j=SimileAjax.DateTime;switch(g){case j.MILLISECOND:case j.SECOND:case j.MINUTE:case j.HOUR:var a=c.getUTCMonth()+1;var k=c.getUTCDate();var f=c.getUTCHours();var b=c.getUTCMinutes();var e=c.getUTCSeconds();return c.getUTCFullYear()+"-"+((a<10)?"0":"")+a+"-"+((k<10)?"0":"")+k+" "+((f<10)?"0":"")+f+":"+((b<10)?"0":"")+b+":"+((e<10)?"0":"")+e;case j.DAY:case j.WEEK:case j.MONTH:case j.QUARTER:case j.SEMESTER:var a=c.getUTCMonth()+1;var k=c.getUTCDate();return c.getUTCFullYear()+"-"+((a<10)?"0":"")+a+"-"+((k<10)?"0":"")+k;case j.YEAR:case j.LUSTRUM:case j.DECADE:case j.HALFCENTURY:case j.CENTURY:case j.HALFMILLENNIUM:case j.MILLENNIUM:return c.getUTCFullYear()}};Timeplot.DefaultEventSource.prototype.loadData=function(b){this._events.maxValues=new Array();this._events.removeAll();for(var a=0;a<b.length;a++){var c=b[a];var d=new Timeplot.DefaultEventSource.NumericEvent(c.date,c.value);this._events.add(d)}this._fire("onAddMany",[])};Timeplot._Impl.prototype.resetPlots=function(e){this._plotInfos=e;this._painters={background:[],foreground:[]};this._painter=null;var b=this;var a={onAddMany:function(){b.update()},onClear:function(){b.update()}};for(i=this._plots.length;i>0;i--){this._plots[i-1].opacityPlot.removeChild(this._plots[i-1]._opacityCanvas);this._plots[i-1].dispose();if(document.addEventListener){this._containerDiv.removeEventListener("mousemove",this._plots[i-1].mousemove,false);this._containerDiv.removeEventListener("mouseover",this._plots[i-1].mouseover,false)}else{if(document.attachEvent){this._containerDiv.detachEvent("onmousemove",this._plots[i-1].mousemove);this._containerDiv.detachEvent("onmouseover",this._plots[i-1].mouseover)}}delete this._plots[i-1]}this._plots=[];for(i=0;i<this._plotInfos.length;i++){var c=new Timeplot.Plot(this,this._plotInfos[i]);var d=c.getDataSource();if(d){d.addListener(a)}this.addPainter("background",{context:c.getTimeGeometry(),action:c.getTimeGeometry().paint});this.addPainter("background",{context:c.getValueGeometry(),action:c.getValueGeometry().paint});this.addPainter("foreground",{context:c,action:c.paint});this._plots.push(c);c.initialize()}};Timeplot.DefaultTimeGeometry.prototype._calculateGrid=function(){var a=[];var c=SimileAjax.DateTime;var h=this._unit;var b=this._period;if(b==0){return a}var g=-1;do{g++}while(c.gregorianUnitLengths[g]<b);g--;var f;if(g<c.DAY){f=c.HOUR}else{if(g<c.WEEK){f=c.DAY}else{if(g<c.QUARTER){f=c.WEEK}else{if(g<c.YEAR){f=c.MONTH}else{if(g<c.DECADE){f=c.YEAR}else{if(g<c.CENTURY){f=c.DECADE}else{if(g<c.HALFMILLENNIUM){f=c.CENTURY}else{if(g<c.MILLENNIUM){f=c.HALFMILLENNIUM}else{f=c.MILLENNIUM}}}}}}}}if(f<this._granularity){f=this._granularity}var k=h.cloneValue(this._earliestDate);var j;do{c.roundDownToInterval(k,f,j,1,0);var e=this.toScreen(h.toNumber(k));var d=SimileAjax.DateTime.getTimeLabel(f,k);if(e>0){a.push({x:e,label:d})}c.incrementByInterval(k,f,j)}while(k.getTime()<this._latestDate.getTime());return a};Timeplot.DefaultValueGeometry.prototype.paint=function(){if(this._timeplot){var a=this._canvas.getContext("2d");a.lineJoin="miter";if(this._gridColor){var d=a.createLinearGradient(0,0,0,this._canvas.height);d.addColorStop(0,this._gridColor.toHexString());d.addColorStop(0.3,this._gridColor.toHexString());d.addColorStop(1,"rgba(255,255,255,0.5)");a.lineWidth=this._gridLineWidth;a.strokeStyle=d;for(var c=0;c<this._grid.length;c++){var b=this._grid[c];var f=Math.floor(b.y)+0.5;if(typeof b.label!="undefined"){if(this._axisLabelsPlacement=="left"){var e=this._timeplot.putText(this._id+"-"+c,b.label,"timeplot-grid-label",{left:4,bottom:f+2,color:this._gridColor.toHexString(),visibility:"hidden"});this._labels.push(e)}else{if(this._axisLabelsPlacement=="right"){var e=this._timeplot.putText(this._id+"-"+c,b.label,"timeplot-grid-label",{right:4,bottom:f+2,color:this._gridColor.toHexString(),visibility:"hidden"});this._labels.push(e)}}if(f+e.clientHeight<this._canvas.height+10){e.style.visibility="visible"}}a.beginPath();if(this._gridType=="long"||b.label==0){a.moveTo(0,f);a.lineTo(this._canvas.width,f)}else{if(this._gridType=="short"){if(this._axisLabelsPlacement=="left"){a.moveTo(0,f);a.lineTo(this._gridShortSize,f)}else{if(this._axisLabelsPlacement=="right"){a.moveTo(this._canvas.width,f);a.lineTo(this._canvas.width-this._gridShortSize,f)}}}}a.stroke()}}}};Timeplot.DefaultTimeGeometry.prototype.paint=function(){if(this._canvas){var e=this._unit;var b=this._canvas.getContext("2d");var f=b.createLinearGradient(0,0,0,this._canvas.height);b.strokeStyle=f;b.lineWidth=this._gridLineWidth;b.lineJoin="miter";if(this._gridColor){f.addColorStop(0,this._gridColor.toString());f.addColorStop(1,"rgba(255,255,255,0.9)");for(var d=0;d<this._grid.length;d++){var c=this._grid[d];var a=Math.floor(c.x)+0.5;if(this._axisLabelsPlacement=="top"){var g=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:a+4,top:2,visibility:"hidden"});this._labels.push(g)}else{if(this._axisLabelsPlacement=="bottom"){var g=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:a+4,bottom:2,visibility:"hidden"});this._labels.push(g)}}if(!this._hideLabels&&a+g.clientWidth<this._canvas.width+10){g.style.visibility="visible"}b.beginPath();b.moveTo(a,0);b.lineTo(a,this._canvas.height);b.stroke()}}}};Timeplot.Plot.prototype.getSliceNumber=function(){return this._dataSource.getData().times.length};Timeplot.Plot.prototype.getSliceId=function(c){var b=this._dataSource.getData();for(var a=0;a<b.times.length;a++){if(b.times[a].getTime()==c.getTime()){return a}}return null};Timeplot.Plot.prototype.getSliceTime=function(a){var b=this._dataSource.getData();if(0<=a&&a<b.times.length){return b.times[a]}return null};Timeplot.Plot.prototype.initialize=function(){if(this._dataSource&&this._dataSource.getValue){this._timeFlag=this._timeplot.putDiv("timeflag","timeplot-timeflag");this._valueFlag=this._timeplot.putDiv(this._id+"valueflag","timeplot-valueflag");this._pinValueFlag=this._timeplot.putDiv(this._id+"pinvalueflag","timeplot-valueflag");var a=document.getElementById(this._timeplot._id+"-"+this._id+"pinvalueflag");if(SimileAjax.Platform.browser.isIE&&SimileAjax.Platform.browser.majorVersion<9){var c="border: 1px solid "+this._plotInfo.lineColor.toString()+"; background-color: "+this._plotInfo.fillColor.toString()+";";c=c.replace(/rgba\((\s*\d{1,3}),(\s*\d{1,3}),(\s*\d{1,3}),(\s*\d{1}|\s*\d{1}\.\d+)\)/g,"rgb($1,$2,$3)");a.style.setAttribute("cssText",c)}else{a.style.border="1px solid "+this._plotInfo.lineColor.toString();a.style.backgroundColor=this._plotInfo.fillColor.toString()}this._valueFlagLineLeft=this._timeplot.putDiv(this._id+"valueflagLineLeft","timeplot-valueflag-line");this._valueFlagLineRight=this._timeplot.putDiv(this._id+"valueflagLineRight","timeplot-valueflag-line");this._pinValueFlagLineLeft=this._timeplot.putDiv(this._id+"pinValueflagLineLeft","timeplot-valueflag-line");this._pinValueFlagLineRight=this._timeplot.putDiv(this._id+"pinValueflagLineRight","timeplot-valueflag-line");if(!this._valueFlagLineLeft.firstChild){this._valueFlagLineLeft.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_left.png"));this._valueFlagLineRight.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_right.png"))}if(!this._pinValueFlagLineLeft.firstChild){this._pinValueFlagLineLeft.appendChild(SimileAjax.Graphics.createTranslucentImage(GeoTemConfig.path+"plot-line_left.png"));this._pinValueFlagLineRight.appendChild(SimileAjax.Graphics.createTranslucentImage(GeoTemConfig.path+"plot-line_right.png"))}this._valueFlagPole=this._timeplot.putDiv(this._id+"valuepole","timeplot-valueflag-pole");var f=this._plotInfo.valuesOpacity;SimileAjax.Graphics.setOpacity(this._timeFlag,f);SimileAjax.Graphics.setOpacity(this._valueFlag,f);SimileAjax.Graphics.setOpacity(this._pinValueFlag,f);SimileAjax.Graphics.setOpacity(this._valueFlagLineLeft,f);SimileAjax.Graphics.setOpacity(this._valueFlagLineRight,f);SimileAjax.Graphics.setOpacity(this._pinValueFlagLineLeft,f);SimileAjax.Graphics.setOpacity(this._pinValueFlagLineRight,f);SimileAjax.Graphics.setOpacity(this._valueFlagPole,f);var g=this;var d=function(m,l,o){g._timeFlag.style.visibility="visible";g._valueFlag.style.visibility="visible";g._pinValueFlag.style.visibility="visible";g._valueFlagLineLeft.style.visibility="visible";g._valueFlagLineRight.style.visibility="visible";g._pinValueFlagLineLeft.style.visibility="visible";g._pinValueFlagLineRight.style.visibility="visible";g._valueFlagPole.style.visibility="visible";if(g._plotInfo.showValues){g._valueFlag.style.display="block";e(m,l,o)}};var k=function(m,l,o){g._timeFlag.style.visibility="hidden";g._valueFlag.style.visibility="hidden";g._pinValueFlag.style.visibility="hidden";g._valueFlagLineLeft.style.visibility="hidden";g._valueFlagLineRight.style.visibility="hidden";g._pinValueFlagLineLeft.style.visibility="hidden";g._pinValueFlagLineRight.style.visibility="hidden";g._valueFlagPole.style.visibility="hidden"};var j=24*60*60*1000;var h=30*j;var e=function(z,F,X){if(typeof SimileAjax!="undefined"&&g._plotInfo.showValues){var R=g._canvas;var A=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(F,g._canvas).x);if(A>R.width){A=R.width}if(isNaN(A)||A<0){A=0}var D=g._timeGeometry.fromScreen(A);if(D==0){g._valueFlag.style.display="none";return}var C,P;if(g.style=="bars"){var Q=g._dataSource.getClosestValidTime(D);var N=g._timeGeometry.toScreen(Q);var o=g.getSliceId(Q);var O;if(A<N&&o>0||A>=N&&o==g.getSliceNumber()-1){O=g.getSliceTime(o-1)}else{O=g.getSliceTime(o+1)}var M=g._timeGeometry.toScreen(O);var B=new Date(Q);var w=new Date(O);var E=g._timeGeometry.extendedDataSource.unit;var K;if(N<M){K=SimileAjax.DateTime.getTimeLabel(E,B)+"-"+SimileAjax.DateTime.getTimeLabel(E,w);P=Q}else{K=SimileAjax.DateTime.getTimeLabel(E,w)+"-"+SimileAjax.DateTime.getTimeLabel(E,B);P=O}C=g._dataSource.getValue(P);if(g._plotInfo.roundValues){C=Math.round(C)}g._valueFlag.innerHTML=C;g._timeFlag.innerHTML=K;A=(N+M)/2}else{if(g.style=="graph"){P=g._dataSource.getClosestValidTime(D);A=g._timeGeometry.toScreen(P);C=g._dataSource.getValue(P);if(g._plotInfo.roundValues){C=Math.round(C)}g._valueFlag.innerHTML=C;var D=new Date(P);var E=g._timeGeometry.extendedDataSource.unit;var K=SimileAjax.DateTime.getTimeLabel(E,D);g._timeFlag.innerHTML=K}}var W=g._timeFlag.clientWidth;var r=g._timeFlag.clientHeight;var J=Math.round(W/2);var H=g._valueFlag.clientWidth;var V=g._valueFlag.clientHeight;var u=g._valueGeometry.toScreen(C);if(A+J>R.width){var U=R.width-J}else{if(A-J<0){var U=J}else{var U=A}}g._timeplot.placeDiv(g._valueFlagPole,{left:A,top:0,height:R.height,display:"block"});g._timeplot.placeDiv(g._timeFlag,{left:U-J,top:0,display:"block"});var T=g.getSliceId(P);var G,S=0,s;if(g.pins[T].count>0){g._pinValueFlag.innerHTML=g.pins[T].count;G=g._pinValueFlag.clientWidth;S=g._pinValueFlag.clientHeight;s=g.pins[T].height}var I=A+H+14>R.width;var L=false;if(g.pins[T].count>0){if(A-G-14<0){L=true}}var m,q;if(g.pins[T].count>0){var p=u-s<V/2+S/2;if((L||I)&&p){m=0;q=S}else{m=V/2;q=S/2}}else{m=V/2}if(A+H+14>R.width&&u+V/2+4>R.height){g._valueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._valueFlagLineRight,{left:A-14,bottom:u-14,display:"block"});g._timeplot.placeDiv(g._valueFlag,{left:A-H-13,bottom:u-13-m,display:"block"})}else{if(A+H+14>R.width&&u+V/2+4<R.height){g._valueFlagLineRight.style.display="none";g._timeplot.placeDiv(g._valueFlagLineLeft,{left:A-14,bottom:u,display:"block"});g._timeplot.placeDiv(g._valueFlag,{left:A-H-13,bottom:u+13-m,display:"block"})}else{if(A+H+14<R.width&&u+V/2+4>R.height){g._valueFlagLineRight.style.display="none";g._timeplot.placeDiv(g._valueFlagLineLeft,{left:A,bottom:u-13,display:"block"});g._timeplot.placeDiv(g._valueFlag,{left:A+13,bottom:u-13-m,display:"block"})}else{g._valueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._valueFlagLineRight,{left:A,bottom:u,display:"block"});g._timeplot.placeDiv(g._valueFlag,{left:A+13,bottom:u+13-m,display:"block"})}}}if(g.pins[T].count>0){if(A-G-14<0&&s+S+4>R.height){g._pinValueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._pinValueFlagLineRight,{left:A,bottom:s,display:"block"});g._timeplot.placeDiv(g._pinValueFlag,{left:A+13,bottom:s-13-q,display:"block"})}else{if(A-G-14<0&&s+S+4<R.height){g._pinValueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._pinValueFlagLineRight,{left:A,bottom:s,display:"block"});g._timeplot.placeDiv(g._pinValueFlag,{left:A+13,bottom:s+13-q,display:"block"})}else{if(A-G-14>=0&&s+S+4>R.height){g._pinValueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._pinValueFlagLineRight,{left:A-13,bottom:s-13,display:"block"});g._timeplot.placeDiv(g._pinValueFlag,{left:A-15-G,bottom:s-13-q,display:"block"})}else{g._pinValueFlagLineRight.style.display="none";g._timeplot.placeDiv(g._pinValueFlagLineLeft,{left:A-14,bottom:s,display:"block"});g._timeplot.placeDiv(g._pinValueFlag,{left:A-G-15,bottom:s+13-q,display:"block"})}}}}else{g._pinValueFlagLineLeft.style.display="none";g._pinValueFlagLineRight.style.display="none";g._pinValueFlag.style.display="none"}}};var b=this._timeplot.getElement();this.mouseover=SimileAjax.DOM.registerPlotEvent(b,"mouseover",d);this.mouseout=SimileAjax.DOM.registerPlotEvent(b,"mouseout",k);this.mousemove=SimileAjax.DOM.registerPlotEvent(b,"mousemove",e);this.opacityPlot=this._timeplot.putDiv("opacityPlot"+this._timeplot._plots.length,"opacityPlot");SimileAjax.Graphics.setOpacity(this.opacityPlot,50);this._timeplot.placeDiv(this.opacityPlot,{left:0,bottom:0,width:this._canvas.width,height:this._canvas.height});this._opacityCanvas=document.createElement("canvas");this.opacityPlot.appendChild(this._opacityCanvas);if(!this._opacityCanvas.getContext&&G_vmlCanvasManager){this._opacityCanvas=G_vmlCanvasManager.initElement(this._opacityCanvas)}this._opacityCanvas.width=this._canvas.width;this._opacityCanvas.height=this._canvas.height;this._opacityCanvas.style.position="absolute";this._opacityCanvas.style.left="0px";this.opacityPlot.style.visibility="hidden"}};SimileAjax.DOM.registerPlotEvent=function(c,b,d){var a=function(e){e=(e)?e:((event)?event:null);if(e){var f=(e.target)?e.target:((e.srcElement)?e.srcElement:null);if(f){f=(f.nodeType==1||f.nodeType==9)?f:f.parentNode}return d(c,e,f)}return true};if(SimileAjax.Platform.browser.isIE){c.attachEvent("on"+b,a)}else{c.addEventListener(b,a,false)}return a};SimileAjax.DOM.getEventRelativeCoordinates=function(a,b){if(SimileAjax.Platform.browser.isIE){var c=SimileAjax.DOM.getPageCoordinates(b);return{x:a.clientX-c.left,y:a.clientY-c.top}}else{var c=SimileAjax.DOM.getPageCoordinates(b);if((a.type=="DOMMouseScroll")&&SimileAjax.Platform.browser.isFirefox&&(SimileAjax.Platform.browser.majorVersion==2)){return{x:a.screenX-c.left,y:a.screenY-c.top}}else{return{x:a.pageX-c.left,y:a.pageY-c.top}}}};SimileAjax.Graphics.setOpacity=function(b,a){if(SimileAjax.Platform.browser.isIE){b.style.filter="alpha(opacity = "+a+")"}else{var c=(a/100).toString();b.style.opacity=c;b.style.MozOpacity=c}};Timeplot.Plot.prototype.fullOpacityPlot=function(e,r,l,j,m){var u=this._opacityCanvas.getContext("2d");u.clearRect(0,0,this._canvas.width,this._canvas.height);u.lineWidth=this._plotInfo.lineWidth;u.lineJoin="miter";var k=this._canvas.height;u.fillStyle=this._plotInfo.lineColor.toString();var f=this._dataSource.getData();var b=f.times;var q=f.values;var g=true;u.beginPath();u.fillStyle=this._plotInfo.lineColor.toString();var d=0,a=0;for(var s=0;s<b.length;s++){if(!(b[s].getTime()<e.getTime()||b[s].getTime()>r.getTime())){var p=this._timeGeometry.toScreen(b[s]);var o=this._valueGeometry.toScreen(q[s]);if(g){u.moveTo(p,k);g=false}if(this.style=="bars"){u.lineTo(p,k-a)}u.lineTo(p,k-o);if(b[s].getTime()==r.getTime()||s==b.length-1){u.lineTo(p,k)}d=p;a=o}}u.fill()};Timeplot._Impl.prototype.regularGrid=function(){var e=this.getCanvas();var d=e.getContext("2d");var g=d.createLinearGradient(0,0,0,e.height);g.addColorStop(0,"rgb(0,0,0)");g.addColorStop(1,"rgba(255,255,255,0.9)");d.strokeStyle=g;d.lineWidth=0.5;d.lineJoin="miter";var b=e.width/9;var c=[];for(var f=1;f<9;f++){var a=f*b;d.beginPath();d.moveTo(a,0);d.lineTo(a,e.height);d.stroke();c.push({label:"",x:a})}return c};Timeplot.Plot.prototype._plot=function(){var k=this._canvas.getContext("2d");var e=this._dataSource.getData();if(e){var a=e.times;var h=e.values;var d=a.length;k.moveTo(0,0);var c=0,b=0;for(var j=0;j<d;j++){var g=this._timeGeometry.toScreen(a[j]);var f=this._valueGeometry.toScreen(h[j]);if(j>0&&(h[j-1]>0||h[j]>0)){if(this.style=="graph"){k.lineTo(g,f)}if(this.style=="bars"){if(h[j-1]>0){k.lineTo(g,b)}else{k.moveTo(g,b)}k.lineTo(g,f)}}else{k.moveTo(g,f)}c=g;b=f}}};SimileAjax.DOM.registerEvent=function(c,b,d){var a=function(e){e=(e)?e:((event)?event:null);if(e){var f=(e.target)?e.target:((e.srcElement)?e.srcElement:null);if(f){f=(f.nodeType==1||f.nodeType==9)?f:f.parentNode}return d(c,e,f)}return true};if(SimileAjax.Platform.browser.isIE){c.attachEvent("on"+b,a)}else{if(b=="mousewheel"){b="DOMMouseScroll"}c.addEventListener(b,a,false)}};Timeplot._Impl.prototype._setUpright=function(a,b){if(!SimileAjax.Platform.browser.isIE){this._upright=false}else{if(SimileAjax.Platform.browser.majorVersion>8){this._upright=false}}if(!this._upright){this._upright=true;a.translate(0,b.height);a.scale(1,-1)}};Timeplot._Impl.prototype._resizeCanvas=function(){var b=this.getCanvas();if(b.firstChild){b.firstChild.style.width=b.clientWidth+"px";b.firstChild.style.height=b.clientHeight+"px"}for(var c=0;c<this._plots.length;c++){var a=this._plots[c]._opacityCanvas;if(a.firstChild){a.firstChild.style.width=a.clientWidth+"px";a.firstChild.style.height=a.clientHeight+"px"}}};Timeplot._Impl.prototype.getWidth=function(){var a=this.getCanvas();if(typeof a.width!="undefined"&&this._containerDiv.clientWidth==0){return a.width}return this._containerDiv.clientWidth};Timeplot._Impl.prototype.getHeight=function(){var a=this.getCanvas();if(typeof a.height!="undefined"&&this._containerDiv.clientHeight==0){return a.height}return this._containerDiv.clientHeight};Timeplot._Impl.prototype._prepareCanvas=function(){var c=this.getCanvas();var b=SimileAjax.jQuery(this._containerDiv);this._paddingX=(parseInt(b.css("paddingLeft"))+parseInt(b.css("paddingRight")))/2;this._paddingY=(parseInt(b.css("paddingTop"))+parseInt(b.css("paddingBottom")))/2;if(isNaN(this._paddingX)){this._paddingX=0}if(isNaN(this._paddingY)){this._paddingY=0}c.width=this.getWidth()-(this._paddingX*2);c.height=this.getHeight()-(this._paddingY*2);var a=c.getContext("2d");this._setUpright(a,c);a.globalCompositeOperation="source-over"};var OpenLayers={VERSION_NUMBER:"Release 2.12",singleFile:!0,_getScriptLocation:function(){for(var h=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,g=document.getElementsByTagName("script"),m,l="",k=0,j=g.length;k<j;k++){if(m=g[k].getAttribute("src")){if(m=m.match(h)){l=m[1];break}}}return function(){return l}}(),ImgPath:""};OpenLayers.Class=function(){var f=arguments.length,e=arguments[0],h=arguments[f-1],g="function"==typeof h.initialize?h.initialize:function(){e.prototype.initialize.apply(this,arguments)};1<f?(f=[g,e].concat(Array.prototype.slice.call(arguments).slice(1,f-1),h),OpenLayers.inherit.apply(null,f)):g.prototype=h;return g};OpenLayers.inherit=function(g,f){var k=function(){};k.prototype=f.prototype;g.prototype=new k;var j,h,k=2;for(j=arguments.length;k<j;k++){h=arguments[k],"function"===typeof h&&(h=h.prototype),OpenLayers.Util.extend(g.prototype,h)}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(f,e){f=f||{};if(e){for(var h in e){var g=e[h];void 0!==g&&(f[h]=g)}!("function"==typeof window.Event&&e instanceof window.Event)&&(e.hasOwnProperty&&e.hasOwnProperty("toString"))&&(f.toString=e.toString)}return f};OpenLayers.String={startsWith:function(d,c){return 0==d.indexOf(c)},contains:function(d,c){return -1!=d.indexOf(c)},trim:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(g){for(var g=g.split("-"),f=g[0],k=1,j=g.length;k<j;k++){var h=g[k],f=f+(h.charAt(0).toUpperCase()+h.substring(1))}return f},format:function(e,d,f){d||(d=window);return e.replace(OpenLayers.String.tokenRegEx,function(b,l){for(var k,j=l.split(/\.+/),c=0;c<j.length;c++){0==c&&(k=d),k=k[j[c]]}"function"==typeof k&&(k=f?k.apply(null,f):k());return"undefined"==typeof k?"undefined":k})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(b){return OpenLayers.String.numberRegEx.test(b)},numericIf:function(b){return OpenLayers.String.isNumeric(b)?parseFloat(b):b}};OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,d){var f=0;0<d&&(f=parseFloat(e.toPrecision(d)));return f},format:function(h,g,m,l){g="undefined"!=typeof g?g:0;m="undefined"!=typeof m?m:OpenLayers.Number.thousandsSeparator;l="undefined"!=typeof l?l:OpenLayers.Number.decimalSeparator;null!=g&&(h=parseFloat(h.toFixed(g)));var k=h.toString().split(".");1==k.length&&null==g&&(g=0);h=k[0];if(m){for(var j=/(-?[0-9]+)([0-9]{3})/;j.test(h);){h=h.replace(j,"$1"+m+"$2")}}0==g?g=h:(m=1<k.length?k[1]:"0",null!=g&&(m+=Array(g-m.length+1).join("0")),g=h+l+m);return g}};OpenLayers.Function={bind:function(e,d){var f=Array.prototype.slice.apply(arguments,[2]);return function(){var a=f.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(d,a)}},bindAsEventListener:function(d,c){return function(a){return d.call(c,a||window.event)}},False:function(){return !1},True:function(){return !0},Void:function(){}};OpenLayers.Array={filter:function(j,h,p){var o=[];if(Array.prototype.filter){o=j.filter(h,p)}else{var m=j.length;if("function"!=typeof h){throw new TypeError}for(var l=0;l<m;l++){if(l in j){var k=j[l];h.call(p,k,l,j)&&o.push(k)}}}return o}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(f,e,h,g){OpenLayers.Util.isArray(f)&&(g=f[3],h=f[2],e=f[1],f=f[0]);null!=f&&(this.left=OpenLayers.Util.toFloat(f));null!=e&&(this.bottom=OpenLayers.Util.toFloat(e));null!=h&&(this.right=OpenLayers.Util.toFloat(h));null!=g&&(this.top=OpenLayers.Util.toFloat(g))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(d){var c=!1;null!=d&&(c=this.left==d.left&&this.right==d.right&&this.top==d.top&&this.bottom==d.bottom);return c},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(b){return !0===b?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(h,g){null==h&&(h=6);var m=Math.pow(10,h),l=Math.round(this.left*m)/m,k=Math.round(this.bottom*m)/m,j=Math.round(this.right*m)/m,m=Math.round(this.top*m)/m;return !0===g?k+","+l+","+m+","+j:l+","+k+","+j+","+m},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat},scale:function(f,e){null==e&&(e=this.getCenterLonLat());var h,g;"OpenLayers.LonLat"==e.CLASS_NAME?(h=e.lon,g=e.lat):(h=e.x,g=e.y);return new OpenLayers.Bounds((this.left-h)*f+h,(this.bottom-g)*f+g,(this.right-h)*f+h,(this.top-g)*f+g)},add:function(d,c){if(null==d||null==c){throw new TypeError("Bounds.add cannot receive null values")}return new OpenLayers.Bounds(this.left+d,this.bottom+c,this.right+d,this.top+c)},extend:function(d){var c=null;if(d){switch(d.CLASS_NAME){case"OpenLayers.LonLat":c=new OpenLayers.Bounds(d.lon,d.lat,d.lon,d.lat);break;case"OpenLayers.Geometry.Point":c=new OpenLayers.Bounds(d.x,d.y,d.x,d.y);break;case"OpenLayers.Bounds":c=d}if(c){this.centerLonLat=null;if(null==this.left||c.left<this.left){this.left=c.left}if(null==this.bottom||c.bottom<this.bottom){this.bottom=c.bottom}if(null==this.right||c.right>this.right){this.right=c.right}if(null==this.top||c.top>this.top){this.top=c.top}}}},containsLonLat:function(f,e){"boolean"===typeof e&&(e={inclusive:e});var e=e||{},h=this.contains(f.lon,f.lat,e.inclusive),g=e.worldBounds;g&&!h&&(h=g.getWidth(),g=Math.round((f.lon-(g.left+g.right)/2)/h),h=this.containsLonLat({lon:f.lon-g*h,lat:f.lat},{inclusive:e.inclusive}));return h},containsPixel:function(d,c){return this.contains(d.x,d.y,c)},contains:function(f,e,h){null==h&&(h=!0);if(null==f||null==e){return !1}var f=OpenLayers.Util.toFloat(f),e=OpenLayers.Util.toFloat(e),g=!1;return g=h?f>=this.left&&f<=this.right&&e>=this.bottom&&e<=this.top:f>this.left&&f<this.right&&e>this.bottom&&e<this.top},intersectsBounds:function(j,h){"boolean"===typeof h&&(h={inclusive:h});h=h||{};if(h.worldBounds){var p=this.wrapDateLine(h.worldBounds),j=j.wrapDateLine(h.worldBounds)}else{p=this}null==h.inclusive&&(h.inclusive=!0);var o=!1,m=p.left==j.right||p.right==j.left||p.top==j.bottom||p.bottom==j.top;if(h.inclusive||!m){var o=j.top>=p.bottom&&j.top<=p.top||p.top>j.bottom&&p.top<j.top,m=j.left>=p.left&&j.left<=p.right||p.left>=j.left&&p.left<=j.right,l=j.right>=p.left&&j.right<=p.right||p.right>=j.left&&p.right<=j.right,o=(j.bottom>=p.bottom&&j.bottom<=p.top||p.bottom>=j.bottom&&p.bottom<=j.top||o)&&(m||l)}if(h.worldBounds&&!o){var k=h.worldBounds,m=k.getWidth(),l=!k.containsBounds(p),k=!k.containsBounds(j);l&&!k?(j=j.add(-m,0),o=p.intersectsBounds(j,{inclusive:h.inclusive})):k&&!l&&(p=p.add(-m,0),o=j.intersectsBounds(p,{inclusive:h.inclusive}))}return o},containsBounds:function(h,g,m){null==g&&(g=!1);null==m&&(m=!0);var l=this.contains(h.left,h.bottom,m),k=this.contains(h.right,h.bottom,m),j=this.contains(h.left,h.top,m),h=this.contains(h.right,h.top,m);return g?l||k||j||h:l&&k&&j&&h},determineQuadrant:function(e){var d="",f=this.getCenterLonLat(),d=d+(e.lat<f.lat?"b":"t");return d+=e.lon<f.lon?"l":"r"},transform:function(h,g){this.centerLonLat=null;var m=OpenLayers.Projection.transform({x:this.left,y:this.bottom},h,g),l=OpenLayers.Projection.transform({x:this.right,y:this.bottom},h,g),k=OpenLayers.Projection.transform({x:this.left,y:this.top},h,g),j=OpenLayers.Projection.transform({x:this.right,y:this.top},h,g);this.left=Math.min(m.x,k.x);this.bottom=Math.min(m.y,l.y);this.right=Math.max(l.x,j.x);this.top=Math.max(k.y,j.y);return this},wrapDateLine:function(h,g){var g=g||{},m=g.leftTolerance||0,l=g.rightTolerance||0,k=this.clone();if(h){for(var j=h.getWidth();k.left<h.left&&k.right-l<=h.left;){k=k.add(j,0)}for(;k.left+m>=h.right&&k.right>h.right;){k=k.add(-j,0)}m=k.left+m;m<h.right&&(m>h.left&&k.right-l>h.right)&&(k=k.add(-j,0))}return k},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(e,d){var f=e.split(",");return OpenLayers.Bounds.fromArray(f,d)};OpenLayers.Bounds.fromArray=function(d,c){return !0===c?new OpenLayers.Bounds(d[1],d[0],d[3],d[2]):new OpenLayers.Bounds(d[0],d[1],d[2],d[3])};OpenLayers.Bounds.fromSize=function(b){return new OpenLayers.Bounds(0,b.h,b.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(d){var c;c=""+("t"==d.charAt(0)?"b":"t");return c+="l"==d.charAt(1)?"r":"l"};OpenLayers.Element={visible:function(b){return"none"!=OpenLayers.Util.getElement(b).style.display},toggle:function(){for(var f=0,e=arguments.length;f<e;f++){var h=OpenLayers.Util.getElement(arguments[f]),g=OpenLayers.Element.visible(h)?"none":"";h.style.display=g}},remove:function(b){b=OpenLayers.Util.getElement(b);b.parentNode.removeChild(b)},getHeight:function(b){b=OpenLayers.Util.getElement(b);return b.offsetHeight},hasClass:function(e,d){var f=e.className;return !!f&&RegExp("(^|\\s)"+d+"(\\s|$)").test(f)},addClass:function(d,c){OpenLayers.Element.hasClass(d,c)||(d.className+=(d.className?" ":"")+c);return d},removeClass:function(e,d){var f=e.className;f&&(e.className=OpenLayers.String.trim(f.replace(RegExp("(^|\\s+)"+d+"(\\s+|$)")," ")));return e},toggleClass:function(d,c){OpenLayers.Element.hasClass(d,c)?OpenLayers.Element.removeClass(d,c):OpenLayers.Element.addClass(d,c);return d},getStyle:function(f,e){var f=OpenLayers.Util.getElement(f),h=null;if(f&&f.style){h=f.style[OpenLayers.String.camelize(e)];h||(document.defaultView&&document.defaultView.getComputedStyle?h=(h=document.defaultView.getComputedStyle(f,null))?h.getPropertyValue(e):null:f.currentStyle&&(h=f.currentStyle[OpenLayers.String.camelize(e)]));var g=["left","top","right","bottom"];window.opera&&(-1!=OpenLayers.Util.indexOf(g,e)&&"static"==OpenLayers.Element.getStyle(f,"position"))&&(h="auto")}return"auto"==h?null:h}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(d,c){OpenLayers.Util.isArray(d)&&(c=d[1],d=d[0]);this.lon=OpenLayers.Util.toFloat(d);this.lat=OpenLayers.Util.toFloat(c)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(d,c){if(null==d||null==c){throw new TypeError("LonLat.add cannot receive null values")}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(d),this.lat+OpenLayers.Util.toFloat(c))},equals:function(d){var c=!1;null!=d&&(c=this.lon==d.lon&&this.lat==d.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(d.lon)&&isNaN(d.lat));return c},transform:function(e,d){var f=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,d);this.lon=f.x;this.lat=f.y;return this},wrapDateLine:function(d){var c=this.clone();if(d){for(;c.lon<d.left;){c.lon+=d.getWidth()}for(;c.lon>d.right;){c.lon-=d.getWidth()}}return c},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){b=b.split(",");return new OpenLayers.LonLat(b[0],b[1])};OpenLayers.LonLat.fromArray=function(d){var c=OpenLayers.Util.isArray(d);return new OpenLayers.LonLat(c&&d[0],c&&d[1])};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(d,c){this.x=parseFloat(d);this.y=parseFloat(c)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(d){var c=!1;null!=d&&(c=this.x==d.x&&this.y==d.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(d.x)&&isNaN(d.y));return c},distanceTo:function(b){return Math.sqrt(Math.pow(this.x-b.x,2)+Math.pow(this.y-b.y,2))},add:function(d,c){if(null==d||null==c){throw new TypeError("Pixel.add cannot receive null values")}return new OpenLayers.Pixel(this.x+d,this.y+c)},offset:function(d){var c=this.clone();d&&(c=this.add(d.x,d.y));return c},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(d,c){this.w=parseFloat(d);this.h=parseFloat(c)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(d){var c=!1;null!=d&&(c=this.w==d.w&&this.h==d.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(d.w)&&isNaN(d.h));return c},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(b){alert(b)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){for(var e=document.getElementsByTagName("script"),d=0,f=e.length;d<f;++d){if(-1!=e[d].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}})();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code},setCode:function(e){var d;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);e=e.split("-");e[0]=e[0].toLowerCase();"object"==typeof OpenLayers.Lang[e[0]]&&(d=e[0]);if(e[1]){var f=e[0]+"-"+e[1].toUpperCase();"object"==typeof OpenLayers.Lang[f]&&(d=f)}d||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+e.join("-")+" dictionary, falling back to default language"),d=OpenLayers.Lang.defaultCode);OpenLayers.Lang.code=d},translate:function(e,d){var f=OpenLayers.Lang[OpenLayers.Lang.getCode()];(f=f&&f[e])||(f=e);d&&(f=OpenLayers.String.format(f,d));return f}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var f=[],e=0,h=arguments.length;e<h;e++){var g=arguments[e];"string"==typeof g&&(g=document.getElementById(g));if(1==arguments.length){return g}f.push(g)}return f};OpenLayers.Util.isElement=function(b){return !!(b&&1===b.nodeType)};OpenLayers.Util.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)};"undefined"===typeof window.$&&(window.$=OpenLayers.Util.getElement);OpenLayers.Util.removeItem=function(e,d){for(var f=e.length-1;f>=0;f--){e[f]==d&&e.splice(f,1)}return e};OpenLayers.Util.indexOf=function(f,e){if(typeof f.indexOf=="function"){return f.indexOf(e)}for(var h=0,g=f.length;h<g;h++){if(f[h]==e){return h}}return -1};OpenLayers.Util.modifyDOMElement=function(k,j,r,q,p,o,m,l){if(j){k.id=j}if(r){k.style.left=r.x+"px";k.style.top=r.y+"px"}if(q){k.style.width=q.w+"px";k.style.height=q.h+"px"}if(p){k.style.position=p}if(o){k.style.border=o}if(m){k.style.overflow=m}if(parseFloat(l)>=0&&parseFloat(l)<1){k.style.filter="alpha(opacity="+l*100+")";k.style.opacity=l}else{if(parseFloat(l)==1){k.style.filter="";k.style.opacity=""}}};OpenLayers.Util.createDiv=function(s,r,q,p,o,m,l,k){var j=document.createElement("div");if(p){j.style.backgroundImage="url("+p+")"}s||(s=OpenLayers.Util.createUniqueID("OpenLayersDiv"));o||(o="absolute");OpenLayers.Util.modifyDOMElement(j,s,r,q,o,m,l,k);return j};OpenLayers.Util.createImage=function(s,r,q,p,o,m,l,k){var j=document.createElement("img");s||(s=OpenLayers.Util.createUniqueID("OpenLayersDiv"));o||(o="relative");OpenLayers.Util.modifyDOMElement(j,s,r,q,o,m,null,l);if(k){j.style.display="none";r=function(){j.style.display="";OpenLayers.Event.stopObservingElement(j)};OpenLayers.Event.observe(j,"load",r);OpenLayers.Event.observe(j,"error",r)}j.style.alt=s;j.galleryImg="no";if(p){j.src=p}return j};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var e=navigator.appVersion.split("MSIE"),e=parseFloat(e[1]),d=false;try{d=!!document.body.filters}catch(f){}OpenLayers.Util.alphaHackNeeded=d&&e>=5.5&&e<7}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(s,r,q,p,o,m,l,k,j){OpenLayers.Util.modifyDOMElement(s,r,q,p,m,null,null,j);r=s.childNodes[0];if(o){r.src=o}OpenLayers.Util.modifyDOMElement(r,s.id+"_innerImage",null,p,"relative",l);if(OpenLayers.Util.alphaHack()){if(s.style.display!="none"){s.style.display="inline-block"}k==null&&(k="scale");s.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+r.src+"', sizingMethod='"+k+"')";if(parseFloat(s.style.opacity)>=0&&parseFloat(s.style.opacity)<1){s.style.filter=s.style.filter+(" alpha(opacity="+s.style.opacity*100+")")}r.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(u,t,s,r,q,p,o,m,l){var k=OpenLayers.Util.createDiv(),l=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);l.className="olAlphaImg";k.appendChild(l);OpenLayers.Util.modifyAlphaImageDiv(k,u,t,s,r,q,p,o,m);return k};OpenLayers.Util.upperCaseObject=function(e){var d={},f;for(f in e){d[f.toUpperCase()]=e[f]}return d};OpenLayers.Util.applyDefaults=function(f,e){var f=f||{},h=typeof window.Event=="function"&&e instanceof window.Event,g;for(g in e){if(f[g]===void 0||!h&&e.hasOwnProperty&&e.hasOwnProperty(g)&&!f.hasOwnProperty(g)){f[g]=e[g]}}if(!h&&e&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&!f.hasOwnProperty("toString")){f.toString=e.toString}return f};OpenLayers.Util.getParameterString=function(k){var j=[],r;for(r in k){var q=k[r];if(q!=null&&typeof q!="function"){if(typeof q=="object"&&q.constructor==Array){for(var p=[],o,m=0,l=q.length;m<l;m++){o=q[m];p.push(encodeURIComponent(o===null||o===void 0?"":o))}q=p.join(",")}else{q=encodeURIComponent(q)}j.push(encodeURIComponent(r)+"="+q)}}return j.join("&")};OpenLayers.Util.urlAppend=function(f,e){var h=f;if(e){var g=(f+" ").split(/[?&]/),h=h+(g.pop()===" "?e:g.length?"&"+e:"?"+e)}return h};OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(b){return OpenLayers.Util.getImagesLocation()+b};OpenLayers.Util.Try=function(){for(var g=null,f=0,k=arguments.length;f<k;f++){var j=arguments[f];try{g=j();break}catch(h){}}return g};OpenLayers.Util.getXmlNodeValue=function(d){var c=null;OpenLayers.Util.Try(function(){c=d.text;if(!c){c=d.textContent}if(!c){c=d.firstChild.nodeValue}},function(){c=d.textContent});return c};OpenLayers.Util.mouseLeft=function(e,d){for(var f=e.relatedTarget?e.relatedTarget:e.toElement;f!=d&&f!=null;){f=f.parentNode}return f!=d};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(d,c){if(c==null){c=OpenLayers.Util.DEFAULT_PRECISION}typeof d!=="number"&&(d=parseFloat(d));return c===0?d:parseFloat(d.toPrecision(c))};OpenLayers.Util.rad=function(b){return b*Math.PI/180};OpenLayers.Util.deg=function(b){return b*180/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(N,M){for(var L=OpenLayers.Util.VincentyConstants,K=L.a,J=L.b,L=L.f,I=OpenLayers.Util.rad(M.lon-N.lon),H=Math.atan((1-L)*Math.tan(OpenLayers.Util.rad(N.lat))),G=Math.atan((1-L)*Math.tan(OpenLayers.Util.rad(M.lat))),F=Math.sin(H),H=Math.cos(H),E=Math.sin(G),G=Math.cos(G),D=I,C=2*Math.PI,B=20;Math.abs(D-C)>1e-12&&--B>0;){var A=Math.sin(D),z=Math.cos(D),y=Math.sqrt(G*A*G*A+(H*E-F*G*z)*(H*E-F*G*z));if(y==0){return 0}var z=F*E+H*G*z,x=Math.atan2(y,z),w=Math.asin(H*G*A/y),v=Math.cos(w)*Math.cos(w),A=z-2*F*E/v,u=L/16*v*(4+L*(4-3*v)),C=D,D=I+(1-u)*L*Math.sin(w)*(x+u*y*(A+u*z*(-1+2*A*A)))}if(B==0){return NaN}K=v*(K*K-J*J)/(J*J);L=K/1024*(256+K*(-128+K*(74-47*K)));return(J*(1+K/16384*(4096+K*(-768+K*(320-175*K))))*(x-L*y*(A+L/4*(z*(-1+2*A*A)-L/6*A*(-3+4*y*y)*(-3+4*A*A))))).toFixed(3)/1000};OpenLayers.Util.destinationVincenty=function(N,M,L){for(var K=OpenLayers.Util,J=K.VincentyConstants,I=J.a,H=J.b,G=J.f,J=N.lon,N=N.lat,F=K.rad(M),M=Math.sin(F),F=Math.cos(F),N=(1-G)*Math.tan(K.rad(N)),E=1/Math.sqrt(1+N*N),D=N*E,C=Math.atan2(N,F),N=E*M,B=1-N*N,I=B*(I*I-H*H)/(H*H),A=1+I/16384*(4096+I*(-768+I*(320-175*I))),z=I/1024*(256+I*(-128+I*(74-47*I))),I=L/(H*A),y=2*Math.PI;Math.abs(I-y)>1e-12;){var x=Math.cos(2*C+I),w=Math.sin(I),v=Math.cos(I),u=z*w*(x+z/4*(v*(-1+2*x*x)-z/6*x*(-3+4*w*w)*(-3+4*x*x))),y=I,I=L/(H*A)+u}L=D*w-E*v*F;H=Math.atan2(D*v+E*w*F,(1-G)*Math.sqrt(N*N+L*L));M=Math.atan2(w*M,E*v-D*w*F);F=G/16*B*(4+G*(4-3*B));x=M-(1-F)*G*N*(I+F*w*(x+F*v*(-1+2*x*x)));Math.atan2(N,-L);return new OpenLayers.LonLat(J+K.deg(x),K.deg(H))};OpenLayers.Util.getParameters=function(k){var k=k===null||k===void 0?window.location.href:k,j="";if(OpenLayers.String.contains(k,"?")){var j=k.indexOf("?")+1,r=OpenLayers.String.contains(k,"#")?k.indexOf("#"):k.length,j=k.substring(j,r)}for(var k={},j=j.split(/[&;]/),r=0,q=j.length;r<q;++r){var p=j[r].split("=");if(p[0]){var o=p[0];try{o=decodeURIComponent(o)}catch(m){o=unescape(o)}p=(p[1]||"").replace(/\+/g," ");try{p=decodeURIComponent(p)}catch(l){p=unescape(p)}p=p.split(",");p.length==1&&(p=p[0]);k[o]=p}}return k};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(b){b==null&&(b="id_");OpenLayers.Util.lastSeqID=OpenLayers.Util.lastSeqID+1;return b+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1000*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){return b>1?1/b:b};OpenLayers.Util.getResolutionFromScale=function(e,d){var f;if(e){d==null&&(d="degrees");f=1/(OpenLayers.Util.normalizeScale(e)*OpenLayers.INCHES_PER_UNIT[d]*OpenLayers.DOTS_PER_INCH)}return f};OpenLayers.Util.getScaleFromResolution=function(d,c){c==null&&(c="degrees");return d*OpenLayers.INCHES_PER_UNIT[c]*OpenLayers.DOTS_PER_INCH};OpenLayers.Util.pagePosition=function(g){var f=[0,0],k=OpenLayers.Util.getViewportElement();if(!g||g==window||g==k){return f}var j=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&OpenLayers.Element.getStyle(g,"position")=="absolute"&&(g.style.top==""||g.style.left==""),h=null;if(g.getBoundingClientRect){g=g.getBoundingClientRect();h=k.scrollTop;f[0]=g.left+k.scrollLeft;f[1]=g.top+h}else{if(document.getBoxObjectFor&&!j){g=document.getBoxObjectFor(g);k=document.getBoxObjectFor(k);f[0]=g.screenX-k.screenX;f[1]=g.screenY-k.screenY}else{f[0]=g.offsetLeft;f[1]=g.offsetTop;h=g.offsetParent;if(h!=g){for(;h;){f[0]=f[0]+h.offsetLeft;f[1]=f[1]+h.offsetTop;h=h.offsetParent}}k=OpenLayers.BROWSER_NAME;if(k=="opera"||k=="safari"&&OpenLayers.Element.getStyle(g,"position")=="absolute"){f[1]=f[1]-document.body.offsetTop}for(h=g.offsetParent;h&&h!=document.body;){f[0]=f[0]-h.scrollLeft;if(k!="opera"||h.tagName!="TR"){f[1]=f[1]-h.scrollTop}h=h.offsetParent}}}return f};OpenLayers.Util.getViewportElement=function(){var b=arguments.callee.viewportElement;if(b==void 0){b=OpenLayers.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat"?document.body:document.documentElement;arguments.callee.viewportElement=b}return b};OpenLayers.Util.isEquivalentUrl=function(f,e,h){h=h||{};OpenLayers.Util.applyDefaults(h,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var f=OpenLayers.Util.createUrlObject(f,h),e=OpenLayers.Util.createUrlObject(e,h),g;for(g in f){if(g!=="args"&&f[g]!=e[g]){return false}}for(g in f.args){if(f.args[g]!=e.args[g]){return false}delete e.args[g]}for(g in e.args){return false}return true};OpenLayers.Util.createUrlObject=function(g,f){f=f||{};if(!/^\w+:\/\//.test(g)){var k=window.location,j=k.port?":"+k.port:"",j=k.protocol+"//"+k.host.split(":").shift()+j;if(g.indexOf("/")===0){g=j+g}else{k=k.pathname.split("/");k.pop();g=j+k.join("/")+"/"+g}}f.ignoreCase&&(g=g.toLowerCase());k=document.createElement("a");k.href=g;j={};j.host=k.host.split(":").shift();j.protocol=k.protocol;j.port=f.ignorePort80?k.port=="80"||k.port=="0"?"":k.port:k.port==""||k.port=="0"?"80":k.port;j.hash=f.ignoreHash||k.hash==="#"?"":k.hash;var h=k.search;if(!h){h=g.indexOf("?");h=h!=-1?g.substr(h):""}j.args=OpenLayers.Util.getParameters(h);j.pathname=k.pathname.charAt(0)=="/"?k.pathname:"/"+k.pathname;return j};OpenLayers.Util.removeTail=function(e){var d=null,d=e.indexOf("?"),f=e.indexOf("#");return d=d==-1?f!=-1?e.substr(0,f):e:f!=-1?e.substr(0,Math.min(d,f)):e.substr(0,d)};OpenLayers.IS_GECKO=function(){var b=navigator.userAgent.toLowerCase();return b.indexOf("webkit")==-1&&b.indexOf("gecko")!=-1}();OpenLayers.CANVAS_SUPPORTED=function(){var b=document.createElement("canvas");return !(!b.getContext||!b.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var d="",c=navigator.userAgent.toLowerCase();c.indexOf("opera")!=-1?d="opera":c.indexOf("msie")!=-1?d="msie":c.indexOf("safari")!=-1?d="safari":c.indexOf("mozilla")!=-1&&(d=c.indexOf("firefox")!=-1?"firefox":"mozilla");return d}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(w,v,u){var t,s,r=document.createElement("div");r.style.visibility="hidden";for(var q=u&&u.containerElement?u.containerElement:document.body,p=false,o=null,m=q;m&&m.tagName.toLowerCase()!="body";){var l=OpenLayers.Element.getStyle(m,"position");if(l=="absolute"){p=true;break}else{if(l&&l!="static"){break}}m=m.parentNode}if(p&&(q.clientHeight===0||q.clientWidth===0)){o=document.createElement("div");o.style.visibility="hidden";o.style.position="absolute";o.style.overflow="visible";o.style.width=document.body.clientWidth+"px";o.style.height=document.body.clientHeight+"px";o.appendChild(r)}r.style.position="absolute";if(v){if(v.w){t=v.w;r.style.width=t+"px"}else{if(v.h){s=v.h;r.style.height=s+"px"}}}if(u&&u.displayClass){r.className=u.displayClass}v=document.createElement("div");v.innerHTML=w;v.style.overflow="visible";if(v.childNodes){w=0;for(u=v.childNodes.length;w<u;w++){if(v.childNodes[w].style){v.childNodes[w].style.overflow="visible"}}}r.appendChild(v);o?q.appendChild(o):q.appendChild(r);if(!t){t=parseInt(v.scrollWidth);r.style.width=t+"px"}s||(s=parseInt(v.scrollHeight));r.removeChild(v);if(o){o.removeChild(r);q.removeChild(o)}else{q.removeChild(r)}return new OpenLayers.Size(t,s)};OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(e==null){var d=null,f=null,d=e=0,d=document.createElement("div");d.style.position="absolute";d.style.top="-1000px";d.style.left="-1000px";d.style.width="100px";d.style.height="50px";d.style.overflow="hidden";f=document.createElement("div");f.style.width="100%";f.style.height="200px";d.appendChild(f);document.body.appendChild(d);e=f.offsetWidth;d.style.overflow="scroll";d=f.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=e-d;e=OpenLayers.Util._scrollbarWidth}return e};OpenLayers.Util.getFormattedLonLat=function(h,g,m){m||(m="dms");var h=(h+540)%360-180,l=Math.abs(h),k=Math.floor(l),j=l=(l-k)/(1/60),l=Math.floor(l),j=Math.round((j-l)/(1/60)*10),j=j/10;if(j>=60){j=j-60;l=l+1;if(l>=60){l=l-60;k=k+1}}k<10&&(k="0"+k);k=k+"\u00b0";if(m.indexOf("dm")>=0){l<10&&(l="0"+l);k=k+(l+"'");if(m.indexOf("dms")>=0){j<10&&(j="0"+j);k=k+(j+'"')}}return k=g=="lon"?k+(h<0?OpenLayers.i18n("W"):OpenLayers.i18n("E")):k+(h<0?OpenLayers.i18n("S"):OpenLayers.i18n("N"))};OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b},destroy:function(){},read:function(){throw Error("Read not implemented.")},write:function(){throw Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.CSWGetRecords=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Format.CSWGetRecords.DEFAULTS),c=OpenLayers.Format.CSWGetRecords["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported CSWGetRecords version: "+d.version}return new c(d)};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handler:null,eventListeners:null,events:null,initialize:function(b){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,b);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null);this.eventListeners=null;this.handler&&(this.handler.destroy(),this.handler=null);if(this.handlers){for(var b in this.handlers){this.handlers.hasOwnProperty(b)&&"function"==typeof this.handlers[b].destroy&&this.handlers[b].destroy()}this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null);this.div=null},setMap:function(b){this.map=b;this.handler&&this.handler.setMap(b)},draw:function(b){if(null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title)){this.div.title=this.title}null!=b&&(this.position=b.clone());this.moveTo(this.position);return this.div},moveTo:function(b){null!=b&&null!=this.div&&(this.div.style.left=b.x+"px",this.div.style.top=b.y+"px")},activate:function(){if(this.active){return !1}this.handler&&this.handler.activate();this.active=!0;this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("activate");return !0},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(b){return b.target||b.srcElement},isSingleTouch:function(b){return b.touches&&1==b.touches.length},isMultiTouch:function(b){return b.touches&&1<b.touches.length},isLeftClick:function(b){return b.which&&1==b.which||b.button&&1==b.button},isRightClick:function(b){return b.which&&3==b.which||b.button&&2==b.button},stop:function(d,c){c||(d.preventDefault?d.preventDefault():d.returnValue=!1);d.stopPropagation?d.stopPropagation():d.cancelBubble=!0},findElement:function(e,d){for(var f=OpenLayers.Event.element(e);f.parentNode&&(!f.tagName||f.tagName.toUpperCase()!=d.toUpperCase());){f=f.parentNode}return f},observe:function(g,f,k,j){g=OpenLayers.Util.getElement(g);j=j||!1;if("keypress"==f&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||g.attachEvent)){f="keydown"}this.observers||(this.observers={});if(!g._eventCacheID){var h="eventCacheID_";g.id&&(h=g.id+"_"+h);g._eventCacheID=OpenLayers.Util.createUniqueID(h)}h=g._eventCacheID;this.observers[h]||(this.observers[h]=[]);this.observers[h].push({element:g,name:f,observer:k,useCapture:j});g.addEventListener?g.addEventListener(f,k,j):g.attachEvent&&g.attachEvent("on"+f,k)},stopObservingElement:function(b){b=OpenLayers.Util.getElement(b)._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[b])},_removeElementObservers:function(e){if(e){for(var d=e.length-1;0<=d;d--){var f=e[d];OpenLayers.Event.stopObserving.apply(this,[f.element,f.name,f.observer,f.useCapture])}}},stopObserving:function(s,r,q,p){var p=p||!1,s=OpenLayers.Util.getElement(s),o=s._eventCacheID;if("keypress"==r&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||s.detachEvent)){r="keydown"}var m=!1,l=OpenLayers.Event.observers[o];if(l){for(var k=0;!m&&k<l.length;){var j=l[k];if(j.name==r&&j.observer==q&&j.useCapture==p){l.splice(k,1);0==l.length&&delete OpenLayers.Event.observers[o];m=!0;break}k++}}m&&(s.removeEventListener?s.removeEventListener(r,q,p):s&&s.detachEvent&&s.detachEvent("on"+r,q));return m},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var b in OpenLayers.Event.observers){OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[b]])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(g,f,k,j,h){OpenLayers.Util.extend(this,h);this.object=g;this.fallThrough=j;this.listeners={};this.extensions={};this.extensionCount={};null!=f&&this.attachToElement(f)},destroy:function(){for(var b in this.extensions){"boolean"!==typeof this.extensions[b]&&this.extensions[b].destroy()}this.extensions=null;this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener));this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this));this.element=e;for(var d=0,f=this.BROWSER_EVENTS.length;d<f;d++){OpenLayers.Event.observe(e,this.BROWSER_EVENTS[d],this.eventHandler)}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(d){for(var c in d){"scope"!=c&&d.hasOwnProperty(c)&&this.register(c,d.scope,d[c])}},register:function(g,f,k,j){g in OpenLayers.Events&&!this.extensions[g]&&(this.extensions[g]=new OpenLayers.Events[g](this));if(null!=k){null==f&&(f=this.object);var h=this.listeners[g];h||(h=[],this.listeners[g]=h,this.extensionCount[g]=0);f={obj:f,func:k};j?(h.splice(this.extensionCount[g],0,f),"object"===typeof j&&j.extension&&this.extensionCount[g]++):h.push(f)}},registerPriority:function(e,d,f){this.register(e,d,f,!0)},un:function(d){for(var c in d){"scope"!=c&&d.hasOwnProperty(c)&&this.unregister(c,d.scope,d[c])}},unregister:function(g,f,k){null==f&&(f=this.object);g=this.listeners[g];if(null!=g){for(var j=0,h=g.length;j<h;j++){if(g[j].obj==f&&g[j].func==k){g.splice(j,1);break}}}},remove:function(b){null!=this.listeners[b]&&(this.listeners[b]=[])},triggerEvent:function(h,g){var m=this.listeners[h];if(m&&0!=m.length){null==g&&(g={});g.object=this.object;g.element=this.element;g.type||(g.type=h);for(var m=m.slice(),l,k=0,j=m.length;k<j&&!(l=m[k],l=l.func.apply(l.obj,[g]),void 0!=l&&!1==l);k++){}this.fallThrough||OpenLayers.Event.stop(g,!0);return l}},handleBrowserEvent:function(k){var j=k.type,r=this.listeners[j];if(r&&0!=r.length){if((r=k.touches)&&r[0]){for(var q=0,p=0,o=r.length,m,l=0;l<o;++l){m=r[l],q+=m.clientX,p+=m.clientY}k.clientX=q/o;k.clientY=p/o}this.includeXY&&(k.xy=this.getMousePosition(k));this.triggerEvent(j,k)}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;var b=document.body;if(b&&(!(0!=b.scrollTop||0!=b.scrollLeft)||!navigator.userAgent.match(/iPhone/i))){this.element.offsets=null}},getMousePosition:function(d){this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache();if(!this.element.scrolls){var c=OpenLayers.Util.getViewportElement();this.element.scrolls=[c.scrollLeft,c.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(d.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],d.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(b){this.target=b;for(b=this.events.length-1;0<=b;--b){this.target.register(this.events[b],this,this.buttonClick,{extension:!0})}},destroy:function(){for(var b=this.events.length-1;0<=b;--b){this.target.unregister(this.events[b],this,this.buttonClick)}delete this.target},getPressedButton:function(e){var d=3,f;do{if(OpenLayers.Element.hasClass(e,"olButton")){f=e;break}e=e.parentNode}while(0<--d&&e);return f},buttonClick:function(e){var d=!0,f=OpenLayers.Event.element(e);if(f&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){if(f=this.getPressedButton(f)){if("keydown"===e.type){switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:f}),OpenLayers.Event.stop(e),d=!1}}else{this.startEvt&&(this.completeRegEx.test(e.type)&&(d=OpenLayers.Util.pagePosition(f),this.target.triggerEvent("buttonclick",{buttonElement:f,buttonXY:{x:this.startEvt.clientX-d[0],y:this.startEvt.clientY-d[1]}})),this.cancelRegEx.test(e.type)&&delete this.startEvt,OpenLayers.Event.stop(e),d=!1)}this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),d=!1)}else{delete this.startEvt}}return d}});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,initialize:function(b){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[b])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(0===this.layers.length){if(this.map.baseLayer){this.layers=[this.map.baseLayer.clone()]}else{return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(this.outsideViewport){this.element.style.display=""}else{this.div.className+=" "+this.displayClass+"Container";var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,b,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";this.div.appendChild(this.maximizeDiv);b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,b,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";this.div.appendChild(this.minimizeDiv);this.minimizeControl()}this.map.getExtent()&&this.update();this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});this.maximized&&this.maximizeControl();return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(h){var g=this.handlers.drag.last.x-h.x,m=this.handlers.drag.last.y-h.y;if(0!=g||0!=m){var l=this.rectPxBounds.top,k=this.rectPxBounds.left,h=Math.abs(this.rectPxBounds.getHeight()),j=this.rectPxBounds.getWidth(),m=Math.max(0,l-m),m=Math.min(m,this.ovmap.size.h-this.hComp-h),g=Math.max(0,k-g),g=Math.min(g,this.ovmap.size.w-this.wComp-j);this.setRectPxBounds(new OpenLayers.Bounds(g,m+h,g+j,m))}},mapDivClick:function(h){var g=this.rectPxBounds.getCenterPixel(),m=h.xy.x-g.x,l=h.xy.y-g.y,k=this.rectPxBounds.top,j=this.rectPxBounds.left,h=Math.abs(this.rectPxBounds.getHeight()),g=this.rectPxBounds.getWidth(),l=Math.max(0,k+l),l=Math.min(l,this.ovmap.size.h-h),m=Math.max(0,j+m),m=Math.min(m,this.ovmap.size.w-g);this.setRectPxBounds(new OpenLayers.Bounds(m,l+h,m+g,l));this.updateMapToRect()},onButtonClick:function(b){b.buttonElement===this.minimizeDiv?this.minimizeControl():b.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(b){this.element.style.display="";this.showToggle(!1);null!=b&&OpenLayers.Event.stop(b)},minimizeControl:function(b){this.element.style.display="none";this.showToggle(!0);null!=b&&OpenLayers.Event.stop(b)},showToggle:function(b){this.maximizeDiv.style.display=b?"":"none";this.minimizeDiv.style.display=b?"none":""},update:function(){null==this.ovmap&&this.createMap();(this.autoPan||!this.isSuitableOverview())&&this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var d=this.map.getExtent(),c=this.map.maxExtent,d=new OpenLayers.Bounds(Math.max(d.left,c.left),Math.max(d.bottom,c.bottom),Math.min(d.right,c.right),Math.min(d.top,c.top));this.ovmap.getProjection()!=this.map.getProjection()&&(d=d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));c=this.ovmap.getResolution()/this.map.getResolution();return c>this.minRatio&&c<=this.maxRatio&&this.ovmap.getExtent().containsBounds(d)},updateOverview:function(){var e=this.map.getResolution(),d=this.ovmap.getResolution(),f=d/e;f>this.maxRatio?d=this.minRatio*e:f<=this.minRatio&&(d=this.maxRatio*e);this.ovmap.getProjection()!=this.map.getProjection()?(e=this.map.center.clone(),e.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):e=this.map.center;this.ovmap.setCenter(e,this.ovmap.getZoomForResolution(d*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var d=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,d);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=(this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")))?this.wComp:2;this.hComp=(this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")))?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register("mouseover",this,function(){!this.handlers.drag.active&&!this.map.dragging&&this.handlers.drag.activate()});this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var d=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,c=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=d&&c?OpenLayers.INCHES_PER_UNIT[d]/OpenLayers.INCHES_PER_UNIT[c]:1}},updateRectToMap:function(){var b=this.getRectBoundsFromMapBounds(this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent());b&&this.setRectPxBounds(b)},updateMapToRect:function(){var b=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(b=b.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(b.getCenterLonLat())},setRectPxBounds:function(h){var g=Math.max(h.top,0),m=Math.max(h.left,0),l=Math.min(h.top+Math.abs(h.getHeight()),this.ovmap.size.h-this.hComp),h=Math.min(h.left+h.getWidth(),this.ovmap.size.w-this.wComp),k=Math.max(h-m,0),j=Math.max(l-g,0);k<this.minRectSize||j<this.minRectSize?(this.extentRectangle.className=this.displayClass+this.minRectDisplayClass,k=m+k/2-this.minRectSize/2,this.extentRectangle.style.top=Math.round(g+j/2-this.minRectSize/2)+"px",this.extentRectangle.style.left=Math.round(k)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"):(this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(g)+"px",this.extentRectangle.style.left=Math.round(m)+"px",this.extentRectangle.style.height=Math.round(j)+"px",this.extentRectangle.style.width=Math.round(k)+"px");this.rectPxBounds=new OpenLayers.Bounds(Math.round(m),Math.round(l),Math.round(h),Math.round(g))},getRectBoundsFromMapBounds:function(e){var d=this.getOverviewPxFromLonLat({lon:e.left,lat:e.bottom}),e=this.getOverviewPxFromLonLat({lon:e.right,lat:e.top}),f=null;d&&e&&(f=new OpenLayers.Bounds(d.x,d.y,e.x,e.y));return f},getMapBoundsFromRectBounds:function(d){var c=this.getLonLatFromOverviewPx({x:d.left,y:d.bottom}),d=this.getLonLatFromOverviewPx({x:d.right,y:d.top});return new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)},getLonLatFromOverviewPx:function(f){var e=this.ovmap.size,h=this.ovmap.getResolution(),g=this.ovmap.getExtent().getCenterLonLat();return{lon:g.lon+(f.x-e.w/2)*h,lat:g.lat-(f.y-e.h/2)*h}},getOverviewPxFromLonLat:function(e){var d=this.ovmap.getResolution(),f=this.ovmap.getExtent();if(f){return{x:Math.round(1/d*(e.lon-f.left)),y:Math.round(1/d*(f.top-e.lat))}}},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Animation=function(g){var f=!(!g.requestAnimationFrame&&!g.webkitRequestAnimationFrame&&!g.mozRequestAnimationFrame&&!g.oRequestAnimationFrame&&!g.msRequestAnimationFrame),k=function(){var a=g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(c){g.setTimeout(c,16)};return function(e,b){a.apply(g,[e,b])}}(),j=0,h={};return{isNative:f,requestFrame:k,start:function(d,c,m){var c=0<c?c:Number.POSITIVE_INFINITY,l=++j,e=+new Date;h[l]=function(){h[l]&&+new Date-e<=c?(d(),h[l]&&k(h[l],m)):delete h[l]};k(h[l],m);return l},stop:function(b){delete h[b]}}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,animationId:null,playing:!1,initialize:function(b){this.easing=b?b:OpenLayers.Easing.Expo.easeOut},start:function(f,e,h,g){this.playing=!0;this.begin=f;this.finish=e;this.duration=h;this.callbacks=g.callbacks;this.time=0;OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var f={},e;for(e in this.begin){var h=this.begin[e],g=this.finish[e];if(null==h||null==g||isNaN(h)||isNaN(g)){throw new TypeError("invalid value for Tween")}f[e]=this.easing.apply(this,[this.time,h,g-h,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,f);this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(f,e,h,g){return h*f/g+e},easeOut:function(f,e,h,g){return h*f/g+e},easeInOut:function(f,e,h,g){return h*f/g+e},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(f,e,h,g){return 0==f?e:h*Math.pow(2,10*(f/g-1))+e},easeOut:function(f,e,h,g){return f==g?e+h:h*(-Math.pow(2,-10*f/g)+1)+e},easeInOut:function(f,e,h,g){return 0==f?e:f==g?e+h:1>(f/=g/2)?h/2*Math.pow(2,10*(f-1))+e:h/2*(-Math.pow(2,-10*--f)+2)+e},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(f,e,h,g){return h*(f/=g)*f+e},easeOut:function(f,e,h,g){return -h*(f/=g)*(f-2)+e},easeInOut:function(f,e,h,g){return 1>(f/=g/2)?h/2*f*f+e:-h/2*(--f*(f-2)-1)+e},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(d,c){OpenLayers.Util.extend(this,c);this.projCode=d;window.Proj4js&&(this.proj=new Proj4js.Proj(d))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(d){var c=!1;d&&(d instanceof OpenLayers.Projection||(d=new OpenLayers.Projection(d)),window.Proj4js&&this.proj.defData&&d.proj.defData?c=this.proj.defData.replace(this.titleRegEx,"")==d.proj.defData.replace(this.titleRegEx,""):d.getCode&&(c=this.getCode(),d=d.getCode(),c=c==d||!!OpenLayers.Projection.transforms[c]&&OpenLayers.Projection.transforms[c][d]===OpenLayers.Projection.nullTransform));return c},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};OpenLayers.Projection.addTransform=function(f,e,h){if(h===OpenLayers.Projection.nullTransform){var g=OpenLayers.Projection.defaults[f];g&&!OpenLayers.Projection.defaults[e]&&(OpenLayers.Projection.defaults[e]=g)}OpenLayers.Projection.transforms[f]||(OpenLayers.Projection.transforms[f]={});OpenLayers.Projection.transforms[f][e]=h};OpenLayers.Projection.transform=function(f,e,h){if(e&&h){if(e instanceof OpenLayers.Projection||(e=new OpenLayers.Projection(e)),h instanceof OpenLayers.Projection||(h=new OpenLayers.Projection(h)),e.proj&&h.proj){f=Proj4js.transform(e.proj,h.proj,f)}else{var e=e.getCode(),h=h.getCode(),g=OpenLayers.Projection.transforms;if(g[e]&&g[e][h]){g[e][h](f)}}}return f};OpenLayers.Projection.nullTransform=function(b){return b};(function(){function j(b){b.x=180*b.x/o;b.y=180/Math.PI*(2*Math.atan(Math.exp(b.y/o*Math.PI))-Math.PI/2);return b}function h(b){b.x=b.x*o/180;b.y=Math.log(Math.tan((90+b.y)*Math.PI/360))/Math.PI*o;return b}function p(w,v){var u=OpenLayers.Projection.addTransform,t=OpenLayers.Projection.nullTransform,s,r,q,b,a;s=0;for(r=v.length;s<r;++s){q=v[s];u(w,q,h);u(q,w,j);for(a=s+1;a<r;++a){b=v[a],u(q,b,t),u(b,q,t)}}}var o=20037508.34,m=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],l=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],k;for(k=m.length-1;0<=k;--k){p(m[k],l)}for(k=l.length-1;0<=k;--k){p(l[k],m)}})();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!0,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(h,g){1===arguments.length&&"object"===typeof h&&(h=(g=h)&&g.div);this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend({},g);OpenLayers.Util.extend(this,g);OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]);this.maxExtent&&!(this.maxExtent instanceof OpenLayers.Bounds)&&(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));this.minExtent&&!(this.minExtent instanceof OpenLayers.Bounds)&&(this.minExtent=new OpenLayers.Bounds(this.minExtent));this.restrictedExtent&&!(this.restrictedExtent instanceof OpenLayers.Bounds)&&(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));this.center&&!(this.center instanceof OpenLayers.LonLat)&&(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(h);this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px");OpenLayers.Element.addClass(this.div,"olMap");var m=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(m,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});m=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(m);this.layerContainerDiv.style.width="100px";this.layerContainerDiv.style.height="100px";this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}9>parseFloat(navigator.appVersion.split("MSIE")[1])?this.events.register("resize",this,this.updateSize):(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy));if(this.theme){for(var m=!0,l=document.getElementsByTagName("link"),k=0,j=l.length;k<j;++k){if(OpenLayers.Util.isEquivalentUrl(l.item(k).href,this.theme)){m=!1;break}}m&&(m=document.createElement("link"),m.setAttribute("rel","stylesheet"),m.setAttribute("type","text/css"),m.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(m))}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));k=0;for(j=this.controls.length;k<j;k++){this.addControlToMap(this.controls[k])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);g&&g.layers&&(delete this.center,this.addLayers(g.layers),g.center&&!this.getCenter()&&this.setCenter(g.center,g.zoom))},getViewport:function(){return this.viewPortDiv},render:function(b){this.div=OpenLayers.Util.getElement(b);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return !1}this.panTween&&(this.panTween.stop(),this.panTween=null);OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy?OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy):this.events.unregister("resize",this,this.updateSize);this.paddingForPopups=null;if(null!=this.controls){for(var b=this.controls.length-1;0<=b;--b){this.controls[b].destroy()}this.controls=null}if(null!=this.layers){for(b=this.layers.length-1;0<=b;--b){this.layers[b].destroy(!1)}this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv);this.viewPortDiv=null;this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null);this.events.destroy();this.options=this.events=null},setOptions:function(d){var c=this.minPx&&d.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,d);c&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(f,e,h){var g="function"==typeof h.test;return OpenLayers.Array.filter(this[f],function(b){return b[e]==h||g&&h.test(b[e])})},getLayersBy:function(d,c){return this.getBy("layers",d,c)},getLayersByName:function(b){return this.getLayersBy("name",b)},getLayersByClass:function(b){return this.getLayersBy("CLASS_NAME",b)},getControlsBy:function(d,c){return this.getBy("controls",d,c)},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b)},getLayer:function(g){for(var f=null,k=0,j=this.layers.length;k<j;k++){var h=this.layers[k];if(h.id==g){f=h;break}}return f},setLayerZIndex:function(d,c){d.setZIndex(this.Z_INDEX_BASE[d.isBaseLayer?"BaseLayer":"Overlay"]+5*c)},resetLayersZIndex:function(){for(var d=0,c=this.layers.length;d<c;d++){this.setLayerZIndex(this.layers[d],d)}},addLayer:function(e){for(var d=0,f=this.layers.length;d<f;d++){if(this.layers[d]==e){return !1}}if(!1===this.events.triggerEvent("preaddlayer",{layer:e})){return !1}this.allOverlays&&(e.isBaseLayer=!1);e.div.className="olLayerDiv";e.div.style.overflow="";this.setLayerZIndex(e,this.layers.length);e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div);this.layers.push(e);e.setMap(this);e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw();this.events.triggerEvent("addlayer",{layer:e});e.events.triggerEvent("added",{map:this,layer:e});e.afterAdd();return !0},addLayers:function(e){for(var d=0,f=e.length;d<f;d++){this.addLayer(e[d])}},removeLayer:function(g,f){if(!1!==this.events.triggerEvent("preremovelayer",{layer:g})){null==f&&(f=!0);g.isFixed?this.viewPortDiv.removeChild(g.div):this.layerContainerDiv.removeChild(g.div);OpenLayers.Util.removeItem(this.layers,g);g.removeMap(this);g.map=null;if(this.baseLayer==g&&(this.baseLayer=null,f)){for(var k=0,j=this.layers.length;k<j;k++){var h=this.layers[k];if(h.isBaseLayer||this.allOverlays){this.setBaseLayer(h);break}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:g});g.events.triggerEvent("removed",{map:this,layer:g})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(b){return OpenLayers.Util.indexOf(this.layers,b)},setLayerIndex:function(f,e){var h=this.getLayerIndex(f);0>e?e=0:e>this.layers.length&&(e=this.layers.length);if(h!=e){this.layers.splice(h,1);this.layers.splice(e,0,f);for(var h=0,g=this.layers.length;h<g;h++){this.setLayerZIndex(this.layers[h],h)}this.events.triggerEvent("changelayer",{layer:f,property:"order"});this.allOverlays&&(0===e?this.setBaseLayer(f):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,d){var f=this.getLayerIndex(e)+d;this.setLayerIndex(e,f)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var d=this.getCachedCenter(),f=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);null!=this.baseLayer&&!this.allOverlays&&this.baseLayer.setVisibility(!1);this.baseLayer=e;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&&this.baseLayer.redraw()}null!=d&&(e=this.getZoomForResolution(f||this.resolution,!0),this.setCenter(d,e,!1,!0));this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(d,c){this.controls.push(d);this.addControlToMap(d,c)},addControls:function(g,f){for(var k=1===arguments.length?[]:f,j=0,h=g.length;j<h;j++){this.addControl(g[j],k[j]?k[j]:null)}},addControlToMap:function(e,d){e.outsideViewport=null!=e.div;this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection);e.setMap(this);var f=e.draw(d);f&&!e.outsideViewport&&(f.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(f));e.autoActivate&&e.activate()},getControl:function(g){for(var f=null,k=0,j=this.controls.length;k<j;k++){var h=this.controls[k];if(h.id==g){f=h;break}}return f},removeControl:function(b){b&&b==this.getControl(b.id)&&(b.div&&b.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(b.div),OpenLayers.Util.removeItem(this.controls,b))},addPopup:function(e,d){if(d){for(var f=this.popups.length-1;0<=f;--f){this.removePopup(this.popups[f])}}e.map=this;this.popups.push(e);if(f=e.draw()){f.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(f)}},removePopup:function(d){OpenLayers.Util.removeItem(this.popups,d);if(d.div){try{this.layerContainerDiv.removeChild(d.div)}catch(c){}}d.map=null},getSize:function(){var b=null;null!=this.size&&(b=this.size.clone());return b},updateSize:function(){var d=this.getCurrentSize();if(d&&!isNaN(d.h)&&!isNaN(d.w)){this.events.clearMouseCache();var c=this.getSize();null==c&&(this.size=c=d);if(!d.equals(c)){this.size=d;d=0;for(c=this.layers.length;d<c;d++){this.layers[d].onMapResize()}d=this.getCachedCenter();null!=this.baseLayer&&null!=d&&(c=this.getZoom(),this.zoom=null,this.setCenter(d,c))}}},getCurrentSize:function(){var b=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==b.w&&0==b.h||isNaN(b.w)&&isNaN(b.h)){b.w=this.div.offsetWidth,b.h=this.div.offsetHeight}if(0==b.w&&0==b.h||isNaN(b.w)&&isNaN(b.h)){b.w=parseInt(this.div.style.width),b.h=parseInt(this.div.style.height)}return b},calculateBounds:function(f,e){var h=null;null==f&&(f=this.getCachedCenter());null==e&&(e=this.getResolution());if(null!=f&&null!=e){var h=this.size.w*e/2,g=this.size.h*e/2,h=new OpenLayers.Bounds(f.lon-h,f.lat-g,f.lon+h,f.lat+g)}return h},getCenter:function(){var d=null,c=this.getCachedCenter();c&&(d=c.clone());return d},getCachedCenter:function(){!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2}));return this.center},getZoom:function(){return this.zoom},pan:function(f,e,h){h=OpenLayers.Util.applyDefaults(h,{animate:!0,dragging:!1});if(h.dragging){(0!=f||0!=e)&&this.moveByPx(f,e)}else{var g=this.getViewPortPxFromLonLat(this.getCachedCenter()),f=g.add(f,e);if(this.dragging||!f.equals(g)){g=this.getLonLatFromViewPortPx(f),h.animate?this.panTo(g):(this.moveTo(g),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(g){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(g)){this.panTween||(this.panTween=new OpenLayers.Tween(this.panMethod));var f=this.getCachedCenter();if(!g.equals(f)){var f=this.getPixelFromLonLat(f),k=this.getPixelFromLonLat(g),j=0,h=0;this.panTween.start({x:0,y:0},{x:k.x-f.x,y:k.y-f.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(b){this.moveByPx(b.x-j,b.y-h);j=Math.round(b.x);h=Math.round(b.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(g);this.dragging=false;this.events.triggerEvent("moveend")},this)}})}}else{this.setCenter(g)}},setCenter:function(f,e,h,g){this.panTween&&this.panTween.stop();this.moveTo(f,e,{dragging:h,forceZoomChange:g})},moveByPx:function(s,r){var q=this.size.w/2,p=this.size.h/2,o=q+s,m=p+r,l=this.baseLayer.wrapDateLine,k=0,j=0;this.restrictedExtent&&(k=q,j=p,l=!1);s=l||o<=this.maxPx.x-k&&o>=this.minPx.x+k?Math.round(s):0;r=m<=this.maxPx.y-j&&m>=this.minPx.y+j?Math.round(r):0;if(s||r){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart"));this.center=null;s&&(this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-s+"px",this.minPx.x-=s,this.maxPx.x-=s);r&&(this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-r+"px",this.minPx.y-=r,this.maxPx.y-=r);p=0;for(o=this.layers.length;p<o;++p){if(q=this.layers[p],q.visibility&&(q===this.baseLayer||q.inRange)){q.moveByPx(s,r),q.events.triggerEvent("move")}}this.events.triggerEvent("move")}},adjustZoom:function(g){var f=this.baseLayer.resolutions,k=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(g)>k){for(var j=g|0,h=f.length;j<h;++j){if(f[j]<=k){g=j;break}}}return g},moveTo:function(u,t,s){null!=u&&!(u instanceof OpenLayers.LonLat)&&(u=new OpenLayers.LonLat(u));s||(s={});null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t)));if(this.baseLayer.wrapDateLine){var r=t,t=this.adjustZoom(t);t!==r&&(u=this.getCenter())}var r=s.dragging||this.dragging,q=s.forceZoomChange;!this.getCachedCenter()&&!this.isValidLonLat(u)&&(u=this.maxExtent.getCenterLonLat(),this.center=u.clone());if(null!=this.restrictedExtent){null==u&&(u=this.center);null==t&&(t=this.getZoom());var p=this.getResolutionForZoom(t),p=this.calculateBounds(u,p);if(!this.restrictedExtent.containsBounds(p)){var o=this.restrictedExtent.getCenterLonLat();p.getWidth()>this.restrictedExtent.getWidth()?u=new OpenLayers.LonLat(o.lon,u.lat):p.left<this.restrictedExtent.left?u=u.add(this.restrictedExtent.left-p.left,0):p.right>this.restrictedExtent.right&&(u=u.add(this.restrictedExtent.right-p.right,0));p.getHeight()>this.restrictedExtent.getHeight()?u=new OpenLayers.LonLat(u.lon,o.lat):p.bottom<this.restrictedExtent.bottom?u=u.add(0,this.restrictedExtent.bottom-p.bottom):p.top>this.restrictedExtent.top&&(u=u.add(0,this.restrictedExtent.top-p.top))}}q=q||this.isValidZoomLevel(t)&&t!=this.getZoom();p=this.isValidLonLat(u)&&!u.equals(this.center);if(q||p||r){r||this.events.triggerEvent("movestart");p&&(!q&&this.center&&this.centerLayerContainer(u),this.center=u.clone());u=q?this.getResolutionForZoom(t):this.getResolution();if(q||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";var p=this.getMaxExtent({restricted:!0}),m=p.getCenterLonLat(),o=this.center.lon-m.lon,m=m.lat-this.center.lat,l=Math.round(p.getWidth()/u),k=Math.round(p.getHeight()/u);this.minPx={x:(this.size.w-l)/2-o/u,y:(this.size.h-k)/2-m/u};this.maxPx={x:this.minPx.x+Math.round(p.getWidth()/u),y:this.minPx.y+Math.round(p.getHeight()/u)}}q&&(this.zoom=t,this.resolution=u);u=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(u,q,s.dragging),s.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:q}));u=this.baseLayer.getExtent();for(t=this.layers.length-1;0<=t;--t){if(p=this.layers[t],p!==this.baseLayer&&!p.isBaseLayer&&(o=p.calculateInRange(),p.inRange!=o&&((p.inRange=o)||p.display(!1),this.events.triggerEvent("changelayer",{layer:p,property:"visibility"})),o&&p.visibility)){p.moveTo(u,q,s.dragging),s.dragging||p.events.triggerEvent("moveend",{zoomChanged:q})}}this.events.triggerEvent("move");r||this.events.triggerEvent("moveend");if(q){t=0;for(s=this.popups.length;t<s;t++){this.popups[t].updatePosition()}this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(g){var f=this.getViewPortPxFromLonLat(this.layerContainerOrigin),k=this.getViewPortPxFromLonLat(g);if(null!=f&&null!=k){var j=parseInt(this.layerContainerDiv.style.left),g=parseInt(this.layerContainerDiv.style.top),h=Math.round(f.x-k.x),f=Math.round(f.y-k.y);this.layerContainerDiv.style.left=h+"px";this.layerContainerDiv.style.top=f+"px";j-=h;g-=f;this.minPx.x-=j;this.maxPx.x-=j;this.minPx.y-=g;this.maxPx.y-=g}},isValidZoomLevel:function(b){return null!=b&&0<=b&&b<this.getNumZoomLevels()},isValidLonLat:function(d){var c=!1;null!=d&&(c=this.getMaxExtent(),c=c.containsLonLat(d,{worldBounds:this.baseLayer.wrapDateLine&&c}));return c},getProjection:function(){var b=this.getProjectionObject();return b?b.getCode():null},getProjectionObject:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.projection);return b},getMaxResolution:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.maxResolution);return b},getMaxExtent:function(d){var c=null;d&&d.restricted&&this.restrictedExtent?c=this.restrictedExtent:null!=this.baseLayer&&(c=this.baseLayer.maxExtent);return c},getNumZoomLevels:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.numZoomLevels);return b},getExtent:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.getExtent());return b},getResolution:function(){var b=null;null!=this.baseLayer?b=this.baseLayer.getResolution():!0===this.allOverlays&&0<this.layers.length&&(b=this.layers[0].getResolution());return b},getUnits:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.units);return b},getScale:function(){var b=null;null!=this.baseLayer&&(b=this.getResolution(),b=OpenLayers.Util.getScaleFromResolution(b,this.baseLayer.units));return b},getZoomForExtent:function(e,d){var f=null;null!=this.baseLayer&&(f=this.baseLayer.getZoomForExtent(e,d));return f},getResolutionForZoom:function(d){var c=null;this.baseLayer&&(c=this.baseLayer.getResolutionForZoom(d));return c},getZoomForResolution:function(e,d){var f=null;null!=this.baseLayer&&(f=this.baseLayer.getZoomForResolution(e,d));return f},zoomTo:function(b){this.isValidZoomLevel(b)&&this.setCenter(null,b)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,d){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var f=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){f=this.getMaxExtent();for(e=e.clone();e.right<e.left;){e.right+=f.getWidth()}f=e.getCenterLonLat().wrapDateLine(f)}this.setCenter(f,this.getZoomForExtent(e,d))},zoomToMaxExtent:function(b){this.zoomToExtent(this.getMaxExtent({restricted:b?b.restricted:!0}))},zoomToScale:function(g,f){var k=OpenLayers.Util.getResolutionFromScale(g,this.baseLayer.units),j=this.size.w*k/2,k=this.size.h*k/2,h=this.getCachedCenter();this.zoomToExtent(new OpenLayers.Bounds(h.lon-j,h.lat-k,h.lon+j,h.lat+k),f)},getLonLatFromViewPortPx:function(d){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getLonLatFromViewPortPx(d));return c},getViewPortPxFromLonLat:function(d){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getViewPortPxFromLonLat(d));return c},getLonLatFromPixel:function(b){return this.getLonLatFromViewPortPx(b)},getPixelFromLonLat:function(b){b=this.getViewPortPxFromLonLat(b);b.x=Math.round(b.x);b.y=Math.round(b.y);return b},getGeodesicPixelSize:function(h){var g=h?this.getLonLatFromPixel(h):this.getCachedCenter()||new OpenLayers.LonLat(0,0),m=this.getResolution(),h=g.add(-m/2,0),l=g.add(m/2,0),k=g.add(0,-m/2),g=g.add(0,m/2),m=new OpenLayers.Projection("EPSG:4326"),j=this.getProjectionObject()||m;j.equals(m)||(h.transform(j,m),l.transform(j,m),k.transform(j,m),g.transform(j,m));return new OpenLayers.Size(OpenLayers.Util.distVincenty(h,l),OpenLayers.Util.distVincenty(k,g))},getViewPortPxFromLayerPx:function(e){var d=null;if(null!=e){var d=parseInt(this.layerContainerDiv.style.left),f=parseInt(this.layerContainerDiv.style.top),d=e.add(d,f)}return d},getLayerPxFromViewPortPx:function(e){var d=null;if(null!=e){var d=-parseInt(this.layerContainerDiv.style.left),f=-parseInt(this.layerContainerDiv.style.top),d=e.add(d,f);if(isNaN(d.x)||isNaN(d.y)){d=null}}return d},getLonLatFromLayerPx:function(b){b=this.getViewPortPxFromLayerPx(b);return this.getLonLatFromViewPortPx(b)},getLayerPxFromLonLat:function(b){return this.getLayerPxFromViewPortPx(this.getPixelFromLonLat(b))},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(d,c){this.metadata={};this.addOptions(c);this.name=d;if(null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object)){this.events.on(this.eventListeners)}},destroy:function(b){null==b&&(b=!0);null!=this.map&&this.map.removeLayer(this,b);this.options=this.div=this.name=this.map=this.projection=null;this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy());this.events=this.eventListeners=null},clone:function(b){null==b&&(b=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(b,this);b.map=null;return b},getOptions:function(){var d={},c;for(c in this.options){d[c]=this[c]}return d},setName:function(b){b!=this.name&&(this.name=b,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(g,f){null==this.options&&(this.options={});if(g&&("string"==typeof g.projection&&(g.projection=new OpenLayers.Projection(g.projection)),g.projection&&OpenLayers.Util.applyDefaults(g,OpenLayers.Projection.defaults[g.projection.getCode()]),g.maxExtent&&!(g.maxExtent instanceof OpenLayers.Bounds)&&(g.maxExtent=new OpenLayers.Bounds(g.maxExtent)),g.minExtent&&!(g.minExtent instanceof OpenLayers.Bounds))){g.minExtent=new OpenLayers.Bounds(g.minExtent)}OpenLayers.Util.extend(this.options,g);OpenLayers.Util.extend(this,g);this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits());if(this.map){var k=this.map.getResolution(),j=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]),h;for(h in g){if(g.hasOwnProperty(h)&&0<=OpenLayers.Util.indexOf(j,h)){this.initResolutions();f&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(k),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}}},onMapResize:function(){},redraw:function(){var d=!1;if(this.map){this.inRange=this.calculateInRange();var c=this.getExtent();c&&(this.inRange&&this.visibility)&&(this.moveTo(c,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),d=!0)}return d},moveTo:function(){var b=this.visibility;this.isBaseLayer||(b=b&&this.inRange);this.display(b)},moveByPx:function(){},setMap:function(b){null==this.map&&(this.map=b,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),this.div.style.display=this.visibility&&this.inRange?"":"none"),this.setTileSize())},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(b){this.tileSize=b=b?b:this.tileSize?this.tileSize:this.map.getTileSize();this.gutter&&(this.imageSize=new OpenLayers.Size(b.w+2*this.gutter,b.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(b){b!=this.visibility&&(this.visibility=b,this.display(b),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(b){b!=("none"!=this.div.style.display)&&(this.div.style.display=b&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var b=!1;this.alwaysInRange?b=!0:this.map&&(b=this.map.getResolution(),b=b>=this.minResolution&&b<=this.maxResolution);return b},setIsBaseLayer:function(b){b!=this.isBaseLayer&&(this.isBaseLayer=b,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var j,h,p,o={},m=!0;j=0;for(h=this.RESOLUTION_PROPERTIES.length;j<h;j++){p=this.RESOLUTION_PROPERTIES[j],o[p]=this.options[p],m&&this.options[p]&&(m=!1)}null==this.alwaysInRange&&(this.alwaysInRange=m);null==o.resolutions&&(o.resolutions=this.resolutionsFromScales(o.scales));null==o.resolutions&&(o.resolutions=this.calculateResolutions(o));if(null==o.resolutions){j=0;for(h=this.RESOLUTION_PROPERTIES.length;j<h;j++){p=this.RESOLUTION_PROPERTIES[j],o[p]=null!=this.options[p]?this.options[p]:this.map[p]}null==o.resolutions&&(o.resolutions=this.resolutionsFromScales(o.scales));null==o.resolutions&&(o.resolutions=this.calculateResolutions(o))}var l;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(l=this.options.maxResolution);this.options.minScale&&(l=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var k;this.options.minResolution&&"auto"!==this.options.minResolution&&(k=this.options.minResolution);this.options.maxScale&&(k=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));o.resolutions&&(o.resolutions.sort(function(d,c){return c-d}),l||(l=o.resolutions[0]),k||(k=o.resolutions[o.resolutions.length-1]));if(this.resolutions=o.resolutions){h=this.resolutions.length;this.scales=Array(h);for(j=0;j<h;j++){this.scales[j]=OpenLayers.Util.getScaleFromResolution(this.resolutions[j],this.units)}this.numZoomLevels=h}if(this.minResolution=k){this.maxScale=OpenLayers.Util.getScaleFromResolution(k,this.units)}if(this.maxResolution=l){this.minScale=OpenLayers.Util.getScaleFromResolution(l,this.units)}},resolutionsFromScales:function(f){if(null!=f){var e,h,g;g=f.length;e=Array(g);for(h=0;h<g;h++){e[h]=OpenLayers.Util.getResolutionFromScale(f[h],this.units)}return e}},calculateResolutions:function(h){var g,m,l=h.maxResolution;null!=h.minScale?l=OpenLayers.Util.getResolutionFromScale(h.minScale,this.units):"auto"==l&&null!=this.maxExtent&&(g=this.map.getSize(),m=this.maxExtent.getWidth()/g.w,g=this.maxExtent.getHeight()/g.h,l=Math.max(m,g));m=h.minResolution;null!=h.maxScale?m=OpenLayers.Util.getResolutionFromScale(h.maxScale,this.units):"auto"==h.minResolution&&null!=this.minExtent&&(g=this.map.getSize(),m=this.minExtent.getWidth()/g.w,g=this.minExtent.getHeight()/g.h,m=Math.max(m,g));"number"!==typeof l&&("number"!==typeof m&&null!=this.maxExtent)&&(l=this.map.getTileSize(),l=Math.max(this.maxExtent.getWidth()/l.w,this.maxExtent.getHeight()/l.h));g=h.maxZoomLevel;h=h.numZoomLevels;"number"===typeof m&&"number"===typeof l&&void 0===h?h=Math.floor(Math.log(l/m)/Math.log(2))+1:void 0===h&&null!=g&&(h=g+1);if(!("number"!==typeof h||0>=h||"number"!==typeof l&&"number"!==typeof m)){g=Array(h);var k=2;"number"==typeof m&&"number"==typeof l&&(k=Math.pow(l/m,1/(h-1)));var j;if("number"===typeof l){for(j=0;j<h;j++){g[j]=l/Math.pow(k,j)}}else{for(j=0;j<h;j++){g[h-1-j]=m*Math.pow(k,j)}}return g}},getResolution:function(){return this.getResolutionForZoom(this.map.getZoom())},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,d){var f=this.map.getSize();return this.getZoomForResolution(Math.max(e.getWidth()/f.w,e.getHeight()/f.h),d)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));if(this.map.fractionalZoom){var d=Math.floor(e),f=Math.ceil(e),e=this.resolutions[d]-(e-d)*(this.resolutions[d]-this.resolutions[f])}else{e=this.resolutions[Math.round(e)]}return e},getZoomForResolution:function(k,j){var r,q;if(this.map.fractionalZoom){var p=0,o=this.resolutions[p],m=this.resolutions[this.resolutions.length-1],l;r=0;for(q=this.resolutions.length;r<q;++r){if(l=this.resolutions[r],l>=k&&(o=l,p=r),l<=k){m=l;break}}r=o-m;r=0<r?p+(o-k)/r:p}else{o=Number.POSITIVE_INFINITY;r=0;for(q=this.resolutions.length;r<q;r++){if(j){p=Math.abs(this.resolutions[r]-k);if(p>o){break}o=p}else{if(this.resolutions[r]<k){break}}}r=Math.max(0,r-1)}return r},getLonLatFromViewPortPx:function(f){var e=null,h=this.map;if(null!=f&&h.minPx){var e=h.getResolution(),g=h.getMaxExtent({restricted:!0}),e=new OpenLayers.LonLat((f.x-h.minPx.x)*e+g.left,(h.minPx.y-f.y)*e+g.top);this.wrapDateLine&&(e=e.wrapDateLine(this.maxExtent))}return e},getViewPortPxFromLonLat:function(e,d){var f=null;null!=e&&(d=d||this.map.getResolution(),f=this.map.calculateBounds(null,d),f=new OpenLayers.Pixel(1/d*(e.lon-f.left),1/d*(f.top-e.lat)));return f},setOpacity:function(h){if(h!=this.opacity){this.opacity=h;for(var g=this.div.childNodes,m=0,l=g.length;m<l;++m){var k=g[m].firstChild||g[m],j=g[m].lastChild;j&&"iframe"===j.nodeName.toLowerCase()&&(k=j.parentNode);OpenLayers.Util.modifyDOMElement(k,null,null,null,null,null,null,h)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(b){this.div.style.zIndex=b},adjustBounds:function(d){if(this.gutter){var c=this.gutter*this.map.getResolution(),d=new OpenLayers.Bounds(d.left-c,d.bottom-c,d.right+c,d.top+c)}this.wrapDateLine&&(c={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},d=d.wrapDateLine(this.maxExtent,c));return d},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Layer.SphericalMercator={getExtent:function(){var b=null;return b=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(b){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(b){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var b=0;b<=this.MAX_ZOOM_LEVEL;++b){this.RESOLUTIONS[b]=156543.03390625/Math.pow(2,b)}this.units="m";this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var d=new OpenLayers.Projection("EPSG:4326"),c=new OpenLayers.Projection("EPSG:900913");return function(f,b){var a=OpenLayers.Projection.transform({x:f,y:b},d,c);return new OpenLayers.LonLat(a.x,a.y)}}(),inverseMercator:function(){var d=new OpenLayers.Projection("EPSG:4326"),c=new OpenLayers.Projection("EPSG:900913");return function(f,b){var a=OpenLayers.Projection.transform({x:f,y:b},c,d);return new OpenLayers.LonLat(a.x,a.y)}}()};OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(d,c){OpenLayers.Layer.prototype.initialize.apply(this,arguments);null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.pane=this.mapObject=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";"msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")");this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane);this.loadMapObject();null==this.mapObject&&this.loadWarningMessage()},removeMap:function(b){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane);OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var e=this.map.getSize(),d=Math.min(e.w,300),f=Math.min(e.h,200),d=new OpenLayers.Size(d,f),e=(new OpenLayers.Pixel(e.w/2,e.h/2)).add(-d.w/2,-d.h/2),e=OpenLayers.Util.createDiv(this.name+"_warning",e,d,null,null,null,"auto");e.style.padding="7px";e.style.backgroundColor="yellow";e.innerHTML=this.getWarningHTML();this.div.appendChild(e)},getWarningHTML:function(){return""},display:function(b){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(b){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(d,c){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);this.dragPanMapObject?this.dragPanMapObject(d,-c):this.moveTo(this.map.getCachedCenter())},moveTo:function(j,h,p){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(null!=this.mapObject){var o=this.map.getCenter(),m=this.map.getZoom();if(null!=o){var l=this.getOLLonLatFromMapObjectLonLat(this.getMapObjectCenter()),k=this.getOLZoomFromMapObjectZoom(this.getMapObjectZoom());if(!o.equals(l)||m!=k){!h&&l&&this.dragPanMapObject&&this.smoothDragPan?(m=this.map.getViewPortPxFromLonLat(l),o=this.map.getViewPortPxFromLonLat(o),this.dragPanMapObject(o.x-m.x,m.y-o.y)):(o=this.getMapObjectLonLatFromOLLonLat(o),m=this.getMapObjectZoomFromOLZoom(m),this.setMapObjectCenter(o,m,p))}}}},getLonLatFromViewPortPx:function(d){var c=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(c=this.getOLLonLatFromMapObjectLonLat(this.getMapObjectLonLatFromMapObjectPixel(this.getMapObjectPixelFromOLPixel(d))));return c},getViewPortPxFromLonLat:function(d){var c=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(c=this.getOLPixelFromMapObjectPixel(this.getMapObjectPixelFromMapObjectLonLat(this.getMapObjectLonLatFromOLLonLat(d))));return c},getOLLonLatFromMapObjectLonLat:function(d){var c=null;null!=d&&(c=this.getLongitudeFromMapObjectLonLat(d),d=this.getLatitudeFromMapObjectLonLat(d),c=new OpenLayers.LonLat(c,d));return c},getMapObjectLonLatFromOLLonLat:function(d){var c=null;null!=d&&(c=this.getMapObjectLonLatFromLonLat(d.lon,d.lat));return c},getOLPixelFromMapObjectPixel:function(d){var c=null;null!=d&&(c=this.getXFromMapObjectPixel(d),d=this.getYFromMapObjectPixel(d),c=new OpenLayers.Pixel(c,d));return c},getMapObjectPixelFromOLPixel:function(d){var c=null;null!=d&&(c=this.getMapObjectPixelFromXY(d.x,d.y));return c},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var f=["minZoomLevel","maxZoomLevel","numZoomLevels"],e=0,h=f.length;e<h;e++){var g=f[e];this[g]=null!=this.options[g]?this.options[g]:this.map[g]}if(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL){this.minZoomLevel=this.MIN_ZOOM_LEVEL}f=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;e=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels;this.numZoomLevels=null!=e?Math.min(e,f):f;this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(null!=this.RESOLUTIONS){f=0;this.resolutions=[];for(e=this.minZoomLevel;e<=this.maxZoomLevel;e++){this.resolutions[f++]=this.RESOLUTIONS[e]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)}var e=null,d=this.map.getSize(),f=this.getExtent();null!=d&&null!=f&&(e=Math.max(f.getWidth()/d.w,f.getHeight()/d.h));return e},getExtent:function(){var d=this.map.getSize(),c=this.getLonLatFromViewPortPx({x:0,y:0}),d=this.getLonLatFromViewPortPx({x:d.w,y:d.h});return null!=c&&null!=d?new OpenLayers.Bounds(c.lon,d.lat,d.lon,c.lat):null},getZoomForResolution:function(b){return null!=this.resolutions?OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments):this.getZoomForExtent(OpenLayers.Layer.prototype.getExtent.apply(this,[]))},getOLZoomFromMapObjectZoom:function(d){var c=null;null!=d&&(c=d-this.minZoomLevel,this.map.baseLayer!==this&&(c=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(c))));return c},getMapObjectZoomFromOLZoom:function(d){var c=null;null!=d&&(c=d+this.minZoomLevel,this.map.baseLayer!==this&&(c=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(c))));return c},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031,0.00000536441802978515,0.00000268220901489257,0.000001341104507446289,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(e,d){d=d||{};d.version||(d.version="function"===typeof GMap2?"2":"3");var f=OpenLayers.Layer.Google["v"+d.version.replace(/\./g,"_")];if(f){OpenLayers.Util.applyDefaults(d,f)}else{throw"Unsupported Google Maps API version: "+d.version}OpenLayers.Util.applyDefaults(d,f.DEFAULTS);d.maxExtent&&(d.maxExtent=d.maxExtent.clone());OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[e,d]);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[e,d]);this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(d){var c=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(c)},display:function(b){this._dragging||this.setGMapVisibility(b);OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(e,d,f){this._dragging=f;OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(d){d!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=d);if(this.getVisibility()){var c=this.getMapContainer();OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,d)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[this.map.id];b&&1>=b.count&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var d=OpenLayers.Layer.Google.cache[this.map.id];if(d){var c=this.mapObject&&this.getMapContainer();c&&c.parentNode&&c.parentNode.removeChild(c);(c=d.termsOfUse)&&c.parentNode&&c.parentNode.removeChild(c);(d=d.poweredBy)&&d.parentNode&&d.parentNode.removeChild(d)}},removeMap:function(d){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var c=OpenLayers.Layer.Google.cache[d.id];c&&(1>=c.count?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[d.id]):--c.count);delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(d){var c=null;null!=d&&(c=d.getSouthWest(),d=d.getNorthEast(),this.sphericalMercator?(c=this.forwardMercator(c.lng(),c.lat()),d=this.forwardMercator(d.lng(),d.lat())):(c=new OpenLayers.LonLat(c.lng(),c.lat()),d=new OpenLayers.LonLat(d.lng(),d.lat())),c=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat));return c},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(b){return this.sphericalMercator?this.forwardMercator(b.lng(),b.lat()).lon:b.lng()},getLatitudeFromMapObjectLonLat:function(b){return this.sphericalMercator?this.forwardMercator(b.lng(),b.lat()).lat:b.lat()},getXFromMapObjectPixel:function(b){return b.x},getYFromMapObjectPixel:function(b){return b.y},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.Google.cache={};OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var h,g,m,l=OpenLayers.Layer.Google.cache[this.map.id];if(l){h=l.mapObject,g=l.termsOfUse,m=l.poweredBy,++l.count}else{var l=this.map.viewPortDiv,k=document.createElement("div");k.id=this.map.id+"_GMap2Container";k.style.position="absolute";k.style.width="100%";k.style.height="100%";l.appendChild(k);try{h=new GMap2(k),g=k.lastChild,l.appendChild(g),g.style.zIndex="1100",g.style.right="",g.style.bottom="",g.className="olLayerGoogleCopyright",m=k.lastChild,l.appendChild(m),m.style.zIndex="1100",m.style.right="",m.style.bottom="",m.className="olLayerGooglePoweredBy gmnoprint"}catch(j){throw j}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:h,termsOfUse:g,poweredBy:m,count:1}}this.mapObject=h;this.termsOfUse=g;this.poweredBy=m;-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type);"function"==typeof h.getDragObject?this.dragObject=h.getDragObject():this.dragPanMapObject=null;!1===this.isBaseLayer&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()}else{if(!this._resized){var d=this,c=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(c);delete d._resized;d.mapObject.checkResize();d.moveTo(d.map.getCenter(),d.map.getZoom())})}this._resized=!0}},setGMapVisibility:function(e){var d=OpenLayers.Layer.Google.cache[this.map.id];if(d){var f=this.mapObject.getContainer();!0===e?(this.mapObject.setMapType(this.type),f.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",d.displayed=this.id):(d.displayed===this.id&&delete d.displayed,d.displayed||(f.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(d){var c=null;null!=d&&(c=this.sphericalMercator?this.inverseMercator(d.bottom,d.left):new OpenLayers.LonLat(d.bottom,d.left),d=this.sphericalMercator?this.inverseMercator(d.top,d.right):new OpenLayers.LonLat(d.top,d.right),c=new GLatLngBounds(new GLatLng(c.lat,c.lon),new GLatLng(d.lat,d.lon)));return c},setMapObjectCenter:function(d,c){this.mapObject.setCenter(d,c)},dragPanMapObject:function(d,c){this.dragObject.moveBy(new GSize(-d,c))},getMapObjectLonLatFromMapObjectPixel:function(b){return this.mapObject.fromContainerPixelToLatLng(b)},getMapObjectPixelFromMapObjectLonLat:function(b){return this.mapObject.fromLatLngToContainerPixel(b)},getMapObjectZoomFromMapObjectBounds:function(b){return this.mapObject.getBoundsZoomLevel(b)},getMapObjectLonLatFromLonLat:function(e,d){var f;this.sphericalMercator?(f=this.inverseMercator(e,d),f=new GLatLng(f.lat,f.lon)):f=new GLatLng(d,e);return f},getMapObjectPixelFromXY:function(d,c){return new GPoint(d,c)}};OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(d){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[d]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var c in this.namespaces){this.namespaceAlias[this.namespaces[c]]=c}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(d,c){this.namespaces[d]=c;this.namespaceAlias[c]=d},read:function(d){var c=d.indexOf("<");0<c&&(d=d.substring(c));c=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var a;a=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom;a.loadXML(d);return a},this),function(){return(new DOMParser).parseFromString(d,"text/xml")},function(){var a=new XMLHttpRequest;a.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(d),!1);a.overrideMimeType&&a.overrideMimeType("text/xml");a.send(null);return a.responseXML});this.keepData&&(this.data=c);return c},write:function(e){if(this.xmldom){e=e.xml}else{var d=new XMLSerializer;if(1==e.nodeType){var f=document.implementation.createDocument("","",null);f.importNode&&(e=f.importNode(e,!0));f.appendChild(e);e=d.serializeToString(f)}else{e=d.serializeToString(e)}}return e},createElementNS:function(d,c){return this.xmldom?"string"==typeof d?this.xmldom.createNode(1,c,d):this.xmldom.createNode(1,c,""):document.createElementNS(d,c)},createTextNode:function(b){"string"!==typeof b&&(b=""+b);return this.xmldom?this.xmldom.createTextNode(b):document.createTextNode(b)},getElementsByTagNameNS:function(k,j,r){var q=[];if(k.getElementsByTagNameNS){q=k.getElementsByTagNameNS(j,r)}else{for(var k=k.getElementsByTagName("*"),p,o,m=0,l=k.length;m<l;++m){if(p=k[m],o=p.prefix?p.prefix+":"+r:r,"*"==r||o==p.nodeName){("*"==j||j==p.namespaceURI)&&q.push(p)}}}return q},getAttributeNodeNS:function(k,j,r){var q=null;if(k.getAttributeNodeNS){q=k.getAttributeNodeNS(j,r)}else{for(var k=k.attributes,p,o,m=0,l=k.length;m<l;++m){if(p=k[m],p.namespaceURI==j&&(o=p.prefix?p.prefix+":"+r:r,o==p.nodeName)){q=p;break}}}return q},getAttributeNS:function(f,e,h){var g="";if(f.getAttributeNS){g=f.getAttributeNS(e,h)||""}else{if(f=this.getAttributeNodeNS(f,e,h)){g=f.nodeValue}}return g},getChildValue:function(f,e){var h=e||"";if(f){for(var g=f.firstChild;g;g=g.nextSibling){switch(g.nodeType){case 3:case 4:h+=g.nodeValue}}}return h},isSimpleContent:function(d){for(var c=!0,d=d.firstChild;d;d=d.nextSibling){if(1===d.nodeType){c=!1;break}}return c},contentType:function(f){for(var e=!1,h=!1,g=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,f=f.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 1:h=!0;break;case 8:break;default:e=!0}if(h&&e){break}}if(h&&e){g=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else{if(h){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}if(e){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}}return g},hasAttributeNS:function(f,e,h){var g=!1;return g=f.hasAttributeNS?f.hasAttributeNS(e,h):!!this.getAttributeNodeNS(f,e,h)},setAttributeNS:function(f,e,h,g){if(f.setAttributeNS){f.setAttributeNS(e,h,g)}else{if(this.xmldom){e?(e=f.ownerDocument.createNode(2,h,e),e.nodeValue=g,f.setAttributeNode(e)):f.setAttribute(h,g)}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(f,e){var e=e||{},h=e.uri||this.namespaces[e.prefix];h||(h=f.indexOf(":"),h=this.namespaces[f.substring(0,h)]);h||(h=this.namespaces[this.defaultPrefix]);h=this.createElementNS(h,f);e.attributes&&this.setAttributes(h,e.attributes);var g=e.value;null!=g&&h.appendChild(this.createTextNode(g));return h},setAttributes:function(g,f){var k,j,h;for(h in f){null!=f[h]&&f[h].toString&&(k=f[h].toString(),j=this.namespaces[h.substring(0,h.indexOf(":"))]||null,this.setAttributeNS(g,j,h,k))}},readNode:function(f,e){e||(e={});var h=this.readers[f.namespaceURI?this.namespaceAlias[f.namespaceURI]:this.defaultPrefix];if(h){var g=f.localName||f.nodeName.split(":").pop();(h=h[g]||h["*"])&&h.apply(this,[f,e])}return e},readChildNodes:function(h,g){g||(g={});for(var m=h.childNodes,l,k=0,j=m.length;k<j;++k){l=m[k],1==l.nodeType&&this.readNode(l,g)}return g},writeNode:function(g,f,k){var j,h=g.indexOf(":");0<h?(j=g.substring(0,h),g=g.substring(h+1)):j=k?this.namespaceAlias[k.namespaceURI]:this.defaultPrefix;f=this.writers[j][g].apply(this,[f]);k&&k.appendChild(f);return f},getChildEl:function(e,d,f){return e&&this.getThisOrNextEl(e.firstChild,d,f)},getNextEl:function(e,d,f){return e&&this.getThisOrNextEl(e.nextSibling,d,f)},getThisOrNextEl:function(e,d,f){e:for(;e;e=e.nextSibling){switch(e.nodeType){case 1:if((!d||d===(e.localName||e.nodeName.split(":").pop()))&&(!f||f===e.namespaceURI)){break e}e=null;break e;case 3:if(/^\s*$/.test(e.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:e=null;break e}}return e||null},lookupNamespaceURI:function(g,f){var k=null;if(g){if(g.lookupNamespaceURI){k=g.lookupNamespaceURI(f)}else{g:switch(g.nodeType){case 1:if(null!==g.namespaceURI&&g.prefix===f){k=g.namespaceURI;break g}if(k=g.attributes.length){for(var j,h=0;h<k;++h){if(j=g.attributes[h],"xmlns"===j.prefix&&j.name==="xmlns:"+f){k=j.value||null;break g}else{if("xmlns"===j.name&&null===f){k=j.value||null;break g}}}}k=this.lookupNamespaceURI(g.parentNode,f);break g;case 2:k=this.lookupNamespaceURI(g.ownerElement,f);break g;case 9:k=this.lookupNamespaceURI(g.documentElement,f);break g;case 6:case 12:case 10:case 11:break g;default:k=this.lookupNamespaceURI(g.parentNode,f)}}}return k},getXMLDoc:function(){!OpenLayers.Format.XML.document&&!this.xmldom&&(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")));return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.WFST=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Format.WFST.DEFAULTS),c=OpenLayers.Format.WFST["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported WFST version: "+d.version}return new c(d)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(b){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},getSrsName:function(e,d){var f=d&&d.srsName;f||(f=e&&e.layer?e.layer.projection.getCode():this.srsName);return f},read:function(e,d){d=d||{};OpenLayers.Util.applyDefaults(d,{output:"features"});"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var f={};e&&this.readNode(e,f,!0);f.features&&"features"===d.output&&(f=f.features);return f},readers:{wfs:{FeatureCollection:function(d,c){c.features=[];this.readChildNodes(d,c)}}},write:function(f,e){var h=this.writeNode("wfs:Transaction",{features:f,options:e}),g=this.schemaLocationAttr();g&&this.setAttributeNS(h,this.namespaces.xsi,"xsi:schemaLocation",g);return OpenLayers.Format.XML.prototype.write.apply(this,[h])},writers:{wfs:{GetFeature:function(f){var e=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:f&&f.handle,outputFormat:f&&f.outputFormat,maxFeatures:f&&f.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(f)}});if("string"==typeof this.featureType){this.writeNode("Query",f,e)}else{for(var h=0,g=this.featureType.length;h<g;h++){f.featureType=this.featureType[h],this.writeNode("Query",f,e)}}return e},Transaction:function(j){var j=j||{},h=j.options||{},p=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:h.handle}}),o,m=j.features;if(m){!0===h.multi&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"});var l,k,j=0;for(o=m.length;j<o;++j){k=m[j],(l=this.stateName[k.state])&&this.writeNode(l,{feature:k,options:h},p)}!0===h.multi&&this.setGeometryTypes()}if(h.nativeElements){j=0;for(o=h.nativeElements.length;j<o;++j){this.writeNode("wfs:Native",h.nativeElements[j],p)}}return p},Native:function(b){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:b.vendorId,safeToIgnore:b.safeToIgnore},value:b.value})},Insert:function(d){var c=d.feature,d=d.options,d=this.createElementNSPlus("wfs:Insert",{attributes:{handle:d&&d.handle}});this.srsName=this.getSrsName(c);this.writeNode("feature:_typeName",c,d);return d},Update:function(f){var e=f.feature,f=f.options,f=this.createElementNSPlus("wfs:Update",{attributes:{handle:f&&f.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&f.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var h=e.modified;if(null!==this.geometryName&&(!h||void 0!==h.geometry)){this.srsName=this.getSrsName(e),this.writeNode("Property",{name:this.geometryName,value:e.geometry},f)}for(var g in e.attributes){void 0!==e.attributes[g]&&(!h||!h.attributes||h.attributes&&void 0!==h.attributes[g])&&this.writeNode("Property",{name:g,value:e.attributes[g]},f)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[e.fid]}),f);return f},Property:function(d){var c=this.createElementNSPlus("wfs:Property");this.writeNode("Name",d.name,c);null!==d.value&&this.writeNode("Value",d.value,c);return c},Name:function(b){return this.createElementNSPlus("wfs:Name",{value:b})},Value:function(d){var c;d instanceof OpenLayers.Geometry?(c=this.createElementNSPlus("wfs:Value"),d=this.writeNode("feature:_geometry",d).firstChild,c.appendChild(d)):c=this.createElementNSPlus("wfs:Value",{value:d});return c},Delete:function(d){var c=d.feature,d=d.options,d=this.createElementNSPlus("wfs:Delete",{attributes:{handle:d&&d.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[c.fid]}),d);return d}}},schemaLocationAttr:function(f){var f=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},f),e=OpenLayers.Util.extend({},this.schemaLocations);f.schema&&(e[f.featurePrefix]=f.schema);var f=[],h,g;for(g in e){(h=this.namespaces[g])&&f.push(h+" "+e[g])}return f.join(" ")||void 0},setFilterProperty:function(e){if(e.filters){for(var d=0,f=e.filters.length;d<f;++d){OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[d])}}else{e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));var c={exceptionReport:null};d.documentElement&&(this.readChildNodes(d,c),null===c.exceptionReport&&(c=(new OpenLayers.Format.OWSCommon).read(d)));return c},readers:{ogc:{ServiceExceptionReport:function(d,c){c.exceptionReport={exceptions:[]};this.readChildNodes(d,c.exceptionReport)},ServiceException:function(e,d){var f={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};d.exceptions.push(f)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,errorProperty:null,name:null,stringifyOutput:!1,parser:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);b=this.CLASS_NAME;this.name=b.substring(b.lastIndexOf(".")+1)},getVersion:function(e,d){var f;e?(f=this.version,f||(f=e.getAttribute("version"),f||(f=this.defaultVersion))):f=d&&d.version||this.version||this.defaultVersion;return f},getParser:function(e){var e=e||this.defaultVersion,d=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var f=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+d];if(!f){throw"Can't find a "+this.name+" parser for version "+e+d}this.parser=new f(this.options)}return this.parser},write:function(e,d){this.parser=this.getParser(this.getVersion(null,d));var f=this.parser.write(e,d);return !1===this.stringifyOutput?f:OpenLayers.Format.XML.prototype.write.apply(this,[f])},read:function(g,f){"string"==typeof g&&(g=OpenLayers.Format.XML.prototype.read.apply(this,[g]));var k=this.getVersion(g.documentElement);this.parser=this.getParser(k);var j=this.parser.read(g,f);if(null!==this.errorProperty&&void 0===j[this.errorProperty]){var h=new OpenLayers.Format.OGCExceptionReport;j.error=h.read(g)}j.version=k;return j},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,d,f){this.layer=e;this.lonlat=d;this.data=null!=f?f:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup);null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker);this.data=this.lonlat=this.id=this.layer=null;null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null);null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var b=!1;null!=this.layer&&null!=this.layer.map&&(b=this.layer.map.getExtent().containsLonLat(this.lonlat));return b},createMarker:function(){null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(b){null!=this.lonlat&&(this.popup||(this.popup=new (this.popupClass?this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,b)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this);return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,d,f){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,d]);this.lonlat=null;this.geometry=e?e:null;this.state=null;this.attributes={};d&&(this.attributes=OpenLayers.Util.extend(this.attributes,d));this.style=f?f:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null);this.modified=this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(d){var c=!1;this.layer&&this.layer.map&&(c=this.layer.map.getExtent(),d?(d=this.geometry.getBounds(),c=c.intersectsBounds(d)):c=c.toGeometry().intersects(this.geometry));return c},getVisibility:function(){return !(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(f,e,h){var g=!1;this.geometry&&(g=this.geometry.atPoint(f,e,h));return g},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){var e="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e,d=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),f=this.layer.map.getResolution();this.geometry.move(f*(e.x-d.x),f*(d.y-e.y));this.layer.drawFeature(this);return d}},toState:function(b){if(b==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=b}}else{if(b==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=b}}else{if(b==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=b}}else{b==OpenLayers.State.UNKNOWN&&(this.state=b)}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(d,c){OpenLayers.Util.extend(this,c);this.rules=[];c&&c.rules&&this.addRules(c.rules);this.setDefaultStyle(d||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var d=0,c=this.rules.length;d<c;d++){this.rules[d].destroy(),this.rules[d]=null}this.defaultStyle=this.rules=null},createSymbolizer:function(k){for(var j=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),k),r=this.rules,q,p=[],o=!1,m=0,l=r.length;m<l;m++){q=r[m],q.evaluate(k)&&(q instanceof OpenLayers.Rule&&q.elseFilter?p.push(q):(o=!0,this.applySymbolizer(q,j,k)))}if(!1==o&&0<p.length){o=!0;m=0;for(l=p.length;m<l;m++){this.applySymbolizer(p[m],j,k)}}0<r.length&&!1==o&&(j.display="none");null!=j.label&&"string"!==typeof j.label&&(j.label=""+j.label);return j},applySymbolizer:function(f,e,h){var g=h.geometry?this.getSymbolizerPrefix(h.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],f=f.symbolizer[g]||f.symbolizer;!0===this.defaultsPerSymbolizer&&(g=this.defaultStyle,OpenLayers.Util.applyDefaults(f,{pointRadius:g.pointRadius}),(!0===f.stroke||!0===f.graphic)&&OpenLayers.Util.applyDefaults(f,{strokeWidth:g.strokeWidth,strokeColor:g.strokeColor,strokeOpacity:g.strokeOpacity,strokeDashstyle:g.strokeDashstyle,strokeLinecap:g.strokeLinecap}),(!0===f.fill||!0===f.graphic)&&OpenLayers.Util.applyDefaults(f,{fillColor:g.fillColor,fillOpacity:g.fillOpacity}),!0===f.graphic&&OpenLayers.Util.applyDefaults(f,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset}));return this.createLiterals(OpenLayers.Util.extend(e,f),h)},createLiterals:function(f,e){var h=OpenLayers.Util.extend({},e.attributes||e.data);OpenLayers.Util.extend(h,this.context);for(var g in this.propertyStyles){f[g]=OpenLayers.Style.createLiteral(f[g],h,e,g)}return f},findPropertyStyles:function(){var j={};this.addPropertyStyles(j,this.defaultStyle);for(var h=this.rules,p,o,m=0,l=h.length;m<l;m++){p=h[m].symbolizer;for(var k in p){if(o=p[k],"object"==typeof o){this.addPropertyStyles(j,o)}else{this.addPropertyStyles(j,p);break}}}return j},addPropertyStyles:function(f,e){var h,g;for(g in e){h=e[g],"string"==typeof h&&h.match(/\$\{\w+\}/)&&(f[g]=!0)}return f},addRules:function(b){Array.prototype.push.apply(this.rules,b);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(b){this.defaultStyle=b;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(f){for(var e=OpenLayers.Style.SYMBOLIZER_PREFIXES,h=0,g=e.length;h<g;h++){if(-1!=f.CLASS_NAME.indexOf(e[h])){return e[h]}}},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var d=0,f=this.rules.length;d<f;++d){e.rules.push(this.rules[d].clone())}}e.context=this.context&&OpenLayers.Util.extend({},this.context);d=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(d,e)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(f,e,h,g){"string"==typeof f&&-1!=f.indexOf("${")&&(f=OpenLayers.String.format(f,e,[h,g]),f=isNaN(f)||!f?f:parseFloat(f));return f};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(b){OpenLayers.Util.extend(this,b)},destroy:function(){},evaluate:function(){return !0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(b){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[b])},evaluate:function(e){for(var d=0,f=this.fids.length;d<f;d++){if((e.fid||e.id)==this.fids[d]){return !0}}return !1},clone:function(){var b=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(b,this);b.fids=this.fids.slice();return b},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(b){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[b])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var d,f;switch(this.type){case OpenLayers.Filter.Logical.AND:d=0;for(f=this.filters.length;d<f;d++){if(!1==this.filters[d].evaluate(e)){return !1}}return !0;case OpenLayers.Filter.Logical.OR:d=0;for(f=this.filters.length;d<f;d++){if(!0==this.filters[d].evaluate(e)){return !0}}return !1;case OpenLayers.Filter.Logical.NOT:return !this.filters[0].evaluate(e)}},clone:function(){for(var e=[],d=0,f=this.filters.length;d<f;++d){e.push(this.filters[d].clone())}return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(b){OpenLayers.Filter.prototype.initialize.apply(this,[b]);this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===b.matchCase&&(this.matchCase=null)},evaluate:function(d){d instanceof OpenLayers.Feature.Vector&&(d=d.attributes);var c=!1,d=d[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:c=this.value;c=!this.matchCase&&"string"==typeof d&&"string"==typeof c?d.toUpperCase()==c.toUpperCase():d==c;break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:c=this.value;c=!this.matchCase&&"string"==typeof d&&"string"==typeof c?d.toUpperCase()!=c.toUpperCase():d!=c;break;case OpenLayers.Filter.Comparison.LESS_THAN:c=d<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:c=d>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:c=d<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:c=d>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:c=d>=this.lowerBoundary&&d<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:c=RegExp(this.value,"gi").test(d)}return c},value2regex:function(e,d,f){if("."==e){throw Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison")}e=e?e:"*";d=d?d:".";this.value=this.value.replace(RegExp("\\"+(f?f:"!")+"(.|$)","g"),"\\$1");this.value=this.value.replace(RegExp("\\"+d,"g"),".");this.value=this.value.replace(RegExp("\\"+e,"g"),".*");this.value=this.value.replace(RegExp("\\\\.\\*","g"),"\\"+e);return this.value=this.value.replace(RegExp("\\\\\\.","g"),"\\"+d)},regex2value:function(){var b=this.value,b=b.replace(/!/g,"!!"),b=b.replace(/(\\)?\\\./g,function(d,e){return e?d:"!."}),b=b.replace(/(\\)?\\\*/g,function(d,e){return e?d:"!*"}),b=b.replace(/\\\\/g,"\\");return b=b.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(d){var c={};this.readers.ogc.Filter.apply(this,[d,c]);return c.filter},readers:{ogc:{_expression:function(e){for(var d="",f=e.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 1:e=this.readNode(f);e.property?d+="${"+e.property+"}":void 0!==e.value&&(d+=e.value);break;case 3:case 4:d+=f.nodeValue}}return d},Filter:function(e,d){var f={fids:[],filters:[]};this.readChildNodes(e,f);0<f.fids.length?d.filter=new OpenLayers.Filter.FeatureId({fids:f.fids}):0<f.filters.length&&(d.filter=f.filters[0])},FeatureId:function(e,d){var f=e.getAttribute("fid");f&&d.fids.push(f)},And:function(e,d){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,f);d.filters.push(f)},Or:function(e,d){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,f);d.filters.push(f)},Not:function(e,d){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLessThan:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsGreaterThan:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLessThanOrEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsGreaterThanOrEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsBetween:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,f);d.filters.push(f)},Literal:function(d,c){c.value=OpenLayers.String.numericIf(this.getChildValue(d))},PropertyName:function(d,c){c.property=this.getChildValue(d)},LowerBoundary:function(d,c){c.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,d))},UpperBoundary:function(d,c){c.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,d))},Intersects:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(d,c){c.distance=parseInt(this.getChildValue(d));c.distanceUnits=d.getAttribute("units")},Function:function(){}}},readSpatial:function(e,d,f){f=new OpenLayers.Filter.Spatial({type:f});this.readChildNodes(e,f);f.value=f.components[0];delete f.components;d.filters.push(f)},writeOgcExpression:function(e,d){if(e instanceof OpenLayers.Filter.Function){var f=this.writeNode("Function",e,d);d.appendChild(f)}else{this.writeNode("Literal",e,d)}return d},write:function(b){return this.writers.ogc.Filter.apply(this,[b])},writeFeatureIdNodes:function(f,e){for(var h=0,g=f.fids.length;h<g;++h){this.writeNode("FeatureId",f.fids[h],e)}},writers:{ogc:{Filter:function(d){var c=this.createElementNSPlus("ogc:Filter");"FID"===d.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,d,c):this.writeNode(this.getFilterType(d),d,c);return c},FeatureId:function(b){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:b}})},And:function(g){for(var f=this.createElementNSPlus("ogc:And"),k,j=0,h=g.filters.length;j<h;++j){k=g.filters[j],"FID"===k.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,k,f):this.writeNode(this.getFilterType(k),k,f)}return f},Or:function(g){for(var f=this.createElementNSPlus("ogc:Or"),k,j=0,h=g.filters.length;j<h;++j){k=g.filters[j],"FID"===k.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,k,f):this.writeNode(this.getFilterType(k),k,f)}return f},Not:function(d){var c=this.createElementNSPlus("ogc:Not"),d=d.filters[0];"FID"===d.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,d,c):this.writeNode(this.getFilterType(d),d,c);return c},PropertyIsLessThan:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsGreaterThan:function(d){var c=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsLessThanOrEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsGreaterThanOrEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsBetween:function(d){var c=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",d,c);this.writeNode("LowerBoundary",d,c);this.writeNode("UpperBoundary",d,c);return c},PropertyName:function(b){return this.createElementNSPlus("ogc:PropertyName",{value:b.property})},Literal:function(b){return this.createElementNSPlus("ogc:Literal",{value:b})},LowerBoundary:function(d){var c=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(d.lowerBoundary,c);return c},UpperBoundary:function(d){var c=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",d.upperBoundary,c);return c},INTERSECTS:function(b){return this.writeSpatial(b,"Intersects")},WITHIN:function(b){return this.writeSpatial(b,"Within")},CONTAINS:function(b){return this.writeSpatial(b,"Contains")},DWITHIN:function(d){var c=this.writeSpatial(d,"DWithin");this.writeNode("Distance",d,c);return c},Distance:function(b){return this.createElementNSPlus("ogc:Distance",{attributes:{units:b.distanceUnits},value:b.distance})},Function:function(f){for(var e=this.createElementNSPlus("ogc:Function",{attributes:{name:f.name}}),f=f.params,h=0,g=f.length;h<g;h++){this.writeOgcExpression(f[h],e)}return e}}},getFilterType:function(d){var c=this.filterMap[d.type];if(!c){throw"Filter writing not supported for rule type: "+d.type}return c},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(b){b&&(this.bounds=b.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(b){this.getBounds()?this.bounds.extend(b):this.setBounds(b)},getBounds:function(){null==this.bounds&&this.calculateBounds();return this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(f,e,h){var g=!1;null!=this.getBounds()&&null!=f&&(e=null!=e?e:0,h=null!=h?h:0,g=(new OpenLayers.Bounds(this.bounds.left-e,this.bounds.bottom-h,this.bounds.right+e,this.bounds.top+h)).containsLonLat(f));return g},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(f){var e;if(OpenLayers.Format&&OpenLayers.Format.WKT){var h=OpenLayers.Geometry.fromWKT.format;h||(h=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=h);f=h.read(f);if(f instanceof OpenLayers.Feature.Vector){e=f.geometry}else{if(OpenLayers.Util.isArray(f)){e=f.length;for(var h=Array(e),g=0;g<e;++g){h[g]=f[g].geometry}e=new OpenLayers.Geometry.Collection(h)}}}return e};OpenLayers.Geometry.segmentsIntersect=function(y,x,w){var v=w&&w.point,w=w&&w.tolerance,u=!1,t=y.x1-x.x1,s=y.y1-x.y1,r=y.x2-y.x1,q=y.y2-y.y1,p=x.y2-x.y1,o=x.x2-x.x1,m=p*r-o*q,p=o*s-p*t,s=r*s-q*t;0==m?0==p&&0==s&&(u=!0):(t=p/m,m=s/m,0<=t&&(1>=t&&0<=m&&1>=m)&&(v?(r=y.x1+t*r,m=y.y1+t*q,u=new OpenLayers.Geometry.Point(r,m)):u=!0));if(w){if(u){if(v){y=[y,x];x=0;y:for(;2>x;++x){t=y[x];for(q=1;3>q;++q){if(r=t["x"+q],m=t["y"+q],v=Math.sqrt(Math.pow(r-u.x,2)+Math.pow(m-u.y,2)),v<w){u.x=r;u.y=m;break y}}}}}else{y=[y,x];x=0;y:for(;2>x;++x){r=y[x];m=y[(x+1)%2];for(q=1;3>q;++q){if(t={x:r["x"+q],y:r["y"+q]},s=OpenLayers.Geometry.distanceToSegment(t,m),s.distance<w){u=v?new OpenLayers.Geometry.Point(t.x,t.y):!0;break y}}}}}return u};OpenLayers.Geometry.distanceToSegment=function(w,v){var u=w.x,t=w.y,s=v.x1,r=v.y1,q=v.x2,p=v.y2,o=q-s,m=p-r,l=(o*(u-s)+m*(t-r))/(Math.pow(o,2)+Math.pow(m,2));0>=l||(1<=l?(s=q,r=p):(s+=l*o,r+=l*m));return{distance:Math.sqrt(Math.pow(s-u,2)+Math.pow(r-t,2)),x:s,y:r}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(d,c){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(d);this.y=parseFloat(c)},clone:function(b){null==b&&(b=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(b,this);return b},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(k,j){var r=!(j&&!1===j.edge)&&j&&j.details,q,p,o,m,l;k instanceof OpenLayers.Geometry.Point?(p=this.x,o=this.y,m=k.x,l=k.y,q=Math.sqrt(Math.pow(p-m,2)+Math.pow(o-l,2)),q=!r?q:{x0:p,y0:o,x1:m,y1:l,distance:q}):(q=k.distanceTo(this,j),r&&(q={x0:q.x1,y0:q.y1,x1:q.x0,y1:q.y0,distance:q.distance}));return q},equals:function(d){var c=!1;null!=d&&(c=this.x==d.x&&this.y==d.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(d.x)&&isNaN(d.y));return c},toShortString:function(){return this.x+", "+this.y},move:function(d,c){this.x+=d;this.y+=c;this.clearBounds()},rotate:function(f,e){var f=f*(Math.PI/180),h=this.distanceTo(e),g=f+Math.atan2(this.y-e.y,this.x-e.x);this.x=e.x+h*Math.cos(g);this.y=e.y+h*Math.sin(g);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,d,f){this.x=d.x+e*(void 0==f?1:f)*(this.x-d.x);this.y=d.y+e*(this.y-d.y);this.clearBounds();return this},intersects:function(d){var c=!1;return c="OpenLayers.Geometry.Point"==d.CLASS_NAME?this.equals(d):d.intersects(this)},transform:function(d,c){d&&c&&(OpenLayers.Projection.transform(this,d,c),this.bounds=null);return this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=b&&this.addComponents(b)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var a=eval("new "+this.CLASS_NAME+"()"),b=0,c=this.components.length;b<c;b++){a.addComponent(this.components[b].clone())}OpenLayers.Util.applyDefaults(a,this);return a},getComponentsString:function(){for(var e=[],d=0,f=this.components.length;d<f;d++){e.push(this.components[d].toShortString())}return e.join(",")},calculateBounds:function(){this.bounds=null;var f=new OpenLayers.Bounds,e=this.components;if(e){for(var h=0,g=e.length;h<g;h++){f.extend(e[h].getBounds())}}null!=f.left&&(null!=f.bottom&&null!=f.right&&null!=f.top)&&this.setBounds(f)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var d=0,f=e.length;d<f;d++){this.addComponent(e[d])}},addComponent:function(f,e){var h=!1;if(f&&(null==this.componentTypes||-1<OpenLayers.Util.indexOf(this.componentTypes,f.CLASS_NAME))){if(null!=e&&e<this.components.length){var h=this.components.slice(0,e),g=this.components.slice(e,this.components.length);h.push(f);this.components=h.concat(g)}else{this.components.push(f)}f.parent=this;this.clearBounds();h=!0}return h},removeComponents:function(e){var d=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var f=e.length-1;0<=f;--f){d=this.removeComponent(e[f])||d}return d},removeComponent:function(b){OpenLayers.Util.removeItem(this.components,b);this.clearBounds();return !0},getLength:function(){for(var e=0,d=0,f=this.components.length;d<f;d++){e+=this.components[d].getLength()}return e},getArea:function(){for(var e=0,d=0,f=this.components.length;d<f;d++){e+=this.components[d].getArea()}return e},getGeodesicArea:function(f){for(var e=0,h=0,g=this.components.length;h<g;h++){e+=this.components[h].getGeodesicArea(f)}return e},getCentroid:function(s){if(!s){return this.components.length&&this.components[0].getCentroid()}s=this.components.length;if(!s){return !1}for(var r=[],q=[],p=0,o=Number.MAX_VALUE,m,l=0;l<s;++l){m=this.components[l];var k=m.getArea();m=m.getCentroid(!0);!isNaN(k)&&(!isNaN(m.x)&&!isNaN(m.y))&&(r.push(k),p+=k,o=k<o&&0<k?k:o,q.push(m))}s=r.length;if(0===p){for(l=0;l<s;++l){r[l]=1}p=r.length}else{for(l=0;l<s;++l){r[l]/=o}p/=o}for(var j=o=0,l=0;l<s;++l){m=q[l],k=r[l],o+=m.x*k,j+=m.y*k}return new OpenLayers.Geometry.Point(o/p,j/p)},getGeodesicLength:function(f){for(var e=0,h=0,g=this.components.length;h<g;h++){e+=this.components[h].getGeodesicLength(f)}return e},move:function(f,e){for(var h=0,g=this.components.length;h<g;h++){this.components[h].move(f,e)}},rotate:function(f,e){for(var h=0,g=this.components.length;h<g;++h){this.components[h].rotate(f,e)}},resize:function(f,e,h){for(var g=0;g<this.components.length;++g){this.components[g].resize(f,e,h)}return this},distanceTo:function(s,r){for(var q=!(r&&!1===r.edge)&&r&&r.details,p,o,m,l=Number.POSITIVE_INFINITY,k=0,j=this.components.length;k<j&&!(p=this.components[k].distanceTo(s,r),m=q?p.distance:p,m<l&&(l=m,o=p,0==l));++k){}return o},equals:function(f){var e=!0;if(!f||!f.CLASS_NAME||this.CLASS_NAME!=f.CLASS_NAME){e=!1}else{if(!OpenLayers.Util.isArray(f.components)||f.components.length!=this.components.length){e=!1}else{for(var h=0,g=this.components.length;h<g;++h){if(!this.components[h].equals(f.components[h])){e=!1;break}}}}return e},transform:function(f,e){if(f&&e){for(var h=0,g=this.components.length;h<g;h++){this.components[h].transform(f,e)}this.bounds=null}return this},intersects:function(f){for(var e=!1,h=0,g=this.components.length;h<g&&!(e=f.intersects(this.components[h]));++h){}return e},getVertices:function(f){for(var e=[],h=0,g=this.components.length;h<g;++h){Array.prototype.push.apply(e,this.components[h].getVertices(f))}return e},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(d,c){this.addComponent(d,c)},removePoint:function(b){this.removeComponent(b)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&1<this.components.length){for(var d=1,f=this.components.length;d<f;d++){e+=this.components[d-1].distanceTo(this.components[d])}}return e},getGeodesicLength:function(h){var g=this;if(h){var m=new OpenLayers.Projection("EPSG:4326");m.equals(h)||(g=this.clone().transform(h,m))}h=0;if(g.components&&1<g.components.length){for(var l,k=1,j=g.components.length;k<j;k++){m=g.components[k-1],l=g.components[k],h+=OpenLayers.Util.distVincenty({lon:m.x,lat:m.y},{lon:l.x,lat:l.y})}}return 1000*h},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(d){var c=this.components&&2<this.components.length;c&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return c},intersects:function(D){var C=!1,B=D.CLASS_NAME;if("OpenLayers.Geometry.LineString"==B||"OpenLayers.Geometry.LinearRing"==B||"OpenLayers.Geometry.Point"==B){var A=this.getSortedSegments(),D="OpenLayers.Geometry.Point"==B?[{x1:D.x,y1:D.y,x2:D.x,y2:D.y}]:D.getSortedSegments(),z,y,x,w,v,u,t,s=0,r=A.length;D:for(;s<r;++s){B=A[s];z=B.x1;y=B.x2;x=B.y1;w=B.y2;var q=0,p=D.length;for(;q<p;++q){v=D[q];if(v.x1>y){break}if(!(v.x2<z)&&(u=v.y1,t=v.y2,!(Math.min(u,t)>Math.max(x,w))&&!(Math.max(u,t)<Math.min(x,w))&&OpenLayers.Geometry.segmentsIntersect(B,v))){C=!0;break D}}}}else{C=D.intersects(this)}return C},getSortedSegments:function(){for(var g=this.components.length-1,f=Array(g),k,j,h=0;h<g;++h){k=this.components[h],j=this.components[h+1],f[h]=k.x<j.x?{x1:k.x,y1:k.y,x2:j.x,y2:j.y}:{x1:j.x,y1:j.y,x2:k.x,y2:k.y}}return f.sort(function(d,c){return d.x1-c.x1})},splitWithSegment:function(J,I){for(var H=!(I&&!1===I.edge),G=I&&I.tolerance,F=[],E=this.getVertices(),D=[],C=[],B=!1,A,z,y,x={point:!0,tolerance:G},w=null,v=0,u=E.length-2;v<=u;++v){if(G=E[v],D.push(G.clone()),A=E[v+1],z={x1:G.x,y1:G.y,x2:A.x,y2:A.y},z=OpenLayers.Geometry.segmentsIntersect(J,z,x),z instanceof OpenLayers.Geometry.Point&&((y=z.x===J.x1&&z.y===J.y1||z.x===J.x2&&z.y===J.y2||z.equals(G)||z.equals(A)?!0:!1)||H)){z.equals(C[C.length-1])||C.push(z.clone()),!(0===v&&z.equals(G))&&!z.equals(A)&&(B=!0,z.equals(G)||D.push(z),F.push(new OpenLayers.Geometry.LineString(D)),D=[z.clone()])}}B&&(D.push(A.clone()),F.push(new OpenLayers.Geometry.LineString(D)));if(0<C.length){var t=J.x1<J.x2?1:-1,s=J.y1<J.y2?1:-1,w={lines:F,points:C.sort(function(d,c){return t*d.x-t*c.x||s*d.y-s*c.y})}}return w},split:function(N,M){var L=null,K=M&&M.mutual,J,I,H,G;if(N instanceof OpenLayers.Geometry.LineString){var F=this.getVertices(),E,D,C,B,A,z=[];H=[];for(var y=0,x=F.length-2;y<=x;++y){E=F[y];D=F[y+1];C={x1:E.x,y1:E.y,x2:D.x,y2:D.y};G=G||[N];K&&z.push(E.clone());for(var w=0;w<G.length;++w){if(B=G[w].splitWithSegment(C,M)){if(A=B.lines,0<A.length&&(A.unshift(w,1),Array.prototype.splice.apply(G,A),w+=A.length-2),K){for(var v=0,u=B.points.length;v<u;++v){A=B.points[v],A.equals(E)||(z.push(A),H.push(new OpenLayers.Geometry.LineString(z)),z=A.equals(D)?[]:[A.clone()])}}}}}K&&(0<H.length&&0<z.length)&&(z.push(D.clone()),H.push(new OpenLayers.Geometry.LineString(z)))}else{L=N.splitWith(this,M)}G&&1<G.length?I=!0:G=[];H&&1<H.length?J=!0:H=[];if(I||J){L=K?[H,G]:G}return L},splitWith:function(d,c){return d.split(this,c)},getVertices:function(b){return !0===b?[this.components[0],this.components[this.components.length-1]]:!1===b?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(H,G){var F=!(G&&!1===G.edge)&&G&&G.details,E,D={},C=Number.POSITIVE_INFINITY;if(H instanceof OpenLayers.Geometry.Point){for(var B=this.getSortedSegments(),A=H.x,z=H.y,y,x=0,w=B.length;x<w;++x){if(y=B[x],E=OpenLayers.Geometry.distanceToSegment(H,y),E.distance<C){if(C=E.distance,D=E,0===C){break}}else{if(y.x2>A&&(z>y.y1&&z<y.y2||z<y.y1&&z>y.y2)){break}}}D=F?{distance:D.distance,x0:D.x,y0:D.y,x1:A,y1:z}:D.distance}else{if(H instanceof OpenLayers.Geometry.LineString){var B=this.getSortedSegments(),A=H.getSortedSegments(),v,u,t=A.length,s={point:!0},x=0,w=B.length;H:for(;x<w;++x){z=B[x];y=z.x1;u=z.y1;for(var r=0;r<t;++r){if(E=A[r],v=OpenLayers.Geometry.segmentsIntersect(z,E,s)){C=0;D={distance:0,x0:v.x,y0:v.y,x1:v.x,y1:v.y};break H}else{E=OpenLayers.Geometry.distanceToSegment({x:y,y:u},E),E.distance<C&&(C=E.distance,D={distance:C,x0:y,y0:u,x1:E.x,y1:E.y})}}}F||(D=D.distance);0!==C&&z&&(E=H.distanceTo(new OpenLayers.Geometry.Point(z.x2,z.y2),G),x=F?E.distance:E,x<C&&(D=F?{distance:C,x0:E.x1,y0:E.y1,x1:E.x0,y1:E.y0}:x))}else{D=H.distanceTo(this,G),F&&(D={distance:D.distance,x0:D.x1,y0:D.y1,x1:D.x0,y1:D.y0})}}return D},simplify:function(g){if(this&&null!==this){var f=this.getVertices();if(3>f.length){return this}var k=function(w,v,u,t){for(var s=0,r=0,q=v,p;q<u;q++){p=w[v];var e=w[u],c=w[q],c=Math.abs(0.5*(p.x*e.y+e.x*c.y+c.x*p.y-e.x*p.y-c.x*e.y-p.x*c.y));p=Math.sqrt(Math.pow(p.x-e.x,2)+Math.pow(p.y-e.y,2));p=2*(c/p);p>s&&(s=p,r=q)}s>t&&r!=v&&(h.push(r),k(w,v,r,t),k(w,r,u,t))},j=f.length-1,h=[];h.push(0);for(h.push(j);f[0].equals(f[j]);){j--,h.push(j)}k(f,0,j,g);g=[];h.sort(function(d,c){return d-c});for(j=0;j<h.length;j++){g.push(f[h[j]])}return new OpenLayers.Geometry.LineString(g)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(D,C){for(var B=null,A=C&&C.mutual,z,y,x,w,v=[],u=[D],t=0,s=this.components.length;t<s;++t){y=this.components[t];x=!1;for(var r=0;r<u.length;++r){if(z=y.split(u[r],C)){if(A){x=z[0];for(var q=0,p=x.length;q<p;++q){0===q&&v.length?v[v.length-1].addComponent(x[q]):v.push(new OpenLayers.Geometry.MultiLineString([x[q]]))}x=!0;z=z[1]}if(z.length){z.unshift(r,1);Array.prototype.splice.apply(u,z);break}}}x||(v.length?v[v.length-1].addComponent(y.clone()):v=[new OpenLayers.Geometry.MultiLineString(y.clone())])}v&&1<v.length?x=!0:v=[];u&&1<u.length?w=!0:u=[];if(x||w){B=A?[v,u]:u}return B},splitWith:function(B,A){var z=null,y=A&&A.mutual,x,w,v,u,t,s;if(B instanceof OpenLayers.Geometry.LineString){s=[];t=[B];for(var r=0,q=this.components.length;r<q;++r){v=!1;w=this.components[r];for(var p=0;p<t.length;++p){if(x=t[p].split(w,A)){y&&(v=x[0],v.length&&(v.unshift(p,1),Array.prototype.splice.apply(t,v),p+=v.length-2),x=x[1],0===x.length&&(x=[w.clone()]));v=0;for(var o=x.length;v<o;++v){0===v&&s.length?s[s.length-1].addComponent(x[v]):s.push(new OpenLayers.Geometry.MultiLineString([x[v]]))}v=!0}}v||(s.length?s[s.length-1].addComponent(w.clone()):s=[new OpenLayers.Geometry.MultiLineString([w.clone()])])}}else{z=B.split(this)}t&&1<t.length?u=!0:t=[];s&&1<s.length?v=!0:s=[];if(u||v){z=y?[t,s]:s}return z},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(f,e){var h=!1,g=this.components.pop();if(null!=e||!f.equals(g)){h=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]);return h},removeComponent:function(d){var c=this.components&&3<this.components.length;c&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]));return c},move:function(f,e){for(var h=0,g=this.components.length;h<g-1;h++){this.components[h].move(f,e)}},rotate:function(f,e){for(var h=0,g=this.components.length;h<g-1;++h){this.components[h].rotate(f,e)}},resize:function(g,f,k){for(var j=0,h=this.components.length;j<h-1;++j){this.components[j].resize(g,f,k)}return this},transform:function(f,e){if(f&&e){for(var h=0,g=this.components.length;h<g-1;h++){this.components[h].transform(f,e)}this.bounds=null}return this},getCentroid:function(){if(this.components&&2<this.components.length){for(var g=0,f=0,k=0;k<this.components.length-1;k++){var j=this.components[k],h=this.components[k+1],g=g+(j.x+h.x)*(j.x*h.y-h.x*j.y),f=f+(j.y+h.y)*(j.x*h.y-h.x*j.y)}k=-1*this.getArea();return new OpenLayers.Geometry.Point(g/(6*k),f/(6*k))}return null},getArea:function(){var g=0;if(this.components&&2<this.components.length){for(var f=g=0,k=this.components.length;f<k-1;f++){var j=this.components[f],h=this.components[f+1],g=g+(j.x+h.x)*(h.y-j.y)}g=-g/2}return g},getGeodesicArea:function(h){var g=this;if(h){var m=new OpenLayers.Projection("EPSG:4326");m.equals(h)||(g=this.clone().transform(h,m))}h=0;m=g.components&&g.components.length;if(2<m){for(var l,k,j=0;j<m-1;j++){l=g.components[j],k=g.components[j+1],h+=OpenLayers.Util.rad(k.x-l.x)*(2+Math.sin(OpenLayers.Util.rad(l.y))+Math.sin(OpenLayers.Util.rad(k.y)))}h=40680631590769*h/2}return h},containsPoint:function(w){for(var v=OpenLayers.Number.limitSigDigs,u=v(w.x,14),w=v(w.y,14),t=this.components.length-1,s,r,q,p,o,m=0,l=0;l<t;++l){if(s=this.components[l],q=v(s.x,14),s=v(s.y,14),r=this.components[l+1],p=v(r.x,14),r=v(r.y,14),s==r){if(w==s&&(q<=p&&u>=q&&u<=p||q>=p&&u<=q&&u>=p)){m=-1;break}}else{o=v((w-r)*((p-q)/(r-s))+p,14);if(o==u&&(s<r&&w>=s&&w<=r||s>r&&w<=s&&w>=r)){m=-1;break}o<=u||q!=p&&(o<Math.min(q,p)||o>Math.max(q,p))||(s<r&&w>=s&&w<r||s>r&&w<s&&w>=r)&&++m}}return -1==m?1:!!(m&1)},intersects:function(f){var e=!1;if("OpenLayers.Geometry.Point"==f.CLASS_NAME){e=this.containsPoint(f)}else{if("OpenLayers.Geometry.LineString"==f.CLASS_NAME){e=f.intersects(this)}else{if("OpenLayers.Geometry.LinearRing"==f.CLASS_NAME){e=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[f])}else{for(var h=0,g=f.components.length;h<g&&!(e=f.components[h].intersects(this));++h){}}}}return e},getVertices:function(b){return !0===b?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&0<this.components.length){for(var e=e+Math.abs(this.components[0].getArea()),d=1,f=this.components.length;d<f;d++){e-=Math.abs(this.components[d].getArea())}}return e},getGeodesicArea:function(f){var e=0;if(this.components&&0<this.components.length){for(var e=e+Math.abs(this.components[0].getGeodesicArea(f)),h=1,g=this.components.length;h<g;h++){e-=Math.abs(this.components[h].getGeodesicArea(f))}}return e},containsPoint:function(g){var f=this.components.length,k=!1;if(0<f&&(k=this.components[0].containsPoint(g),1!==k&&k&&1<f)){for(var j,h=1;h<f;++h){if(j=this.components[h].containsPoint(g)){k=1===j?1:!1;break}}}return k},intersects:function(g){var f=!1,k,j;if("OpenLayers.Geometry.Point"==g.CLASS_NAME){f=this.containsPoint(g)}else{if("OpenLayers.Geometry.LineString"==g.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==g.CLASS_NAME){k=0;for(j=this.components.length;k<j&&!(f=g.intersects(this.components[k]));++k){}if(!f){k=0;for(j=g.components.length;k<j&&!(f=this.containsPoint(g.components[k]));++k){}}}else{k=0;for(j=g.components.length;k<j&&!(f=this.intersects(g.components[k]));++k){}}}if(!f&&"OpenLayers.Geometry.Polygon"==g.CLASS_NAME){var h=this.components[0];k=0;for(j=h.components.length;k<j&&!(f=g.containsPoint(h.components[k]));++k){}}return f},distanceTo:function(d,c){return c&&!1===c.edge&&this.intersects(d)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[d,c])},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(k,j,r,q){var p=Math.PI*(1/r-0.5);q&&(p+=q/180*Math.PI);for(var o,m=[],l=0;l<r;++l){o=p+2*l*Math.PI/r,q=k.x+j*Math.cos(o),o=k.y+j*Math.sin(o),m.push(new OpenLayers.Geometry.Point(q,o))}k=new OpenLayers.Geometry.LinearRing(m);return new OpenLayers.Geometry.Polygon([k])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(b){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(f){"string"==typeof f&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));for(var f=this.getElementsByTagNameNS(f.documentElement,this.gmlns,this.featureName),e=[],h=0;h<f.length;h++){var g=this.parseFeature(f[h]);g&&e.push(g)}return e},parseFeature:function(s){for(var r="MultiPolygon Polygon MultiLineString LineString MultiPoint Point Envelope".split(" "),q,p,o,m=0;m<r.length;++m){if(q=r[m],p=this.getElementsByTagNameNS(s,this.gmlns,q),0<p.length){if(o=this.parseGeometry[q.toLowerCase()]){o=o.apply(this,[p[0]]),this.internalProjection&&this.externalProjection&&o.transform(this.externalProjection,this.internalProjection)}else{throw new TypeError("Unsupported geometry type: "+q)}break}}var l;q=this.getElementsByTagNameNS(s,this.gmlns,"Box");for(m=0;m<q.length;++m){r=q[m],p=this.parseGeometry.box.apply(this,[r]),r=r.parentNode,"boundedBy"===(r.localName||r.nodeName.split(":").pop())?l=p:o=p.toGeometry()}var k;this.extractAttributes&&(k=this.parseAttributes(s));k=new OpenLayers.Feature.Vector(o,k);k.bounds=l;k.gml={featureType:s.firstChild.nodeName.split(":")[1],featureNS:s.firstChild.namespaceURI,featureNSPrefix:s.firstChild.prefix};for(var s=s.firstChild,j;s&&!(1==s.nodeType&&(j=s.getAttribute("fid")||s.getAttribute("id")));){s=s.nextSibling}k.fid=j;return k},parseGeometry:{point:function(e){var d,f;f=[];d=this.getElementsByTagNameNS(e,this.gmlns,"pos");0<d.length&&(f=d[0].firstChild.nodeValue,f=f.replace(this.regExes.trimSpace,""),f=f.split(this.regExes.splitSpace));0==f.length&&(d=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),0<d.length&&(f=d[0].firstChild.nodeValue,f=f.replace(this.regExes.removeSpace,""),f=f.split(",")));0==f.length&&(d=this.getElementsByTagNameNS(e,this.gmlns,"coord"),0<d.length&&(e=this.getElementsByTagNameNS(d[0],this.gmlns,"X"),d=this.getElementsByTagNameNS(d[0],this.gmlns,"Y"),0<e.length&&0<d.length&&(f=[e[0].firstChild.nodeValue,d[0].firstChild.nodeValue])));2==f.length&&(f[2]=null);return this.xy?new OpenLayers.Geometry.Point(f[0],f[1],f[2]):new OpenLayers.Geometry.Point(f[1],f[0],f[2])},multipoint:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"Point"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.point.apply(this,[f[g]]))&&e.push(h)}}return new OpenLayers.Geometry.MultiPoint(e)},linestring:function(s,r){var q,p;p=[];var o=[];q=this.getElementsByTagNameNS(s,this.gmlns,"posList");if(0<q.length){p=this.getChildValue(q[0]);p=p.replace(this.regExes.trimSpace,"");p=p.split(this.regExes.splitSpace);var m=parseInt(q[0].getAttribute("dimension")),l,k,j;for(q=0;q<p.length/m;++q){l=q*m,k=p[l],j=p[l+1],l=2==m?null:p[l+2],this.xy?o.push(new OpenLayers.Geometry.Point(k,j,l)):o.push(new OpenLayers.Geometry.Point(j,k,l))}}if(0==p.length&&(q=this.getElementsByTagNameNS(s,this.gmlns,"coordinates"),0<q.length)){p=this.getChildValue(q[0]);p=p.replace(this.regExes.trimSpace,"");p=p.replace(this.regExes.trimComma,",");m=p.split(this.regExes.splitSpace);for(q=0;q<m.length;++q){p=m[q].split(","),2==p.length&&(p[2]=null),this.xy?o.push(new OpenLayers.Geometry.Point(p[0],p[1],p[2])):o.push(new OpenLayers.Geometry.Point(p[1],p[0],p[2]))}}p=null;0!=o.length&&(p=r?new OpenLayers.Geometry.LinearRing(o):new OpenLayers.Geometry.LineString(o));return p},multilinestring:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"LineString"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.linestring.apply(this,[f[g]]))&&e.push(h)}}return new OpenLayers.Geometry.MultiLineString(e)},polygon:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"LinearRing"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.linestring.apply(this,[f[g],!0]))&&e.push(h)}}return new OpenLayers.Geometry.Polygon(e)},multipolygon:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"Polygon"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.polygon.apply(this,[f[g]]))&&e.push(h)}}return new OpenLayers.Geometry.MultiPolygon(e)},envelope:function(j){var h=[],p,o,m=this.getElementsByTagNameNS(j,this.gmlns,"lowerCorner");if(0<m.length){p=[];0<m.length&&(p=m[0].firstChild.nodeValue,p=p.replace(this.regExes.trimSpace,""),p=p.split(this.regExes.splitSpace));2==p.length&&(p[2]=null);var l=this.xy?new OpenLayers.Geometry.Point(p[0],p[1],p[2]):new OpenLayers.Geometry.Point(p[1],p[0],p[2])}j=this.getElementsByTagNameNS(j,this.gmlns,"upperCorner");if(0<j.length){p=[];0<j.length&&(p=j[0].firstChild.nodeValue,p=p.replace(this.regExes.trimSpace,""),p=p.split(this.regExes.splitSpace));2==p.length&&(p[2]=null);var k=this.xy?new OpenLayers.Geometry.Point(p[0],p[1],p[2]):new OpenLayers.Geometry.Point(p[1],p[0],p[2])}l&&k&&(h.push(new OpenLayers.Geometry.Point(l.x,l.y)),h.push(new OpenLayers.Geometry.Point(k.x,l.y)),h.push(new OpenLayers.Geometry.Point(k.x,k.y)),h.push(new OpenLayers.Geometry.Point(l.x,k.y)),h.push(new OpenLayers.Geometry.Point(l.x,l.y)),h=new OpenLayers.Geometry.LinearRing(h),o=new OpenLayers.Geometry.Polygon([h]));return o},box:function(e){var d=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),f=e=null;0<d.length&&(d=d[0].firstChild.nodeValue,d=d.split(" "),2==d.length&&(e=d[0].split(","),f=d[1].split(",")));if(null!==e&&null!==f){return new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(f[0]),parseFloat(f[1]))}}},parseAttributes:function(g){for(var f={},g=g.firstChild,k,j,h;g;){if(1==g.nodeType){g=g.childNodes;for(k=0;k<g.length;++k){if(j=g[k],1==j.nodeType){if(h=j.childNodes,1==h.length){if(h=h[0],3==h.nodeType||4==h.nodeType){j=j.prefix?j.nodeName.split(":")[1]:j.nodeName,h=h.nodeValue.replace(this.regExes.trimSpace,""),f[j]=h}}else{f[j.nodeName.split(":").pop()]=null}}}break}g=g.nextSibling}return f},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var d=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),f=0;f<e.length;f++){d.appendChild(this.createFeatureXML(e[f]))}return OpenLayers.Format.XML.prototype.write.apply(this,[d])},createFeatureXML:function(h){var g=this.buildGeometryNode(h.geometry),m=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);m.appendChild(g);var g=this.createElementNS(this.gmlns,"gml:"+this.featureName),l=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);l.setAttribute("fid",h.fid||h.id);l.appendChild(m);for(var k in h.attributes){var m=this.createTextNode(h.attributes[k]),j=this.createElementNS(this.featureNS,this.featurePrefix+":"+k.substring(k.lastIndexOf(":")+1));j.appendChild(m);l.appendChild(j)}g.appendChild(l);return g},buildGeometryNode:function(d){this.externalProjection&&this.internalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));var c=d.CLASS_NAME;return this.buildGeometry[c.substring(c.lastIndexOf(".")+1).toLowerCase()].apply(this,[d])},buildGeometry:{point:function(d){var c=this.createElementNS(this.gmlns,"gml:Point");c.appendChild(this.buildCoordinatesNode(d));return c},multipoint:function(g){for(var f=this.createElementNS(this.gmlns,"gml:MultiPoint"),g=g.components,k,j,h=0;h<g.length;h++){k=this.createElementNS(this.gmlns,"gml:pointMember"),j=this.buildGeometry.point.apply(this,[g[h]]),k.appendChild(j),f.appendChild(k)}return f},linestring:function(d){var c=this.createElementNS(this.gmlns,"gml:LineString");c.appendChild(this.buildCoordinatesNode(d));return c},multilinestring:function(g){for(var f=this.createElementNS(this.gmlns,"gml:MultiLineString"),g=g.components,k,j,h=0;h<g.length;++h){k=this.createElementNS(this.gmlns,"gml:lineStringMember"),j=this.buildGeometry.linestring.apply(this,[g[h]]),k.appendChild(j),f.appendChild(k)}return f},linearring:function(d){var c=this.createElementNS(this.gmlns,"gml:LinearRing");c.appendChild(this.buildCoordinatesNode(d));return c},polygon:function(g){for(var f=this.createElementNS(this.gmlns,"gml:Polygon"),g=g.components,k,j,h=0;h<g.length;++h){k=0==h?"outerBoundaryIs":"innerBoundaryIs",k=this.createElementNS(this.gmlns,"gml:"+k),j=this.buildGeometry.linearring.apply(this,[g[h]]),k.appendChild(j),f.appendChild(k)}return f},multipolygon:function(g){for(var f=this.createElementNS(this.gmlns,"gml:MultiPolygon"),g=g.components,k,j,h=0;h<g.length;++h){k=this.createElementNS(this.gmlns,"gml:polygonMember"),j=this.buildGeometry.polygon.apply(this,[g[h]]),k.appendChild(j),f.appendChild(k)}return f},bounds:function(d){var c=this.createElementNS(this.gmlns,"gml:Box");c.appendChild(this.buildCoordinatesNode(d));return c}},buildCoordinatesNode:function(f){var e=this.createElementNS(this.gmlns,"gml:coordinates");e.setAttribute("decimal",".");e.setAttribute("cs",",");e.setAttribute("ts"," ");var h=[];if(f instanceof OpenLayers.Bounds){h.push(f.left+","+f.bottom),h.push(f.right+","+f.top)}else{for(var f=f.components?f.components:[f],g=0;g<f.length;g++){h.push(f[g].x+","+f[g].y)}}h=this.createTextNode(h.join(" "));e.appendChild(h);return e},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.setGeometryTypes();b&&b.featureNS&&this.setNamespace("feature",b.featureNS);this.singleFeatureType=!b||typeof b.featureType==="string"},read:function(f){typeof f=="string"&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));if(f&&f.nodeType==9){f=f.documentElement}var e=[];this.readNode(f,{features:e},true);if(e.length==0){var h=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMember");if(h.length){for(var f=0,g=h.length;f<g;++f){this.readNode(h[f],{features:e},true)}}else{h=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMembers");h.length&&this.readNode(h[0],{features:e},true)}}return e},readNode:function(e,d,f){if(f===true&&this.autoConfig===true){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces.feature;this.featureNS=null}if(!this.featureNS&&!(e.prefix in this.namespaces)&&e.parentNode.namespaceURI==this.namespaces.gml&&this.regExes.featureMember.test(e.parentNode.nodeName)){this.featureType=e.nodeName.split(":").pop();this.setNamespace("feature",e.namespaceURI);this.featureNS=e.namespaceURI;this.autoConfig=true}return OpenLayers.Format.XML.prototype.readNode.apply(this,[e,d])},readers:{gml:{featureMember:function(d,c){this.readChildNodes(d,c)},featureMembers:function(d,c){this.readChildNodes(d,c)},name:function(d,c){c.name=this.getChildValue(d)},boundedBy:function(e,d){var f={};this.readChildNodes(e,f);if(f.components&&f.components.length>0){d.bounds=f.components[0]}},Point:function(e,d){var f={points:[]};this.readChildNodes(e,f);if(!d.components){d.components=[]}d.components.push(f.points[0])},coordinates:function(j,h){for(var p=this.getChildValue(j).replace(this.regExes.trimSpace,""),p=p.replace(this.regExes.trimComma,","),p=p.split(this.regExes.splitSpace),o,m=p.length,l=Array(m),k=0;k<m;++k){o=p[k].split(",");l[k]=this.xy?new OpenLayers.Geometry.Point(o[0],o[1],o[2]):new OpenLayers.Geometry.Point(o[1],o[0],o[2])}h.points=l},coord:function(e,d){var f={};this.readChildNodes(e,f);if(!d.points){d.points=[]}d.points.push(new OpenLayers.Geometry.Point(f.x,f.y,f.z))},X:function(d,c){c.x=this.getChildValue(d)},Y:function(d,c){c.y=this.getChildValue(d)},Z:function(d,c){c.z=this.getChildValue(d)},MultiPoint:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.MultiPoint(f.components)]},pointMember:function(d,c){this.readChildNodes(d,c)},LineString:function(e,d){var f={};this.readChildNodes(e,f);if(!d.components){d.components=[]}d.components.push(new OpenLayers.Geometry.LineString(f.points))},MultiLineString:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.MultiLineString(f.components)]},lineStringMember:function(d,c){this.readChildNodes(d,c)},Polygon:function(e,d){var f={outer:null,inner:[]};this.readChildNodes(e,f);f.inner.unshift(f.outer);if(!d.components){d.components=[]}d.components.push(new OpenLayers.Geometry.Polygon(f.inner))},LinearRing:function(e,d){var f={};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.LinearRing(f.points)]},MultiPolygon:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.MultiPolygon(f.components)]},polygonMember:function(d,c){this.readChildNodes(d,c)},GeometryCollection:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.Collection(f.components)]},geometryMember:function(d,c){this.readChildNodes(d,c)}},feature:{"*":function(f,e){var h,g=f.localName||f.nodeName.split(":").pop();e.features?!this.singleFeatureType&&OpenLayers.Util.indexOf(this.featureType,g)!==-1?h="_typeName":g===this.featureType&&(h="_typeName"):f.childNodes.length==0||f.childNodes.length==1&&f.firstChild.nodeType==3?this.extractAttributes&&(h="_attribute"):h="_geometry";h&&this.readers.feature[h].apply(this,[f,e])},_typeName:function(g,f){var k={components:[],attributes:{}};this.readChildNodes(g,k);if(k.name){k.attributes.name=k.name}var j=new OpenLayers.Feature.Vector(k.components[0],k.attributes);if(!this.singleFeatureType){j.type=g.nodeName.split(":").pop();j.namespace=g.namespaceURI}var h=g.getAttribute("fid")||this.getAttributeNS(g,this.namespaces.gml,"id");if(h){j.fid=h}this.internalProjection&&(this.externalProjection&&j.geometry)&&j.geometry.transform(this.externalProjection,this.internalProjection);if(k.bounds){j.bounds=k.bounds}f.features.push(j)},_geometry:function(d,c){if(!this.geometryName){this.geometryName=d.nodeName.split(":").pop()}this.readChildNodes(d,c)},_attribute:function(f,e){var h=f.localName||f.nodeName.split(":").pop(),g=this.getChildValue(f);e.attributes[h]=g}},wfs:{FeatureCollection:function(d,c){this.readChildNodes(d,c)}}},write:function(b){b=this.writeNode("gml:"+(OpenLayers.Util.isArray(b)?"featureMembers":"featureMember"),b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{gml:{featureMember:function(d){var c=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",d,c);return c},MultiPoint:function(f){for(var e=this.createElementNSPlus("gml:MultiPoint"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("pointMember",f[h],e)}return e},pointMember:function(d){var c=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",d,c);return c},MultiLineString:function(f){for(var e=this.createElementNSPlus("gml:MultiLineString"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("lineStringMember",f[h],e)}return e},lineStringMember:function(d){var c=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",d,c);return c},MultiPolygon:function(f){for(var e=this.createElementNSPlus("gml:MultiPolygon"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("polygonMember",f[h],e)}return e},polygonMember:function(d){var c=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",d,c);return c},GeometryCollection:function(f){for(var e=this.createElementNSPlus("gml:GeometryCollection"),h=0,g=f.components.length;h<g;++h){this.writeNode("geometryMember",f.components[h],e)}return e},geometryMember:function(d){var c=this.createElementNSPlus("gml:geometryMember"),d=this.writeNode("feature:_geometry",d);c.appendChild(d.firstChild);return c}},feature:{_typeName:function(f){var e=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:f.fid}});f.geometry&&this.writeNode("feature:_geometry",f.geometry,e);for(var h in f.attributes){var g=f.attributes[h];g!=null&&this.writeNode("feature:_attribute",{name:h,value:g},e)}return e},_geometry:function(d){this.externalProjection&&this.internalProjection&&(d=d.clone().transform(this.internalProjection,this.externalProjection));var c=this.createElementNSPlus("feature:"+this.geometryName),d=this.writeNode("gml:"+this.geometryTypes[d.CLASS_NAME],d,c);this.srsName&&d.setAttribute("srsName",this.srsName);return c},_attribute:function(b){return this.createElementNSPlus("feature:"+b.name,{value:b.value})}},wfs:{FeatureCollection:function(f){for(var e=this.createElementNSPlus("wfs:FeatureCollection"),h=0,g=f.length;h<g;++h){this.writeNode("gml:featureMember",f[h],e)}return e}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(b){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[b])},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(d,c){this.readChildNodes(d,c)},Curve:function(e,d){var f={points:[]};this.readChildNodes(e,f);d.components||(d.components=[]);d.components.push(new OpenLayers.Geometry.LineString(f.points))},segments:function(d,c){this.readChildNodes(d,c)},LineStringSegment:function(e,d){var f={};this.readChildNodes(e,f);f.points&&Array.prototype.push.apply(d.points,f.points)},pos:function(e,d){var f=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),f=this.xy?new OpenLayers.Geometry.Point(f[0],f[1],f[2]):new OpenLayers.Geometry.Point(f[1],f[0],f[2]);d.points=[f]},posList:function(u,t){for(var s=this.getChildValue(u).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),r=parseInt(u.getAttribute("dimension"))||2,q,p,o,m=Array(s.length/r),l=0,k=s.length;l<k;l+=r){q=s[l],p=s[l+1],o=2==r?void 0:s[l+2],m[l/r]=this.xy?new OpenLayers.Geometry.Point(q,p,o):new OpenLayers.Geometry.Point(p,q,o)}t.points=m},Surface:function(d,c){this.readChildNodes(d,c)},patches:function(d,c){this.readChildNodes(d,c)},PolygonPatch:function(d,c){this.readers.gml.Polygon.apply(this,[d,c])},exterior:function(e,d){var f={};this.readChildNodes(e,f);d.outer=f.components[0]},interior:function(e,d){var f={};this.readChildNodes(e,f);d.inner.push(f.components[0])},MultiCurve:function(e,d){var f={components:[]};this.readChildNodes(e,f);0<f.components.length&&(d.components=[new OpenLayers.Geometry.MultiLineString(f.components)])},curveMember:function(d,c){this.readChildNodes(d,c)},MultiSurface:function(e,d){var f={components:[]};this.readChildNodes(e,f);0<f.components.length&&(d.components=[new OpenLayers.Geometry.MultiPolygon(f.components)])},surfaceMember:function(d,c){this.readChildNodes(d,c)},surfaceMembers:function(d,c){this.readChildNodes(d,c)},pointMembers:function(d,c){this.readChildNodes(d,c)},lineStringMembers:function(d,c){this.readChildNodes(d,c)},polygonMembers:function(d,c){this.readChildNodes(d,c)},geometryMembers:function(d,c){this.readChildNodes(d,c)},Envelope:function(f,e){var h={points:Array(2)};this.readChildNodes(f,h);e.components||(e.components=[]);var g=h.points[0],h=h.points[1];e.components.push(new OpenLayers.Bounds(g.x,g.y,h.x,h.y))},lowerCorner:function(e,d){var f={};this.readers.gml.pos.apply(this,[e,f]);d.points[0]=f.points[0]},upperCorner:function(e,d){var f={};this.readers.gml.pos.apply(this,[e,f]);d.points[1]=f.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(b){b=this.writeNode("gml:"+(OpenLayers.Util.isArray(b)?"featureMembers":"featureMember"),b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(f){for(var e=this.createElementNSPlus("gml:featureMembers"),h=0,g=f.length;h<g;++h){this.writeNode("feature:_typeName",f[h],e)}return e},Point:function(d){var c=this.createElementNSPlus("gml:Point");this.writeNode("pos",d,c);return c},pos:function(b){return this.createElementNSPlus("gml:pos",{value:this.xy?b.x+" "+b.y:b.y+" "+b.x})},LineString:function(d){var c=this.createElementNSPlus("gml:LineString");this.writeNode("posList",d.components,c);return c},Curve:function(d){var c=this.createElementNSPlus("gml:Curve");this.writeNode("segments",d,c);return c},segments:function(d){var c=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",d,c);return c},LineStringSegment:function(d){var c=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",d.components,c);return c},posList:function(g){for(var f=g.length,k=Array(f),j,h=0;h<f;++h){j=g[h],k[h]=this.xy?j.x+" "+j.y:j.y+" "+j.x}return this.createElementNSPlus("gml:posList",{value:k.join(" ")})},Surface:function(d){var c=this.createElementNSPlus("gml:Surface");this.writeNode("patches",d,c);return c},patches:function(d){var c=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",d,c);return c},PolygonPatch:function(f){var e=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",f.components[0],e);for(var h=1,g=f.components.length;h<g;++h){this.writeNode("interior",f.components[h],e)}return e},Polygon:function(f){var e=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",f.components[0],e);for(var h=1,g=f.components.length;h<g;++h){this.writeNode("interior",f.components[h],e)}return e},exterior:function(d){var c=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",d,c);return c},interior:function(d){var c=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",d,c);return c},LinearRing:function(d){var c=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",d.components,c);return c},MultiCurve:function(f){for(var e=this.createElementNSPlus("gml:MultiCurve"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("curveMember",f[h],e)}return e},curveMember:function(d){var c=this.createElementNSPlus("gml:curveMember");this.curve?this.writeNode("Curve",d,c):this.writeNode("LineString",d,c);return c},MultiSurface:function(f){for(var e=this.createElementNSPlus("gml:MultiSurface"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("surfaceMember",f[h],e)}return e},surfaceMember:function(d){var c=this.createElementNSPlus("gml:surfaceMember");this.surface?this.writeNode("Surface",d,c):this.writeNode("Polygon",d,c);return c},Envelope:function(d){var c=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",d,c);this.writeNode("upperCorner",d,c);this.srsName&&c.setAttribute("srsName",this.srsName);return c},lowerCorner:function(b){return this.createElementNSPlus("gml:lowerCorner",{value:this.xy?b.left+" "+b.bottom:b.bottom+" "+b.left})},upperCorner:function(b){return this.createElementNSPlus("gml:upperCorner",{value:this.xy?b.right+" "+b.top:b.top+" "+b.right})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.curve?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":!0===this.surface?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(b){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[b])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,d){var f=e.getAttribute("matchCase"),f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===f||"0"===f)});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsNotEqualTo:function(e,d){var f=e.getAttribute("matchCase"),f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===f||"0"===f)});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLike:function(h,g){var m=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(h,m);var l=h.getAttribute("wildCard"),k=h.getAttribute("singleChar"),j=h.getAttribute("escapeChar");m.value2regex(l,k,j);g.filters.push(m)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:d.matchCase}});this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsNotEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:d.matchCase}});this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsLike:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:d.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",d,c);this.writeNode("Literal",d.regex2value(),c);return c},BBOX:function(e){var d=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,d);var f=this.writeNode("gml:Envelope",e.value);e.projection&&f.setAttribute("srsName",e.projection);d.appendChild(f);return d},SortBy:function(f){for(var e=this.createElementNSPlus("ogc:SortBy"),h=0,g=f.length;h<g;h++){this.writeNode("ogc:SortProperty",f[h],e)}return e},SortProperty:function(d){var c=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",d,c);this.writeNode("ogc:SortOrder","DESC"==d.order?"DESC":"ASC",c);return c},SortOrder:function(b){return this.createElementNSPlus("ogc:SortOrder",{value:b})}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(f,e){var h=this.createElementNSPlus("ogc:"+e);this.writeNode("PropertyName",f,h);if(f.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",f.value,h)}else{var g;g=f.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",f.value).firstChild:this.writeNode("gml:Envelope",f.value);f.projection&&g.setAttribute("srsName",f.projection);h.appendChild(g)}return h},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(d){var c=this.version;c||((d=d.getAttribute("xmlns:ows"))&&"1.1"===d.substring(d.lastIndexOf("/")+1)&&(c="1.1.0"),c||(c=this.defaultVersion));return c},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,d){OpenLayers.Util.applyDefaults(d,this.options);var f={};this.readChildNodes(e,f);return f},readers:{ows:{Exception:function(e,d){var f={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};d.exceptions.push(f);this.readChildNodes(e,f)},ExceptionText:function(e,d){var f=this.getChildValue(e);d.texts.push(f)},ServiceIdentification:function(d,c){c.serviceIdentification={};this.readChildNodes(d,c.serviceIdentification)},Title:function(d,c){c.title=this.getChildValue(d)},Abstract:function(d,c){c["abstract"]=this.getChildValue(d)},Keywords:function(d,c){c.keywords={};this.readChildNodes(d,c.keywords)},Keyword:function(d,c){c[this.getChildValue(d)]=!0},ServiceType:function(d,c){c.serviceType={codeSpace:d.getAttribute("codeSpace"),value:this.getChildValue(d)}},ServiceTypeVersion:function(d,c){c.serviceTypeVersion=this.getChildValue(d)},Fees:function(d,c){c.fees=this.getChildValue(d)},AccessConstraints:function(d,c){c.accessConstraints=this.getChildValue(d)},ServiceProvider:function(d,c){c.serviceProvider={};this.readChildNodes(d,c.serviceProvider)},ProviderName:function(d,c){c.providerName=this.getChildValue(d)},ProviderSite:function(d,c){c.providerSite=this.getAttributeNS(d,this.namespaces.xlink,"href")},ServiceContact:function(d,c){c.serviceContact={};this.readChildNodes(d,c.serviceContact)},IndividualName:function(d,c){c.individualName=this.getChildValue(d)},PositionName:function(d,c){c.positionName=this.getChildValue(d)},ContactInfo:function(d,c){c.contactInfo={};this.readChildNodes(d,c.contactInfo)},Phone:function(d,c){c.phone={};this.readChildNodes(d,c.phone)},Voice:function(d,c){c.voice=this.getChildValue(d)},Address:function(d,c){c.address={};this.readChildNodes(d,c.address)},DeliveryPoint:function(d,c){c.deliveryPoint=this.getChildValue(d)},City:function(d,c){c.city=this.getChildValue(d)},AdministrativeArea:function(d,c){c.administrativeArea=this.getChildValue(d)},PostalCode:function(d,c){c.postalCode=this.getChildValue(d)},Country:function(d,c){c.country=this.getChildValue(d)},ElectronicMailAddress:function(d,c){c.electronicMailAddress=this.getChildValue(d)},Role:function(d,c){c.role=this.getChildValue(d)},OperationsMetadata:function(d,c){c.operationsMetadata={};this.readChildNodes(d,c.operationsMetadata)},Operation:function(e,d){var f=e.getAttribute("name");d[f]={};this.readChildNodes(e,d[f])},DCP:function(d,c){c.dcp={};this.readChildNodes(d,c.dcp)},HTTP:function(d,c){c.http={};this.readChildNodes(d,c.http)},Get:function(e,d){d.get||(d.get=[]);var f={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,f);d.get.push(f)},Post:function(e,d){d.post||(d.post=[]);var f={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,f);d.post.push(f)},Parameter:function(e,d){d.parameters||(d.parameters={});var f=e.getAttribute("name");d.parameters[f]={};this.readChildNodes(e,d.parameters[f])},Constraint:function(e,d){d.constraints||(d.constraints={});var f=e.getAttribute("name");d.constraints[f]={};this.readChildNodes(e,d.constraints[f])},Value:function(d,c){c[this.getChildValue(d)]=!0},OutputFormat:function(d,c){c.formats.push({value:this.getChildValue(d)});this.readChildNodes(d,c)},WGS84BoundingBox:function(e,d){var f={};f.crs=e.getAttribute("crs");d.BoundingBox?d.BoundingBox.push(f):(d.projection=f.crs,f=d);this.readChildNodes(e,f)},BoundingBox:function(d,c){this.readers.ows.WGS84BoundingBox.apply(this,[d,c])},LowerCorner:function(e,d){var f=this.getChildValue(e).replace(this.regExes.trimSpace,""),f=f.replace(this.regExes.trimComma,","),f=f.split(this.regExes.splitSpace);d.left=f[0];d.bottom=f[1]},UpperCorner:function(e,d){var f=this.getChildValue(e).replace(this.regExes.trimSpace,""),f=f.replace(this.regExes.trimComma,","),f=f.split(this.regExes.splitSpace);d.right=f[0];d.top=f[1];d.bounds=new OpenLayers.Bounds(d.left,d.bottom,d.right,d.top);delete d.left;delete d.bottom;delete d.right;delete d.top},Language:function(d,c){c.language=this.getChildValue(d)}}},writers:{ows:{BoundingBox:function(d){var c=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:d.projection}});this.writeNode("ows:LowerCorner",d,c);this.writeNode("ows:UpperCorner",d,c);return c},LowerCorner:function(b){return this.createElementNSPlus("ows:LowerCorner",{value:b.bounds.left+" "+b.bounds.bottom})},UpperCorner:function(b){return this.createElementNSPlus("ows:UpperCorner",{value:b.bounds.right+" "+b.bounds.top})},Identifier:function(b){return this.createElementNSPlus("ows:Identifier",{value:b})},Title:function(b){return this.createElementNSPlus("ows:Title",{value:b})},Abstract:function(b){return this.createElementNSPlus("ows:Abstract",{value:b})},OutputFormat:function(b){return this.createElementNSPlus("ows:OutputFormat",{value:b})}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(d,c){c.success=!1;c.exceptionReport={version:d.getAttribute("version"),language:d.getAttribute("language"),exceptions:[]};this.readChildNodes(d,c.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(b){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[b]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[b])},readNode:function(d,c){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,[d,c])},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(d,c){c.numberOfFeatures=parseInt(d.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(d,c){c.insertIds=[];c.success=!1;this.readChildNodes(d,c)},TransactionSummary:function(d,c){c.success=!0},InsertResults:function(d,c){this.readChildNodes(d,c)},Feature:function(e,d){var f={fids:[]};this.readChildNodes(e,f);d.insertIds.push(f.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(d){var c=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);d&&this.setAttributes(c,{resultType:d.resultType,startIndex:d.startIndex,count:d.count});return c},Query:function(f){var f=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},f),e=f.featurePrefix,h=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e?e+":":"")+f.featureType,srsName:f.srsName}});f.featureNS&&h.setAttribute("xmlns:"+e,f.featureNS);if(f.propertyNames){for(var e=0,g=f.propertyNames.length;e<g;e++){this.writeNode("wfs:PropertyName",{property:f.propertyNames[e]},h)}}f.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,f.filter),this.writeNode("ogc:Filter",f.filter,h));return h},PropertyName:function(b){return this.createElementNSPlus("wfs:PropertyName",{value:b.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(b){b=b||{};OpenLayers.Util.extend(this,b);this.options=b},mergeWithDefaultFilter:function(b){return b&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,b]}):b||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(b){b=b||{};b.filter=this.mergeWithDefaultFilter(b.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(e,d,f){return OpenLayers.Function.bind(function(){e.apply(this,[d,f])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(b){OpenLayers.Util.extend(this,b)},success:function(){return 0<this.code},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return !(!window.JSON||!("function"==typeof JSON.parse&&"function"==typeof JSON.stringify))}(),read:function(a,b){var c;if(this.nativeJSON){c=JSON.parse(a,b)}else{try{if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(c=eval("("+a+")"),"function"===typeof b)){var d=function(a,c){if(c&&"object"===typeof c){for(var e in c){c.hasOwnProperty(e)&&(c[e]=d(e,c[e]))}}return b(a,c)};c=d("",c)}}catch(e){}}this.keepData&&(this.data=c);return c},write:function(g,f){this.pretty=!!f;var k=null,j=typeof g;if(this.serialize[j]){try{k=!this.pretty&&this.nativeJSON?JSON.stringify(g):this.serialize[j].apply(this,[g])}catch(h){OpenLayers.Console.error("Trouble serializing: "+h)}}return k},writeIndent:function(){var d=[];if(this.pretty){for(var c=0;c<this.level;++c){d.push(this.indent)}}return d.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(h){if(null==h){return"null"}if(h.constructor==Date){return this.serialize.date.apply(this,[h])}if(h.constructor==Array){return this.serialize.array.apply(this,[h])}var g=["{"];this.level+=1;var m,l,k,j=!1;for(m in h){h.hasOwnProperty(m)&&(l=OpenLayers.Format.JSON.prototype.write.apply(this,[m,this.pretty]),k=OpenLayers.Format.JSON.prototype.write.apply(this,[h[m],this.pretty]),null!=l&&null!=k&&(j&&g.push(","),g.push(this.writeNewline(),this.writeIndent(),l,":",this.writeSpace(),k),j=!0))}this.level-=1;g.push(this.writeNewline(),this.writeIndent(),"}");return g.join("")},array:function(g){var f,k=["["];this.level+=1;for(var j=0,h=g.length;j<h;++j){f=OpenLayers.Format.JSON.prototype.write.apply(this,[g[j],this.pretty]),null!=f&&(0<j&&k.push(","),k.push(this.writeNewline(),this.writeIndent(),f))}this.level-=1;k.push(this.writeNewline(),this.writeIndent(),"]");return k.join("")},string:function(d){var c={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(d)?'"'+d.replace(/([\x00-\x1f\\"])/g,function(b,g){var f=c[g];if(f){return f}f=g.charCodeAt();return"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16)})+'"':'"'+d+'"'},number:function(b){return isFinite(b)?""+b:"null"},"boolean":function(b){return""+b},date:function(d){function c(b){return 10>b?"0"+b:b}return'"'+d.getFullYear()+"-"+c(d.getMonth()+1)+"-"+c(d.getDate())+"T"+c(d.getHours())+":"+c(d.getMinutes())+":"+c(d.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(w,v,u){var v=v?v:"FeatureCollection",t=null,s=null;if(s="string"==typeof w?OpenLayers.Format.JSON.prototype.read.apply(this,[w,u]):w){if("string"!=typeof s.type){OpenLayers.Console.error("Bad GeoJSON - no type: "+w)}else{if(this.isValidType(s,v)){switch(v){case"Geometry":try{t=this.parseGeometry(s)}catch(r){OpenLayers.Console.error(r)}break;case"Feature":try{t=this.parseFeature(s),t.type="Feature"}catch(q){OpenLayers.Console.error(q)}break;case"FeatureCollection":switch(t=[],s.type){case"Feature":try{t.push(this.parseFeature(s))}catch(p){t=null,OpenLayers.Console.error(p)}break;case"FeatureCollection":w=0;for(v=s.features.length;w<v;++w){try{t.push(this.parseFeature(s.features[w]))}catch(o){t=null,OpenLayers.Console.error(o)}}break;default:try{var m=this.parseGeometry(s);t.push(new OpenLayers.Feature.Vector(m))}catch(l){t=null,OpenLayers.Console.error(l)}}}}}}else{OpenLayers.Console.error("Bad JSON: "+w)}return t},isValidType:function(e,d){var f=!1;switch(d){case"Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):f=!0;break;case"FeatureCollection":f=!0;break;default:e.type==d?f=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+d)}return f},parseFeature:function(g){var f,k,j;k=g.properties?g.properties:{};j=g.geometry&&g.geometry.bbox||g.bbox;try{f=this.parseGeometry(g.geometry)}catch(h){throw h}f=new OpenLayers.Feature.Vector(f,k);j&&(f.bounds=OpenLayers.Bounds.fromArray(j));g.id&&(f.fid=g.id);return f},parseGeometry:function(g){if(null==g){return null}var f,k=!1;if("GeometryCollection"==g.type){if(!OpenLayers.Util.isArray(g.geometries)){throw"GeometryCollection must have geometries array: "+g}f=g.geometries.length;for(var k=Array(f),j=0;j<f;++j){k[j]=this.parseGeometry.apply(this,[g.geometries[j]])}f=new OpenLayers.Geometry.Collection(k);k=!0}else{if(!OpenLayers.Util.isArray(g.coordinates)){throw"Geometry must have coordinates array: "+g}if(!this.parseCoords[g.type.toLowerCase()]){throw"Unsupported geometry type: "+g.type}try{f=this.parseCoords[g.type.toLowerCase()].apply(this,[g.coordinates])}catch(h){throw h}}this.internalProjection&&(this.externalProjection&&!k)&&f.transform(this.externalProjection,this.internalProjection);return f},parseCoords:{point:function(b){if(!1==this.ignoreExtraDims&&2!=b.length){throw"Only 2D points are supported: "+b}return new OpenLayers.Geometry.Point(b[0],b[1])},multipoint:function(h){for(var g=[],m=null,l=0,k=h.length;l<k;++l){try{m=this.parseCoords.point.apply(this,[h[l]])}catch(j){throw j}g.push(m)}return new OpenLayers.Geometry.MultiPoint(g)},linestring:function(h){for(var g=[],m=null,l=0,k=h.length;l<k;++l){try{m=this.parseCoords.point.apply(this,[h[l]])}catch(j){throw j}g.push(m)}return new OpenLayers.Geometry.LineString(g)},multilinestring:function(h){for(var g=[],m=null,l=0,k=h.length;l<k;++l){try{m=this.parseCoords.linestring.apply(this,[h[l]])}catch(j){throw j}g.push(m)}return new OpenLayers.Geometry.MultiLineString(g)},polygon:function(j){for(var h=[],p,o,m=0,l=j.length;m<l;++m){try{o=this.parseCoords.linestring.apply(this,[j[m]])}catch(k){throw k}p=new OpenLayers.Geometry.LinearRing(o.components);h.push(p)}return new OpenLayers.Geometry.Polygon(h)},multipolygon:function(h){for(var g=[],m=null,l=0,k=h.length;l<k;++l){try{m=this.parseCoords.polygon.apply(this,[h[l]])}catch(j){throw j}g.push(m)}return new OpenLayers.Geometry.MultiPolygon(g)},box:function(b){if(2!=b.length){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(b[0][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[0][1])])])}},write:function(h,g){var m={type:null};if(OpenLayers.Util.isArray(h)){m.type="FeatureCollection";var l=h.length;m.features=Array(l);for(var k=0;k<l;++k){var j=h[k];if(!j instanceof OpenLayers.Feature.Vector){throw"FeatureCollection only supports collections of features: "+j}m.features[k]=this.extract.feature.apply(this,[j])}}else{0==h.CLASS_NAME.indexOf("OpenLayers.Geometry")?m=this.extract.geometry.apply(this,[h]):h instanceof OpenLayers.Feature.Vector&&(m=this.extract.feature.apply(this,[h]),h.layer&&h.layer.projection&&(m.crs=this.createCRSObject(h)))}return OpenLayers.Format.JSON.prototype.write.apply(this,[m,g])},createCRSObject:function(d){var d=d.layer.projection.toString(),c={};d.match(/epsg:/i)&&(d=parseInt(d.substring(d.indexOf(":")+1)),c=4326==d?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+d}});return c},extract:{feature:function(d){var c=this.extract.geometry.apply(this,[d.geometry]),c={type:"Feature",properties:d.attributes,geometry:c};null!=d.fid&&(c.id=d.fid);return c},geometry:function(d){if(null==d){return null}this.internalProjection&&this.externalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));var c=d.CLASS_NAME.split(".")[2],d=this.extract[c.toLowerCase()].apply(this,[d]);return"Collection"==c?{type:"GeometryCollection",geometries:d}:{type:c,coordinates:d}},point:function(b){return[b.x,b.y]},multipoint:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.point.apply(this,[f.components[h]]))}return e},linestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.point.apply(this,[f.components[h]]))}return e},multilinestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.linestring.apply(this,[f.components[h]]))}return e},polygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.linestring.apply(this,[f.components[h]]))}return e},multipolygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.polygon.apply(this,[f.components[h]]))}return e},collection:function(f){for(var e=f.components.length,h=Array(e),g=0;g<e;++g){h[g]=this.extract.geometry.apply(this,[f.components[g]])}return h}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(d){d=d||{};this.params={};this.pendingRequests={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);this.format||(this.format=new OpenLayers.Format.GeoJSON);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var c=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(b,e){return c.write(b,e)}}},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=OpenLayers.Util.applyDefaults(e,this.options);e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params);e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var d=new OpenLayers.Protocol.Response({requestType:"read"}),f=this.createRequest(e.url,e.params,OpenLayers.Function.bind(function(a){d.data=a;this.handleRead(d,e)},this));d.priv=f;return d},createRequest:function(f,e,h){var h=OpenLayers.Protocol.Script.register(h),g=OpenLayers.String.format(this.callbackTemplate,{id:h}),e=OpenLayers.Util.extend({},e);e[this.callbackKey]=this.callbackPrefix+g;f=OpenLayers.Util.urlAppend(f,OpenLayers.Util.getParameterString(e));e=document.createElement("script");e.type="text/javascript";e.src=f;e.id="OpenLayers_Protocol_Script_"+h;this.pendingRequests[e.id]=e;document.getElementsByTagName("head")[0].appendChild(e);return e},destroyRequest:function(b){OpenLayers.Protocol.Script.unregister(b.id.split("_").pop());delete this.pendingRequests[b.id];b.parentNode&&b.parentNode.removeChild(b)},handleRead:function(d,c){this.handleResponse(d,c)},handleResponse:function(d,c){c.callback&&(d.data?(d.features=this.parseFeatures(d.data),d.code=OpenLayers.Protocol.Response.SUCCESS):d.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(d.priv),c.callback.call(c.scope,d))},parseFeatures:function(b){return this.format.read(b)},abort:function(d){if(d){this.destroyRequest(d.priv)}else{for(var c in this.pendingRequests){this.destroyRequest(this.pendingRequests[c])}}},destroy:function(){this.abort();delete this.params;delete this.format;OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"});(function(){var d=OpenLayers.Protocol.Script,c=0;d.registry={};d.register=function(b){var a="c"+ ++c;d.registry[a]=function(){b.apply(this,arguments)};return a};d.unregister=function(a){delete d.registry[a]}})();OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.controls=[];this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var d,c=this.controls.length-1;0<=c;c--){d=this.controls[c],d.events&&d.events.un({activate:this.iconOn,deactivate:this.iconOff}),d.panel_div=null}this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var e,d=0,f=this.controls.length;d<f;d++){e=this.controls[d],(e===this.defaultControl||this.saveState&&this.activeState[e.id])&&e.activate()}!0===this.saveState&&(this.defaultControl=null);this.redraw();return !0}return !1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var e,d=0,f=this.controls.length;d<f;d++){e=this.controls[d],this.activeState[e.id]=e.deactivate()}this.redraw();return !0}return !1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick);this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var d=this.div.childNodes.length-1;0<=d;d--){this.div.removeChild(this.div.childNodes[d])}this.div.innerHTML="";if(this.active){for(var d=0,c=this.controls.length;d<c;d++){this.div.appendChild(this.controls[d].panel_div)}}},activateControl:function(f){if(!this.active){return !1}if(f.type==OpenLayers.Control.TYPE_BUTTON){f.trigger()}else{if(f.type==OpenLayers.Control.TYPE_TOGGLE){f.active?f.deactivate():f.activate()}else{if(this.allowDepress&&f.active){f.deactivate()}else{for(var e,h=0,g=this.controls.length;h<g;h++){e=this.controls[h],e!=f&&(e.type===OpenLayers.Control.TYPE_TOOL||null==e.type)&&e.deactivate()}f.activate()}}}},addControls:function(g){OpenLayers.Util.isArray(g)||(g=[g]);this.controls=this.controls.concat(g);for(var f=0,k=g.length;f<k;f++){var j=g[f],h=this.createControlMarkup(j);OpenLayers.Element.addClass(h,j.displayClass+"ItemInactive");OpenLayers.Element.addClass(h,"olButton");""!=j.title&&!h.title&&(h.title=j.title);j.panel_div=h}this.map&&(this.addControlsToMap(g),this.redraw())},createControlMarkup:function(){return document.createElement("div")},addControlsToMap:function(f){for(var e,h=0,g=f.length;h<g;h++){e=f[h],!0===e.autoActivate?(e.autoActivate=!1,this.map.addControl(e),e.autoActivate=!0):(this.map.addControl(e),e.deactivate()),e.events.on({activate:this.iconOn,deactivate:this.iconOff})}},iconOn:function(){var b=this.panel_div;b.className=b.className.replace(RegExp("\\b("+this.displayClass+"Item)Inactive\\b"),"$1Active")},iconOff:function(){var b=this.panel_div;b.className=b.className.replace(RegExp("\\b("+this.displayClass+"Item)Active\\b"),"$1Inactive")},onButtonClick:function(e){for(var d=this.controls,e=e.buttonElement,f=d.length-1;0<=f;--f){if(d[f].panel_div===e){this.activateControl(d[f]);break}}},getControlsBy:function(e,d){var f="function"==typeof d.test;return OpenLayers.Array.filter(this.controls,function(a){return a[e]==d||f&&d.test(a[e])})},getControlsByName:function(b){return this.getControlsBy("name",b)},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(f,e,h,g){OpenLayers.Layer.prototype.initialize.apply(this,[f,g]);this.url=e;this.params||(this.params=OpenLayers.Util.extend({},h))},destroy:function(){this.params=this.url=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.prototype.clone.apply(this,[b])},setUrl:function(b){this.url=b},mergeNewParams:function(b){this.params=OpenLayers.Util.extend(this.params,b);b=this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});return b},redraw:function(b){return b?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(g,f){for(var k=1,j=0,h=g.length;j<h;j++){k*=g.charCodeAt(j)*this.URL_HASH_FACTOR,k-=Math.floor(k)}return f[Math.floor(k*f.length)]},getFullRequestString:function(h,g){var m=g||this.url,l=OpenLayers.Util.extend({},this.params),l=OpenLayers.Util.extend(l,h),k=OpenLayers.Util.getParameterString(l);OpenLayers.Util.isArray(m)&&(m=this.selectUrl(k,m));var k=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(m)),j;for(j in l){j.toUpperCase() in k&&delete l[j]}k=OpenLayers.Util.getParameterString(l);return OpenLayers.Util.urlAppend(m,k)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(h,g,m,l,k,j){this.layer=h;this.position=g.clone();this.setBounds(m);this.url=l;k&&(this.size=k.clone());this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,j);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=this.eventListeners=null},draw:function(d){d||this.clear();var c=this.shouldDraw();c&&!d&&(c=!1!==this.events.triggerEvent("beforedraw"));return c},shouldDraw:function(){var e=!1,d=this.layer.maxExtent;if(d){var f=this.layer.map,f=f.baseLayer.wrapDateLine&&f.getMaxExtent();this.bounds.intersectsBounds(d,{inclusive:!1,worldBounds:f})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){e=e.clone();if(this.layer.map.baseLayer.wrapDateLine){var d=this.layer.map.getMaxExtent(),f=this.layer.map.getResolution(),e=e.wrapDateLine(d,{leftTolerance:f,rightTolerance:f})}this.bounds=e},moveTo:function(e,d,f){null==f&&(f=!0);this.setBounds(e);this.position=d.clone();f&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(h,g,m,l,k,j){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=l;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"}null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null);this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var b=OpenLayers.Tile.prototype.draw.apply(this,arguments);b?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.positionTile(),this.renderTile()):this.unload();return b},renderTile:function(){this.layer.div.appendChild(this.getTile());if(this.layer.async){var b=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(a){b==this.asyncRequestId&&(this.url=a,this.initImage())},this)}else{this.url=this.layer.getURL(this.bounds),this.initImage()}},positionTile:function(){var d=this.getTile().style,c=this.frame?this.size:this.layer.getImageSize(this.bounds);d.left=this.position.x+"%";d.top=this.position.y+"%";d.width=c.w+"%";d.height=c.h+"%"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var d=this.imgDiv;if(d){OpenLayers.Event.stopObservingElement(d);var c=this.getTile();c.parentNode===this.layer.div&&this.layer.div.removeChild(c);this.setImgSrc();!0===this.layerAlphaHack&&(d.style.filter="");OpenLayers.Element.removeClass(d,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=document.createElement("img");this.imgDiv.className="olTileImage";this.imgDiv.galleryImg="no";var e=this.imgDiv.style;if(this.frame){var d=0,f=0;this.layer.gutter&&(d=100*(this.layer.gutter/this.layer.tileSize.w),f=100*(this.layer.gutter/this.layer.tileSize.h));e.left=-d+"%";e.top=-f+"%";e.width=2*d+100+"%";e.height=2*f+100+"%"}e.visibility="hidden";e.opacity=0;1>this.layer.opacity&&(e.filter="alpha(opacity="+100*this.layer.opacity+")");e.position="absolute";this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%");this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},initImage:function(){this.events.triggerEvent(this._loadEvent);var d=this.getImage();if(this.url&&d.getAttribute("src")==this.url){this.onImageLoad()}else{var c=OpenLayers.Function.bind(function(){OpenLayers.Event.stopObservingElement(d);OpenLayers.Event.observe(d,"load",OpenLayers.Function.bind(this.onImageLoad,this));OpenLayers.Event.observe(d,"error",OpenLayers.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)},this);d.getAttribute("src")==this.blankImageUrl?c():(OpenLayers.Event.observe(d,"load",c),OpenLayers.Event.observe(d,"error",c),this.crossOriginKeyword&&d.removeAttribute("crossorigin"),d.src=this.blankImageUrl)}},setImgSrc:function(d){var c=this.imgDiv;c.style.visibility="hidden";c.style.opacity=0;d&&(this.crossOriginKeyword&&("data:"!==d.substr(0,5)?c.setAttribute("crossorigin",this.crossOriginKeyword):c.removeAttribute("crossorigin")),c.src=d)},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var b;this.frame?(b=this.frame.cloneNode(!1),b.appendChild(this.imgDiv)):b=this.imgDiv;this.imgDiv=null;return b}},onImageLoad:function(){var e=this.imgDiv;OpenLayers.Event.stopObservingElement(e);e.style.visibility="inherit";e.style.opacity=this.layer.opacity;this.isLoading=!1;this.canvasContext=null;this.events.triggerEvent("loadend");if(7>parseFloat(navigator.appVersion.split("MSIE")[1])&&this.layer&&this.layer.div){var d=document.createElement("span");d.style.display="none";var f=this.layer.div;f.appendChild(d);window.setTimeout(function(){d.parentNode===f&&d.parentNode.removeChild(d)},0)}!0===this.layerAlphaHack&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var b=this.imgDiv;null!=b.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(b,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var b=document.createElement("canvas");b.width=this.size.w;b.height=this.size.h;this.canvasContext=b.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:null,numLoadingTiles:0,tileLoadingDelay:85,serverResolutions:null,moveTimerId:null,deferMoveGriddedTiles:null,tileQueueId:null,tileQueue:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,initialize:function(f,e,h,g){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this.tileQueue=[];null===this.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500);null===this.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid");OpenLayers.Animation.isNative||(this.deferMoveGriddedTiles=OpenLayers.Function.bind(function(){this.moveGriddedTiles(true);this.moveTimerId=null},this))},setMap:function(b){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,b);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){null!==this.moveTimerId&&(window.clearTimeout(this.moveTimerId),this.moveTimerId=null);this.clearTileQueue();null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null)},destroy:function(){this.removeBackBuffer();this.clearGrid();this.tileSize=this.grid=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){this.clearTileQueue();if(this.grid){for(var g=0,f=this.grid.length;g<f;g++){for(var k=this.grid[g],j=0,h=k.length;j<h;j++){this.destroyTile(k[j])}}this.grid=[];this.gridResolution=null}},clone:function(b){null==b&&(b=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));b=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[b]);null!=this.tileSize&&(b.tileSize=this.tileSize.clone());b.grid=[];b.gridResolution=null;b.backBuffer=null;b.backBufferTimerId=null;b.tileQueue=[];b.tileQueueId=null;b.loading=!1;b.moveTimerId=null;return b},moveTo:function(j,h,p){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);j=j||this.map.getExtent();if(null!=j){var o=!this.grid.length||h,m=this.getTilesBounds(),l=this.map.getResolution(),k=this.getServerResolution(l);if(this.singleTile){if(o||!p&&!m.containsBounds(j)){h&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),(!h||"resize"===this.transitionEffect)&&this.applyBackBuffer(k),this.initSingleTile(j)}}else{(o=o||!m.intersectsBounds(j,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),l!==k?(j=this.map.calculateBounds(null,k),o&&this.transformDiv(k/l)):(this.div.style.width="100%",this.div.style.height="100%",this.div.style.left="0%",this.div.style.top="0%"),o)?(h&&"resize"===this.transitionEffect&&this.applyBackBuffer(k),this.initGriddedTiles(j)):this.moveGriddedTiles()}}},getTileData:function(w){var v=null,u=w.lon,t=w.lat,s=this.grid.length;if(this.map&&s){var r=this.map.getResolution(),w=this.tileSize.w,q=this.tileSize.h,p=this.grid[0][0].bounds,o=p.left,p=p.top;if(u<o&&this.map.baseLayer.wrapDateLine){var m=this.map.getMaxExtent().getWidth(),l=Math.ceil((o-u)/m),u=u+m*l}u=(u-o)/(r*w);t=(p-t)/(r*q);r=Math.floor(u);o=Math.floor(t);0<=o&&o<s&&(s=this.grid[o][r])&&(v={tile:s,i:Math.floor((u-r)*w),j:Math.floor((t-o)*q)})}return v},queueTileDraw:function(b){b=b.object;~OpenLayers.Util.indexOf(this.tileQueue,b)||this.tileQueue.push(b);this.tileQueueId||(this.tileQueueId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.drawTileFromQueue,this),null,this.div));return !1},drawTileFromQueue:function(){0===this.tileQueue.length?this.clearTileQueue():this.tileQueue.shift().draw(!0)},clearTileQueue:function(){OpenLayers.Animation.stop(this.tileQueueId);this.tileQueueId=null;this.tileQueue=[]},destroyTile:function(b){this.removeTileMonitoringHooks(b);b.destroy()},getServerResolution:function(e){e=e||this.map.getResolution();if(this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var d,f;for(d=this.serverResolutions.length-1;0<=d;d--){if(f=this.serverResolutions[d],f>e){e=f;break}}if(-1===d){throw"no appropriate resolution in serverResolutions"}}return e},getServerZoom:function(){var b=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoomForResolution(b)+(this.zoomOffset||0)},transformDiv:function(f){this.div.style.width=100*f+"%";this.div.style.height=100*f+"%";var e=this.map.getSize(),h=parseInt(this.map.layerContainerDiv.style.left,10),g=(parseInt(this.map.layerContainerDiv.style.top,10)-e.h/2)*(f-1);this.div.style.left=(h-e.w/2)*(f-1)+"%";this.div.style.top=g+"%"},getResolutionScale:function(){return parseInt(this.div.style.width,10)/100},applyBackBuffer:function(f){null!==this.backBufferTimerId&&this.removeBackBuffer();var e=this.backBuffer;if(!e){e=this.createBackBuffer();if(!e){return}this.div.insertBefore(e,this.div.firstChild);this.backBuffer=e;var h=this.grid[0][0].bounds;this.backBufferLonLat={lon:h.left,lat:h.top};this.backBufferResolution=this.gridResolution}var h=e.style,g=this.backBufferResolution/f;h.width=100*g+"%";h.height=100*g+"%";f=this.getViewPortPxFromLonLat(this.backBufferLonLat,f);h=parseInt(this.map.layerContainerDiv.style.left,10);g=parseInt(this.map.layerContainerDiv.style.top,10);e.style.left=Math.round(f.x-h)+"%";e.style.top=Math.round(f.y-g)+"%"},createBackBuffer:function(){var h;if(0<this.grid.length){h=document.createElement("div");h.id=this.div.id+"_bb";h.className="olBackBuffer";h.style.position="absolute";h.style.width="100%";h.style.height="100%";for(var g=0,m=this.grid.length;g<m;g++){for(var l=0,k=this.grid[g].length;l<k;l++){var j=this.grid[g][l].createBackBuffer();j&&(j.style.top=g*this.tileSize.h+"%",j.style.left=l*this.tileSize.w+"%",h.appendChild(j))}}}return h},removeBackBuffer:function(){this.backBuffer&&(this.div.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(b){this.singleTile&&(b=this.map.getSize(),b.h=parseInt(b.h*this.ratio),b.w=parseInt(b.w*this.ratio));OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[b])},getTilesBounds:function(){var e=null,d=this.grid.length;if(d){var e=this.grid[d-1][0].bounds,d=this.grid[0].length*e.getWidth(),f=this.grid.length*e.getHeight(),e=new OpenLayers.Bounds(e.left,e.bottom,e.left+d,e.bottom+f)}return e},initSingleTile:function(e){this.clearTileQueue();var d=e.getCenterLonLat(),f=e.getWidth()*this.ratio,e=e.getHeight()*this.ratio,d=new OpenLayers.Bounds(d.lon-f/2,d.lat-e/2,d.lon+f/2,d.lat+e/2),f=this.map.getLayerPxFromLonLat({lon:d.left,lat:d.top});this.grid.length||(this.grid[0]=[]);(e=this.grid[0][0])?e.moveTo(d,f):(e=this.addTile(d,f),this.addTileMonitoringHooks(e),e.draw(),this.grid[0][0]=e);this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(j,h,p){var o=p*this.tileSize.w,p=p*this.tileSize.h,m=j.left-h.lon,l=Math.floor(m/o)-this.buffer,m=-(m/o-l)*this.tileSize.w,l=h.lon+l*o,j=j.top-(h.lat+p),k=Math.ceil(j/p)+this.buffer;return{tilelon:o,tilelat:p,tileoffsetlon:l,tileoffsetlat:h.lat+k*p,tileoffsetx:m,tileoffsety:-(k-j/p)*this.tileSize.h}},getTileOrigin:function(){var d=this.tileOrigin;if(!d){var d=this.getMaxExtent(),c={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],d=new OpenLayers.LonLat(d[c[0]],d[c[1]])}return d},initGriddedTiles:function(P){this.clearTileQueue();var O=this.map.getSize(),N=Math.ceil(O.h/this.tileSize.h)+Math.max(1,2*this.buffer),O=Math.ceil(O.w/this.tileSize.w)+Math.max(1,2*this.buffer),M=this.getTileOrigin(),L=this.getServerResolution(),M=this.calculateGridLayout(P,M,L),L=Math.round(M.tileoffsetx),K=Math.round(M.tileoffsety),J=M.tileoffsetlon,I=M.tileoffsetlat,H=M.tilelon,G=M.tilelat,F=L,E=J,D=0,C=parseInt(this.map.layerContainerDiv.style.left),B=parseInt(this.map.layerContainerDiv.style.top),M=[],A=this.map.getCenter();do{var z=this.grid[D++];z||(z=[],this.grid.push(z));var J=E,L=F,y=0;do{var x=new OpenLayers.Bounds(J,I,J+H,I+G),w=L,w=w-C,v=K,v=v-B,v=new OpenLayers.Pixel(w,v);(w=z[y++])?w.moveTo(x,v,!1):(w=this.addTile(x,v),this.addTileMonitoringHooks(w),z.push(w));x=x.getCenterLonLat();M.push({tile:w,distance:Math.pow(x.lon-A.lon,2)+Math.pow(x.lat-A.lat,2)});J+=H;L+=this.tileSize.w}while(J<=P.right+H*this.buffer||y<O);I-=G;K+=this.tileSize.h}while(I>=P.bottom-G*this.buffer||D<N);this.removeExcessTiles(D,y);this.gridResolution=this.getServerResolution();M.sort(function(d,c){return d.distance-c.distance});P=0;for(N=M.length;P<N;++P){M[P].tile.draw()}},getMaxExtent:function(){return this.maxExtent},addTile:function(e,d){var f=new this.tileClass(this,d,e,null,this.tileSize,this.tileOptions);f.events.register("beforedraw",this,this.queueTileDraw);return f},addTileMonitoringHooks:function(b){b.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart"));this.events.triggerEvent("tileloadstart",{tile:b});this.numLoadingTiles++};b.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded",{tile:b});0===this.tileQueue.length&&0===this.numLoadingTiles&&(this.loading=!1,this.events.triggerEvent("loadend"),this.backBuffer&&(this.backBufferTimerId=window.setTimeout(OpenLayers.Function.bind(this.removeBackBuffer,this),this.removeBackBufferDelay)))};b.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:b})};b.events.on({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,loaderror:b.onLoadError,scope:this})},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,loaderror:b.onLoadError,scope:this})},moveGriddedTiles:function(h){if(!h&&!OpenLayers.Animation.isNative){null!=this.moveTimerId&&window.clearTimeout(this.moveTimerId),this.moveTimerId=window.setTimeout(this.deferMoveGriddedTiles,this.tileLoadingDelay)}else{for(var h=this.buffer||1,g=this.getResolutionScale();;){var m=this.grid[0][0].position.x*g+parseInt(this.div.style.left,10)+parseInt(this.map.layerContainerDiv.style.left),l=this.grid[0][0].position.y*g+parseInt(this.div.style.top,10)+parseInt(this.map.layerContainerDiv.style.top),k=this.tileSize.w*g,j=this.tileSize.h*g;if(m>-k*(h-1)){this.shiftColumn(!0)}else{if(m<-k*h){this.shiftColumn(!1)}else{if(l>-j*(h-1)){this.shiftRow(!0)}else{if(l<-j*h){this.shiftRow(!1)}else{break}}}}}}},shiftRow:function(u){for(var t=this.grid,s=t[u?0:this.grid.length-1],r=this.getServerResolution(),q=u?-this.tileSize.h:this.tileSize.h,r=r*-q,p=u?t.pop():t.shift(),o=0,m=s.length;o<m;o++){var l=s[o],k=l.bounds.clone(),l=l.position.clone();k.bottom+=r;k.top+=r;l.y+=q;p[o].moveTo(k,l)}u?t.unshift(p):t.push(p)},shiftColumn:function(s){for(var r=s?-this.tileSize.w:this.tileSize.w,q=this.getServerResolution()*r,p=0,o=this.grid.length;p<o;p++){var m=this.grid[p],l=m[s?0:m.length-1],k=l.bounds.clone(),l=l.position.clone();k.left+=q;k.right+=q;l.x+=r;var j=s?this.grid[p].pop():this.grid[p].shift();j.moveTo(k,l);s?m.unshift(j):m.push(j)}},removeExcessTiles:function(h,g){for(var m,l;this.grid.length>h;){var k=this.grid.pop();m=0;for(l=k.length;m<l;m++){var j=k[m];this.destroyTile(j)}}m=0;for(l=this.grid.length;m<l;m++){for(;this.grid[m].length>g;){k=this.grid[m],j=k.pop(),this.destroyTile(j)}}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(g){var f=this.maxExtent,k=this.getResolution(),j=k*this.tileSize.w,k=k*this.tileSize.h,h=this.getLonLatFromViewPortPx(g),g=f.left+j*Math.floor((h.lon-f.left)/j),f=f.bottom+k*Math.floor((h.lat-f.bottom)/k);return new OpenLayers.Bounds(g,f,g+j,f+k)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:"antialiasing blockout font fontcolor fontsize fontstyle glowing interval outline printmode shadow transparency".split(" "),request:null,response:null,initialize:function(d){this.request=new OpenLayers.Format.ArcXML.Request;this.response=new OpenLayers.Format.ArcXML.Response;if(d){if("feature"==d.requesttype){this.request.get_image=null;var c=this.request.get_feature.query;this.addCoordSys(c.featurecoordsys,d.featureCoordSys);this.addCoordSys(c.filtercoordsys,d.filterCoordSys);d.polygon?(c.isspatial=!0,c.spatialfilter.polygon=d.polygon):d.envelope&&(c.isspatial=!0,c.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(c.spatialfilter.envelope,d.envelope))}else{"image"==d.requesttype?(this.request.get_feature=null,c=this.request.get_image.properties,this.parseEnvelope(c.envelope,d.envelope),this.addLayers(c.layerlist,d.layers),this.addImageSize(c.imagesize,d.tileSize),this.addCoordSys(c.featurecoordsys,d.featureCoordSys),this.addCoordSys(c.filtercoordsys,d.filterCoordSys)):this.request=null}}OpenLayers.Format.XML.prototype.initialize.apply(this,[d])},parseEnvelope:function(d,c){c&&4==c.length&&(d.minx=c[0],d.miny=c[1],d.maxx=c[2],d.maxy=c[3])},addLayers:function(f,e){for(var h=0,g=e.length;h<g;h++){f.push(e[h])}},addImageSize:function(d,c){null!==c&&(d.width=c.w,d.height=c.h,d.printwidth=c.w,d.printheight=c.h)},addCoordSys:function(d,c){"string"==typeof c?(d.id=parseInt(c),d.string=c):"object"==typeof c&&null!==c.proj&&(d.id=c.proj.srsProjNumber,d.string=c.proj.srsCode)},iserror:function(d){var c=null;d?(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]),d=d.documentElement.getElementsByTagName("ERROR"),c=null!==d&&0<d.length):c=""!==this.response.error;return c},read:function(g){"string"==typeof g&&(g=OpenLayers.Format.XML.prototype.read.apply(this,[g]));var f=null;g&&g.documentElement&&(f="ARCXML"==g.documentElement.nodeName?g.documentElement:g.documentElement.getElementsByTagName("ARCXML")[0]);if(!f||"parsererror"===f.firstChild.nodeName){var k,j;try{k=g.firstChild.nodeValue,j=g.firstChild.childNodes[1].firstChild.nodeValue}catch(h){}throw {message:"Error parsing the ArcXML request",error:k,source:j}}return this.parseResponse(f)},write:function(k){k||(k=this.request);var j=this.createElementNS("","ARCXML");j.setAttribute("version","1.1");var r=this.createElementNS("","REQUEST");if(null!=k.get_image){var q=this.createElementNS("","GET_IMAGE");r.appendChild(q);var p=this.createElementNS("","PROPERTIES");q.appendChild(p);k=k.get_image.properties;null!=k.featurecoordsys&&(q=this.createElementNS("","FEATURECOORDSYS"),p.appendChild(q),0===k.featurecoordsys.id?q.setAttribute("string",k.featurecoordsys.string):q.setAttribute("id",k.featurecoordsys.id));null!=k.filtercoordsys&&(q=this.createElementNS("","FILTERCOORDSYS"),p.appendChild(q),0===k.filtercoordsys.id?q.setAttribute("string",k.filtercoordsys.string):q.setAttribute("id",k.filtercoordsys.id));null!=k.envelope&&(q=this.createElementNS("","ENVELOPE"),p.appendChild(q),q.setAttribute("minx",k.envelope.minx),q.setAttribute("miny",k.envelope.miny),q.setAttribute("maxx",k.envelope.maxx),q.setAttribute("maxy",k.envelope.maxy));q=this.createElementNS("","IMAGESIZE");p.appendChild(q);q.setAttribute("height",k.imagesize.height);q.setAttribute("width",k.imagesize.width);if(k.imagesize.height!=k.imagesize.printheight||k.imagesize.width!=k.imagesize.printwidth){q.setAttribute("printheight",k.imagesize.printheight),q.setArrtibute("printwidth",k.imagesize.printwidth)}null!=k.background&&(q=this.createElementNS("","BACKGROUND"),p.appendChild(q),q.setAttribute("color",k.background.color.r+","+k.background.color.g+","+k.background.color.b),null!==k.background.transcolor&&q.setAttribute("transcolor",k.background.transcolor.r+","+k.background.transcolor.g+","+k.background.transcolor.b));if(null!=k.layerlist&&0<k.layerlist.length){q=this.createElementNS("","LAYERLIST");p.appendChild(q);for(p=0;p<k.layerlist.length;p++){var o=this.createElementNS("","LAYERDEF");q.appendChild(o);o.setAttribute("id",k.layerlist[p].id);o.setAttribute("visible",k.layerlist[p].visible);if("object"==typeof k.layerlist[p].query){var m=k.layerlist[p].query;if(0>m.where.length){continue}var l=null,l="boolean"==typeof m.spatialfilter&&m.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY");l.setAttribute("where",m.where);"number"==typeof m.accuracy&&0<m.accuracy&&l.setAttribute("accuracy",m.accuracy);"number"==typeof m.featurelimit&&2000>m.featurelimit&&l.setAttribute("featurelimit",m.featurelimit);"string"==typeof m.subfields&&"#ALL#"!=m.subfields&&l.setAttribute("subfields",m.subfields);"string"==typeof m.joinexpression&&0<m.joinexpression.length&&l.setAttribute("joinexpression",m.joinexpression);"string"==typeof m.jointables&&0<m.jointables.length&&l.setAttribute("jointables",m.jointables);o.appendChild(l)}"object"==typeof k.layerlist[p].renderer&&this.addRenderer(o,k.layerlist[p].renderer)}}}else{if(null!=k.get_feature&&(q=this.createElementNS("","GET_FEATURES"),q.setAttribute("outputmode","newxml"),q.setAttribute("checkesc","true"),k.get_feature.geometry?q.setAttribute("geometry",k.get_feature.geometry):q.setAttribute("geometry","false"),k.get_feature.compact&&q.setAttribute("compact",k.get_feature.compact),"number"==k.get_feature.featurelimit&&q.setAttribute("featurelimit",k.get_feature.featurelimit),q.setAttribute("globalenvelope","true"),r.appendChild(q),null!=k.get_feature.layer&&0<k.get_feature.layer.length&&(p=this.createElementNS("","LAYER"),p.setAttribute("id",k.get_feature.layer),q.appendChild(p)),k=k.get_feature.query,null!=k)){p=null,p=k.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),q.appendChild(p),"number"==typeof k.accuracy&&p.setAttribute("accuracy",k.accuracy),null!=k.featurecoordsys&&(q=this.createElementNS("","FEATURECOORDSYS"),0==k.featurecoordsys.id?q.setAttribute("string",k.featurecoordsys.string):q.setAttribute("id",k.featurecoordsys.id),p.appendChild(q)),null!=k.filtercoordsys&&(q=this.createElementNS("","FILTERCOORDSYS"),0===k.filtercoordsys.id?q.setAttribute("string",k.filtercoordsys.string):q.setAttribute("id",k.filtercoordsys.id),p.appendChild(q)),0<k.buffer&&(q=this.createElementNS("","BUFFER"),q.setAttribute("distance",k.buffer),p.appendChild(q)),k.isspatial&&(q=this.createElementNS("","SPATIALFILTER"),q.setAttribute("relation",k.spatialfilter.relation),p.appendChild(q),k.spatialfilter.envelope?(o=this.createElementNS("","ENVELOPE"),o.setAttribute("minx",k.spatialfilter.envelope.minx),o.setAttribute("miny",k.spatialfilter.envelope.miny),o.setAttribute("maxx",k.spatialfilter.envelope.maxx),o.setAttribute("maxy",k.spatialfilter.envelope.maxy),q.appendChild(o)):"object"==typeof k.spatialfilter.polygon&&q.appendChild(this.writePolygonGeometry(k.spatialfilter.polygon))),null!=k.where&&0<k.where.length&&p.setAttribute("where",k.where)}}j.appendChild(r);return OpenLayers.Format.XML.prototype.write.apply(this,[j])},addGroupRenderer:function(f,e){var h=this.createElementNS("","GROUPRENDERER");f.appendChild(h);for(var g=0;g<e.length;g++){this.addRenderer(h,e[g])}},addRenderer:function(e,d){if(OpenLayers.Util.isArray(d)){this.addGroupRenderer(e,d)}else{var f=this.createElementNS("",d.type.toUpperCase()+"RENDERER");e.appendChild(f);"VALUEMAPRENDERER"==f.tagName?this.addValueMapRenderer(f,d):"VALUEMAPLABELRENDERER"==f.tagName?this.addValueMapLabelRenderer(f,d):"SIMPLELABELRENDERER"==f.tagName?this.addSimpleLabelRenderer(f,d):"SCALEDEPENDENTRENDERER"==f.tagName&&this.addScaleDependentRenderer(f,d)}},addScaleDependentRenderer:function(d,c){("string"==typeof c.lower||"number"==typeof c.lower)&&d.setAttribute("lower",c.lower);("string"==typeof c.upper||"number"==typeof c.upper)&&d.setAttribute("upper",c.upper);this.addRenderer(d,c.renderer)},addValueMapLabelRenderer:function(w,v){w.setAttribute("lookupfield",v.lookupfield);w.setAttribute("labelfield",v.labelfield);if("object"==typeof v.exacts){for(var u=0,t=v.exacts.length;u<t;u++){var s=v.exacts[u],r=this.createElementNS("","EXACT");"string"==typeof s.value&&r.setAttribute("value",s.value);"string"==typeof s.label&&r.setAttribute("label",s.label);"string"==typeof s.method&&r.setAttribute("method",s.method);w.appendChild(r);if("object"==typeof s.symbol){var q=null;"text"==s.symbol.type&&(q=this.createElementNS("","TEXTSYMBOL"));if(null!=q){for(var p=this.fontStyleKeys,o=0,m=p.length;o<m;o++){var l=p[o];s.symbol[l]&&q.setAttribute(l,s.symbol[l])}r.appendChild(q)}}}}},addValueMapRenderer:function(j,h){j.setAttribute("lookupfield",h.lookupfield);if("object"==typeof h.ranges){for(var p=0,o=h.ranges.length;p<o;p++){var m=h.ranges[p],l=this.createElementNS("","RANGE");l.setAttribute("lower",m.lower);l.setAttribute("upper",m.upper);j.appendChild(l);if("object"==typeof m.symbol){var k=null;"simplepolygon"==m.symbol.type&&(k=this.createElementNS("","SIMPLEPOLYGONSYMBOL"));null!=k&&("string"==typeof m.symbol.boundarycolor&&k.setAttribute("boundarycolor",m.symbol.boundarycolor),"string"==typeof m.symbol.fillcolor&&k.setAttribute("fillcolor",m.symbol.fillcolor),"number"==typeof m.symbol.filltransparency&&k.setAttribute("filltransparency",m.symbol.filltransparency),l.appendChild(k))}}}else{if("object"==typeof h.exacts){p=0;for(o=h.exacts.length;p<o;p++){m=h.exacts[p],l=this.createElementNS("","EXACT"),"string"==typeof m.value&&l.setAttribute("value",m.value),"string"==typeof m.label&&l.setAttribute("label",m.label),"string"==typeof m.method&&l.setAttribute("method",m.method),j.appendChild(l),"object"==typeof m.symbol&&(k=null,"simplemarker"==m.symbol.type&&(k=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=k&&("string"==typeof m.symbol.antialiasing&&k.setAttribute("antialiasing",m.symbol.antialiasing),"string"==typeof m.symbol.color&&k.setAttribute("color",m.symbol.color),"string"==typeof m.symbol.outline&&k.setAttribute("outline",m.symbol.outline),"string"==typeof m.symbol.overlap&&k.setAttribute("overlap",m.symbol.overlap),"string"==typeof m.symbol.shadow&&k.setAttribute("shadow",m.symbol.shadow),"number"==typeof m.symbol.transparency&&k.setAttribute("transparency",m.symbol.transparency),"string"==typeof m.symbol.usecentroid&&k.setAttribute("usecentroid",m.symbol.usecentroid),"number"==typeof m.symbol.width&&k.setAttribute("width",m.symbol.width),l.appendChild(k)))}}}},addSimpleLabelRenderer:function(k,j){k.setAttribute("field",j.field);for(var r="featureweight howmanylabels labelbufferratio labelpriorities labelweight linelabelposition rotationalangles".split(" "),q=0,p=r.length;q<p;q++){var o=r[q];j[o]&&k.setAttribute(o,j[o])}if("text"==j.symbol.type){var m=j.symbol,l=this.createElementNS("","TEXTSYMBOL");k.appendChild(l);r=this.fontStyleKeys;q=0;for(p=r.length;q<p;q++){o=r[q],m[o]&&l.setAttribute(o,j[o])}}},writePolygonGeometry:function(u){if(!(u instanceof OpenLayers.Geometry.Polygon)){throw {message:"Cannot write polygon geometry to ArcXML with an "+u.CLASS_NAME+" object.",geometry:u}}for(var t=this.createElementNS("","POLYGON"),s=0,r=u.components.length;s<r;s++){for(var q=u.components[s],p=this.createElementNS("","RING"),o=0,m=q.components.length;o<m;o++){var l=q.components[o],k=this.createElementNS("","POINT");k.setAttribute("x",l.x);k.setAttribute("y",l.y);p.appendChild(k)}t.appendChild(p)}return t},parseResponse:function(u){"string"==typeof u&&(u=(new OpenLayers.Format.XML).read(u));var t=new OpenLayers.Format.ArcXML.Response,s=u.getElementsByTagName("ERROR");if(null!=s&&0<s.length){t.error=this.getChildValue(s,"Unknown error.")}else{s=u.getElementsByTagName("RESPONSE");if(null==s||0==s.length){return t.error="No RESPONSE tag found in ArcXML response.",t}var r=s[0].firstChild.nodeName;"#text"==r&&(r=s[0].firstChild.nextSibling.nodeName);if("IMAGE"==r){s=u.getElementsByTagName("ENVELOPE"),u=u.getElementsByTagName("OUTPUT"),null==s||0==s.length?t.error="No ENVELOPE tag found in ArcXML response.":null==u||0==u.length?t.error="No OUTPUT tag found in ArcXML response.":(s=this.parseAttributes(s[0]),r=this.parseAttributes(u[0]),t.image="string"==typeof r.type?{envelope:s,output:{type:r.type,data:this.getChildValue(u[0])}}:{envelope:s,output:r})}else{if("FEATURES"==r){if(u=s[0].getElementsByTagName("FEATURES"),s=u[0].getElementsByTagName("FEATURECOUNT"),t.features.featurecount=s[0].getAttribute("count"),0<t.features.featurecount){s=u[0].getElementsByTagName("ENVELOPE");t.features.envelope=this.parseAttributes(s[0],"number");u=u[0].getElementsByTagName("FEATURE");for(s=0;s<u.length;s++){for(var r=new OpenLayers.Feature.Vector,q=u[s].getElementsByTagName("FIELD"),p=0;p<q.length;p++){var o=q[p].getAttribute("name"),m=q[p].getAttribute("value");r.attributes[o]=m}q=u[s].getElementsByTagName("POLYGON");if(0<q.length){q=q[0].getElementsByTagName("RING");p=[];for(o=0;o<q.length;o++){m=[];m.push(this.parsePointGeometry(q[o]));for(var l=q[o].getElementsByTagName("HOLE"),k=0;k<l.length;k++){m.push(this.parsePointGeometry(l[k]))}p.push(new OpenLayers.Geometry.Polygon(m))}r.geometry=1==p.length?p[0]:new OpenLayers.Geometry.MultiPolygon(p)}t.features.feature.push(r)}}}else{t.error="Unidentified response type."}}}return t},parseAttributes:function(f,e){for(var h={},g=0;g<f.attributes.length;g++){h[f.attributes[g].nodeName]="number"==e?parseFloat(f.attributes[g].nodeValue):f.attributes[g].nodeValue}return h},parsePointGeometry:function(f){var e=[],h=f.getElementsByTagName("COORDS");if(0<h.length){f=this.getChildValue(h[0]);f=f.split(/;/);for(h=0;h<f.length;h++){var g=f[h].split(/ /);e.push(new OpenLayers.Geometry.Point(g[0],g[1]))}}else{if(f=f.getElementsByTagName("POINT"),0<f.length){for(h=0;h<f.length;h++){e.push(new OpenLayers.Geometry.Point(parseFloat(f[h].getAttribute("x")),parseFloat(f[h].getAttribute("y"))))}}}return new OpenLayers.Geometry.LinearRing(e)},CLASS_NAME:"OpenLayers.Format.ArcXML"});OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(){return OpenLayers.Util.extend(this,{get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]})},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"});OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(){return OpenLayers.Util.extend(this,{image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""})},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"});OpenLayers.ProxyHost="";OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(g,f){var k=0!==g.indexOf("http"),j=!k&&g.match(this.URL_SPLIT_REGEX);if(j){var h=window.location,k=j[1]==h.protocol&&j[3]==h.hostname,j=j[4],h=h.port;if(80!=j&&""!=j||"80"!=h&&""!=h){k=k&&j==h}}k||(f?g="function"==typeof f?f(g):f+encodeURIComponent(g):OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:g}));return g},issue:function(k){var j=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost}),k=OpenLayers.Util.applyDefaults(k,j),j=!1,r;for(r in k.headers){k.headers.hasOwnProperty(r)&&"x-requested-with"===r.toLowerCase()&&(j=!0)}!1===j&&(k.headers["X-Requested-With"]="XMLHttpRequest");var q=new OpenLayers.Request.XMLHttpRequest,p=OpenLayers.Util.urlAppend(k.url,OpenLayers.Util.getParameterString(k.params||{})),p=OpenLayers.Request.makeSameOrigin(p,k.proxy);q.open(k.method,p,k.async,k.user,k.password);for(var o in k.headers){q.setRequestHeader(o,k.headers[o])}var m=this.events,l=this;q.onreadystatechange=function(){q.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==m.triggerEvent("complete",{request:q,config:k,requestUrl:p})&&l.runCallbacks({request:q,config:k,requestUrl:p})};!1===k.async?q.send(k.data):window.setTimeout(function(){0!==q.readyState&&q.send(k.data)},0);return q},runCallbacks:function(h){var g=h.request,m=h.config,l=m.scope?OpenLayers.Function.bind(m.callback,m.scope):m.callback,k;m.success&&(k=m.scope?OpenLayers.Function.bind(m.success,m.scope):m.success);var j;m.failure&&(j=m.scope?OpenLayers.Function.bind(m.failure,m.scope):m.failure);"file:"==OpenLayers.Util.createUrlObject(m.url).protocol&&g.responseText&&(g.status=200);l(g);if(!g.status||200<=g.status&&300>g.status){this.events.triggerEvent("success",h),k&&k(g)}if(g.status&&(200>g.status||300<=g.status)){this.events.triggerEvent("failure",h),j&&j(g)}},GET:function(b){b=OpenLayers.Util.extend(b,{method:"GET"});return OpenLayers.Request.issue(b)},POST:function(b){b=OpenLayers.Util.extend(b,{method:"POST"});b.headers=b.headers?b.headers:{};"CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers)||(b.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(b)},PUT:function(b){b=OpenLayers.Util.extend(b,{method:"PUT"});b.headers=b.headers?b.headers:{};"CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers)||(b.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(b)},DELETE:function(b){b=OpenLayers.Util.extend(b,{method:"DELETE"});return OpenLayers.Request.issue(b)},HEAD:function(b){b=OpenLayers.Util.extend(b,{method:"HEAD"});return OpenLayers.Request.issue(b)},OPTIONS:function(b){b=OpenLayers.Util.extend(b,{method:"OPTIONS"});return OpenLayers.Request.issue(b)}};OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(e,d,f){this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults({ServiceName:f.serviceName},this.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(f,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,d,this.params,f]);if(this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format)){this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}null===this.options.layers&&(this.options.layers=[])},getURL:function(d){var c="",d=this.adjustBounds(d),d=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:d.toArray(),tileSize:this.tileSize})),d=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:d.write(),async:!1});if(null!=d){c=d.responseXML;if(!c||!c.documentElement){c=d.responseText}c=this.getUrlOrImage((new OpenLayers.Format.ArcXML).read(c).image.output)}return c},getURLasync:function(e,d,f){e=this.adjustBounds(e);e=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:e.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:e.write(),callback:function(b){var c=b.responseXML;if(!c||!c.documentElement){c=b.responseText}b=(new OpenLayers.Format.ArcXML).read(c);d.call(f,this.getUrlOrImage(b.image.output))},scope:this})},getUrlOrImage:function(d){var c="";d.url?c=d.url:d.data&&(c="data:image/"+d.type+";base64,"+d.data);return c},setLayerQuery:function(e,d){for(var f=0;f<this.options.layers.length;f++){if(e==this.options.layers[f].id){this.options.layers[f].query=d;return}}this.options.layers.push({id:e,visible:!0,query:d})},getFeatureInfo:function(k,j,r){var q=r.buffer||1,p=r.callback||function(){},o=r.scope||window,m={};OpenLayers.Util.extend(m,this.options);m.requesttype="feature";k instanceof OpenLayers.LonLat?(m.polygon=null,m.envelope=[k.lon-q,k.lat-q,k.lon+q,k.lat+q]):k instanceof OpenLayers.Geometry.Polygon&&(m.envelope=null,m.polygon=k);var l=new OpenLayers.Format.ArcXML(m);OpenLayers.Util.extend(l.request.get_feature,r);l.request.get_feature.layer=j.id;"number"==typeof j.query.accuracy?l.request.get_feature.query.accuracy=j.query.accuracy:(k=this.map.getCenter(),r=this.map.getViewPortPxFromLonLat(k),r.x++,r=this.map.getLonLatFromPixel(r),l.request.get_feature.query.accuracy=r.lon-k.lon);l.request.get_feature.query.where=j.query.where;l.request.get_feature.query.spatialfilter.relation="area_intersection";OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:l.write(),callback:function(b){b=l.parseResponse(b.responseText);l.iserror()?p.call(o,null):p.call(o,b.features)}})},clone:function(b){null==b&&(b=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(d,c){c.exceptionReport={version:d.getAttribute("version"),language:d.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(d,c.exceptionReport)},AllowedValues:function(d,c){c.allowedValues={};this.readChildNodes(d,c.allowedValues)},AnyValue:function(d,c){c.anyValue=!0},DataType:function(d,c){c.dataType=this.getChildValue(d)},Range:function(d,c){c.range={};this.readChildNodes(d,c.range)},MinimumValue:function(d,c){c.minValue=this.getChildValue(d)},MaximumValue:function(d,c){c.maxValue=this.getChildValue(d)},Identifier:function(d,c){c.identifier=this.getChildValue(d)},SupportedCRS:function(d,c){c.supportedCRS=this.getChildValue(d)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(d){var c=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":d.closure}});this.writeNode("ows:MinimumValue",d.minValue,c);this.writeNode("ows:MaximumValue",d.maxValue,c);return c},MinimumValue:function(b){return this.createElementNSPlus("ows:MinimumValue",{value:b})},MaximumValue:function(b){return this.createElementNSPlus("ows:MaximumValue",{value:b})},Value:function(b){return this.createElementNSPlus("ows:Value",{value:b})}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(b){b=this.writeNode("wcs:GetCoverage",b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{wcs:{GetCoverage:function(d){var c=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:d.version||this.VERSION,service:"WCS"}});this.writeNode("ows:Identifier",d.identifier,c);this.writeNode("wcs:DomainSubset",d.domainSubset,c);this.writeNode("wcs:Output",d.output,c);return c},DomainSubset:function(d){var c=this.createElementNSPlus("wcs:DomainSubset",{});this.writeNode("ows:BoundingBox",d.boundingBox,c);d.temporalSubset&&this.writeNode("wcs:TemporalSubset",d.temporalSubset,c);return c},TemporalSubset:function(f){for(var e=this.createElementNSPlus("wcs:TemporalSubset",{}),h=0,g=f.timePeriods.length;h<g;++h){this.writeNode("wcs:TimePeriod",f.timePeriods[h],e)}return e},TimePeriod:function(d){var c=this.createElementNSPlus("wcs:TimePeriod",{});this.writeNode("wcs:BeginPosition",d.begin,c);this.writeNode("wcs:EndPosition",d.end,c);d.resolution&&this.writeNode("wcs:TimeResolution",d.resolution,c);return c},BeginPosition:function(b){return this.createElementNSPlus("wcs:BeginPosition",{value:b})},EndPosition:function(b){return this.createElementNSPlus("wcs:EndPosition",{value:b})},TimeResolution:function(b){return this.createElementNSPlus("wcs:TimeResolution",{value:b})},Output:function(d){var c=this.createElementNSPlus("wcs:Output",{attributes:{format:d.format,store:d.store}});d.gridCRS&&this.writeNode("wcs:GridCRS",d.gridCRS,c);return c},GridCRS:function(d){var c=this.createElementNSPlus("wcs:GridCRS",{});this.writeNode("wcs:GridBaseCRS",d.baseCRS,c);d.type&&this.writeNode("wcs:GridType",d.type,c);d.origin&&this.writeNode("wcs:GridOrigin",d.origin,c);this.writeNode("wcs:GridOffsets",d.offsets,c);d.CS&&this.writeNode("wcs:GridCS",d.CS,c);return c},GridBaseCRS:function(b){return this.createElementNSPlus("wcs:GridBaseCRS",{value:b})},GridOrigin:function(b){return this.createElementNSPlus("wcs:GridOrigin",{value:b})},GridType:function(b){return this.createElementNSPlus("wcs:GridType",{value:b})},GridOffsets:function(b){return this.createElementNSPlus("wcs:GridOffsets",{value:b})},GridCS:function(b){return this.createElementNSPlus("wcs:GridCS",{value:b})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"});OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(){},write:function(d){var c;window.ActiveXObject?this.xmldom=c=new ActiveXObject("Microsoft.XMLDOM"):c=document.implementation.createDocument("","",null);d=this.writeNode("wps:Execute",d,c);this.setAttributeNS(d,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[d])},writers:{wps:{Execute:function(d){var c=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});this.writeNode("ows:Identifier",d.identifier,c);this.writeNode("wps:DataInputs",d.dataInputs,c);this.writeNode("wps:ResponseForm",d.responseForm,c);return c},ResponseForm:function(d){var c=this.createElementNSPlus("wps:ResponseForm",{});d.rawDataOutput&&this.writeNode("wps:RawDataOutput",d.rawDataOutput,c);d.responseDocument&&this.writeNode("wps:ResponseDocument",d.responseDocument,c);return c},ResponseDocument:function(d){var c=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:d.storeExecuteResponse,lineage:d.lineage,status:d.status}});d.output&&this.writeNode("wps:Output",d.output,c);return c},Output:function(d){var c=this.createElementNSPlus("wps:Output",{attributes:{asReference:d.asReference}});this.writeNode("ows:Identifier",d.identifier,c);this.writeNode("ows:Title",d.title,c);this.writeNode("ows:Abstract",d["abstract"],c);return c},RawDataOutput:function(d){var c=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:d.mimeType}});this.writeNode("ows:Identifier",d.identifier,c);return c},DataInputs:function(f){for(var e=this.createElementNSPlus("wps:DataInputs",{}),h=0,g=f.length;h<g;++h){this.writeNode("wps:Input",f[h],e)}return e},Input:function(d){var c=this.createElementNSPlus("wps:Input",{});this.writeNode("ows:Identifier",d.identifier,c);d.title&&this.writeNode("ows:Title",d.title,c);d.data&&this.writeNode("wps:Data",d.data,c);d.reference&&this.writeNode("wps:Reference",d.reference,c);return c},Data:function(d){var c=this.createElementNSPlus("wps:Data",{});d.literalData?this.writeNode("wps:LiteralData",d.literalData,c):d.complexData&&this.writeNode("wps:ComplexData",d.complexData,c);return c},LiteralData:function(b){return this.createElementNSPlus("wps:LiteralData",{attributes:{uom:b.uom},value:b.value})},ComplexData:function(e){var d=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}}),f=e.value;"string"===typeof f?d.appendChild(this.getXMLDoc().createCDATASection(e.value)):d.appendChild(f);return d},Reference:function(d){var c=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:d.mimeType,"xlink:href":d.href,method:d.method,encoding:d.encoding,schema:d.schema}});d.body&&this.writeNode("wps:Body",d.body,c);return c},Body:function(d){var c=this.createElementNSPlus("wps:Body",{});d.wcs?this.writeNode("wcs:GetCoverage",d.wcs,c):d.wfs?(this.featureType=d.wfs.featureType,this.version=d.wfs.version,this.writeNode("wfs:GetFeature",d.wfs,c)):this.writeNode("wps:Execute",d,c);return c}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"});OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(b){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);this.removeButtons();this.position=this.buttons=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position;this.buttons=[];var d={w:18,h:18},f=new OpenLayers.Pixel(e.x+d.w/2,e.y);this._addButton("panup","north-mini.png",f,d);e.y=f.y+d.h;this._addButton("panleft","west-mini.png",e,d);this._addButton("panright","east-mini.png",e.add(d.w,0),d);this._addButton("pandown","south-mini.png",f.add(0,2*d.h),d);this._addButton("zoomin","zoom-plus-mini.png",f.add(0,3*d.h+5),d);this._addButton("zoomworld","zoom-world-mini.png",f.add(0,4*d.h+5),d);this._addButton("zoomout","zoom-minus-mini.png",f.add(0,5*d.h+5),d);return this.div},_addButton:function(f,e,h,g){e=OpenLayers.Util.getImageLocation(e);h=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+f,h,g,e,"absolute");h.style.cursor="pointer";this.div.appendChild(h);h.action=f;h.className="olButton";this.buttons.push(h);return h},_removeButton:function(b){this.div.removeChild(b);OpenLayers.Util.removeItem(this.buttons,b)},removeButtons:function(){for(var b=this.buttons.length-1;0<=b;--b){this._removeButton(this.buttons[b])}},onButtonClick:function(b){switch(b.buttonElement.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(b){return this.slideRatio?this.map.getSize()[b]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(b){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar());this.draw()},draw:function(f){OpenLayers.Control.prototype.draw.apply(this,arguments);f=this.position.clone();this.buttons=[];var e={w:18,h:18};if(this.panIcons){var h=new OpenLayers.Pixel(f.x+e.w/2,f.y),g=e.w;this.zoomWorldIcon&&(h=new OpenLayers.Pixel(f.x+e.w,f.y));this._addButton("panup","north-mini.png",h,e);f.y=h.y+e.h;this._addButton("panleft","west-mini.png",f,e);this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",f.add(e.w,0),e),g*=2);this._addButton("panright","east-mini.png",f.add(g,0),e);this._addButton("pandown","south-mini.png",h.add(0,2*e.h),e);this._addButton("zoomin","zoom-plus-mini.png",h.add(0,3*e.h+5),e);h=this._addZoomBar(h.add(0,4*e.h+5));this._addButton("zoomout","zoom-minus-mini.png",h,e)}else{this._addButton("zoomin","zoom-plus-mini.png",f,e),h=this._addZoomBar(f.add(0,e.h)),this._addButton("zoomout","zoom-minus-mini.png",h,e),this.zoomWorldIcon&&(h=h.add(0,e.h+3),this._addButton("zoomworld","zoom-world-mini.png",h,e))}return this.div},_addZoomBar:function(g){var f=OpenLayers.Util.getImageLocation("slider.png"),k=this.id+"_"+this.map.id,j=this.map.getNumZoomLevels()-1-this.map.getZoom(),j=OpenLayers.Util.createAlphaImageDiv(k,g.add(-1,j*this.zoomStopHeight),{w:20,h:9},f,"absolute");j.style.cursor="move";this.slider=j;this.sliderEvents=new OpenLayers.Events(this,j,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var h={w:this.zoomStopWidth,h:this.zoomStopHeight*this.map.getNumZoomLevels()},f=OpenLayers.Util.getImageLocation("zoombar.png"),k=null;OpenLayers.Util.alphaHack()?(k=this.id+"_"+this.map.id,k=OpenLayers.Util.createAlphaImageDiv(k,g,{w:h.w,h:this.zoomStopHeight},f,"absolute",null,"crop"),k.style.height=h.h+"px"):k=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,g,h,f);k.style.cursor="pointer";k.className="olButton";this.zoombarDiv=k;this.div.appendChild(k);this.startTop=parseInt(k.style.top);this.div.appendChild(j);this.map.events.register("zoomend",this,this.moveZoomBar);return g=g.add(0,this.zoomStopHeight*this.map.getNumZoomLevels())},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(d){OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(d.buttonElement===this.zoombarDiv){var c=d.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){c=Math.floor(c)}c=this.map.getNumZoomLevels()-1-c;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(c)}},passEventToSlider:function(b){this.sliderEvents.handleBrowserEvent(b)},zoomBarDown:function(b){if(OpenLayers.Event.isLeftClick(b)||OpenLayers.Event.isSingleTouch(b)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=b.xy.clone(),this.zoomStart=b.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(b)}},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var d=this.mouseDragStart.y-e.xy.y,f=OpenLayers.Util.pagePosition(this.zoombarDiv);0<e.clientY-f[1]&&e.clientY-f[1]<parseInt(this.zoombarDiv.style.height)-2&&(this.slider.style.top=parseInt(this.slider.style.top)-d+"px",this.mouseDragStart=e.xy.clone());this.deltaY=this.zoomStart.y-e.xy.y;OpenLayers.Event.stop(e)}},zoomBarUp:function(d){if((OpenLayers.Event.isLeftClick(d)||"touchend"===d.type)&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var c=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(c+=this.deltaY/this.zoomStopHeight,c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)):(c+=this.deltaY/this.zoomStopHeight,c=Math.max(Math.round(c),0));this.map.zoomTo(c);this.zoomStart=this.mouseDragStart=null;this.deltaY=0;OpenLayers.Event.stop(d)}},moveZoomBar:function(){this.slider.style.top=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{wfs:{WFS_Capabilities:function(d,c){this.readChildNodes(d,c)},FeatureTypeList:function(d,c){c.featureTypeList={featureTypes:[]};this.readChildNodes(d,c.featureTypeList)},FeatureType:function(e,d){var f={};this.readChildNodes(e,f);d.featureTypes.push(f)},Name:function(e,d){var f=this.getChildValue(e);f&&(f=f.split(":"),d.name=f.pop(),0<f.length&&(d.featureNS=this.lookupNamespaceURI(e,f[0])))},Title:function(e,d){var f=this.getChildValue(e);f&&(d.title=f)},Abstract:function(e,d){var f=this.getChildValue(e);f&&(d["abstract"]=f)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(e,d){var f=this.getChildValue(e);f&&(d.srs=f)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(g,f,k,j,h){this.url=f;this.maxExtent=this.extent=k;this.size=j;OpenLayers.Layer.prototype.initialize.apply(this,[g,h]);this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null);OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions()));return b=OpenLayers.Layer.prototype.clone.apply(this,[b])},setMap:function(b){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w);OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(g,f,k){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var j=null==this.tile;if(f||j){this.setTileSize();var h=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});j?(this.tile=new OpenLayers.Tile.Image(this,h,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=h.clone());this.tile.draw()}},setTileSize:function(){var d=this.extent.getWidth()/this.map.getResolution(),c=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(d,c)},addTileMonitoringHooks:function(b){b.onLoadStart=function(){this.events.triggerEvent("loadstart")};b.events.register("loadstart",this,b.onLoadStart);b.onLoadEnd=function(){this.events.triggerEvent("loadend")};b.events.register("loadend",this,b.onLoadEnd);b.events.register("unload",this,b.onLoadEnd)},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,scope:this})},setUrl:function(b){this.url=b;this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b;this.active=!1},destroy:function(){this.deactivate();this.options=this.layer=null},setLayer:function(b){this.layer=b},activate:function(){return !this.active?this.active=!0:!1},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(b){OpenLayers.Strategy.prototype.initialize.apply(this,[b]);this.events=new OpenLayers.Events(this)},activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b&&this.auto){if("number"===typeof this.auto){this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1000*this.auto)}else{this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})}}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.auto&&("number"===typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this}));return b},triggerSave:function(d){var c=d.feature;(c.state===OpenLayers.State.INSERT||c.state===OpenLayers.State.UPDATE||c.state===OpenLayers.State.DELETE)&&this.save([d.feature])},save:function(k){k||(k=this.layer.features);this.events.triggerEvent("start",{features:k});var j=this.layer.projection,r=this.layer.map.getProjectionObject();if(!r.equals(j)){for(var q=k.length,p=Array(q),o,m,l=0;l<q;++l){o=k[l],m=o.clone(),m.fid=o.fid,m.state=o.state,o.url&&(m.url=o.url),m._original=o,m.geometry.transform(r,j),p[l]=m}k=p}this.layer.protocol.commit(k,{callback:this.onCommit,scope:this})},onCommit:function(s){var r={response:s};if(s.success()){for(var q=s.reqFeatures,p,o=[],m=s.insertIds||[],l=0,k=0,j=q.length;k<j;++k){if(p=q[k],p=p._original||p,s=p.state){s==OpenLayers.State.DELETE?o.push(p):s==OpenLayers.State.INSERT&&(p.fid=m[l],++l),p.state=null}}0<o.length&&this.layer.destroyFeatures(o);this.events.triggerEvent("success",r)}else{this.events.triggerEvent("fail",r)}},CLASS_NAME:"OpenLayers.Strategy.Save"});OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(b){this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(u){"string"==typeof u&&(u=OpenLayers.Format.XML.prototype.read.apply(this,[u]));var t=[];if(this.extractTracks){for(var s=u.getElementsByTagName("trk"),r=0,q=s.length;r<q;r++){var p={};this.extractAttributes&&(p=this.parseAttributes(s[r]));for(var o=this.getElementsByTagNameNS(s[r],s[r].namespaceURI,"trkseg"),m=0,l=o.length;m<l;m++){var k=this.extractSegment(o[m],"trkpt");t.push(new OpenLayers.Feature.Vector(k,p))}}}if(this.extractRoutes){q=u.getElementsByTagName("rte");s=0;for(r=q.length;s<r;s++){p={},this.extractAttributes&&(p=this.parseAttributes(q[s])),o=this.extractSegment(q[s],"rtept"),t.push(new OpenLayers.Feature.Vector(o,p))}}if(this.extractWaypoints){u=u.getElementsByTagName("wpt");s=0;for(q=u.length;s<q;s++){p={},this.extractAttributes&&(p=this.parseAttributes(u[s])),r=new OpenLayers.Geometry.Point(u[s].getAttribute("lon"),u[s].getAttribute("lat")),t.push(new OpenLayers.Feature.Vector(r,p))}}if(this.internalProjection&&this.externalProjection){p=0;for(u=t.length;p<u;p++){t[p].geometry.transform(this.externalProjection,this.internalProjection)}}return t},extractSegment:function(h,g){for(var m=this.getElementsByTagNameNS(h,h.namespaceURI,g),l=[],k=0,j=m.length;k<j;k++){l.push(new OpenLayers.Geometry.Point(m[k].getAttribute("lon"),m[k].getAttribute("lat")))}return new OpenLayers.Geometry.LineString(l)},parseAttributes:function(f){for(var e={},f=f.firstChild,h,g;f;){if(1==f.nodeType&&f.firstChild&&(h=f.firstChild,3==h.nodeType||4==h.nodeType)){g=f.prefix?f.nodeName.split(":")[1]:f.nodeName,"trkseg"!=g&&"rtept"!=g&&(e[g]=h.nodeValue)}f=f.nextSibling}return e},write:function(g,f){var g=OpenLayers.Util.isArray(g)?g:[g],k=this.createElementNS(this.namespaces.gpx,"gpx");k.setAttribute("version","1.1");k.setAttribute("creator",this.creator);this.setAttributes(k,{"xsi:schemaLocation":this.schemaLocation});f&&"object"==typeof f&&k.appendChild(this.buildMetadataNode(f));for(var j=0,h=g.length;j<h;j++){k.appendChild(this.buildFeatureNode(g[j]))}return OpenLayers.Format.XML.prototype.write.apply(this,[k])},buildMetadataNode:function(h){for(var g=["name","desc","author"],m=this.createElementNSPlus("gpx:metadata"),l=0;l<g.length;l++){var k=g[l];if(h[k]){var j=this.createElementNSPlus("gpx:"+k);j.appendChild(this.createTextNode(h[k]));m.appendChild(j)}}return m},buildFeatureNode:function(f){var e=f.geometry,e=e.clone();this.internalProjection&&this.externalProjection&&e.transform(this.internalProjection,this.externalProjection);if("OpenLayers.Geometry.Point"==e.CLASS_NAME){var h=this.buildWptNode(e);this.appendAttributesNode(h,f);return h}h=this.createElementNSPlus("gpx:trk");this.appendAttributesNode(h,f);for(var f=this.buildTrkSegNode(e),f=OpenLayers.Util.isArray(f)?f:[f],e=0,g=f.length;e<g;e++){h.appendChild(f[e])}return h},buildTrkSegNode:function(g){var f,k,j,h;if("OpenLayers.Geometry.LineString"==g.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==g.CLASS_NAME){f=this.createElementNSPlus("gpx:trkseg");k=0;for(j=g.components.length;k<j;k++){h=g.components[k],f.appendChild(this.buildTrkPtNode(h))}return f}f=[];k=0;for(j=g.components.length;k<j;k++){f.push(this.buildTrkSegNode(g.components[k]))}return f},buildTrkPtNode:function(d){var c=this.createElementNSPlus("gpx:trkpt");c.setAttribute("lon",d.x);c.setAttribute("lat",d.y);return c},buildWptNode:function(d){var c=this.createElementNSPlus("gpx:wpt");c.setAttribute("lon",d.x);c.setAttribute("lat",d.y);return c},appendAttributesNode:function(e,d){var f=this.createElementNSPlus("gpx:name");f.appendChild(this.createTextNode(d.attributes.name||d.id));e.appendChild(f);f=this.createElementNSPlus("gpx:desc");f.appendChild(this.createTextNode(d.attributes.description||this.defaultDesc));e.appendChild(f)},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",getVersion:function(e,d){var f=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);if("1.1.1"==f||"1.1.0"==f){f="1.1"}return f},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});OpenLayers.Format.WMSDescribeLayer.v1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(b){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[b])},read:function(k){"string"==typeof k&&(k=OpenLayers.Format.XML.prototype.read.apply(this,[k]));for(var k=k.documentElement.childNodes,j=[],r,q,p=0;p<k.length;++p){if(r=k[p],q=r.nodeName,"LayerDescription"==q){q=r.getAttribute("name");var o="",m="",l="";r.getAttribute("owsType")?(o=r.getAttribute("owsType"),m=r.getAttribute("owsURL")):""!=r.getAttribute("wfs")?(o="WFS",m=r.getAttribute("wfs")):""!=r.getAttribute("wcs")&&(o="WCS",m=r.getAttribute("wcs"));r=r.getElementsByTagName("Query");0<r.length&&((l=r[0].getAttribute("typeName"))||(l=r[0].getAttribute("typename")));j.push({layerName:q,owsType:o,owsURL:m,typeName:l})}}return j},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,d,f){if(f&&f.sphericalMercator||this.sphericalMercator){f=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},f)}OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,d||this.url,{},f])},clone:function(b){null==b&&(b=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(d){var d=this.getXYZ(d),c=this.url;OpenLayers.Util.isArray(c)&&(c=this.selectUrl(""+d.x+d.y+d.z,c));return OpenLayers.String.format(c,d)},getXYZ:function(f){var e=this.getServerResolution(),h=Math.round((f.left-this.maxExtent.left)/(e*this.tileSize.w)),f=Math.round((this.maxExtent.top-f.top)/(e*this.tileSize.h)),e=this.getServerZoom();if(this.wrapDateLine){var g=Math.pow(2,e),h=(h%g+g)%g}return{x:h,y:f,z:e}},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(e,d,f){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(b){null==b&&(b=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(d,c){this.container=OpenLayers.Util.getElement(d);OpenLayers.Util.extend(this,c)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return !1},setExtent:function(e,d){this.extent=e.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var f=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/f);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(f)}d&&(this.resolution=null);return !0},setSize:function(b){this.size=b.clone();this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(j,h){null==h&&(h=j.style);if(j.geometry){var p=j.geometry.getBounds();if(p){var o;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(o=this.map.getMaxExtent());p.intersectsBounds(this.extent,{worldBounds:o})?this.calculateFeatureDx(p,o):h={display:"none"};p=this.drawGeometry(j.geometry,h,j.id);if("none"!=h.display&&h.label&&!1!==p){o=j.geometry.getCentroid();if(h.labelXOffset||h.labelYOffset){var m=isNaN(h.labelXOffset)?0:h.labelXOffset,l=isNaN(h.labelYOffset)?0:h.labelYOffset,k=this.getResolution();o.move(m*k,l*k)}this.drawText(j.id,h,o)}else{this.removeText(j.id)}return p}}},calculateFeatureDx:function(e,d){this.featureDx=0;if(d){var f=d.getWidth();this.featureDx=Math.round(((e.left+e.right)/2-(this.extent.left+this.extent.right)/2)/f)*f}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(f){OpenLayers.Util.isArray(f)||(f=[f]);for(var e=0,h=f.length;e<h;++e){var g=f[e];this.eraseGeometry(g.geometry,g.id);this.removeText(g.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(d){var c=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);!1===d.stroke&&(delete c.strokeWidth,delete c.strokeColor);!1===d.fill&&delete c.fillColor;OpenLayers.Util.extend(c,d);return c},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(d,c){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return !1},eraseGeometry:function(d,c){this.eraseFeatures(this.features[c][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(d){this.size=d.clone();var c=this.root;c.style.width=d.w+"px";c.style.height=d.h+"px";c.width=d.w;c.height=d.h;this.resolution=null;this.hitDetection&&(c=this.hitCanvas,c.style.width=d.w+"px",c.style.height=d.h+"px",c.width=d.w,c.height=d.h)},drawFeature:function(f,e){var h;if(f.geometry){e=this.applyDefaultSymbolizer(e||f.style);h=f.geometry.getBounds();var g;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(g=this.map.getMaxExtent());g=h&&h.intersectsBounds(this.extent,{worldBounds:g});(h="none"!==e.display&&!!h&&g)?this.features[f.id]=[f,e]:delete this.features[f.id];this.pendingRedraw=!0}this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1);return h},drawGeometry:function(f,e,h){var g=f.CLASS_NAME;if("OpenLayers.Geometry.Collection"==g||"OpenLayers.Geometry.MultiPoint"==g||"OpenLayers.Geometry.MultiLineString"==g||"OpenLayers.Geometry.MultiPolygon"==g){for(g=0;g<f.components.length;g++){this.drawGeometry(f.components[g],e,h)}}else{switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(f,e,h);break;case"OpenLayers.Geometry.LineString":this.drawLineString(f,e,h);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(f,e,h);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(f,e,h)}}},drawExternalGraphic:function(s,r,q){var p=new Image;r.graphicTitle&&(p.title=r.graphicTitle);var o=r.graphicWidth||r.graphicHeight,m=r.graphicHeight||r.graphicWidth,o=o?o:2*r.pointRadius,m=m?m:2*r.pointRadius,l=void 0!=r.graphicXOffset?r.graphicXOffset:-(0.5*o),k=void 0!=r.graphicYOffset?r.graphicYOffset:-(0.5*m),j=r.graphicOpacity||r.fillOpacity;p.onload=OpenLayers.Function.bind(function(){if(this.features[q]){var c=this.getLocalXY(s),e=c[0],c=c[1];if(!isNaN(e)&&!isNaN(c)){var e=e+l|0,c=c+k|0,d=this.canvas;d.globalAlpha=j;var a=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);d.drawImage(p,e*a,c*a,o*a,m*a);if(this.hitDetection){this.setHitContextStyle("fill",q);this.hitContext.fillRect(e,c,o,m)}}}},this);p.src=r.externalGraphic},drawNamedSymbol:function(k,j,r){var q,p,o,m;o=Math.PI/180;var l=OpenLayers.Renderer.symbol[j.graphicName];if(!l){throw Error(j.graphicName+" is not a valid symbol name")}if(l.length&&!(2>l.length)&&(k=this.getLocalXY(k),p=k[0],m=k[1],!isNaN(p)&&!isNaN(m))){this.canvas.lineCap="round";this.canvas.lineJoin="round";this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round");if(j.graphicName in this.cachedSymbolBounds){q=this.cachedSymbolBounds[j.graphicName]}else{q=new OpenLayers.Bounds;for(k=0;k<l.length;k+=2){q.extend(new OpenLayers.LonLat(l[k],l[k+1]))}this.cachedSymbolBounds[j.graphicName]=q}this.canvas.save();this.hitDetection&&this.hitContext.save();this.canvas.translate(p,m);this.hitDetection&&this.hitContext.translate(p,m);k=o*j.rotation;isNaN(k)||(this.canvas.rotate(k),this.hitDetection&&this.hitContext.rotate(k));o=2*j.pointRadius/Math.max(q.getWidth(),q.getHeight());this.canvas.scale(o,o);this.hitDetection&&this.hitContext.scale(o,o);k=q.getCenterLonLat().lon;q=q.getCenterLonLat().lat;this.canvas.translate(-k,-q);this.hitDetection&&this.hitContext.translate(-k,-q);m=j.strokeWidth;j.strokeWidth=m/o;if(!1!==j.fill){this.setCanvasStyle("fill",j);this.canvas.beginPath();for(k=0;k<l.length;k+=2){q=l[k],p=l[k+1],0==k&&this.canvas.moveTo(q,p),this.canvas.lineTo(q,p)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",r,j);this.hitContext.beginPath();for(k=0;k<l.length;k+=2){q=l[k],p=l[k+1],0==k&&this.canvas.moveTo(q,p),this.hitContext.lineTo(q,p)}this.hitContext.closePath();this.hitContext.fill()}}if(!1!==j.stroke){this.setCanvasStyle("stroke",j);this.canvas.beginPath();for(k=0;k<l.length;k+=2){q=l[k],p=l[k+1],0==k&&this.canvas.moveTo(q,p),this.canvas.lineTo(q,p)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",r,j,o);this.hitContext.beginPath();for(k=0;k<l.length;k+=2){q=l[k],p=l[k+1],0==k&&this.hitContext.moveTo(q,p),this.hitContext.lineTo(q,p)}this.hitContext.closePath();this.hitContext.stroke()}}j.strokeWidth=m;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle("reset")}},setCanvasStyle:function(d,c){"fill"===d?(this.canvas.globalAlpha=c.fillOpacity,this.canvas.fillStyle=c.fillColor):"stroke"===d?(this.canvas.globalAlpha=c.strokeOpacity,this.canvas.strokeStyle=c.strokeColor,this.canvas.lineWidth=c.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(d){d=Number(d.split("_").pop())+1;16777216<=d&&(this.hitOverflow=d-16777215,d=d%16777216+1);var d="000000"+d.toString(16),c=d.length;return d="#"+d.substring(c-6,c)},setHitContextStyle:function(f,e,h,g){e=this.featureIdToHex(e);"fill"==f?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=e):"stroke"==f?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=e,"undefined"===typeof g?this.hitContext.lineWidth=h.strokeWidth+2:isNaN(g)||(this.hitContext.lineWidth=h.strokeWidth+2/g)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(h,g,m){if(!1!==g.graphic){if(g.externalGraphic){this.drawExternalGraphic(h,g,m)}else{if(g.graphicName&&"circle"!=g.graphicName){this.drawNamedSymbol(h,g,m)}else{var l=this.getLocalXY(h),h=l[0],l=l[1];if(!isNaN(h)&&!isNaN(l)){var k=2*Math.PI,j=g.pointRadius;!1!==g.fill&&(this.setCanvasStyle("fill",g),this.canvas.beginPath(),this.canvas.arc(h,l,j,0,k,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",m,g),this.hitContext.beginPath(),this.hitContext.arc(h,l,j,0,k,!0),this.hitContext.fill()));!1!==g.stroke&&(this.setCanvasStyle("stroke",g),this.canvas.beginPath(),this.canvas.arc(h,l,j,0,k,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",m,g),this.hitContext.beginPath(),this.hitContext.arc(h,l,j,0,k,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}}}},drawLineString:function(e,d,f){d=OpenLayers.Util.applyDefaults({fill:!1},d);this.drawLinearRing(e,d,f)},drawLinearRing:function(e,d,f){!1!==d.fill&&(this.setCanvasStyle("fill",d),this.renderPath(this.canvas,e,d,f,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",f,d),this.renderPath(this.hitContext,e,d,f,"fill")));!1!==d.stroke&&(this.setCanvasStyle("stroke",d),this.renderPath(this.canvas,e,d,f,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",f,d),this.renderPath(this.hitContext,e,d,f,"stroke")));this.setCanvasStyle("reset")},renderPath:function(h,g,m,l,k){g=g.components;m=g.length;h.beginPath();var l=this.getLocalXY(g[0]),j=l[1];if(!isNaN(l[0])&&!isNaN(j)){h.moveTo(l[0],l[1]);for(l=1;l<m;++l){j=this.getLocalXY(g[l]),h.lineTo(j[0],j[1])}"fill"===k?h.fill():h.stroke()}},drawPolygon:function(g,f,k){var g=g.components,j=g.length;this.drawLinearRing(g[0],f,k);for(var h=1;h<j;++h){this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(g[h],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},f),k),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(g[h],OpenLayers.Util.applyDefaults({fill:!1},f),k)}},drawText:function(u,t){var s=this.getLocalXY(u);this.setCanvasStyle("reset");this.canvas.fillStyle=t.fontColor;this.canvas.globalAlpha=t.fontOpacity||1;var r=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),q=t.label.split("\n"),p=q.length;if(this.canvas.fillText){this.canvas.font=r;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var o=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==o&&(o=-0.5);r=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;s[1]+=r*o*(p-1);for(o=0;o<p;o++){t.labelOutlineWidth&&(this.canvas.save(),this.canvas.strokeStyle=t.labelOutlineColor,this.canvas.lineWidth=t.labelOutlineWidth,this.canvas.strokeText(q[o],s[0],s[1]+r*o+1),this.canvas.restore()),this.canvas.fillText(q[o],s[0],s[1]+r*o)}}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=r;var m=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==m&&(m=-0.5);o=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==o&&(o=-0.5);r=this.canvas.mozMeasureText("xx");s[1]+=r*(1+o*p);for(o=0;o<p;o++){var l=s[0]+m*this.canvas.mozMeasureText(q[o]),k=s[1]+o*r;this.canvas.translate(l,k);this.canvas.mozDrawText(q[o]);this.canvas.translate(-l,-k)}}}this.setCanvasStyle("reset")},getLocalXY:function(e){var d=this.getResolution(),f=this.extent;return[(e.x-this.featureDx)/d+-f.left/d,f.top/d-e.y/d]},clear:function(){var d=this.root.height,c=this.root.width;this.canvas.clearRect(0,0,c,d);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,c,d)},getFeatureIdFromEvent:function(e){var d;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging&&(e=e.xy,e=this.hitContext.getImageData(e.x|0,e.y|0,1,1).data,255===e[3]&&(e=e[2]+256*(e[1]+256*e[0])))){e="OpenLayers.Feature.Vector_"+(e-1+this.hitOverflow);try{d=this.features[e][0]}catch(f){}}return d},eraseFeatures:function(d){OpenLayers.Util.isArray(d)||(d=[d]);for(var c=0;c<d.length;++c){delete this.features[d[c].id]}this.redraw()},redraw:function(){if(!this.locked){var h=this.root.height,g=this.root.width;this.canvas.clearRect(0,0,g,h);this.hitDetection&&this.hitContext.clearRect(0,0,g,h);var h=[],m,l,k=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent(),j;for(j in this.features){this.features.hasOwnProperty(j)&&(g=this.features[j][0],m=g.geometry,this.calculateFeatureDx(m.getBounds(),k),l=this.features[j][1],this.drawGeometry(m,l,g.id),l.label&&h.push([g,l]))}g=0;for(m=h.length;g<m;++g){j=h[g],this.drawText(j[0].geometry.getCentroid(),j[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(e){for(var d={interestingTagsExclude:"source source_ref source:ref history attribution created_by".split(" "),areaTags:"area building leisure tourism ruins historic landuse military natural sport".split(" ")},d=OpenLayers.Util.extend(d,e),f={},e=0;e<d.interestingTagsExclude.length;e++){f[d.interestingTagsExclude[e]]=!0}d.interestingTagsExclude=f;f={};for(e=0;e<d.areaTags.length;e++){f[d.areaTags[e]]=!0}d.areaTags=f;this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[d])},read:function(u){"string"==typeof u&&(u=OpenLayers.Format.XML.prototype.read.apply(this,[u]));for(var t=this.getNodes(u),s=this.getWays(u),u=Array(s.length),r=0;r<s.length;r++){for(var q=Array(s[r].nodes.length),p=this.isWayArea(s[r])?1:0,o=0;o<s[r].nodes.length;o++){var m=t[s[r].nodes[o]],l=new OpenLayers.Geometry.Point(m.lon,m.lat);l.osm_id=parseInt(s[r].nodes[o]);q[o]=l;m.used=!0}m=null;m=p?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(q)):new OpenLayers.Geometry.LineString(q);this.internalProjection&&this.externalProjection&&m.transform(this.externalProjection,this.internalProjection);q=new OpenLayers.Feature.Vector(m,s[r].tags);q.osm_id=parseInt(s[r].id);q.fid="way."+q.osm_id;u[r]=q}for(var k in t){m=t[k];if(!m.used||this.checkTags){s=null;if(this.checkTags){s=this.getTags(m.node,!0);if(m.used&&!s[1]){continue}s=s[0]}else{s=this.getTags(m.node)}q=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(m.lon,m.lat),s);this.internalProjection&&this.externalProjection&&q.geometry.transform(this.externalProjection,this.internalProjection);q.osm_id=parseInt(k);q.fid="node."+q.osm_id;u.push(q)}m.node=null}return u},getNodes:function(g){for(var g=g.getElementsByTagName("node"),f={},k=0;k<g.length;k++){var j=g[k],h=j.getAttribute("id");f[h]={lat:j.getAttribute("lat"),lon:j.getAttribute("lon"),node:j}}return f},getWays:function(h){for(var h=h.getElementsByTagName("way"),g=[],m=0;m<h.length;m++){var l=h[m],k={id:l.getAttribute("id")};k.tags=this.getTags(l);l=l.getElementsByTagName("nd");k.nodes=Array(l.length);for(var j=0;j<l.length;j++){k.nodes[j]=l[j].getAttribute("ref")}g.push(k)}return g},getTags:function(j,h){for(var p=j.getElementsByTagName("tag"),o={},m=!1,l=0;l<p.length;l++){var k=p[l].getAttribute("k");o[k]=p[l].getAttribute("v");h&&(this.interestingTagsExclude[k]||(m=!0))}return h?[o,m]:o},isWayArea:function(f){var e=!1,h=!1;f.nodes[0]==f.nodes[f.nodes.length-1]&&(e=!0);if(this.checkTags){for(var g in f.tags){if(this.areaTags[g]){h=!0;break}}}return e&&(this.checkTags?h:!0)},write:function(g){OpenLayers.Util.isArray(g)||(g=[g]);this.osm_id=1;this.created_nodes={};var f=this.createElementNS(null,"osm");f.setAttribute("version","0.5");f.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var k=g.length-1;0<=k;k--){for(var j=this.createFeatureNodes(g[k]),h=0;h<j.length;h++){f.appendChild(j[h])}}return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createFeatureNodes:function(e){var d=[],f=e.geometry.CLASS_NAME,f=f.substring(f.lastIndexOf(".")+1),f=f.toLowerCase();(f=this.createXML[f])&&(d=f.apply(this,[e]));return d},createXML:{point:function(g){var f=null,k=g.geometry?g.geometry:g;this.internalProjection&&this.externalProjection&&(k=k.clone(),k.transform(this.internalProjection,this.externalProjection));var j=!1;g.osm_id?(f=g.osm_id,this.created_nodes[f]&&(j=!0)):(f=-this.osm_id,this.osm_id++);var h=j?this.created_nodes[f]:this.createElementNS(null,"node");this.created_nodes[f]=h;h.setAttribute("id",f);h.setAttribute("lon",k.x);h.setAttribute("lat",k.y);g.attributes&&this.serializeTags(g,h);this.setState(g,h);return j?[]:[h]},linestring:function(j){var h,p=[],o=j.geometry;j.osm_id?h=j.osm_id:(h=-this.osm_id,this.osm_id++);var m=this.createElementNS(null,"way");m.setAttribute("id",h);for(h=0;h<o.components.length;h++){var l=this.createXML.point.apply(this,[o.components[h]]);if(l.length){var l=l[0],k=l.getAttribute("id");p.push(l)}else{k=o.components[h].osm_id,l=this.created_nodes[k]}this.setState(j,l);l=this.createElementNS(null,"nd");l.setAttribute("ref",k);m.appendChild(l)}this.serializeTags(j,m);p.push(m);return p},polygon:function(d){var c=OpenLayers.Util.extend({area:"yes"},d.attributes),c=new OpenLayers.Feature.Vector(d.geometry.components[0],c);c.osm_id=d.osm_id;return this.createXML.linestring.apply(this,[c])}},serializeTags:function(f,e){for(var h in f.attributes){var g=this.createElementNS(null,"tag");g.setAttribute("k",h);g.setAttribute("v",f.attributes[h]);e.appendChild(g)}},setState:function(e,d){if(e.state){var f=null;switch(e.state){case OpenLayers.State.UPDATE:case OpenLayers.State.DELETE:f="delete"}f&&d.setAttribute("action",f)}},CLASS_NAME:"OpenLayers.Format.OSM"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,initialize:function(e,d,f){OpenLayers.Util.extend(this,f);this.control=e;this.callbacks=d;(e=this.map||e.map)&&this.setMap(e);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(b){this.map=b},checkModifiers:function(b){return null==this.keyMask?!0:((b.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(b.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(b.altKey?OpenLayers.Handler.MOD_ALT:0))==this.keyMask},activate:function(){if(this.active){return !1}for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,d=0,f=e.length;d<f;d++){this[e[d]]&&this.register(e[d],this[e[d]])}return this.active=!0},deactivate:function(){if(!this.active){return !1}for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,d=0,f=e.length;d<f;d++){this[e[d]]&&this.unregister(e[d],this[e[d]])}this.active=!1;return !0},callback:function(d,c){d&&this.callbacks[d]&&this.callbacks[d].apply(this.control,c)},register:function(d,c){this.map.events.registerPriority(d,this,c);this.map.events.registerPriority(d,this,this.setEvent)},unregister:function(d,c){this.map.events.unregister(d,this,c);this.map.events.unregister(d,this,this.setEvent)},setEvent:function(b){this.evt=b;return !0},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,touch:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(f,e,h){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(!0===this.documentDrag){var g=this;this._docMove=function(b){g.mousemove({xy:{x:b.clientX,y:b.clientY},element:document})};this._docUp=function(b){g.mouseup({xy:{x:b.clientX,y:b.clientY}})}}},dragstart:function(d){var c=!0;this.dragging=!1;this.checkModifiers(d)&&(OpenLayers.Event.isLeftClick(d)||OpenLayers.Event.isSingleTouch(d))?(this.started=!0,this.last=this.start=d.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(d),this.callback("down",[d.xy]),OpenLayers.Event.stop(d),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,c=!this.stopDown):(this.started=!1,this.last=this.start=null);return c},dragmove:function(b){this.lastMoveEvt=b;if(this.started&&!this.timeoutId&&(b.xy.x!=this.last.x||b.xy.y!=this.last.y)){!0===this.documentDrag&&this.documentEvents&&(b.element===document?(this.adjustXY(b),this.setEvent(b)):this.removeDocumentEvents()),0<this.interval&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(b),this.callback("move",[b.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=b.xy}return !0},dragend:function(d){if(this.started){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(d),this.removeDocumentEvents());var c=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(d);this.callback("up",[d.xy]);c&&this.callback("done",[d.xy]);document.onselectstart=this.oldOnselectstart}return !0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(b){return this.dragstart(b)},touchstart:function(b){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this}));return this.dragstart(b)},mousemove:function(b){return this.dragmove(b)},touchmove:function(b){return this.dragmove(b)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(b){return this.dragend(b)},touchend:function(b){b.xy=this.last;return this.dragend(b)},mouseout:function(d){if(this.started&&OpenLayers.Util.mouseLeft(d,this.map.viewPortDiv)){if(!0===this.documentDrag){this.addDocumentEvents()}else{var c=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(d);this.callback("out",[]);c&&this.callback("done",[d.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}}return !0},click:function(){return this.start==this.last},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=this.touch=!1,this.last=this.start=null,b=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"));return b},adjustXY:function(d){var c=OpenLayers.Util.pagePosition(this.map.viewPortDiv);d.xy.x-=c[0];d.xy.y-=c[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:!1,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(f,e,h,g){OpenLayers.Handler.prototype.initialize.apply(this,[f,h,g]);this.layer=e},touchstart:function(b){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));return OpenLayers.Event.isMultiTouch(b)?!0:this.mousedown(b)},touchmove:function(b){OpenLayers.Event.stop(b)},mousedown:function(b){if(OpenLayers.Event.isLeftClick(b)||OpenLayers.Event.isSingleTouch(b)){this.down=b.xy}return this.handle(b)?!this.stopDown:!0},mouseup:function(b){this.up=b.xy;return this.handle(b)?!this.stopUp:!0},click:function(b){return this.handle(b)?!this.stopClick:!0},mousemove:function(b){if(!this.callbacks.over&&!this.callbacks.out){return !0}this.handle(b);return !0},dblclick:function(b){return !this.handle(b)},geometryTypeMatches:function(b){return null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)},handle:function(g){this.feature&&!this.feature.layer&&(this.feature=null);var f=g.type,k=!1,j=!!this.feature,h="click"==f||"dblclick"==f||"touchstart"==f;if((this.feature=this.layer.getFeatureFromEvent(g))&&!this.feature.layer){this.feature=null}this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null);this.feature?("touchstart"===f&&OpenLayers.Event.stop(g),g=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(j&&g?(this.lastFeature&&this.triggerCallback(f,"out",[this.lastFeature]),this.triggerCallback(f,"in",[this.feature])):(!j||h)&&this.triggerCallback(f,"in",[this.feature]),this.lastFeature=this.feature,k=!0):(this.lastFeature&&(j&&g||h)&&this.triggerCallback(f,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(j||h)&&this.triggerCallback(f,"out",[this.lastFeature]);return k},triggerCallback:function(e,d,f){(d=this.EVENTMAP[e][d])&&("click"==e&&this.up&&this.down?Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(d,f):this.callback(d,f))},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.touch=!1,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),b=!0);return b},handleMapEvents:function(b){("removelayer"==b.type||"order"==b.property)&&this.moveLayerToTop()},moveLayerToTop:function(){this.layer.setZIndex(Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1)},moveLayerBack:function(){var b=this.layer.getZIndex()-1;b>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(b):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(d,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.layer=d;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(b){this.handlers.feature.touch&&(!this.over&&this.overFeature(b))&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(b){this.handlers.feature.touch&&this.over&&(this.outFeature(b),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(d){var c=!1;this.handlers.drag.dragging?this.over=this.feature.id==d.id?!0:!1:(this.feature=d,this.handlers.drag.activate(),this.over=c=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(d));return c},downFeature:function(b){this.lastPixel=b;this.onStart(this.feature,b)},moveFeature:function(d){var c=this.map.getResolution();this.feature.geometry.move(c*(d.x-this.lastPixel.x),c*(this.lastPixel.y-d.y));this.layer.drawFeature(this.feature);this.lastPixel=d;this.onDrag(this.feature,d)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(b){this.onComplete(this.feature,b)},outFeature:function(b){this.handlers.drag.dragging?this.feature.id==b.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(b),this.feature=null)},cancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(b){this.handlers.drag.setMap(b);this.handlers.feature.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,d){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(e instanceof OpenLayers.Style){this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e}else{if("object"==typeof e){for(var f in e){if(e[f] instanceof OpenLayers.Style){this.styles[f]=e[f]}else{if("object"==typeof e[f]){this.styles[f]=new OpenLayers.Style(e[f])}else{this.styles["default"]=new OpenLayers.Style(e);this.styles.select=new OpenLayers.Style(e);this.styles.temporary=new OpenLayers.Style(e);this.styles["delete"]=new OpenLayers.Style(e);break}}}}}OpenLayers.Util.extend(this,d)},destroy:function(){for(var b in this.styles){this.styles[b].destroy()}this.styles=null},createSymbolizer:function(e,d){e||(e=new OpenLayers.Feature.Vector);this.styles[d]||(d="default");e.renderIntent=d;var f={};this.extendDefault&&"default"!=d&&(f=this.styles["default"].createSymbolizer(e));return OpenLayers.Util.extend(f,this.styles[d].createSymbolizer(e))},addUniqueValueRules:function(h,g,m,l){var k=[],j;for(j in m){k.push(new OpenLayers.Rule({symbolizer:m[j],context:l,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:g,value:j})}))}this.styles[h].addRules(k)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(f,e){OpenLayers.Layer.prototype.initialize.apply(this,arguments);(!this.renderer||!this.renderer.supported())&&this.assignRenderer();if(!this.renderer||!this.renderer.supported()){this.renderer=null,this.displayError()}this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var h=0,g=this.strategies.length;h<g;h++){this.strategies[h].setLayer(this)}}},destroy:function(){if(this.strategies){var e,d,f;d=0;for(f=this.strategies.length;d<f;d++){e=this.strategies[d],e.autoDestroy&&e.destroy()}this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null);this.destroyFeatures();this.unrenderedFeatures=this.selectedFeatures=this.features=null;this.renderer&&this.renderer.destroy();this.drawn=this.geometryType=this.renderer=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(g){null==g&&(g=new OpenLayers.Layer.Vector(this.name,this.getOptions()));for(var g=OpenLayers.Layer.prototype.clone.apply(this,[g]),f=this.features,k=f.length,j=Array(k),h=0;h<k;++h){j[h]=f[h].clone()}g.features=j;return g},refresh:function(b){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",b)},assignRenderer:function(){for(var e=0,d=this.renderers.length;e<d;e++){var f=this.renderers[e];if((f="function"==typeof f?f:OpenLayers.Renderer[f])&&f.prototype.supported()){this.renderer=new f(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(d){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(this.renderer){this.renderer.map=this.map;var c=this.map.getSize();c.w*=this.ratio;c.h*=this.ratio;this.renderer.setSize(c)}else{this.map.removeLayer(this)}},afterAdd:function(){if(this.strategies){var e,d,f;d=0;for(f=this.strategies.length;d<f;d++){e=this.strategies[d],e.autoActivate&&e.activate()}}},removeMap:function(){this.drawn=!1;if(this.strategies){var e,d,f;d=0;for(f=this.strategies.length;d<f;d++){e=this.strategies[d],e.autoActivate&&e.deactivate()}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var b=this.map.getSize();b.w*=this.ratio;b.h*=this.ratio;this.renderer.setSize(b)},moveTo:function(h,g,m){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var l=!0;if(!m){this.renderer.root.style.visibility="hidden";var l=this.map.getSize(),k=l.w,l=l.h,k=k/2*this.ratio-k/2,l=l/2*this.ratio-l/2,k=k+parseInt(this.map.layerContainerDiv.style.left,10),k=-Math.round(k),l=l+parseInt(this.map.layerContainerDiv.style.top,10),l=-Math.round(l);this.div.style.left=k+"px";this.div.style.top=l+"px";l=this.renderer.setExtent(this.map.getExtent().scale(this.ratio),g);this.renderer.root.style.visibility="visible";!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft);if(!g&&l){for(var j in this.unrenderedFeatures){k=this.unrenderedFeatures[j],this.drawFeature(k)}}}if(!this.drawn||g||!l){this.drawn=!0;j=0;for(l=this.features.length;j<l;j++){this.renderer.locked=j!==l-1,k=this.features[j],this.drawFeature(k)}}},display:function(d){OpenLayers.Layer.prototype.display.apply(this,arguments);var c=this.div.style.display;c!=this.renderer.root.style.display&&(this.renderer.root.style.display=c)},addFeatures:function(j,h){OpenLayers.Util.isArray(j)||(j=[j]);var p=!h||!h.silent;if(p){var o={features:j};if(!1===this.events.triggerEvent("beforefeaturesadded",o)){return}j=o.features}for(var o=[],m=0,l=j.length;m<l;m++){this.renderer.locked=m!=j.length-1?!0:!1;var k=j[m];if(this.geometryType&&!(k.geometry instanceof this.geometryType)){throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME)}k.layer=this;!k.style&&this.style&&(k.style=OpenLayers.Util.extend({},this.style));if(p){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:k})){continue}this.preFeatureInsert(k)}o.push(k);this.features.push(k);this.drawFeature(k);p&&(this.events.triggerEvent("featureadded",{feature:k}),this.onFeatureInsert(k))}p&&this.events.triggerEvent("featuresadded",{features:o})},removeFeatures:function(g,f){if(g&&0!==g.length){if(g===this.features){return this.removeAllFeatures(f)}OpenLayers.Util.isArray(g)||(g=[g]);g===this.selectedFeatures&&(g=g.slice());var k=!f||!f.silent;k&&this.events.triggerEvent("beforefeaturesremoved",{features:g});for(var j=g.length-1;0<=j;j--){this.renderer.locked=0!=j&&g[j-1].geometry?!0:!1;var h=g[j];delete this.unrenderedFeatures[h.id];k&&this.events.triggerEvent("beforefeatureremoved",{feature:h});this.features=OpenLayers.Util.removeItem(this.features,h);h.layer=null;h.geometry&&this.renderer.eraseFeatures(h);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,h)&&OpenLayers.Util.removeItem(this.selectedFeatures,h);k&&this.events.triggerEvent("featureremoved",{feature:h})}k&&this.events.triggerEvent("featuresremoved",{features:g})}},removeAllFeatures:function(f){var f=!f||!f.silent,e=this.features;f&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var h,g=e.length-1;0<=g;g--){h=e[g],f&&this.events.triggerEvent("beforefeatureremoved",{feature:h}),h.layer=null,f&&this.events.triggerEvent("featureremoved",{feature:h})}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];f&&this.events.triggerEvent("featuresremoved",{features:e})},destroyFeatures:function(e,d){void 0==e&&(e=this.features);if(e){this.removeFeatures(e,d);for(var f=e.length-1;0<=f;f--){e[f].destroy()}}},drawFeature:function(e,d){if(this.drawn){if("object"!=typeof d){!d&&e.state===OpenLayers.State.DELETE&&(d="delete");var f=d||e.renderIntent;(d=e.style||this.style)||(d=this.styleMap.createSymbolizer(e,f))}f=this.renderer.drawFeature(e,d);!1===f||null===f?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(b){this.renderer.eraseFeatures(b)},getFeatureFromEvent:function(d){if(!this.renderer){throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.")}var c=null;(d=this.renderer.getFeatureIdFromEvent(d))&&(c="string"===typeof d?this.getFeatureById(d):d);return c},getFeatureBy:function(g,f){for(var k=null,j=0,h=this.features.length;j<h;++j){if(this.features[j][g]==f){k=this.features[j];break}}return k},getFeatureById:function(b){return this.getFeatureBy("id",b)},getFeatureByFid:function(b){return this.getFeatureBy("fid",b)},getFeaturesByAttribute:function(h,g){var m,l,k=this.features.length,j=[];for(m=0;m<k;m++){(l=this.features[m])&&l.attributes&&l.attributes[h]===g&&j.push(l)}return j},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var g=null,f=this.features;if(f&&0<f.length){for(var k=null,j=0,h=f.length;j<h;j++){if(k=f[j].geometry){null===g&&(g=new OpenLayers.Bounds),g.extend(k.getBounds())}}}return g},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(f){for(var e=this.layers,h,g=0;g<e.length;g++){if(h=e[g].getFeatureFromEvent(f)){return h}}},setMap:function(b){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();b.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(b){b.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var d,c=0;c<this.map.layers.length;++c){d=this.map.layers[c],-1!=OpenLayers.Util.indexOf(this.layers,d)&&d.renderer.moveRoot(this.renderer)}},resetRoots:function(){for(var d,c=0;c<this.layers.length;++c){d=this.layers[c],this.renderer&&d.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(d.renderer)}},handleChangeLayer:function(d){var c=d.layer;"order"==d.property&&-1!=OpenLayers.Util.indexOf(this.layers,c)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);null===this.scope&&(this.scope=this);this.initLayer(e);var f={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(f.over=this.overFeature,f.out=this.outFeature);this.callbacks=OpenLayers.Util.extend(f,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(b){OpenLayers.Util.isArray(b)?(this.layers=b,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:b})):this.layer=b},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer);OpenLayers.Control.prototype.destroy.apply(this,arguments);this.layers&&this.layer.destroy()},activate:function(){this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate());return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer));return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(h){for(var g=this.layers||[this.layer],m,l,k=0;k<g.length;++k){m=g[k];for(var j=m.selectedFeatures.length-1;0<=j;--j){l=m.selectedFeatures[j],(!h||h.except!=l)&&this.unselect(l)}}},clickFeature:function(b){this.hover||(-1<OpenLayers.Util.indexOf(b.layer.selectedFeatures,b)?this.toggleSelect()?this.unselect(b):this.multipleSelect()||this.unselectAll({except:b}):(this.multipleSelect()||this.unselectAll({except:b}),this.select(b)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(d){var c=d.layer;this.hover&&(this.highlightOnly?this.highlight(d):-1==OpenLayers.Util.indexOf(c.selectedFeatures,d)&&this.select(d))},outFeature:function(d){if(this.hover){if(this.highlightOnly){if(d._lastHighlighter==this.id){if(d._prevHighlighter&&d._prevHighlighter!=this.id){delete d._lastHighlighter;var c=this.map.getControl(d._prevHighlighter);c&&c.highlight(d)}else{this.unhighlight(d)}}}else{this.unselect(d)}}},highlight:function(d){var c=d.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:d})&&(d._prevHighlighter=d._lastHighlighter,d._lastHighlighter=this.id,c.drawFeature(d,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",{feature:d}))},unhighlight:function(d){var c=d.layer;void 0==d._prevHighlighter?delete d._lastHighlighter:(d._prevHighlighter!=this.id&&(d._lastHighlighter=d._prevHighlighter),delete d._prevHighlighter);c.drawFeature(d,d.style||d.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:d})},select:function(e){var d=this.onBeforeSelect.call(this.scope,e),f=e.layer;!1!==d&&(d=f.events.triggerEvent("beforefeatureselected",{feature:e}),!1!==d&&(f.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=f.selectedFeatures[0]),f.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(d){var c=d.layer;this.unhighlight(d);OpenLayers.Util.removeItem(c.selectedFeatures,d);c.events.triggerEvent("featureunselected",{feature:d});this.onUnselect.call(this.scope,d)},selectBox:function(k){if(k instanceof OpenLayers.Bounds){var j=this.map.getLonLatFromPixel({x:k.left,y:k.bottom}),k=this.map.getLonLatFromPixel({x:k.right,y:k.top}),j=new OpenLayers.Bounds(j.lon,j.lat,k.lon,k.lat);this.multipleSelect()||this.unselectAll();k=this.multiple;this.multiple=!0;var r=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:r});for(var q,p=0;p<r.length;++p){q=r[p];for(var o=0,m=q.features.length;o<m;++o){var l=q.features[o];l.getVisibility()&&(null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,l.geometry.CLASS_NAME))&&j.toGeometry().intersects(l.geometry)&&-1==OpenLayers.Util.indexOf(q.selectedFeatures,l)&&this.select(l)}}this.multiple=k;this.events.triggerEvent("boxselectionend",{layers:r})}},setMap:function(b){this.handlers.feature.setMap(b);this.box&&this.handlers.box.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(d){var c=this.active;this.unselectAll();this.deactivate();this.layers&&(this.layer.destroy(),this.layers=null);this.initLayer(d);this.handlers.feature.layer=this.layer;c&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(e,d,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var d=0,c=this.KEY_EVENTS.length;d<c;d++){OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[d],this.eventListener)}return !0}return !1},deactivate:function(){var d=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var d=0,c=this.KEY_EVENTS.length;d<c;d++){OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[d],this.eventListener)}d=!0}return d},handleKeyEvent:function(b){this.checkModifiers(b)&&this.callback(b.type,[b])},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(f,e){e=e||{};this.layer=f;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,e.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[e]);OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var h=this,g={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};!1===this.standalone&&(this.selectControl=new OpenLayers.Control.SelectFeature(f,g));this.dragControl=new OpenLayers.Control.DragFeature(f,{geometryTypes:["OpenLayers.Geometry.Point"],onStart:function(d,c){h.dragStart.apply(h,[d,c])},onDrag:function(d,c){h.dragVertex.apply(h,[d,c])},onComplete:function(b){h.dragComplete.apply(h,[b])},featureCallbacks:{over:function(b){(h.standalone!==true||b._sketch||h.feature===b)&&h.dragControl.overFeature.apply(h.dragControl,[b])}}});this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeypress})}},destroy:function(){this.layer=null;this.standalone||this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var d=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:!0});this.layer.removeFeatures(this.virtualVertices,{silent:!0});this.vertices=[];this.dragControl.deactivate();var c=(d=this.feature)&&d.geometry&&d.layer;!1===this.standalone?(c&&this.selectControl.unselect.apply(this.selectControl,[d]),this.selectControl.deactivate()):c&&this.unselectFeature(d);this.handlers.keyboard.deactivate();d=!0}return d},beforeSelectFeature:function(b){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:b})},selectFeature:function(d){if(!this.standalone||!1!==this.beforeSelectFeature(d)){this.feature=d,this.modified=!1,this.resetVertices(),this.dragControl.activate(),this.onModificationStart(this.feature)}var c=d.modified;if(d.geometry&&(!c||!c.geometry)){this._originalGeometry=d.geometry.clone()}},unselectFeature:function(b){this.layer.removeFeatures(this.vertices,{silent:!0});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:!0});this.virtualVertices=[];this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle);this.feature=null;this.dragControl.deactivate();this.onModificationEnd(b);this.layer.events.triggerEvent("afterfeaturemodified",{feature:b,modified:this.modified});this.modified=!1},dragStart:function(d,c){if(d!=this.feature&&(!d.geometry.parent&&d!=this.dragHandle&&d!=this.radiusHandle)&&(!1===this.standalone&&this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]),null==this.geometryTypes||-1!=OpenLayers.Util.indexOf(this.geometryTypes,d.geometry.CLASS_NAME))){this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[d]),this.dragControl.overFeature.apply(this.dragControl,[d]),this.dragControl.lastPixel=c,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=c,this.dragControl.handlers.drag.last=c}},dragVertex:function(d,c){this.modified=!0;"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?(this.feature!=d&&(this.feature=d),this.layer.events.triggerEvent("vertexmodified",{vertex:d.geometry,feature:this.feature,pixel:c})):(d._index?(d.geometry.parent.addComponent(d.geometry,d._index),delete d._index,OpenLayers.Util.removeItem(this.virtualVertices,d),this.vertices.push(d)):d==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):d!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:d.geometry,feature:this.feature,pixel:c}),0<this.virtualVertices.length&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent));this.layer.drawFeature(d)},dragComplete:function(){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var b=this.feature;b.modified=OpenLayers.Util.extend(b.modified,{geometry:this._originalGeometry});delete this._originalGeometry}},resetVertices:function(){this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature);0<this.vertices.length&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]);0<this.virtualVertices.length&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]);this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null);this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(d){var c=d.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,c)&&(c=this.dragControl.feature)&&-1!=OpenLayers.Util.indexOf(this.vertices,c)&&!this.dragControl.handlers.drag.dragging&&c.geometry.parent){c.geometry.parent.removeComponent(c.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:c.geometry,feature:this.feature,pixel:d.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}},collectVertices:function(){function d(k){var j,h,b;if("OpenLayers.Geometry.Point"==k.CLASS_NAME){h=new OpenLayers.Feature.Vector(k),h._sketch=!0,h.renderIntent=c.vertexRenderIntent,c.vertices.push(h)}else{b=k.components.length;"OpenLayers.Geometry.LinearRing"==k.CLASS_NAME&&(b-=1);for(j=0;j<b;++j){h=k.components[j],"OpenLayers.Geometry.Point"==h.CLASS_NAME?(h=new OpenLayers.Feature.Vector(h),h._sketch=!0,h.renderIntent=c.vertexRenderIntent,c.vertices.push(h)):d(h)}if(c.createVertices&&"OpenLayers.Geometry.MultiPoint"!=k.CLASS_NAME){j=0;for(b=k.components.length;j<b-1;++j){h=k.components[j];var a=k.components[j+1];"OpenLayers.Geometry.Point"==h.CLASS_NAME&&"OpenLayers.Geometry.Point"==a.CLASS_NAME&&(h=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((h.x+a.x)/2,(h.y+a.y)/2),null,c.virtualStyle),h.geometry.parent=k,h._index=j+1,h._sketch=!0,c.virtualVertices.push(h))}}}}this.vertices=[];this.virtualVertices=[];var c=this;d.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:!0});this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var e=this.feature.geometry,d=e.getBounds().getCenterLonLat(),d=new OpenLayers.Geometry.Point(d.lon,d.lat),f=new OpenLayers.Feature.Vector(d);d.move=function(a,g){OpenLayers.Geometry.Point.prototype.move.call(this,a,g);e.move(a,g)};f._sketch=!0;this.dragHandle=f;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var j=this.feature.geometry,h=j.getBounds(),p=h.getCenterLonLat(),o=new OpenLayers.Geometry.Point(p.lon,p.lat),h=new OpenLayers.Geometry.Point(h.right,h.bottom),p=new OpenLayers.Feature.Vector(h),m=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,l=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,k=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;h.move=function(d,s){OpenLayers.Geometry.Point.prototype.move.call(this,d,s);var g=this.x-o.x,f=this.y-o.y,e=g-d,a=f-s;if(k){var r=Math.atan2(a,e),r=Math.atan2(f,g)-r,r=r*(180/Math.PI);j.rotate(r,o)}if(m){var q;l?(f/=a,q=g/e/f):(e=Math.sqrt(e*e+a*a),f=Math.sqrt(g*g+f*f)/e);j.resize(f,o,q)}};p._sketch=!0;this.radiusHandle=p;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(b){this.standalone||this.selectControl.setMap(b);this.dragControl.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677,0.14929107084870338,0.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,initialize:function(b){b=OpenLayers.Util.applyDefaults({sphericalMercator:!0},b);OpenLayers.Layer.XYZ.prototype.initialize.apply(this,[b.name||"Bing "+(b.type||this.type),null,b]);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var d=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),d="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(d),c=document.createElement("script");c.type="text/javascript";c.src=d;c.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(c)},initLayer:function(){var e=this.metadata.resourceSets[0].resources[0],d=e.imageUrl.replace("{quadkey}","${quadkey}"),d=d.replace("{culture}",this.culture);this.url=[];for(var f=0;f<e.imageUrlSubdomains.length;++f){this.url.push(d.replace("{subdomain}",e.imageUrlSubdomains[f]))}this.addOptions({maxResolution:Math.min(this.serverResolutions[e.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(e.zoomMax+1-e.zoomMin,this.numZoomLevels)},!0)},getURL:function(j){if(this.url){for(var h=this.getXYZ(j),j=h.x,p=h.y,h=h.z,o=[],m=h;0<m;--m){var l="0",k=1<<m-1;0!=(j&k)&&l++;0!=(p&k)&&(l++,l++);o.push(l)}o=o.join("");j=this.selectUrl(""+j+p+h,this.url);return OpenLayers.String.format(j,{quadkey:o})}},updateAttribution:function(){var y=this.metadata;if(y.resourceSets&&this.map&&this.map.center){var x=y.resourceSets[0].resources[0],w=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),x=x.imageryProviders,v=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),u="",t,s,r,q,p,o,m;s=0;for(r=x.length;s<r;++s){t=x[s];q=0;for(p=t.coverageAreas.length;q<p;++q){m=t.coverageAreas[q],o=OpenLayers.Bounds.fromArray(m.bbox,!0),w.intersectsBounds(o)&&(v<=m.zoomMax&&v>=m.zoomMin)&&(u+=t.attribution+" ")}}this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:y.brandLogoUri,copyrights:u});this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);this.updateAttribution();this.map.events.register("moveend",this,this.updateAttribution)},clone:function(b){null==b&&(b=new OpenLayers.Layer.Bing(this.options));return b=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"});OpenLayers.Layer.Bing.processMetadata=function(b){this.metadata=b;this.initLayer();b=document.getElementById(this._callbackId);b.parentNode.removeChild(b);window[this._callbackId]=void 0;delete this._callbackId};OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(b){b=b||{};OpenLayers.Layer.Vector.prototype.initialize.apply(this,[b.name,b])},setMap:function(b){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);b.events.register("moveend",this,this.onMoveEnd)},removeMap:function(b){b.events.unregister("moveend",this,this.onMoveEnd);OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(b){this.ratio=b;this.updateGrid(!0)},setMaxFeatures:function(b){this.maxFeatures=b;this.updateGrid(!0)},setSpacing:function(d,c){this.dx=d;this.dy=c||d;this.updateGrid(!0)},setOrigin:function(b){this.origin=b;this.updateGrid(!0)},getOrigin:function(){this.origin||(this.origin=this.map.getExtent().getCenterLonLat());return this.origin},setRotation:function(b){this.rotation=b;this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var d=this.map.getExtent();if(this.rotation){var c=this.getOrigin(),c=new OpenLayers.Geometry.Point(c.lon,c.lat),d=d.toGeometry();d.rotate(-this.rotation,c);d=d.getBounds()}return d},updateGrid:function(u){if(u||this.invalidBounds()){var t=this.getViewBounds(),s=this.getOrigin(),u=new OpenLayers.Geometry.Point(s.lon,s.lat),r=t.getWidth(),q=t.getHeight(),p=r/q,o=Math.sqrt(this.dx*this.dy*this.maxFeatures/p),r=Math.min(r*this.ratio,o*p),q=Math.min(q*this.ratio,o),t=t.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(t.lon-r/2,t.lat-q/2,t.lon+r/2,t.lat+q/2);for(var t=Math.floor(q/this.dy),r=Math.floor(r/this.dx),q=s.lon+this.dx*Math.ceil((this.gridBounds.left-s.lon)/this.dx),s=s.lat+this.dy*Math.ceil((this.gridBounds.bottom-s.lat)/this.dy),o=Array(t*r),m,l=0;l<r;++l){for(var p=q+l*this.dx,k=0;k<t;++k){m=s+k*this.dy,m=new OpenLayers.Geometry.Point(p,m),this.rotation&&m.rotate(this.rotation,u),o[l*t+k]=new OpenLayers.Feature.Vector(m)}}this.destroyFeatures(this.features,{silent:!0});this.addFeatures(o,{silent:!0})}},invalidBounds:function(){return !this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:!0,initialize:function(e,d,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(k){if(this.map&&this.checkModifiers(k)){for(var j=!1,r=!1,q=!1,p=OpenLayers.Event.element(k);null!=p&&!q&&!j;){if(!j){try{var o=p.currentStyle?p.currentStyle.overflow:document.defaultView.getComputedStyle(p,null).getPropertyValue("overflow"),j=o&&"auto"==o||"scroll"==o}catch(m){}}if(!r){for(var q=0,l=this.map.layers.length;q<l;q++){if(p==this.map.layers[q].div||p==this.map.layers[q].pane){r=!0;break}}}q=p==this.map.div;p=p.parentNode}!j&&q&&(r&&((j=0,k||(k=window.event),k.wheelDelta?(j=k.wheelDelta/120,window.opera&&9.2>window.opera.version()&&(j=-j)):k.detail&&(j=-k.detail/3),this.delta+=j,this.interval)?(window.clearTimeout(this._timeoutId),this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(k)},this),this.interval)):this.wheelZoom(k)),OpenLayers.Event.stop(k))}},wheelZoom:function(d){var c=this.delta;this.delta=0;c&&(this.mousePosition&&(d.xy=this.mousePosition),d.xy||(d.xy=this.map.getPixelFromLonLat(this.map.getCenter())),0>c?this.callback("down",[d,this.cumulative?c:-1]):this.callback("up",[d,this.cumulative?c:1]))},mousemove:function(b){this.mousePosition=b.xy},activate:function(d){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var c=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",c);OpenLayers.Event.observe(window,"mousewheel",c);OpenLayers.Event.observe(document,"mousewheel",c);return !0}return !1},deactivate:function(d){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var c=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",c);OpenLayers.Event.stopObserving(window,"mousewheel",c);OpenLayers.Event.stopObserving(document,"mousewheel",c);return !0}return !1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(b){OpenLayers.Util.extend(this,b)},clone:function(){return new (eval(this.CLASS_NAME))(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"});OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(b){this.symbolizer={};OpenLayers.Util.extend(this,b);this.symbolizers&&delete this.symbolizer;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var b in this.symbolizer){this.symbolizer[b]=null}this.symbolizer=null;delete this.symbolizers},evaluate:function(f){var e=this.getContext(f),h=!0;if(this.minScaleDenominator||this.maxScaleDenominator){var g=f.layer.map.getScale()}this.minScaleDenominator&&(h=g>=OpenLayers.Style.createLiteral(this.minScaleDenominator,e));h&&this.maxScaleDenominator&&(h=g<OpenLayers.Style.createLiteral(this.maxScaleDenominator,e));h&&this.filter&&(h="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(f):this.filter.evaluate(e));return h},getContext:function(d){var c=this.context;c||(c=d.attributes||d.data);"function"==typeof this.context&&(c=this.context(d));return c},clone:function(){var f=OpenLayers.Util.extend({},this);if(this.symbolizers){var e=this.symbolizers.length;f.symbolizers=Array(e);for(var h=0;h<e;++h){f.symbolizers[h]=this.symbolizers[h].clone()}}else{f.symbolizer={};for(var g in this.symbolizer){e=this.symbolizer[g],h=typeof e,"object"===h?f.symbolizer[g]=OpenLayers.Util.extend({},e):"string"===h&&(f.symbolizer[g]=e)}}f.filter=this.filter&&this.filter.clone();f.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(f)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var d=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var f=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(f=this.value.toGeometry());e.geometry.intersects(f)&&(d=!0)}break;default:throw Error("evaluate is not implemented for this filter type.")}return d},clone:function(){var b=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(b)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(b){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[b])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,d){var f={};this.readChildNodes(e,f);d.outer=f.components[0]},innerBoundaryIs:function(e,d){var f={};this.readChildNodes(e,f);d.inner.push(f.components[0])},Box:function(f,e){var h={};this.readChildNodes(f,h);e.components||(e.components=[]);var g=h.points[0],h=h.points[1];e.components.push(new OpenLayers.Bounds(g.x,g.y,h.x,h.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(b){b=this.writeNode(OpenLayers.Util.isArray(b)?"wfs:FeatureCollection":"gml:featureMember",b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(d){var c=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[d],c);return c},coordinates:function(g){for(var f=g.length,k=Array(f),j,h=0;h<f;++h){j=g[h],k[h]=this.xy?j.x+","+j.y:j.y+","+j.x,void 0!=j.z&&(k[h]+=","+j.z)}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==f?k[0]:k.join(" ")})},LineString:function(d){var c=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",d.components,c);return c},Polygon:function(e){var d=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],d);for(var f=1;f<e.components.length;++f){this.writeNode("innerBoundaryIs",e.components[f],d)}return d},outerBoundaryIs:function(d){var c=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",d,c);return c},innerBoundaryIs:function(d){var c=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",d,c);return c},LinearRing:function(d){var c=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",d.components,c);return c},Box:function(d){var c=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:d.left,y:d.bottom},{x:d.right,y:d.top}],c);this.srsName&&c.setAttribute("srsName",this.srsName);return c}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(b){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[b])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsNotEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLike:function(h,g){var m=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(h,m);var l=h.getAttribute("wildCard"),k=h.getAttribute("singleChar"),j=h.getAttribute("escape");m.value2regex(l,k,j);g.filters.push(m)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsNotEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsLike:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",d,c);this.writeNode("Literal",d.regex2value(),c);return c},BBOX:function(e){var d=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,d);var f=this.writeNode("gml:Box",e.value,d);e.projection&&f.setAttribute("srsName",e.projection);return d}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(f,e){var h=this.createElementNSPlus("ogc:"+e);this.writeNode("PropertyName",f,h);if(f.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",f.value,h)}else{var g;g=f.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",f.value).firstChild:this.writeNode("gml:Box",f.value);f.projection&&g.setAttribute("srsName",f.projection);h.appendChild(g)}return h},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(b){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[b]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[b])},readNode:function(d,c){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,[d,c])},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(d,c){c.insertIds=[];c.success=!1;this.readChildNodes(d,c)},InsertResult:function(e,d){var f={fids:[]};this.readChildNodes(e,f);d.insertIds.push(f.fids[0])},TransactionResult:function(d,c){this.readChildNodes(d,c)},Status:function(d,c){this.readChildNodes(d,c)},SUCCESS:function(d,c){c.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(f){var f=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},f),e=f.featurePrefix,h=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e?e+":":"")+f.featureType}});f.srsNameInQuery&&f.srsName&&h.setAttribute("srsName",f.srsName);f.featureNS&&h.setAttribute("xmlns:"+e,f.featureNS);if(f.propertyNames){for(var e=0,g=f.propertyNames.length;e<g;e++){this.writeNode("ogc:PropertyName",{property:f.propertyNames[e]},h)}}f.filter&&(this.setFilterProperty(f.filter),this.writeNode("ogc:Filter",f.filter,h));return h}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(b){this.compare=b?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(g){this.exists(g)&&this.remove(g);var f=g.id;this.determineZIndex(g);for(var k=-1,j=this.order.length,h;1<j-k;){h=parseInt((k+j)/2),0<this.compare(this,g,OpenLayers.Util.getElement(this.order[h]))?k=h:j=h}this.order.splice(j,0,f);this.indices[f]=this.getZIndex(g);return this.getNextElement(j)},remove:function(d){var d=d.id,c=OpenLayers.Util.indexOf(this.order,d);0<=c&&(this.order.splice(c,1),delete this.indices[d],this.maxZIndex=0<this.order.length?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(b){return null!=this.indices[b.id]},getZIndex:function(b){return b._style.graphicZIndex},determineZIndex:function(d){var c=d._style.graphicZIndex;null==c?(c=this.maxZIndex,d._style.graphicZIndex=c):c>this.maxZIndex&&(this.maxZIndex=c)},getNextElement:function(d){d+=1;if(d<this.order.length){var c=OpenLayers.Util.getElement(this.order[d]);void 0==c&&(c=this.getNextElement(d));return c}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(f,e,h){var e=f.getZIndex(e),g=0;h&&(f=f.getZIndex(h),g=e-f);return g},Z_ORDER_DRAWING_ORDER:function(e,d,f){e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,d,f);f&&0==e&&(e=1);return e},Z_ORDER_Y_ORDER:function(e,d,f){e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,d,f);f&&0===e&&(d=f._boundsBottom-d._boundsBottom,e=0===d?1:d);return e}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(d,c){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(c&&(c.zIndexing||c.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(c.yOrdering)}},destroy:function(){this.clear();this.xmlns=this.root=this.rendererRoot=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var d,c=this.vectorRoot;if(c){for(;d=c.firstChild;){c.removeChild(d)}}if(c=this.textRoot){for(;d=c.firstChild;){c.removeChild(d)}}this.indexer&&this.indexer.clear()},setExtent:function(h,g){var m=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),l=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var k,j=h.getWidth()/this.map.getExtent().getWidth(),h=h.scale(1/j),j=this.map.getMaxExtent();j.right>h.left&&j.right<h.right?k=!0:j.left>h.left&&j.left<h.right&&(k=!1);if(k!==this.rightOfDateLine||g){m=!1,this.xOffset=!0===k?j.getWidth()/l:0}this.rightOfDateLine=k}return m},getNodeType:function(){},drawGeometry:function(h,g,m){var l=h.CLASS_NAME,k=!0;if("OpenLayers.Geometry.Collection"==l||"OpenLayers.Geometry.MultiPoint"==l||"OpenLayers.Geometry.MultiLineString"==l||"OpenLayers.Geometry.MultiPolygon"==l){for(var l=0,j=h.components.length;l<j;l++){k=this.drawGeometry(h.components[l],g,m)&&k}return k}l=k=!1;"none"!=g.display&&(g.backgroundGraphic?this.redrawBackgroundNode(h.id,h,g,m):l=!0,k=this.redrawNode(h.id,h,g,m));if(!1==k&&(g=document.getElementById(h.id))){g._style.backgroundGraphic&&(l=!0),g.parentNode.removeChild(g)}l&&(g=document.getElementById(h.id+this.BACKGROUND_ID_SUFFIX))&&g.parentNode.removeChild(g);return k},redrawNode:function(f,e,h,g){h=this.applyDefaultSymbolizer(h);f=this.nodeFactory(f,this.getNodeType(e,h));f._featureId=g;f._boundsBottom=e.getBounds().bottom;f._geometryClass=e.CLASS_NAME;f._style=h;e=this.drawGeometryNode(f,e,h);if(!1===e){return !1}f=e.node;this.indexer?(h=this.indexer.insert(f))?this.vectorRoot.insertBefore(f,h):this.vectorRoot.appendChild(f):f.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(f);this.postDraw(f);return e.complete},redrawBackgroundNode:function(e,d,f){f=OpenLayers.Util.extend({},f);f.externalGraphic=f.backgroundGraphic;f.graphicXOffset=f.backgroundXOffset;f.graphicYOffset=f.backgroundYOffset;f.graphicZIndex=f.backgroundGraphicZIndex;f.graphicWidth=f.backgroundWidth||f.graphicWidth;f.graphicHeight=f.backgroundHeight||f.graphicHeight;f.backgroundGraphic=null;f.backgroundXOffset=null;f.backgroundYOffset=null;f.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,d,f,null)},drawGeometryNode:function(g,f,k){var k=k||g._style,j={isFilled:void 0===k.fill?!0:k.fill,isStroked:void 0===k.stroke?!!k.strokeWidth:k.stroke},h;switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===k.graphic&&(j.isFilled=!1,j.isStroked=!1);h=this.drawPoint(g,f);break;case"OpenLayers.Geometry.LineString":j.isFilled=!1;h=this.drawLineString(g,f);break;case"OpenLayers.Geometry.LinearRing":h=this.drawLinearRing(g,f);break;case"OpenLayers.Geometry.Polygon":h=this.drawPolygon(g,f);break;case"OpenLayers.Geometry.Rectangle":h=this.drawRectangle(g,f)}g._options=j;return !1!=h?{node:this.setStyle(g,k,j,f),complete:h}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(d){var c=document.getElementById(d+this.LABEL_ID_SUFFIX);c&&this.textRoot.removeChild(c);(d=document.getElementById(d+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(d)},getFeatureIdFromEvent:function(e){var d=e.target,f=d&&d.correspondingUseElement;return(f?f:d||e.srcElement)._featureId},eraseGeometry:function(f,e){if("OpenLayers.Geometry.MultiPoint"==f.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==f.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==f.CLASS_NAME||"OpenLayers.Geometry.Collection"==f.CLASS_NAME){for(var h=0,g=f.components.length;h<g;h++){this.eraseGeometry(f.components[h],e)}}else{if((h=OpenLayers.Util.getElement(f.id))&&h.parentNode){if(h.geometry&&(h.geometry.destroy(),h.geometry=null),h.parentNode.removeChild(h),this.indexer&&this.indexer.remove(h),h._style.backgroundGraphic){(h=OpenLayers.Util.getElement(f.id+this.BACKGROUND_ID_SUFFIX))&&h.parentNode&&h.parentNode.removeChild(h)}}}},nodeFactory:function(e,d){var f=OpenLayers.Util.getElement(e);f?this.nodeTypeCompare(f,d)||(f.parentNode.removeChild(f),f=this.nodeFactory(e,d)):f=this.createNode(d,e);return f},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(d){var c=this.root;d.root.parentNode==this.rendererRoot&&(c=d.root);c.parentNode.removeChild(c);d.rendererRoot.appendChild(c)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(b){return"circle"!=b&&!!b},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(e){var e=e||window.location.href,d=OpenLayers.Util.getParameters(e),f=e.indexOf("#");0<f&&(e="?"+e.substring(f+1,e.length),OpenLayers.Util.extend(d,OpenLayers.Util.getParameters(e)));return d},setMap:function(f){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var e=0,h=this.map.controls.length;e<h;e++){var g=this.map.controls[e];if(g!=this&&"OpenLayers.Control.ArgParser"==g.CLASS_NAME){g.displayProjection!=this.displayProjection&&(this.displayProjection=g.displayProjection);break}}if(e==this.map.controls.length&&(e=this.getParameters(),e.layers&&(this.layers=e.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),e.lat&&e.lon)){this.center=new OpenLayers.LonLat(parseFloat(e.lon),parseFloat(e.lat)),e.zoom&&(this.zoom=parseFloat(e.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter()}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var f=0,e=this.layers.length;f<e;f++){var h=this.map.layers[f],g=this.layers.charAt(f);"B"==g?this.map.setBaseLayer(h):("T"==g||"F"==g)&&h.setVisibility("T"==g)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(e,d,f){null!==e&&"object"==typeof e&&!OpenLayers.Util.isElement(e)?(this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[e]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element))):(OpenLayers.Control.prototype.initialize.apply(this,[f]),this.element=OpenLayers.Util.getElement(e),this.base=d||document.location.href)},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null);this.map&&this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(f){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var e=0,h=this.map.controls.length;e<h;e++){var g=this.map.controls[e];if(g.CLASS_NAME==this.argParserClass.CLASS_NAME){g.displayProjection!=this.displayProjection&&(this.displayProjection=g.displayProjection);break}}e==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);!this.element&&!this.anchor&&(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element));this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var d=this.anchor?"#":"?",c=this.base;-1!=c.indexOf(d)&&(c=c.substring(0,c.indexOf(d)));c+=d+OpenLayers.Util.getParameterString(this.createParams());this.anchor&&!this.element?window.location.href=c:this.element.href=c},createParams:function(g,f,k){var g=g||this.map.getCenter(),j=OpenLayers.Util.getParameters(this.base);if(g){j.zoom=f||this.map.getZoom();f=g.lat;g=g.lon;this.displayProjection&&(f=OpenLayers.Projection.transform({x:g,y:f},this.map.getProjectionObject(),this.displayProjection),g=f.x,f=f.y);j.lat=Math.round(100000*f)/100000;j.lon=Math.round(100000*g)/100000;k=k||this.map.layers;j.layers="";g=0;for(f=k.length;g<f;g++){var h=k[g];j.layers=h.isBaseLayer?j.layers+(h==this.map.baseLayer?"B":"0"):j.layers+(h.getVisibility()?"T":"F")}}return j},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(f,e,h){var g=[];g.push(f,e,{},h);OpenLayers.Layer.Grid.prototype.initialize.apply(this,g)},clone:function(b){null==b&&(b=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(e){var e=this.adjustBounds(e),d=this.getServerResolution(),f=Math.round((e.left-this.tileOrigin.lon)/(d*this.tileSize.w)),e=Math.round((e.bottom-this.tileOrigin.lat)/(d*this.tileSize.h)),f=this.serviceVersion+"/"+this.layername+"/"+this.getServerZoom()+"/"+f+"/"+e+"."+this.type,e=this.url;OpenLayers.Util.isArray(e)&&(e=this.selectUrl(f,e));return e+f},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});if(!0==this.layer.visibility||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}return !0}return !1},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this});return b},load:function(d){var c=this.layer;c.events.triggerEvent("loadstart");c.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,c.map.getProjectionObject()),filter:c.filter},d));c.events.un({visibilitychanged:this.load,scope:this})},merge:function(j,h){var p=this.layer;p.destroyFeatures();var o=h.features;if(o&&0<o.length){if(!j.equals(p.projection)){for(var m,l=0,k=o.length;l<k;++l){(m=o[l].geometry)&&m.transform(p.projection,j)}}p.addFeatures(o)}p.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"-",zoomOutId:"olZoomOutLink",draw:function(){var f=OpenLayers.Control.prototype.draw.apply(this),e=this.getOrCreateLinks(f),h=e.zoomIn,e=e.zoomOut,g=this.map.events;e.parentNode!==f&&(g=this.events,g.attachToElement(e.parentNode));g.register("buttonclick",this,this.onZoomClick);this.zoomInLink=h;this.zoomOutLink=e;return f},getOrCreateLinks:function(e){var d=document.getElementById(this.zoomInId),f=document.getElementById(this.zoomOutId);d||(d=document.createElement("a"),d.href="#zoomIn",d.appendChild(document.createTextNode(this.zoomInText)),d.className="olControlZoomIn",e.appendChild(d));OpenLayers.Element.addClass(d,"olButton");f||(f=document.createElement("a"),f.href="#zoomOut",f.appendChild(document.createTextNode(this.zoomOutText)),f.className="olControlZoomOut",e.appendChild(f));OpenLayers.Element.addClass(f,"olButton");return{zoomIn:d,zoomOut:f}},onZoomClick:function(b){b=b.buttonElement;b===this.zoomInLink?this.map.zoomIn():b===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick);delete this.zoomInLink;delete this.zoomOutLink;OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(s,r){if(2>s.length){throw Error("At least two point features have to be added to create a line from")}for(var q=Array(s.length-1),p,o,m,l=0,k=s.length;l<k;l++){p=s[l];if(m=p.geometry){if("OpenLayers.Geometry.Point"!=m.CLASS_NAME){throw new TypeError("Only features with point geometries are supported.")}}else{m=p.lonlat,m=new OpenLayers.Geometry.Point(m.lon,m.lat)}if(0<l){p=null!=this.dataFrom?s[l+this.dataFrom].data||s[l+this.dataFrom].attributes:null;var j=null!=this.styleFrom?s[l+this.styleFrom].style:null;o=new OpenLayers.Geometry.LineString([o,m]);q[l-1]=new OpenLayers.Feature.Vector(o,p,j)}o=m}this.addFeatures(q,r)},CLASS_NAME:"OpenLayers.Layer.PointTrack"});OpenLayers.Layer.PointTrack.SOURCE_NODE=-1;OpenLayers.Layer.PointTrack.TARGET_NODE=0;OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Protocol.WFS=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Protocol.WFS.DEFAULTS),c=OpenLayers.Protocol.WFS["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported WFS version: "+d.version}return new c(d)};OpenLayers.Protocol.WFS.fromWMSLayer=function(f,e){var h,g;h=f.params.LAYERS;h=(OpenLayers.Util.isArray(h)?h[0]:h).split(":");1<h.length&&(g=h[0]);h=h.pop();g={url:f.url,featureType:h,featurePrefix:g,srsName:f.projection&&f.projection.getCode()||f.map&&f.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(e,g))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(d,c){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(d){if(d!=this.opacity){this.opacity=d;for(var d=0,c=this.markers.length;d<c;d++){this.markers[d].setOpacity(this.opacity)}}},moveTo:function(g,f,k){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(f||!this.drawn){for(var j=0,h=this.markers.length;j<h;j++){this.drawMarker(this.markers[j])}this.drawn=!0}},addMarker:function(b){this.markers.push(b);1>this.opacity&&b.setOpacity(this.opacity);this.map&&this.map.getExtent()&&(b.map=this.map,this.drawMarker(b))},removeMarker:function(b){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,b),b.erase())},clearMarkers:function(){if(null!=this.markers){for(;0<this.markers.length;){this.removeMarker(this.markers[0])}}},drawMarker:function(d){var c=this.map.getLayerPxFromLonLat(d.lonlat);null==c?d.display(!1):d.isDrawn()?d.icon&&d.icon.moveTo(c):this.div.appendChild(d.draw(c))},getDataExtent:function(){var e=null;if(this.markers&&0<this.markers.length){for(var e=new OpenLayers.Bounds,d=0,f=this.markers.length;d<f;d++){e.extend(this.markers[d].lonlat)}}return e},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(d,c){this.direction=d;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[c])},trigger:function(){var b=OpenLayers.Function.bind(function(c){return this.slideRatio?this.map.getSize()[c]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-b("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,b("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-b("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(b("w"),0)}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Format.CSWGetDomain=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Format.CSWGetDomain.DEFAULTS),c=OpenLayers.Format.CSWGetDomain["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported CSWGetDomain version: "+d.version}return new c(d)};OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"};OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{csw:{GetDomainResponse:function(d,c){this.readChildNodes(d,c)},DomainValues:function(h,g){OpenLayers.Util.isArray(g.DomainValues)||(g.DomainValues=[]);for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]=m[k].nodeValue}this.readChildNodes(h,l);g.DomainValues.push(l)},PropertyName:function(d,c){c.PropertyName=this.getChildValue(d)},ParameterName:function(d,c){c.ParameterName=this.getChildValue(d)},ListOfValues:function(d,c){OpenLayers.Util.isArray(c.ListOfValues)||(c.ListOfValues=[]);this.readChildNodes(d,c.ListOfValues)},Value:function(h,g){for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]=m[k].nodeValue}l.value=this.getChildValue(h);g.push({Value:l})},ConceptualScheme:function(d,c){c.ConceptualScheme={};this.readChildNodes(d,c.ConceptualScheme)},Name:function(d,c){c.Name=this.getChildValue(d)},Document:function(d,c){c.Document=this.getChildValue(d)},Authority:function(d,c){c.Authority=this.getChildValue(d)},RangeOfValues:function(d,c){c.RangeOfValues={};this.readChildNodes(d,c.RangeOfValues)},MinValue:function(h,g){for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]=m[k].nodeValue}l.value=this.getChildValue(h);g.MinValue=l},MaxValue:function(h,g){for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]=m[k].nodeValue}l.value=this.getChildValue(h);g.MaxValue=l}}},write:function(b){b=this.writeNode("csw:GetDomain",b);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetDomain:function(d){var c=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});if(d.PropertyName||this.PropertyName){this.writeNode("csw:PropertyName",d.PropertyName||this.PropertyName,c)}else{if(d.ParameterName||this.ParameterName){this.writeNode("csw:ParameterName",d.ParameterName||this.ParameterName,c)}}this.readChildNodes(c,d);return c},PropertyName:function(b){return this.createElementNSPlus("csw:PropertyName",{value:b})},ParameterName:function(b){return this.createElementNSPlus("csw:ParameterName",{value:b})}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"});OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(b){return(new OpenLayers.Format.ArcXML).read(b).features.feature}});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.options=b||{};this.options.layer&&this.setLayer(this.options.layer);b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS);this.setTargets(this.options.targets);0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer);this.geoToleranceCache={}},setLayer:function(b){this.active?(this.deactivate(),this.layer=b,this.activate()):this.layer=b},setTargets:function(f){this.targets=[];if(f&&f.length){for(var e,h=0,g=f.length;h<g;++h){e=f[h],e instanceof OpenLayers.Layer.Vector?this.addTargetLayer(e):this.addTarget(e)}}},addTargetLayer:function(b){this.addTarget({layer:b})},addTarget:function(b){b=OpenLayers.Util.applyDefaults(b,this.defaults);b.nodeTolerance=b.nodeTolerance||b.tolerance;b.vertexTolerance=b.vertexTolerance||b.tolerance;b.edgeTolerance=b.edgeTolerance||b.tolerance;this.targets.push(b)},removeTargetLayer:function(e){for(var d,f=this.targets.length-1;0<=f;--f){d=this.targets[f],d.layer===e&&this.removeTarget(d)}},removeTarget:function(b){return OpenLayers.Util.removeItem(this.targets,b)},activate:function(){var b=OpenLayers.Control.prototype.activate.call(this);if(b&&this.layer&&this.layer.events){this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.call(this);b&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this});this.point=this.feature=null;return b},onSketchModified:function(b){this.feature=b.feature;this.considerSnapping(b.vertex,b.vertex)},onVertexModified:function(d){this.feature=d.feature;var c=this.layer.map.getLonLatFromViewPortPx(d.pixel);this.considerSnapping(d.vertex,new OpenLayers.Geometry.Point(c.lon,c.lat))},considerSnapping:function(k,j){for(var r={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},q=!1,p,o,m=0,l=this.targets.length;m<l;++m){if(o=this.targets[m],p=this.testTarget(o,j)){if(this.greedy){r=p;r.target=o;q=!0;break}else{if(p.rank<r.rank||p.rank===r.rank&&p.dist<r.dist){r=p,r.target=o,q=!0}}}}q&&(!1!==this.events.triggerEvent("beforesnap",{point:k,x:r.x,y:r.y,distance:r.dist,layer:r.target.layer,snapType:this.precedence[r.rank]})?(k.x=r.x,k.y=r.y,this.point=k,this.events.triggerEvent("snap",{point:k,snapType:this.precedence[r.rank],layer:r.target.layer,distance:r.dist})):q=!1);this.point&&!q&&(k.x=j.x,k.y=j.y,this.point=null,this.events.triggerEvent("unsnap",{point:k}))},testTarget:function(P,O){var N=this.layer.map.getResolution();if("minResolution" in P&&N<P.minResolution||"maxResolution" in P&&N>=P.maxResolution){return null}for(var N={node:this.getGeoTolerance(P.nodeTolerance,N),vertex:this.getGeoTolerance(P.vertexTolerance,N),edge:this.getGeoTolerance(P.edgeTolerance,N)},M=Math.max(N.node,N.vertex,N.edge),L={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},K=!1,J=P.layer.features,I,H,G,F,E,D,C=this.precedence.length,B=new OpenLayers.LonLat(O.x,O.y),A=0,z=J.length;A<z;++A){if(I=J[A],I!==this.feature&&(!I._sketch&&I.state!==OpenLayers.State.DELETE&&(!P.filter||P.filter.evaluate(I)))&&I.atPoint(B,M,M)){for(var y=0,x=Math.min(L.rank+1,C);y<x;++y){if(H=this.precedence[y],P[H]){if("edge"===H){if(G=I.geometry.distanceTo(O,{details:!0}),E=G.distance,E<=N[H]&&E<L.dist){L={rank:y,dist:E,x:G.x0,y:G.y0};K=!0;break}}else{G=I.geometry.getVertices("node"===H);D=!1;for(var w=0,v=G.length;w<v;++w){if(F=G[w],E=F.distanceTo(O),E<=N[H]&&(y<L.rank||y===L.rank&&E<L.dist)){L={rank:y,dist:E,x:F.x,y:F.y},D=K=!0}}if(D){break}}}}}}return K?L:null},getGeoTolerance:function(e,d){d!==this.resolution&&(this.resolution=d,this.geoToleranceCache={});var f=this.geoToleranceCache[e];void 0===f&&(f=e*d,this.geoToleranceCache[e]=f);return f},destroy:function(){this.active&&this.deactivate();delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"});OpenLayers.Date={toISOString:function(){if("toISOString" in Date.prototype){return function(c){return c.toISOString()}}var b=function(e,g){for(var f=e+"";f.length<g;){f="0"+f}return f};return function(a){return isNaN(a.getTime())?"Invalid Date":a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2)+"T"+b(a.getUTCHours(),2)+":"+b(a.getUTCMinutes(),2)+":"+b(a.getUTCSeconds(),2)+"."+b(a.getUTCMilliseconds(),3)+"Z"}}(),parse:function(j){var h;if((j=j.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/))&&(j[1]||j[7])){h=parseInt(j[1],10)||0;var p=parseInt(j[2],10)-1||0,o=parseInt(j[3],10)||1;h=new Date(Date.UTC(h,p,o));if(p=j[7]){var o=parseInt(j[4],10),m=parseInt(j[5],10),l=parseFloat(j[6]),k=l|0,l=Math.round(1000*(l-k));h.setUTCHours(o,m,k,l);"Z"!==p&&(p=parseInt(p,10),j=parseInt(j[8],10)||0,h=new Date(h.getTime()+-1000*(60*60*p+60*j)))}}else{h=new Date("invalid")}return h}};(function(){function s(){this._object=m&&!j?new m:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function r(){return new s}function q(b){r.onreadystatechange&&r.onreadystatechange.apply(b);b.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function p(A){try{A.responseText=A._object.responseText}catch(z){}try{var y;var x=A._object,w=x.responseXML,v=x.responseText;k&&(v&&w&&!w.documentElement&&x.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/))&&(w=new window.ActiveXObject("Microsoft.XMLDOM"),w.async=!1,w.validateOnParse=!1,w.loadXML(v));y=w&&(k&&0!=w.parseError||!w.documentElement||w.documentElement&&"parsererror"==w.documentElement.tagName)?null:w;A.responseXML=y}catch(u){}try{A.status=A._object.status}catch(t){}try{A.statusText=A._object.statusText}catch(h){}}function o(b){b._object.onreadystatechange=new window.Function}var m=window.XMLHttpRequest,l=!!window.controllers,k=window.document.all&&!window.opera,j=k&&window.navigator.userAgent.match(/MSIE 7.0/);r.prototype=s.prototype;l&&m.wrapped&&(r.wrapped=m.wrapped);r.UNSENT=0;r.OPENED=1;r.HEADERS_RECEIVED=2;r.LOADING=3;r.DONE=4;r.prototype.readyState=r.UNSENT;r.prototype.responseText="";r.prototype.responseXML=null;r.prototype.status=0;r.prototype.statusText="";r.prototype.priority="NORMAL";r.prototype.onreadystatechange=null;r.onreadystatechange=null;r.onopen=null;r.onsend=null;r.onabort=null;r.prototype.open=function(c,g,d,b,u){delete this._headers;arguments.length<3&&(d=true);this._async=d;var t=this,h=this.readyState,e;if(k&&d){e=function(){if(h!=r.DONE){o(t);t.abort()}};window.attachEvent("onunload",e)}r.onopen&&r.onopen.apply(this,arguments);arguments.length>4?this._object.open(c,g,d,b,u):arguments.length>3?this._object.open(c,g,d,b):this._object.open(c,g,d);this.readyState=r.OPENED;q(this);this._object.onreadystatechange=function(){if(!l||d){t.readyState=t._object.readyState;p(t);if(t._aborted){t.readyState=r.UNSENT}else{if(t.readyState==r.DONE){delete t._data;o(t);k&&d&&window.detachEvent("onunload",e)}h!=t.readyState&&q(t);h=t.readyState}}}};r.prototype.send=function(b){r.onsend&&r.onsend.apply(this,arguments);arguments.length||(b=null);if(b&&b.nodeType){b=window.XMLSerializer?(new window.XMLSerializer).serializeToString(b):b.xml;this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")}this._data=b;b:{this._object.send(this._data);if(l&&!this._async){this.readyState=r.OPENED;for(p(this);this.readyState<r.DONE;){this.readyState++;q(this);if(this._aborted){break b}}}}};r.prototype.abort=function(){r.onabort&&r.onabort.apply(this,arguments);if(this.readyState>r.UNSENT){this._aborted=true}this._object.abort();o(this);this.readyState=r.UNSENT;delete this._data};r.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};r.prototype.getResponseHeader=function(b){return this._object.getResponseHeader(b)};r.prototype.setRequestHeader=function(d,c){if(!this._headers){this._headers={}}this._headers[d]=c;return this._object.setRequestHeader(d,c)};r.prototype.addEventListener=function(g,f,u){for(var t=0,h;h=this._listeners[t];t++){if(h[0]==g&&h[1]==f&&h[2]==u){return}}this._listeners.push([g,f,u])};r.prototype.removeEventListener=function(g,f,u){for(var t=0,h;h=this._listeners[t];t++){if(h[0]==g&&h[1]==f&&h[2]==u){break}}h&&this._listeners.splice(t,1)};r.prototype.dispatchEvent=function(e){e={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};e.type=="readystatechange"&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[e]);for(var d=0,f;f=this._listeners[d];d++){f[0]==e.type&&!f[2]&&(f[1].handleEvent||f[1]).apply(this,[e])}};r.prototype.toString=function(){return"[object XMLHttpRequest]"};r.toString=function(){return"[XMLHttpRequest]"};window.Function.prototype.apply||(window.Function.prototype.apply=function(d,c){c||(c=[]);d.__func=this;d.__func(c[0],c[1],c[2],c[3],c[4]);delete d.__func});OpenLayers.Request.XMLHttpRequest=r})();OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(b){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(b){this.features=[];this.styles={};this.fetched={};return this.parseData(b,{depth:0,styleBaseUrl:this.styleBaseUrl})},parseData:function(j,h){"string"==typeof j&&(j=OpenLayers.Format.XML.prototype.read.apply(this,[j]));for(var p=["Link","NetworkLink","Style","StyleMap","Placemark"],o=0,m=p.length;o<m;++o){var l=p[o],k=this.getElementsByTagNameNS(j,"*",l);if(0!=k.length){switch(l.toLowerCase()){case"link":case"networklink":this.parseLinks(k,h);break;case"style":this.extractStyles&&this.parseStyles(k,h);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(k,h);break;case"placemark":this.parseFeatures(k,h)}}}return this.features},parseLinks:function(h,g){if(g.depth>=this.maxDepth){return !1}var m=OpenLayers.Util.extend({},g);m.depth++;for(var l=0,k=h.length;l<k;l++){var j=this.parseProperty(h[l],"*","href");j&&!this.fetched[j]&&(this.fetched[j]=!0,(j=this.fetchLink(j))&&this.parseData(j,m))}},fetchLink:function(b){if(b=OpenLayers.Request.GET({url:b,async:!1})){return b.responseText}},parseStyles:function(g,f){for(var k=0,j=g.length;k<j;k++){var h=this.parseStyle(g[k]);h&&(this.styles[(f.styleBaseUrl||"")+"#"+h.id]=h)}},parseKmlColor:function(d){var c=null;d&&(d=d.match(this.regExes.kmlColor))&&(c={color:"#"+d[4]+d[3]+d[2],opacity:parseInt(d[1],16)/255});return c},parseStyle:function(A){for(var z={},y=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],x,w,v=0,u=y.length;v<u;++v){if(x=y[v],w=this.getElementsByTagNameNS(A,"*",x)[0]){switch(x.toLowerCase()){case"linestyle":x=this.parseProperty(w,"*","color");if(x=this.parseKmlColor(x)){z.strokeColor=x.color,z.strokeOpacity=x.opacity}(x=this.parseProperty(w,"*","width"))&&(z.strokeWidth=x);break;case"polystyle":x=this.parseProperty(w,"*","color");if(x=this.parseKmlColor(x)){z.fillOpacity=x.opacity,z.fillColor=x.color}"0"==this.parseProperty(w,"*","fill")&&(z.fillColor="none");"0"==this.parseProperty(w,"*","outline")&&(z.strokeWidth="0");break;case"iconstyle":var t=parseFloat(this.parseProperty(w,"*","scale")||1);x=32*t;var s=32*t,r=this.getElementsByTagNameNS(w,"*","Icon")[0];if(r){var q=this.parseProperty(r,"*","href");if(q){var p=this.parseProperty(r,"*","w"),o=this.parseProperty(r,"*","h");OpenLayers.String.startsWith(q,"http://maps.google.com/mapfiles/kml")&&(!p&&!o)&&(o=p=64,t/=2);p=p||o;o=o||p;p&&(x=parseInt(p)*t);o&&(s=parseInt(o)*t);if(o=q.match(this.regExes.kmlIconPalette)){p=o[1],o=o[2],q=this.parseProperty(r,"*","x"),r=this.parseProperty(r,"*","y"),q="http://maps.google.com/mapfiles/kml/pal"+p+"/icon"+(8*(r?7-r/32:7)+(q?q/32:0))+o}z.graphicOpacity=1;z.externalGraphic=q}}if(w=this.getElementsByTagNameNS(w,"*","hotSpot")[0]){q=parseFloat(w.getAttribute("x")),r=parseFloat(w.getAttribute("y")),p=w.getAttribute("xunits"),"pixels"==p?z.graphicXOffset=-q*t:"insetPixels"==p?z.graphicXOffset=-x+q*t:"fraction"==p&&(z.graphicXOffset=-x*q),w=w.getAttribute("yunits"),"pixels"==w?z.graphicYOffset=-s+r*t+1:"insetPixels"==w?z.graphicYOffset=-(r*t)+1:"fraction"==w&&(z.graphicYOffset=-s*(1-r)+1)}z.graphicWidth=x;z.graphicHeight=s;break;case"balloonstyle":(w=OpenLayers.Util.getXmlNodeValue(w))&&(z.balloonStyle=w.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":if(x=this.parseProperty(w,"*","color"),x=this.parseKmlColor(x)){z.fontColor=x.color,z.fontOpacity=x.opacity}}}}!z.strokeColor&&z.fillColor&&(z.strokeColor=z.fillColor);if((A=A.getAttribute("id"))&&z){z.id=A}return z},parseStyleMaps:function(u,t){for(var s=0,r=u.length;s<r;s++){for(var q=u[s],p=this.getElementsByTagNameNS(q,"*","Pair"),q=q.getAttribute("id"),o=0,m=p.length;o<m;o++){var l=p[o],k=this.parseProperty(l,"*","key");(l=this.parseProperty(l,"*","styleUrl"))&&"normal"==k&&(this.styles[(t.styleBaseUrl||"")+"#"+q]=this.styles[(t.styleBaseUrl||"")+l])}}},parseFeatures:function(k,j){for(var r=[],q=0,p=k.length;q<p;q++){var o=k[q],m=this.parseFeature.apply(this,[o]);if(m){this.extractStyles&&(m.attributes&&m.attributes.styleUrl)&&(m.style=this.getStyle(m.attributes.styleUrl,j));if(this.extractStyles){var l=this.getElementsByTagNameNS(o,"*","Style")[0];if(l&&(l=this.parseStyle(l))){m.style=OpenLayers.Util.extend(m.style,l)}}if(this.extractTracks){if((o=this.getElementsByTagNameNS(o,this.namespaces.gx,"Track"))&&0<o.length){m={features:[],feature:m},this.readNode(o[0],m),0<m.features.length&&r.push.apply(r,m.features)}}else{r.push(m)}}else{throw"Bad Placemark: "+q}}this.features=this.features.concat(r)},readers:{kml:{when:function(d,c){c.whens.push(OpenLayers.Date.parse(this.getChildValue(d)))},_trackPointAttribute:function(e,d){var f=e.nodeName.split(":").pop();d.attributes[f].push(this.getChildValue(e))}},gx:{Track:function(u,t){var s={whens:[],points:[],angles:[]};if(this.trackAttributes){var r;s.attributes={};for(var q=0,p=this.trackAttributes.length;q<p;++q){r=this.trackAttributes[q],s.attributes[r]=[],r in this.readers.kml||(this.readers.kml[r]=this.readers.kml._trackPointAttribute)}}this.readChildNodes(u,s);if(s.whens.length!==s.points.length){throw Error("gx:Track with unequal number of when ("+s.whens.length+") and gx:coord ("+s.points.length+") elements.")}var o=0<s.angles.length;if(o&&s.whens.length!==s.angles.length){throw Error("gx:Track with unequal number of when ("+s.whens.length+") and gx:angles ("+s.angles.length+") elements.")}for(var m,l,q=0,p=s.whens.length;q<p;++q){m=t.feature.clone();m.fid=t.feature.fid||t.feature.id;l=s.points[q];m.geometry=l;"z" in l&&(m.attributes.altitude=l.z);this.internalProjection&&this.externalProjection&&m.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes){l=0;for(var k=this.trackAttributes.length;l<k;++l){m.attributes[r]=s.attributes[this.trackAttributes[l]][q]}}m.attributes.when=s.whens[q];m.attributes.trackId=t.feature.id;o&&(l=s.angles[q],m.attributes.heading=parseFloat(l[0]),m.attributes.tilt=parseFloat(l[1]),m.attributes.roll=parseFloat(l[2]));t.features.push(m)}},coord:function(f,e){var h=this.getChildValue(f).replace(this.regExes.trimSpace,"").split(/\s+/),g=new OpenLayers.Geometry.Point(h[0],h[1]);2<h.length&&(g.z=parseFloat(h[2]));e.points.push(g)},angles:function(e,d){var f=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/);d.angles.push(f)}}},parseFeature:function(k){for(var j=["MultiGeometry","Polygon","LineString","Point"],r,q,p,o=0,m=j.length;o<m;++o){if(r=j[o],this.internalns=k.namespaceURI?k.namespaceURI:this.kmlns,q=this.getElementsByTagNameNS(k,this.internalns,r),0<q.length){if(j=this.parseGeometry[r.toLowerCase()]){p=j.apply(this,[q[0]]),this.internalProjection&&this.externalProjection&&p.transform(this.externalProjection,this.internalProjection)}else{throw new TypeError("Unsupported geometry type: "+r)}break}}var l;this.extractAttributes&&(l=this.parseAttributes(k));r=new OpenLayers.Feature.Vector(p,l);k=k.getAttribute("id")||k.getAttribute("name");null!=k&&(r.fid=k);return r},getStyle:function(f,e){var h=OpenLayers.Util.removeTail(f),g=OpenLayers.Util.extend({},e);g.depth++;g.styleBaseUrl=h;!this.styles[f]&&!OpenLayers.String.startsWith(f,"#")&&g.depth<=this.maxDepth&&!this.fetched[h]&&(h=this.fetchLink(h))&&this.parseData(h,g);return OpenLayers.Util.extend({},this.styles[f])},parseGeometry:{point:function(e){var d=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),e=[];if(0<d.length){var f=d[0].firstChild.nodeValue,f=f.replace(this.regExes.removeSpace,""),e=f.split(",")}d=null;if(1<e.length){2==e.length&&(e[2]=null),d=new OpenLayers.Geometry.Point(e[0],e[1],e[2])}else{throw"Bad coordinate string: "+f}return d},linestring:function(s,r){var q=this.getElementsByTagNameNS(s,this.internalns,"coordinates"),p=null;if(0<q.length){for(var q=this.getChildValue(q[0]),q=q.replace(this.regExes.trimSpace,""),q=q.replace(this.regExes.trimComma,","),p=q.split(this.regExes.splitSpace),o=p.length,m=Array(o),l,k,j=0;j<o;++j){if(l=p[j].split(","),k=l.length,1<k){2==l.length&&(l[2]=null),m[j]=new OpenLayers.Geometry.Point(l[0],l[1],l[2])}else{throw"Bad LineString point coordinates: "+p[j]}}if(o){p=r?new OpenLayers.Geometry.LinearRing(m):new OpenLayers.Geometry.LineString(m)}else{throw"Bad LineString coordinates: "+q}}return p},polygon:function(g){var g=this.getElementsByTagNameNS(g,this.internalns,"LinearRing"),f=g.length,k=Array(f);if(0<f){for(var j=0,h=g.length;j<h;++j){if(f=this.parseGeometry.linestring.apply(this,[g[j],!0])){k[j]=f}else{throw"Bad LinearRing geometry: "+j}}}return new OpenLayers.Geometry.Polygon(k)},multigeometry:function(h){for(var g,m=[],l=h.childNodes,k=0,j=l.length;k<j;++k){h=l[k],1==h.nodeType&&(g=this.parseGeometry[(h.prefix?h.nodeName.split(":")[1]:h.nodeName).toLowerCase()])&&m.push(g.apply(this,[h]))}return new OpenLayers.Geometry.Collection(m)}},parseAttributes:function(j){var h={},p=j.getElementsByTagName("ExtendedData");p.length&&(h=this.parseExtendedData(p[0]));for(var o,m,l,j=j.childNodes,p=0,k=j.length;p<k;++p){if(o=j[p],1==o.nodeType&&(m=o.childNodes,1<=m.length&&3>=m.length)){switch(m.length){case 1:l=m[0];break;case 2:l=m[0];m=m[1];l=3==l.nodeType||4==l.nodeType?l:m;break;default:l=m[1]}if(3==l.nodeType||4==l.nodeType){if(o=o.prefix?o.nodeName.split(":")[1]:o.nodeName,l=OpenLayers.Util.getXmlNodeValue(l)){l=l.replace(this.regExes.trimSpace,""),h[o]=l}}}}return h},parseExtendedData:function(s){var r={},q,p,o,m,l=s.getElementsByTagName("Data");q=0;for(p=l.length;q<p;q++){o=l[q];m=o.getAttribute("name");var k={},j=o.getElementsByTagName("value");j.length&&(k.value=this.getChildValue(j[0]));this.kvpAttributes?r[m]=k.value:(o=o.getElementsByTagName("displayName"),o.length&&(k.displayName=this.getChildValue(o[0])),r[m]=k)}s=s.getElementsByTagName("SimpleData");q=0;for(p=s.length;q<p;q++){k={},o=s[q],m=o.getAttribute("name"),k.value=this.getChildValue(o),this.kvpAttributes?r[m]=k.value:(k.displayName=m,r[m]=k)}return r},parseProperty:function(g,f,k){var j,g=this.getElementsByTagNameNS(g,f,k);try{j=OpenLayers.Util.getXmlNodeValue(g[0])}catch(h){j=null}return j},write:function(g){OpenLayers.Util.isArray(g)||(g=[g]);for(var f=this.createElementNS(this.kmlns,"kml"),k=this.createFolderXML(),j=0,h=g.length;j<h;++j){k.appendChild(this.createPlacemarkXML(g[j]))}f.appendChild(k);return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var d=this.createElementNS(this.kmlns,"name"),f=this.createTextNode(this.foldersName);d.appendChild(f);e.appendChild(d)}this.foldersDesc&&(d=this.createElementNS(this.kmlns,"description"),f=this.createTextNode(this.foldersDesc),d.appendChild(f),e.appendChild(d));return e},createPlacemarkXML:function(f){var e=this.createElementNS(this.kmlns,"name");e.appendChild(this.createTextNode(f.style&&f.style.label?f.style.label:f.attributes.name||f.id));var h=this.createElementNS(this.kmlns,"description");h.appendChild(this.createTextNode(f.attributes.description||this.placemarksDesc));var g=this.createElementNS(this.kmlns,"Placemark");null!=f.fid&&g.setAttribute("id",f.fid);g.appendChild(e);g.appendChild(h);e=this.buildGeometryNode(f.geometry);g.appendChild(e);f.attributes&&(f=this.buildExtendedData(f.attributes))&&g.appendChild(f);return g},buildGeometryNode:function(e){var d=e.CLASS_NAME,d=this.buildGeometry[d.substring(d.lastIndexOf(".")+1).toLowerCase()],f=null;d&&(f=d.apply(this,[e]));return f},buildGeometry:{point:function(d){var c=this.createElementNS(this.kmlns,"Point");c.appendChild(this.buildCoordinatesNode(d));return c},multipoint:function(b){return this.buildGeometry.collection.apply(this,[b])},linestring:function(d){var c=this.createElementNS(this.kmlns,"LineString");c.appendChild(this.buildCoordinatesNode(d));return c},multilinestring:function(b){return this.buildGeometry.collection.apply(this,[b])},linearring:function(d){var c=this.createElementNS(this.kmlns,"LinearRing");c.appendChild(this.buildCoordinatesNode(d));return c},polygon:function(h){for(var g=this.createElementNS(this.kmlns,"Polygon"),h=h.components,m,l,k=0,j=h.length;k<j;++k){m=0==k?"outerBoundaryIs":"innerBoundaryIs",m=this.createElementNS(this.kmlns,m),l=this.buildGeometry.linearring.apply(this,[h[k]]),m.appendChild(l),g.appendChild(m)}return g},multipolygon:function(b){return this.buildGeometry.collection.apply(this,[b])},collection:function(g){for(var f=this.createElementNS(this.kmlns,"MultiGeometry"),k,j=0,h=g.components.length;j<h;++j){(k=this.buildGeometryNode.apply(this,[g.components[j]]))&&f.appendChild(k)}return f}},buildCoordinatesNode:function(h){var g=this.createElementNS(this.kmlns,"coordinates"),m;if(m=h.components){for(var l=m.length,k=Array(l),j=0;j<l;++j){h=m[j],k[j]=this.buildCoordinates(h)}m=k.join(" ")}else{m=this.buildCoordinates(h)}m=this.createTextNode(m);g.appendChild(m);return g},buildCoordinates:function(b){this.internalProjection&&this.externalProjection&&(b=b.clone(),b.transform(this.internalProjection,this.externalProjection));return b.x+","+b.y},buildExtendedData:function(h){var g=this.createElementNS(this.kmlns,"ExtendedData"),m;for(m in h){if(h[m]&&"name"!=m&&"description"!=m&&"styleUrl"!=m){var l=this.createElementNS(this.kmlns,"Data");l.setAttribute("name",m);var k=this.createElementNS(this.kmlns,"value");if("object"==typeof h[m]){if(h[m].value&&k.appendChild(this.createTextNode(h[m].value)),h[m].displayName){var j=this.createElementNS(this.kmlns,"displayName");j.appendChild(this.getXMLDoc().createCDATASection(h[m].displayName));l.appendChild(j)}}else{k.appendChild(this.createTextNode(h[m]))}l.appendChild(k);g.appendChild(l)}}return this.isSimpleContent(g)?null:g},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(h,g,m,l,k,j){null==h&&(h=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=h;this.lonlat=g;this.contentSize=null!=m?m:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=l&&(this.contentHTML=l);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;this.groupDiv=OpenLayers.Util.createDiv(this.id+"_GroupDiv",null,null,null,"relative",null,"hidden");h=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(h,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);k&&this.addCloseBox(j);this.registerEvents()},destroy:function(){this.border=this.opacity=this.backgroundColor=this.contentHTML=this.size=this.lonlat=this.id=null;this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide);this.events.destroy();this.events=null;this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv));this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;null!=this.map&&this.map.removePopup(this);this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null},draw:function(b){null==b&&null!=this.lonlat&&null!=this.map&&(b=this.map.getLayerPxFromLonLat(this.lonlat));this.closeOnMove&&this.map.events.register("movestart",this,this.hide);!this.disableFirefoxOverflowHack&&"firefox"==OpenLayers.BROWSER_NAME&&(this.map.events.register("movestart",this,function(){var c=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");"hidden"!=c&&(this.contentDiv._oldOverflow=c,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var c=this.contentDiv._oldOverflow;c&&(this.contentDiv.style.overflow=c,this.contentDiv._oldOverflow=null)}));this.moveTo(b);!this.autoSize&&!this.size&&this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();this.panMapIfOutOfView&&this.panIntoView();return this.div},updatePosition:function(){if(this.lonlat&&this.map){var b=this.map.getLayerPxFromLonLat(this.lonlat);b&&this.moveTo(b)}},moveTo:function(b){null!=b&&null!=this.div&&(this.div.style.left=b.x+"px",this.div.style.top=b.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="";this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(g){this.size=g.clone();var f=this.getContentDivPadding(),k=f.left+f.right,j=f.top+f.bottom;this.fixPadding();k+=this.padding.left+this.padding.right;j+=this.padding.top+this.padding.bottom;if(this.closeDiv){var h=parseInt(this.closeDiv.style.width),k=k+(h+f.right)}this.size.w+=k;this.size.h+=j;"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=f.left+f.right,this.contentSize.h+=f.bottom+f.top);null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px");null!=this.contentDiv&&(this.contentDiv.style.width=g.w+"px",this.contentDiv.style.height=g.h+"px")},updateSize:function(){var g="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",f=this.map?this.map.div:document.body,k=OpenLayers.Util.getRenderedDimensions(g,null,{displayClass:this.displayClass,containerElement:f}),j=this.getSafeContentSize(k),h=null;j.equals(k)?h=k:(k={w:j.w<k.w?j.w:null,h:j.h<k.h?j.h:null},k.w&&k.h?h=j:(g=OpenLayers.Util.getRenderedDimensions(g,k,{displayClass:this.contentDisplayClass,containerElement:f}),"hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&g.equals(j)&&(j=OpenLayers.Util.getScrollbarWidth(),k.w?g.h+=j:g.w+=j),h=this.getSafeContentSize(g)));this.setSize(h)},setBackgroundColor:function(b){void 0!=b&&(this.backgroundColor=b);null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(b){void 0!=b&&(this.opacity=b);null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(b){void 0!=b&&(this.border=b);null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(b){null!=b&&(this.contentHTML=b);null!=this.contentDiv&&(null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML)&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var g=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad))},f=this.contentDiv.getElementsByTagName("img"),k=0,j=f.length;k<j;k++){var h=f[k];if(0==h.width||0==h.height){h._onImgLoad=OpenLayers.Function.bind(g,{popup:this,img:h}),OpenLayers.Event.observe(h,"load",h._onImgLoad)}}},getSafeContentSize:function(g){var g=g.clone(),f=this.getContentDivPadding(),k=f.left+f.right,j=f.top+f.bottom;this.fixPadding();k+=this.padding.left+this.padding.right;j+=this.padding.top+this.padding.bottom;if(this.closeDiv){var h=parseInt(this.closeDiv.style.width),k=k+(h+f.right)}this.minSize&&(g.w=Math.max(g.w,this.minSize.w-k),g.h=Math.max(g.h,this.minSize.h-j));this.maxSize&&(g.w=Math.min(g.w,this.maxSize.w-k),g.h=Math.min(g.h,this.maxSize.h-j));if(this.map&&this.map.size){h=f=0;if(this.keepInMap&&!this.panMapIfOutOfView){switch(h=this.map.getPixelFromLonLat(this.lonlat),this.relativePosition){case"tr":f=h.x;h=this.map.size.h-h.y;break;case"tl":f=this.map.size.w-h.x;h=this.map.size.h-h.y;break;case"bl":f=this.map.size.w-h.x;h=h.y;break;case"br":f=h.x;h=h.y;break;default:f=h.x,h=this.map.size.h-h.y}}j=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-j-h;g.w=Math.min(g.w,this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-k-f);g.h=Math.min(g.h,j)}return g},getContentDivPadding:function(){var b=this._contentDivPadding;if(!b&&(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),this._contentDivPadding=b=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this.div.parentNode==document.body)){document.body.removeChild(this.div),this.div.style.display=""}return b},addCloseBox:function(d){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17});this.closeDiv.className="olPopupCloseBox";var c=this.getContentDivPadding();this.closeDiv.style.right=c.right+"px";this.closeDiv.style.top=c.top+"px";this.groupDiv.appendChild(this.closeDiv);d=d||function(b){this.hide();OpenLayers.Event.stop(b)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(d,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(d,this))},panIntoView:function(){var e=this.map.getSize(),d=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),f=d.clone();d.x<this.map.paddingForPopups.left?f.x=this.map.paddingForPopups.left:d.x+this.size.w>e.w-this.map.paddingForPopups.right&&(f.x=e.w-this.map.paddingForPopups.right-this.size.w);d.y<this.map.paddingForPopups.top?f.y=this.map.paddingForPopups.top:d.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(f.y=e.h-this.map.paddingForPopups.bottom-this.size.h);this.map.pan(d.x-f.x,d.y-f.y)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(b){OpenLayers.Event.stop(b,!0)},scope:this})},onmousedown:function(b){this.mousedown=!0;OpenLayers.Event.stop(b,!0)},onmousemove:function(b){this.mousedown&&OpenLayers.Event.stop(b,!0)},onmouseup:function(b){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(b,!0))},onclick:function(b){OpenLayers.Event.stop(b,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(b){OpenLayers.Event.stop(b,!0)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(j,h,p,o,m,l,k){OpenLayers.Popup.prototype.initialize.apply(this,[j,h,p,o,l,k]);this.anchor=null!=m?m:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.relativePosition=this.anchor=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(d){var c=this.relativePosition;this.relativePosition=this.calculateRelativePosition(d);d=this.calculateNewPx(d);OpenLayers.Popup.prototype.moveTo.apply(this,Array(d));this.relativePosition!=c&&this.updateRelativePosition()},setSize:function(b){OpenLayers.Popup.prototype.setSize.apply(this,arguments);this.lonlat&&this.map&&this.moveTo(this.map.getLayerPxFromLonLat(this.lonlat))},calculateRelativePosition:function(b){b=this.map.getLonLatFromLayerPx(b);b=this.map.getExtent().determineQuadrant(b);return OpenLayers.Bounds.oppositeQuadrant(b)},updateRelativePosition:function(){},calculateNewPx:function(e){var e=e.offset(this.anchor.offset),d=this.size||this.contentSize,f="t"==this.relativePosition.charAt(0);e.y+=f?-d.h:this.anchor.size.h;f="l"==this.relativePosition.charAt(1);e.x+=f?-d.w:this.anchor.size.w;return e},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(e,d,f){this.rgb={r:e,g:d,b:f}},setRed:function(b){this.rgb.r=b},setGreen:function(b){this.rgb.g=b},setBlue:function(b){this.rgb.b=b},setHue:function(d){var c=this.asHSB();c.h=d;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,c.b)},setSaturation:function(d){var c=this.asHSB();c.s=d;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,c.b)},setBrightness:function(d){var c=this.asHSB();c.b=d;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,c.b)},darken:function(d){var c=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,Math.max(c.b-d,0))},brighten:function(d){var c=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,Math.min(c.b+d,1))},blend:function(b){this.rgb.r=Math.floor((this.rgb.r+b.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+b.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+b.rgb.b)/2)},isBright:function(){this.asHSB();return 0.5<this.asHSB().b},isDark:function(){return !this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});OpenLayers.Rico.Color.createFromHex=function(e){if(4==e.length){for(var d=e,e="#",f=1;4>f;f++){e+=d.charAt(f)+d.charAt(f)}}0==e.indexOf("#")&&(e=e.substring(1));d=e.substring(0,2);f=e.substring(2,4);e=e.substring(4,6);return new OpenLayers.Rico.Color(parseInt(d,16),parseInt(f,16),parseInt(e,16))};OpenLayers.Rico.Color.createColorFromBackground=function(d){var c=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(d),"backgroundColor");return"transparent"==c&&d.parentNode?OpenLayers.Rico.Color.createColorFromBackground(d.parentNode):null==c?new OpenLayers.Rico.Color(255,255,255):0==c.indexOf("rgb(")?(d=c.substring(4,c.length-1).split(","),new OpenLayers.Rico.Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]))):0==c.indexOf("#")?OpenLayers.Rico.Color.createFromHex(c):new OpenLayers.Rico.Color(255,255,255)};OpenLayers.Rico.Color.HSBtoRGB=function(s,r,q){var p=0,o=0,m=0;if(0==r){m=o=p=parseInt(255*q+0.5)}else{var s=6*(s-Math.floor(s)),l=s-Math.floor(s),k=q*(1-r),j=q*(1-r*l),r=q*(1-r*(1-l));switch(parseInt(s)){case 0:p=255*q+0.5;o=255*r+0.5;m=255*k+0.5;break;case 1:p=255*j+0.5;o=255*q+0.5;m=255*k+0.5;break;case 2:p=255*k+0.5;o=255*q+0.5;m=255*r+0.5;break;case 3:p=255*k+0.5;o=255*j+0.5;m=255*q+0.5;break;case 4:p=255*r+0.5;o=255*k+0.5;m=255*q+0.5;break;case 5:p=255*q+0.5,o=255*k+0.5,m=255*j+0.5}}return{r:parseInt(p),g:parseInt(o),b:parseInt(m)}};OpenLayers.Rico.Color.RGBtoHSB=function(k,j,r){var q,p=k>j?k:j;r>p&&(p=r);var o=k<j?k:j;r<o&&(o=r);q=0!=p?(p-o)/p:0;if(0==q){k=0}else{var m=(p-k)/(p-o),l=(p-j)/(p-o),r=(p-r)/(p-o),k=(k==p?r-l:j==p?2+m-r:4+l-m)/6;0>k&&(k+=1)}return{h:k,s:q,b:p/255}};OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};OpenLayers.Rico.Corner={round:function(f,e){f=OpenLayers.Util.getElement(f);this._setOptions(e);var h=this.options.color;"fromElement"==this.options.color&&(h=this._background(f));var g=this.options.bgColor;"fromParent"==this.options.bgColor&&(g=this._background(f.offsetParent));this._roundCornersImpl(f,h,g)},changeColor:function(f,e){f.style.backgroundColor=e;for(var h=f.parentNode.getElementsByTagName("span"),g=0;g<h.length;g++){h[g].style.backgroundColor=e}},changeOpacity:function(g,f){var k="alpha(opacity="+100*f+")";g.style.opacity=f;g.style.filter=k;for(var j=g.parentNode.getElementsByTagName("span"),h=0;h<j.length;h++){j[h].style.opacity=f,j[h].style.filter=k}},reRound:function(e,d){var f=e.parentNode.childNodes[2];e.parentNode.removeChild(e.parentNode.childNodes[0]);e.parentNode.removeChild(f);this.round(e.parentNode,d)},_roundCornersImpl:function(e,d,f){this.options.border&&this._renderBorder(e,f);this._isTopRounded()&&this._roundTopCorners(e,d,f);this._isBottomRounded()&&this._roundBottomCorners(e,d,f)},_renderBorder:function(e,d){var f="1px solid "+this._borderColor(d);e.innerHTML="<div "+("style='border-left: "+f+";"+("border-right: "+f)+"'")+">"+e.innerHTML+"</div>"},_roundTopCorners:function(g,f,k){for(var j=this._createCorner(k),h=0;h<this.options.numSlices;h++){j.appendChild(this._createCornerSlice(f,k,h,"top"))}g.style.paddingTop=0;g.insertBefore(j,g.firstChild)},_roundBottomCorners:function(g,f,k){for(var j=this._createCorner(k),h=this.options.numSlices-1;0<=h;h--){j.appendChild(this._createCornerSlice(f,k,h,"bottom"))}g.style.paddingBottom=0;g.appendChild(j)},_createCorner:function(d){var c=document.createElement("div");c.style.backgroundColor=this._isTransparent()?"transparent":d;return c},_createCornerSlice:function(h,g,m,l){var k=document.createElement("span"),j=k.style;j.backgroundColor=h;j.display="block";j.height="1px";j.overflow="hidden";j.fontSize="1px";h=this._borderColor(h,g);this.options.border&&0==m?(j.borderTopStyle="solid",j.borderTopWidth="1px",j.borderLeftWidth="0px",j.borderRightWidth="0px",j.borderBottomWidth="0px",j.height="0px",j.borderColor=h):h&&(j.borderColor=h,j.borderStyle="solid",j.borderWidth="0px 1px");!this.options.compact&&m==this.options.numSlices-1&&(j.height="2px");this._setMargin(k,m,l);this._setBorder(k,m,l);return k},_setOptions:function(b){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1};OpenLayers.Util.extend(this.options,b||{});this.options.numSlices=this.options.compact?2:4;this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")||0<=this.options.corners.indexOf("tl")&&0<=this.options.corners.indexOf("tr")?"":0<=this.options.corners.indexOf("tl")?"left":0<=this.options.corners.indexOf("tr")?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")||0<=this.options.corners.indexOf("bl")&&0<=this.options.corners.indexOf("br")?"":0<=this.options.corners.indexOf("bl")?"left":0<=this.options.corners.indexOf("br")?"right":""},_borderColor:function(d,c){return"transparent"==d?c:this.options.border?this.options.border:this.options.blend?this._blend(c,d):""},_setMargin:function(e,d,f){d=this._marginSize(d);f="top"==f?this._whichSideTop():this._whichSideBottom();"left"==f?(e.style.marginLeft=d+"px",e.style.marginRight="0px"):"right"==f?(e.style.marginRight=d+"px",e.style.marginLeft="0px"):(e.style.marginLeft=d+"px",e.style.marginRight=d+"px")},_setBorder:function(e,d,f){d=this._borderSize(d);f="top"==f?this._whichSideTop():this._whichSideBottom();"left"==f?(e.style.borderLeftWidth=d+"px",e.style.borderRightWidth="0px"):"right"==f?(e.style.borderRightWidth=d+"px",e.style.borderLeftWidth="0px"):(e.style.borderLeftWidth=d+"px",e.style.borderRightWidth=d+"px");!1!=this.options.border&&(e.style.borderLeftWidth=d+"px",e.style.borderRightWidth=d+"px")},_marginSize:function(g){if(this._isTransparent()){return 0}var f=[5,3,2,1],k=[3,2,1,0],j=[2,1],h=[1,0];return this.options.compact&&this.options.blend?h[g]:this.options.compact?j[g]:this.options.blend?k[g]:f[g]},_borderSize:function(g){var f=[5,3,2,1],k=[2,1,1,1],j=[1,0],h=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?j[g]:this.options.blend?k[g]:this.options.border?h[g]:this._isTransparent()?f[g]:0},_hasString:function(d){for(var c=1;c<arguments.length;c++){if(0<=d.indexOf(arguments[c])){return !0}}return !1},_blend:function(e,d){var f=OpenLayers.Rico.Color.createFromHex(e);f.blend(OpenLayers.Rico.Color.createFromHex(d));return f},_background:function(d){try{return OpenLayers.Rico.Color.createColorFromBackground(d).asHex()}catch(c){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(b){return 1==b.childNodes.length&&3==b.childNodes[0].nodeType}};OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:!1,initialize:function(j,h,p,o,m,l,k){OpenLayers.Console.warn("AnchoredBubble is deprecated");this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(b){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(b){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners()},setBackgroundColor:function(b){void 0!=b&&(this.backgroundColor=b);null!=this.div&&null!=this.contentDiv&&(this.div.style.background="transparent",OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor))},setOpacity:function(b){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,b);null!=this.div&&null!=this.groupDiv&&OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)},setBorder:function(){this.border=0},setRicoCorners:function(){var b={corners:this.getCornersToRound(this.relativePosition),color:this.backgroundColor,bgColor:"transparent",blend:!1};this.rounded?(OpenLayers.Rico.Corner.reRound(this.groupDiv,b),this.setBackgroundColor(),this.setOpacity()):(OpenLayers.Rico.Corner.round(this.div,b),this.rounded=!0)},getCornersToRound:function(){var d=["tl","tr","bl","br"],c=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(d,c);return d.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions)));!b.geometryName&&1<parseFloat(this.format.version)&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var d=new OpenLayers.Protocol.Response({requestType:"read"}),f=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);d.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,d,e),params:e.params,headers:e.headers,data:f});return d},setFeatureType:function(b){this.featureType=b;this.format.featureType=b},setGeometryName:function(b){this.geometryName=b;this.format.geometryName=b},handleRead:function(e,d){d=OpenLayers.Util.extend({},d);OpenLayers.Util.applyDefaults(d,this.options);if(d.callback){var f=e.priv;200<=f.status&&300>f.status?(f=this.parseResponse(f,d.readOptions))&&!1!==f.success?(d.readOptions&&"object"==d.readOptions.output?OpenLayers.Util.extend(e,f):e.features=f,e.code=OpenLayers.Protocol.Response.SUCCESS):(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=f):e.code=OpenLayers.Protocol.Response.FAILURE;d.callback.call(d.scope,e)}},parseResponse:function(f,e){var h=f.responseXML;if(!h||!h.documentElement){h=f.responseText}if(!h||0>=h.length){return null}h=null!==this.readFormat?this.readFormat.read(h):this.format.read(h,e);if(!this.featureNS){var g=this.readFormat||this.format;this.featureNS=g.featureNS;g.autoConfig=!1;this.geometryName||this.setGeometryName(g.geometryName)}return h},commit:function(e,d){d=OpenLayers.Util.extend({},d);OpenLayers.Util.applyDefaults(d,this.options);var f=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});f.priv=OpenLayers.Request.POST({url:d.url,headers:d.headers,data:this.format.write(e,d),callback:this.createCallback(this.handleCommit,f,d)});return f},handleCommit:function(f,e){if(e.callback){var h=f.priv,g=h.responseXML;if(!g||!g.documentElement){g=h.responseText}h=this.format.read(g)||{};f.insertIds=h.insertIds||[];h.success?f.code=OpenLayers.Protocol.Response.SUCCESS:(f.code=OpenLayers.Protocol.Response.FAILURE,f.error=h);e.callback.call(e.scope,f)}},filterDelete:function(g,f){f=OpenLayers.Util.extend({},f);OpenLayers.Util.applyDefaults(f,this.options);new OpenLayers.Protocol.Response({requestType:"commit"});var k=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),j=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(f.featureNS?this.featurePrefix+":":"")+f.featureType}});f.featureNS&&j.setAttribute("xmlns:"+this.featurePrefix,f.featureNS);var h=this.format.writeNode("ogc:Filter",g);j.appendChild(h);k.appendChild(j);k=OpenLayers.Format.XML.prototype.write.apply(this.format,[k]);return OpenLayers.Request.POST({url:this.url,callback:f.callback||function(){},data:k})},abort:function(b){b&&b.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,touch:!1,lastTouchPx:null,initialize:function(e,d,f){if(!f||!f.layerOptions||!f.layerOptions.styleMap){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return !1}var b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);return !0},createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return !1}this.cancel();null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1));this.layer=null;this.touch=!1;return !0},destroyFeature:function(b){this.layer&&(b||!this.persist)&&this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var b=this.layer;b&&1<b.features.length&&this.layer.features[0].destroy()},finalize:function(b){this.mouseDown=!1;this.lastTouchPx=this.lastUp=this.lastDown=null;this.callback(b?"cancel":"done",[this.geometryClone()]);this.destroyFeature(b)},cancel:function(){this.finalize(!0)},click:function(b){OpenLayers.Event.stop(b);return !1},dblclick:function(b){OpenLayers.Event.stop(b);return !1},modifyFeature:function(b){this.point||this.createFeature(b);b=this.layer.getLonLatFromViewPortPx(b);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var b=this.point&&this.point.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiPoint([b]));return b},geometryClone:function(){var b=this.getGeometry();return b&&b.clone()},mousedown:function(b){return this.down(b)},touchstart:function(b){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=b.xy;return this.down(b)},mousemove:function(b){return this.move(b)},touchmove:function(b){this.lastTouchPx=b.xy;return this.move(b)},mouseup:function(b){return this.up(b)},touchend:function(b){b.xy=this.lastTouchPx;return this.up(b)},down:function(b){this.mouseDown=!0;this.lastDown=b.xy;this.touch||this.modifyFeature(b.xy);this.stoppedDown=this.stopDown;return !this.stopDown},move:function(b){!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(b.xy);return !0},up:function(b){this.mouseDown=!1;this.stoppedDown=this.stopDown;return this.checkModifiers(b)&&(!this.lastUp||!this.lastUp.equals(b.xy))&&this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(b.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=b.xy,this.finalize(),!this.stopUp):!0},mouseout:function(b){OpenLayers.Util.mouseLeft(b,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(f,e,h){var g=!0;null!=h&&f&&e&&f.distanceTo(e)>h&&(g=!1);return g},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(b){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,b);this.line=null},destroyPersistedFeature:function(){var b=this.layer;b&&2<b.features.length&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(b){this.layer.removeFeatures([this.point]);b=this.layer.getLonLatFromViewPortPx(b);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(d,c){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(d,c),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(e,d){var f=this.line.geometry.components[this.getCurrentPointIndex()-1];f&&(!isNaN(f.x)&&!isNaN(f.y))&&this.insertXY(f.x+e,f.y+d)},insertDirectionLength:function(f,e){var f=f*(Math.PI/180),h=e*Math.cos(f),g=e*Math.sin(f);this.insertDeltaXY(h,g)},insertDeflectionLength:function(f,e){var h=this.getCurrentPointIndex()-1;if(0<h){var g=this.line.geometry.components[h],h=this.line.geometry.components[h-1];this.insertDirectionLength(180*Math.atan2(g.y-h.y,g.x-h.x)/Math.PI+f,e)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,d=e.components,f=this.getCurrentPointIndex()-1,d=d[f];if(e=e.removeComponent(d)){this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature()}return e},redo:function(){var b=this.redoStack&&this.redoStack.pop();b&&(this.line.geometry.addComponent(b,this.getCurrentPointIndex()),this.drawFeature());return !!b},freehandMode:function(b){return this.freehandToggle&&b[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,d){this.line||this.createFeature(e);var f=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=f.lon;this.point.geometry.y=f.lat;this.callback("modify",[this.point.geometry,this.getSketch(),d]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var b=this.line&&this.line.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiLineString([b]));return b},touchstart:function(b){if(this.timerId&&this.passesTolerance(this.lastTouchPx,b.xy,this.doubleTouchTolerance)){return this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1}this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,b)},down:function(d){var c=this.stopDown;this.freehandMode(d)&&(c=!0,this.touch&&(this.modifyFeature(d.xy,!!this.lastUp),OpenLayers.Event.stop(d)));!this.touch&&(!this.lastDown||!this.passesTolerance(this.lastDown,d.xy,this.pixelTolerance))&&this.modifyFeature(d.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=d.xy;this.stoppedDown=c;return !c},move:function(b){if(this.stoppedDown&&this.freehandMode(b)){return this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(b.xy),!1}!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(b.xy,!!this.lastUp);return !0},up:function(b){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(b.xy))){this.stoppedDown&&this.freehandMode(b)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(b.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(b.xy),this.lastUp=b.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())}this.stoppedDown=this.stopDown;this.mouseDown=!1;return !this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]);this.removePoint();this.finalize()},dblclick:function(b){this.freehandMode(b)||this.finishGeometry();return !1},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Spherical=OpenLayers.Spherical||{};OpenLayers.Spherical.DEFAULT_RADIUS=6378137;OpenLayers.Spherical.computeDistanceBetween=function(g,f,k){var k=k||OpenLayers.Spherical.DEFAULT_RADIUS,j=Math.sin(Math.PI*(f.lon-g.lon)/360),h=Math.sin(Math.PI*(f.lat-g.lat)/360),g=h*h+j*j*Math.cos(Math.PI*g.lat/180)*Math.cos(Math.PI*f.lat/180);return 2*k*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))};OpenLayers.Spherical.computeHeading=function(f,e){var h=Math.sin(Math.PI*(f.lon-e.lon)/180)*Math.cos(Math.PI*e.lat/180),g=Math.cos(Math.PI*f.lat/180)*Math.sin(Math.PI*e.lat/180)-Math.sin(Math.PI*f.lat/180)*Math.cos(Math.PI*e.lat/180)*Math.cos(Math.PI*(f.lon-e.lon)/180);return 180*Math.atan2(h,g)/Math.PI};OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);var d,f=this.layers||e.layers;for(d=f.length-1;0<=d;--d){this.addLayer({layer:f[d]})}if(!this.layers){e.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(b){b.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},removeLayer:function(b){b.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},makeSameOrigin:function(d){if(this.active&&(d=d.tile,d instanceof OpenLayers.Tile.Image&&!d.crossOriginKeyword&&"data:"!==d.url.substr(0,5))){var c=OpenLayers.Request.makeSameOrigin(d.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[c]=d.url;d.url=c}},cache:function(f){if(this.active&&window.localStorage&&(f=f.tile,f instanceof OpenLayers.Tile.Image&&"data:"!==f.url.substr(0,5))){try{var e=f.getCanvasContext();if(e){var h=OpenLayers.Control.CacheWrite.urlMap;window.localStorage.setItem("olCache_"+(h[f.url]||f.url),e.canvas.toDataURL(this.imageFormat));delete h[f.url]}}catch(g){(e=g.name||g.message)&&this.quotaRegEx.test(e)?this.events.triggerEvent("cachefull",{tile:f}):OpenLayers.Console.error(g.toString())}}},destroy:function(){if(this.layers||this.map){var d,c=this.layers||this.map.layers;for(d=c.length-1;0<=d;--d){this.removeLayer({layer:c[d]})}}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"});OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var d,c;for(d=window.localStorage.length-1;0<=d;--d){c=window.localStorage.key(d),"olCache_"===c.substr(0,8)&&window.localStorage.removeItem(c)}}};OpenLayers.Control.CacheWrite.urlMap={};OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(f,e){var h=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(e&&e.map){if(this.context=h,e.map instanceof OpenLayers.Map){h=this.mergeContextToMap(h,e.map)}else{var g=e.map;if(OpenLayers.Util.isElement(g)||"string"==typeof g){g={div:g}}h=this.contextToMap(h,g)}}return h},getLayerFromContext:function(h){var g,m,l={queryable:h.queryable,visibility:h.visibility,maxExtent:h.maxExtent,metadata:OpenLayers.Util.applyDefaults(h.metadata,{styles:h.styles,formats:h.formats,"abstract":h["abstract"],dataURL:h.dataURL}),numZoomLevels:h.numZoomLevels,units:h.units,isBaseLayer:h.isBaseLayer,opacity:h.opacity,displayInLayerSwitcher:h.displayInLayerSwitcher,singleTile:h.singleTile,tileSize:h.tileSize?new OpenLayers.Size(h.tileSize.width,h.tileSize.height):void 0,minScale:h.minScale||h.maxScaleDenominator,maxScale:h.maxScale||h.minScaleDenominator,srs:h.srs,dimensions:h.dimensions,metadataURL:h.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(l,this.layerOptions);var k={layers:h.name,transparent:h.transparent,version:h.version};if(h.formats&&0<h.formats.length){k.format=h.formats[0].value;g=0;for(m=h.formats.length;g<m;g++){var j=h.formats[g];if(!0==j.current){k.format=j.value;break}}}if(h.styles&&0<h.styles.length){g=0;for(m=h.styles.length;g<m;g++){if(j=h.styles[g],!0==j.current){j.href?k.sld=j.href:j.body?k.sld_body=j.body:k.styles=j.name;break}}}this.layerParams&&OpenLayers.Util.applyDefaults(k,this.layerParams);g=null;m=h.service;m==OpenLayers.Format.Context.serviceTypes.WFS?(l.strategies=[new OpenLayers.Strategy.BBOX],l.protocol=new OpenLayers.Protocol.WFS({url:h.url,featurePrefix:h.name.split(":")[0],featureType:h.name.split(":").pop()}),g=new OpenLayers.Layer.Vector(h.title||h.name,l)):m==OpenLayers.Format.Context.serviceTypes.KML?(l.strategies=[new OpenLayers.Strategy.Fixed],l.protocol=new OpenLayers.Protocol.HTTP({url:h.url,format:new OpenLayers.Format.KML}),g=new OpenLayers.Layer.Vector(h.title||h.name,l)):m==OpenLayers.Format.Context.serviceTypes.GML?(l.strategies=[new OpenLayers.Strategy.Fixed],l.protocol=new OpenLayers.Protocol.HTTP({url:h.url,format:new OpenLayers.Format.GML}),g=new OpenLayers.Layer.Vector(h.title||h.name,l)):h.features?(g=new OpenLayers.Layer.Vector(h.title||h.name,l),g.addFeatures(h.features)):!0!==h.categoryLayer&&(g=new OpenLayers.Layer.WMS(h.title||h.name,h.url,k,l));return g},getLayersFromContext:function(g){for(var f=[],k=0,j=g.length;k<j;k++){var h=this.getLayerFromContext(g[k]);null!==h&&f.push(h)}return f},contextToMap:function(e,d){d=OpenLayers.Util.applyDefaults({maxExtent:e.maxExtent,projection:e.projection,units:e.units},d);d.maxExtent&&(d.maxResolution=d.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);d.metadata={contactInformation:e.contactInformation,"abstract":e["abstract"],keywords:e.keywords,logo:e.logo,descriptionURL:e.descriptionURL};var f=new OpenLayers.Map(d);f.addLayers(this.getLayersFromContext(e.layersContext));f.setCenter(e.bounds.getCenterLonLat(),f.getZoomForExtent(e.bounds,!0));return f},mergeContextToMap:function(d,c){c.addLayers(this.getLayersFromContext(d.layersContext));return c},write:function(d,c){d=this.toContext(d);return OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"});OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"};OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(h){var g=this.getParser(),m={queryable:h.queryable,visibility:h.visibility,name:h.params.LAYERS,title:h.name,"abstract":h.metadata["abstract"],dataURL:h.metadata.dataURL,metadataURL:h.metadataURL,server:{version:h.params.VERSION,url:h.url},maxExtent:h.maxExtent,transparent:h.params.TRANSPARENT,numZoomLevels:h.numZoomLevels,units:h.units,isBaseLayer:h.isBaseLayer,opacity:1==h.opacity?void 0:h.opacity,displayInLayerSwitcher:h.displayInLayerSwitcher,singleTile:h.singleTile,tileSize:h.singleTile||!h.tileSize?void 0:{width:h.tileSize.w,height:h.tileSize.h},minScale:h.options.resolutions||h.options.scales||h.options.maxResolution||h.options.minScale?h.minScale:void 0,maxScale:h.options.resolutions||h.options.scales||h.options.minResolution||h.options.maxScale?h.maxScale:void 0,formats:[],styles:[],srs:h.srs,dimensions:h.dimensions};h.metadata.servertitle&&(m.server.title=h.metadata.servertitle);if(h.metadata.formats&&0<h.metadata.formats.length){for(var l=0,k=h.metadata.formats.length;l<k;l++){var j=h.metadata.formats[l];m.formats.push({value:j.value,current:j.value==h.params.FORMAT})}}else{m.formats.push({value:h.params.FORMAT,current:!0})}if(h.metadata.styles&&0<h.metadata.styles.length){l=0;for(k=h.metadata.styles.length;l<k;l++){g=h.metadata.styles[l],g.current=g.href==h.params.SLD||g.body==h.params.SLD_BODY||g.name==h.params.STYLES?!0:!1,m.styles.push(g)}}else{m.styles.push({href:h.params.SLD,body:h.params.SLD_BODY,name:h.params.STYLES||g.defaultStyleName,title:g.defaultStyleTitle,current:!0})}return m},toContext:function(g){var f={},k=g.layers;if("OpenLayers.Map"==g.CLASS_NAME){var j=g.metadata||{};f.size=g.getSize();f.bounds=g.getExtent();f.projection=g.projection;f.title=g.title;f.keywords=j.keywords;f["abstract"]=j["abstract"];f.logo=j.logo;f.descriptionURL=j.descriptionURL;f.contactInformation=j.contactInformation;f.maxExtent=g.maxExtent}else{OpenLayers.Util.applyDefaults(f,g),void 0!=f.layers&&delete f.layers}void 0==f.layersContext&&(f.layersContext=[]);if(void 0!=k&&OpenLayers.Util.isArray(k)){g=0;for(j=k.length;g<j;g++){var h=k[g];h instanceof OpenLayers.Layer.WMS&&f.layersContext.push(this.layerToContext(h))}}return f},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(d){var c=null;if(null==d){c=this.namespaces[this.defaultPrefix]}else{for(c in this.namespaces){if(this.namespaces[c]==d){break}}}return c},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d=d.documentElement;this.rootPrefix=d.prefix;var c={version:d.getAttribute("version")};this.runChildNodes(c,d);return c},runChildNodes:function(k,j){for(var r=j.childNodes,q,p,o,m=0,l=r.length;m<l;++m){q=r[m],1==q.nodeType&&(p=this.getNamespacePrefix(q.namespaceURI),o=q.nodeName.split(":").pop(),(p=this["read_"+p+"_"+o])&&p.apply(this,[k,q]))}},read_wmc_General:function(d,c){this.runChildNodes(d,c)},read_wmc_BoundingBox:function(d,c){d.projection=c.getAttribute("SRS");d.bounds=new OpenLayers.Bounds(c.getAttribute("minx"),c.getAttribute("miny"),c.getAttribute("maxx"),c.getAttribute("maxy"))},read_wmc_LayerList:function(d,c){d.layersContext=[];this.runChildNodes(d,c)},read_wmc_Layer:function(e,d){var f={visibility:"1"!=d.getAttribute("hidden"),queryable:"1"==d.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(f,d);e.layersContext.push(f)},read_wmc_Extension:function(d,c){this.runChildNodes(d,c)},read_ol_units:function(d,c){d.units=this.getChildValue(c)},read_ol_maxExtent:function(e,d){var f=new OpenLayers.Bounds(d.getAttribute("minx"),d.getAttribute("miny"),d.getAttribute("maxx"),d.getAttribute("maxy"));e.maxExtent=f},read_ol_transparent:function(d,c){d.transparent=this.getChildValue(c)},read_ol_numZoomLevels:function(d,c){d.numZoomLevels=parseInt(this.getChildValue(c))},read_ol_opacity:function(d,c){d.opacity=parseFloat(this.getChildValue(c))},read_ol_singleTile:function(d,c){d.singleTile="true"==this.getChildValue(c)},read_ol_tileSize:function(e,d){var f={width:d.getAttribute("width"),height:d.getAttribute("height")};e.tileSize=f},read_ol_isBaseLayer:function(d,c){d.isBaseLayer="true"==this.getChildValue(c)},read_ol_displayInLayerSwitcher:function(d,c){d.displayInLayerSwitcher="true"==this.getChildValue(c)},read_wmc_Server:function(d,c){d.version=c.getAttribute("version");d.url=this.getOnlineResource_href(c);d.metadata.servertitle=c.getAttribute("title")},read_wmc_FormatList:function(d,c){this.runChildNodes(d,c)},read_wmc_Format:function(e,d){var f={value:this.getChildValue(d)};"1"==d.getAttribute("current")&&(f.current=!0);e.formats.push(f)},read_wmc_StyleList:function(d,c){this.runChildNodes(d,c)},read_wmc_Style:function(e,d){var f={};this.runChildNodes(f,d);"1"==d.getAttribute("current")&&(f.current=!0);e.styles.push(f)},read_wmc_SLD:function(d,c){this.runChildNodes(d,c)},read_sld_StyledLayerDescriptor:function(e,d){var f=OpenLayers.Format.XML.prototype.write.apply(this,[d]);e.body=f},read_sld_FeatureTypeStyle:function(e,d){var f=OpenLayers.Format.XML.prototype.write.apply(this,[d]);e.body=f},read_wmc_OnlineResource:function(d,c){d.href=this.getAttributeNS(c,this.namespaces.xlink,"href")},read_wmc_Name:function(e,d){var f=this.getChildValue(d);f&&(e.name=f)},read_wmc_Title:function(e,d){var f=this.getChildValue(d);f&&(e.title=f)},read_wmc_MetadataURL:function(d,c){d.metadataURL=this.getOnlineResource_href(c)},read_wmc_KeywordList:function(d,c){d.keywords=[];this.runChildNodes(d.keywords,c)},read_wmc_Keyword:function(d,c){d.push(this.getChildValue(c))},read_wmc_Abstract:function(e,d){var f=this.getChildValue(d);f&&(e["abstract"]=f)},read_wmc_LogoURL:function(d,c){d.logo={width:c.getAttribute("width"),height:c.getAttribute("height"),format:c.getAttribute("format"),href:this.getOnlineResource_href(c)}},read_wmc_DescriptionURL:function(d,c){d.descriptionURL=this.getOnlineResource_href(c)},read_wmc_ContactInformation:function(e,d){var f={};this.runChildNodes(f,d);e.contactInformation=f},read_wmc_ContactPersonPrimary:function(e,d){var f={};this.runChildNodes(f,d);e.personPrimary=f},read_wmc_ContactPerson:function(e,d){var f=this.getChildValue(d);f&&(e.person=f)},read_wmc_ContactOrganization:function(e,d){var f=this.getChildValue(d);f&&(e.organization=f)},read_wmc_ContactPosition:function(e,d){var f=this.getChildValue(d);f&&(e.position=f)},read_wmc_ContactAddress:function(e,d){var f={};this.runChildNodes(f,d);e.contactAddress=f},read_wmc_AddressType:function(e,d){var f=this.getChildValue(d);f&&(e.type=f)},read_wmc_Address:function(e,d){var f=this.getChildValue(d);f&&(e.address=f)},read_wmc_City:function(e,d){var f=this.getChildValue(d);f&&(e.city=f)},read_wmc_StateOrProvince:function(e,d){var f=this.getChildValue(d);f&&(e.stateOrProvince=f)},read_wmc_PostCode:function(e,d){var f=this.getChildValue(d);f&&(e.postcode=f)},read_wmc_Country:function(e,d){var f=this.getChildValue(d);f&&(e.country=f)},read_wmc_ContactVoiceTelephone:function(e,d){var f=this.getChildValue(d);f&&(e.phone=f)},read_wmc_ContactFacsimileTelephone:function(e,d){var f=this.getChildValue(d);f&&(e.fax=f)},read_wmc_ContactElectronicMailAddress:function(e,d){var f=this.getChildValue(d);f&&(e.email=f)},read_wmc_DataURL:function(d,c){d.dataURL=this.getOnlineResource_href(c)},read_wmc_LegendURL:function(e,d){var f={width:d.getAttribute("width"),height:d.getAttribute("height"),format:d.getAttribute("format"),href:this.getOnlineResource_href(d)};e.legend=f},read_wmc_DimensionList:function(d,c){d.dimensions={};this.runChildNodes(d.dimensions,c)},read_wmc_Dimension:function(f,e){var h={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units")||"",unitSymbol:e.getAttribute("unitSymbol")||"",userValue:e.getAttribute("userValue")||"",nearestValue:"1"===e.getAttribute("nearestValue"),multipleValues:"1"===e.getAttribute("multipleValues"),current:"1"===e.getAttribute("current"),"default":e.getAttribute("default")||""},g=this.getChildValue(e);h.values=g.split(",");f[h.name]=h},write:function(e,d){var f=this.createElementDefaultNS("ViewContext");this.setAttributes(f,{version:this.VERSION,id:d&&"string"==typeof d.id?d.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);f.appendChild(this.write_wmc_General(e));f.appendChild(this.write_wmc_LayerList(e));return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createElementDefaultNS:function(e,d,f){e=this.createElementNS(this.namespaces[this.defaultPrefix],e);d&&e.appendChild(this.createTextNode(d));f&&this.setAttributes(e,f);return e},setAttributes:function(f,e){var h,g;for(g in e){h=e[g].toString(),h.match(/[A-Z]/)?this.setAttributeNS(f,null,g,h):f.setAttribute(g,h)}},write_wmc_General:function(e){var d=this.createElementDefaultNS("General");e.size&&d.appendChild(this.createElementDefaultNS("Window",null,{width:e.size.w,height:e.size.h}));var f=e.bounds;d.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:f.left.toPrecision(18),miny:f.bottom.toPrecision(18),maxx:f.right.toPrecision(18),maxy:f.top.toPrecision(18),SRS:e.projection}));d.appendChild(this.createElementDefaultNS("Title",e.title));e.keywords&&d.appendChild(this.write_wmc_KeywordList(e.keywords));e["abstract"]&&d.appendChild(this.createElementDefaultNS("Abstract",e["abstract"]));e.logo&&d.appendChild(this.write_wmc_URLType("LogoURL",e.logo.href,e.logo));e.descriptionURL&&d.appendChild(this.write_wmc_URLType("DescriptionURL",e.descriptionURL));e.contactInformation&&d.appendChild(this.write_wmc_ContactInformation(e.contactInformation));d.appendChild(this.write_ol_MapExtension(e));return d},write_wmc_KeywordList:function(f){for(var e=this.createElementDefaultNS("KeywordList"),h=0,g=f.length;h<g;h++){e.appendChild(this.createElementDefaultNS("Keyword",f[h]))}return e},write_wmc_ContactInformation:function(d){var c=this.createElementDefaultNS("ContactInformation");d.personPrimary&&c.appendChild(this.write_wmc_ContactPersonPrimary(d.personPrimary));d.position&&c.appendChild(this.createElementDefaultNS("ContactPosition",d.position));d.contactAddress&&c.appendChild(this.write_wmc_ContactAddress(d.contactAddress));d.phone&&c.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",d.phone));d.fax&&c.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",d.fax));d.email&&c.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",d.email));return c},write_wmc_ContactPersonPrimary:function(d){var c=this.createElementDefaultNS("ContactPersonPrimary");d.person&&c.appendChild(this.createElementDefaultNS("ContactPerson",d.person));d.organization&&c.appendChild(this.createElementDefaultNS("ContactOrganization",d.organization));return c},write_wmc_ContactAddress:function(d){var c=this.createElementDefaultNS("ContactAddress");d.type&&c.appendChild(this.createElementDefaultNS("AddressType",d.type));d.address&&c.appendChild(this.createElementDefaultNS("Address",d.address));d.city&&c.appendChild(this.createElementDefaultNS("City",d.city));d.stateOrProvince&&c.appendChild(this.createElementDefaultNS("StateOrProvince",d.stateOrProvince));d.postcode&&c.appendChild(this.createElementDefaultNS("PostCode",d.postcode));d.country&&c.appendChild(this.createElementDefaultNS("Country",d.country));return c},write_ol_MapExtension:function(e){var d=this.createElementDefaultNS("Extension");if(e=e.maxExtent){var f=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(f,{minx:e.left.toPrecision(18),miny:e.bottom.toPrecision(18),maxx:e.right.toPrecision(18),maxy:e.top.toPrecision(18)});d.appendChild(f)}return d},write_wmc_LayerList:function(f){for(var e=this.createElementDefaultNS("LayerList"),h=0,g=f.layersContext.length;h<g;++h){e.appendChild(this.write_wmc_Layer(f.layersContext[h]))}return e},write_wmc_Layer:function(d){var c=this.createElementDefaultNS("Layer",null,{queryable:d.queryable?"1":"0",hidden:d.visibility?"0":"1"});c.appendChild(this.write_wmc_Server(d));c.appendChild(this.createElementDefaultNS("Name",d.name));c.appendChild(this.createElementDefaultNS("Title",d.title));d["abstract"]&&c.appendChild(this.createElementDefaultNS("Abstract",d["abstract"]));d.dataURL&&c.appendChild(this.write_wmc_URLType("DataURL",d.dataURL));d.metadataURL&&c.appendChild(this.write_wmc_URLType("MetadataURL",d.metadataURL));return c},write_wmc_LayerExtension:function(h){var g=this.createElementDefaultNS("Extension"),m=h.maxExtent,l=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(l,{minx:m.left.toPrecision(18),miny:m.bottom.toPrecision(18),maxx:m.right.toPrecision(18),maxy:m.top.toPrecision(18)});g.appendChild(l);h.tileSize&&!h.singleTile&&(m=this.createElementNS(this.namespaces.ol,"ol:tileSize"),this.setAttributes(m,h.tileSize),g.appendChild(m));for(var m="transparent numZoomLevels units isBaseLayer opacity displayInLayerSwitcher singleTile".split(" "),k=0,j=m.length;k<j;++k){(l=this.createOLPropertyNode(h,m[k]))&&g.appendChild(l)}return g},createOLPropertyNode:function(e,d){var f=null;null!=e[d]&&(f=this.createElementNS(this.namespaces.ol,"ol:"+d),f.appendChild(this.createTextNode(e[d].toString())));return f},write_wmc_Server:function(e){var e=e.server,d=this.createElementDefaultNS("Server"),f={service:"OGC:WMS",version:e.version};e.title&&(f.title=e.title);this.setAttributes(d,f);d.appendChild(this.write_wmc_OnlineResource(e.url));return d},write_wmc_URLType:function(f,e,h){f=this.createElementDefaultNS(f);f.appendChild(this.write_wmc_OnlineResource(e));if(h){for(var e=["width","height","format"],g=0;g<e.length;g++){e[g] in h&&f.setAttribute(e[g],h[e[g]])}}return f},write_wmc_DimensionList:function(h){var g=this.createElementDefaultNS("DimensionList"),m;for(m in h.dimensions){var l={},k=h.dimensions[m],j;for(j in k){l[j]="boolean"==typeof k[j]?Number(k[j]):k[j]}k="";l.values&&(k=l.values.join(","),delete l.values);g.appendChild(this.createElementDefaultNS("Dimension",k,l))}return g},write_wmc_FormatList:function(g){for(var f=this.createElementDefaultNS("FormatList"),k=0,j=g.formats.length;k<j;k++){var h=g.formats[k];f.appendChild(this.createElementDefaultNS("Format",h.value,h.current&&!0==h.current?{current:"1"}:null))}return f},write_wmc_StyleList:function(j){var h=this.createElementDefaultNS("StyleList");if((j=j.styles)&&OpenLayers.Util.isArray(j)){for(var p,o=0,m=j.length;o<m;o++){var l=j[o],k=this.createElementDefaultNS("Style",null,l.current&&!0==l.current?{current:"1"}:null);l.href?(p=this.createElementDefaultNS("SLD"),l.name&&p.appendChild(this.createElementDefaultNS("Name",l.name)),l.title&&p.appendChild(this.createElementDefaultNS("Title",l.title)),l.legend&&p.appendChild(this.write_wmc_URLType("LegendURL",l.legend.href,l.legend)),l=this.write_wmc_OnlineResource(l.href),p.appendChild(l),k.appendChild(p)):l.body?(p=this.createElementDefaultNS("SLD"),l.name&&p.appendChild(this.createElementDefaultNS("Name",l.name)),l.title&&p.appendChild(this.createElementDefaultNS("Title",l.title)),l.legend&&p.appendChild(this.write_wmc_URLType("LegendURL",l.legend.href,l.legend)),l=OpenLayers.Format.XML.prototype.read.apply(this,[l.body]).documentElement,p.ownerDocument&&p.ownerDocument.importNode&&(l=p.ownerDocument.importNode(l,!0)),p.appendChild(l),k.appendChild(p)):(k.appendChild(this.createElementDefaultNS("Name",l.name)),k.appendChild(this.createElementDefaultNS("Title",l.title)),l["abstract"]&&k.appendChild(this.createElementDefaultNS("Abstract",l["abstract"])),l.legend&&k.appendChild(this.write_wmc_URLType("LegendURL",l.legend.href,l.legend)));h.appendChild(k)}}return h},write_wmc_OnlineResource:function(d){var c=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(c,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(c,this.namespaces.xlink,"xlink:href",d);return c},getOnlineResource_href:function(d){var c={},d=d.getElementsByTagName("OnlineResource");0<d.length&&this.read_wmc_OnlineResource(c,d[0]);return c.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);b={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,b),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,b),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,b),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,b)])},CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var f=[];if(this.map&&this.map.layers){for(var e=0,h=this.map.layers.length;e<h;e++){var g=this.map.layers[e];g.attribution&&g.getVisibility()&&-1===OpenLayers.Util.indexOf(f,g.attribution)&&f.push(g.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:f.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(b){OpenLayers.Util.extend(this,b)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]},update:function(b){this.points.unshift({xy:b,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(h){for(var g,m=(new Date).getTime(),l=0,k=this.points.length,j;l<k;l++){j=this.points[l];if(m-j.tick>this.delay){break}g=j}if(g&&(l=(new Date).getTime()-g.tick,m=Math.sqrt(Math.pow(h.x-g.xy.x,2)+Math.pow(h.y-g.xy.y,2)),l=m/l,!(0==l||l<this.threshold))){return m=Math.asin((h.y-g.xy.y)/m),g.xy.x<=h.x&&(m=Math.PI-m),{speed:l,theta:m}}},move:function(k,j){var r=k.speed,q=Math.cos(k.theta),p=-Math.sin(k.theta),o=(new Date).getTime(),m=0,l=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var d=(new Date).getTime()-o,f=-this.deceleration*Math.pow(d,2)/2+r*d,e=f*q,f=f*p,c,b;c=!1;0>=-this.deceleration*d+r&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,c=!0);d=e-m;b=f-l;m=e;l=f;j(d,b,c)}},this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(e,d,f){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[e,f]);this.location=d;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(e,d,f){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(u){var t=u.responseXML;if(!t||!t.documentElement){t=OpenLayers.Format.XML.prototype.read(u.responseText)}if(this.useFeedTitle){u=null;try{u=t.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(s){u=t.getElementsByTagName("title")[0].firstChild.nodeValue}u&&this.setName(u)}u={};OpenLayers.Util.extend(u,this.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(u.externalProjection=this.projection,u.internalProjection=this.map.getProjectionObject());for(var t=(new OpenLayers.Format.GeoRSS(u)).read(t),u=0,r=t.length;u<r;u++){var q={},p=t[u];if(p.geometry){var o=p.attributes.title?p.attributes.title:"Untitled",m=p.attributes.description?p.attributes.description:"No description.",l=p.attributes.link?p.attributes.link:"",p=p.geometry.getBounds().getCenterLonLat();q.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone();q.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(o||m){q.title=o;q.description=m;var k='<div class="olLayerGeoRSSClose">[x]</div>',k=k+'<div class="olLayerGeoRSSTitle">';l&&(k+='<a class="link" href="'+l+'" target="_blank">');k+=o;l&&(k+="</a>");k+="</div>";k+='<div style="" class="olLayerGeoRSSDescription">';k+=m;k+="</div>";q.popupContentHTML=k}p=new OpenLayers.Feature(this,p,q);this.features.push(p);q=p.createMarker();q.events.register("click",p,this.markerClick);this.addMarker(q)}}this.events.triggerEvent("loadend")},markerClick:function(f){var e=this==this.layer.selectedFeature;this.layer.selectedFeature=!e?this:null;for(var h=0,g=this.layer.map.popups.length;h<g;h++){this.layer.map.removePopup(this.layer.map.popups[h])}e||(e=this.createPopup(),OpenLayers.Event.observe(e.div,"click",OpenLayers.Function.bind(function(){for(var d=0,c=this.layer.map.popups.length;d<c;d++){this.layer.map.removePopup(this.layer.map.popups[d])}},this)),this.layer.map.addPopup(e));OpenLayers.Event.stop(f)},clearFeatures:function(){if(null!=this.features){for(;0<this.features.length;){var b=this.features[0];OpenLayers.Util.removeItem(this.features,b);b.destroy()}}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"});OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"});OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(e,d){var d=OpenLayers.Util.applyDefaults(d,this.options),f={namedLayers:!0===d.namedLayersAsArray?[]:{}};this.readChildNodes(e,f);return f},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(d,c){c.version=d.getAttribute("version");this.readChildNodes(d,c)},Name:function(d,c){c.name=this.getChildValue(d)},Title:function(d,c){c.title=this.getChildValue(d)},Abstract:function(d,c){c.description=this.getChildValue(d)},NamedLayer:function(g,f){var k={userStyles:[],namedStyles:[]};this.readChildNodes(g,k);for(var j=0,h=k.userStyles.length;j<h;++j){k.userStyles[j].layerName=k.name}OpenLayers.Util.isArray(f.namedLayers)?f.namedLayers.push(k):f.namedLayers[k.name]=k},NamedStyle:function(d,c){c.namedStyles.push(this.getChildName(d.firstChild))},UserStyle:function(e,d){var f={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(e,f);this.multipleSymbolizers?(delete f.defaultsPerSymbolizer,f=new OpenLayers.Style2(f)):f=new OpenLayers.Style(this.defaultSymbolizer,f);d.userStyles.push(f)},IsDefault:function(d,c){"1"==this.getChildValue(d)&&(c.isDefault=!0)},FeatureTypeStyle:function(e,d){++this.featureTypeCounter;var f={rules:this.multipleSymbolizers?d.rules:[]};this.readChildNodes(e,f);this.multipleSymbolizers||(d.rules=f.rules)},Rule:function(e,d){var f;this.multipleSymbolizers&&(f={symbolizers:[]});f=new OpenLayers.Rule(f);this.readChildNodes(e,f);d.rules.push(f)},ElseFilter:function(d,c){c.elseFilter=!0},MinScaleDenominator:function(d,c){c.minScaleDenominator=parseFloat(this.getChildValue(d))},MaxScaleDenominator:function(d,c){c.maxScaleDenominator=parseFloat(this.getChildValue(d))},TextSymbolizer:function(e,d){var f={};this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Text(f))):d.symbolizer.Text=OpenLayers.Util.applyDefaults(f,d.symbolizer.Text)},LabelPlacement:function(d,c){this.readChildNodes(d,c)},PointPlacement:function(h,g){var m={};this.readChildNodes(h,m);m.labelRotation=m.rotation;delete m.rotation;var l,k=g.labelAnchorPointX,j=g.labelAnchorPointY;k<=1/3?l="l":k>1/3&&k<2/3?l="c":k>=2/3&&(l="r");j<=1/3?l+="b":j>1/3&&j<2/3?l+="m":j>=2/3&&(l+="t");m.labelAlign=l;OpenLayers.Util.applyDefaults(g,m)},AnchorPoint:function(d,c){this.readChildNodes(d,c)},AnchorPointX:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelAnchorPointX=f)},AnchorPointY:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelAnchorPointY=f)},Displacement:function(d,c){this.readChildNodes(d,c)},DisplacementX:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelXOffset=f)},DisplacementY:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelYOffset=f)},LinePlacement:function(d,c){this.readChildNodes(d,c)},PerpendicularOffset:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelPerpendicularOffset=f)},Label:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.label=f)},Font:function(d,c){this.readChildNodes(d,c)},Halo:function(e,d){var f={};this.readChildNodes(e,f);d.haloRadius=f.haloRadius;d.haloColor=f.fillColor;d.haloOpacity=f.fillOpacity},Radius:function(e,d){var f=this.readers.ogc._expression.call(this,e);null!=f&&(d.haloRadius=f)},RasterSymbolizer:function(e,d){var f={};this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Raster(f))):d.symbolizer.Raster=OpenLayers.Util.applyDefaults(f,d.symbolizer.Raster)},Geometry:function(d,c){c.geometry={};this.readChildNodes(d,c.geometry)},ColorMap:function(d,c){c.colorMap=[];this.readChildNodes(d,c.colorMap)},ColorMapEntry:function(f,e){var h=f.getAttribute("quantity"),g=f.getAttribute("opacity");e.push({color:f.getAttribute("color"),quantity:null!==h?parseFloat(h):void 0,label:f.getAttribute("label")||void 0,opacity:null!==g?parseFloat(g):void 0})},LineSymbolizer:function(e,d){var f={};this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Line(f))):d.symbolizer.Line=OpenLayers.Util.applyDefaults(f,d.symbolizer.Line)},PolygonSymbolizer:function(e,d){var f={fill:!1,stroke:!1};this.multipleSymbolizers||(f=d.symbolizer.Polygon||f);this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Polygon(f))):d.symbolizer.Polygon=f},PointSymbolizer:function(e,d){var f={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(f=d.symbolizer.Point||f);this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Point(f))):d.symbolizer.Point=f},Stroke:function(d,c){c.stroke=!0;this.readChildNodes(d,c)},Fill:function(d,c){c.fill=!0;this.readChildNodes(d,c)},CssParameter:function(f,e){var h=f.getAttribute("name"),g=this.cssMap[h];e.label&&("fill"===h?g="fontColor":"fill-opacity"===h&&(g="fontOpacity"));g&&(h=this.readers.ogc._expression.call(this,f))&&(e[g]=h)},Graphic:function(k,j){j.graphic=!0;var r={};this.readChildNodes(k,r);for(var q="stroke strokeColor strokeWidth strokeOpacity strokeLinecap fill fillColor fillOpacity graphicName rotation graphicFormat".split(" "),p,o,m=0,l=q.length;m<l;++m){p=q[m],o=r[p],void 0!=o&&(j[p]=o)}void 0!=r.opacity&&(j.graphicOpacity=r.opacity);void 0!=r.size&&(isNaN(r.size/2)?j.graphicWidth=r.size:j.pointRadius=r.size/2);void 0!=r.href&&(j.externalGraphic=r.href);void 0!=r.rotation&&(j.rotation=r.rotation)},ExternalGraphic:function(d,c){this.readChildNodes(d,c)},Mark:function(d,c){this.readChildNodes(d,c)},WellKnownName:function(d,c){c.graphicName=this.getChildValue(d)},Opacity:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.opacity=f)},Size:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.size=f)},Rotation:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.rotation=f)},OnlineResource:function(d,c){c.href=this.getAttributeNS(d,this.namespaces.xlink,"href")},Format:function(d,c){c.graphicFormat=this.getChildValue(d)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(e){var d=null,f;for(f in this.cssMap){if(this.cssMap[f]==e){d=f;break}}return d},getGraphicFormat:function(e){var d,f;for(f in this.graphicFormats){if(this.graphicFormats[f].test(e)){d=f;break}}return d||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(b){return this.writers.sld.StyledLayerDescriptor.apply(this,[b])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(k,j){var r=this.createElementNSPlus(k),q="string"==typeof j?j.split("${"):[j];r.appendChild(this.createTextNode(q[0]));for(var p,o,m=1,l=q.length;m<l;m++){p=q[m],o=p.indexOf("}"),0<o?(this.writeNode("ogc:PropertyName",{property:p.substring(0,o)},r),r.appendChild(this.createTextNode(p.substring(++o)))):r.appendChild(this.createTextNode("${"+p))}return r},StyledLayerDescriptor:function(f){var e=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});e.setAttribute("xmlns:ogc",this.namespaces.ogc);e.setAttribute("xmlns:gml",this.namespaces.gml);f.name&&this.writeNode("Name",f.name,e);f.title&&this.writeNode("Title",f.title,e);f.description&&this.writeNode("Abstract",f.description,e);if(OpenLayers.Util.isArray(f.namedLayers)){for(var h=0,g=f.namedLayers.length;h<g;++h){this.writeNode("NamedLayer",f.namedLayers[h],e)}}else{for(h in f.namedLayers){this.writeNode("NamedLayer",f.namedLayers[h],e)}}return e},Name:function(b){return this.createElementNSPlus("sld:Name",{value:b})},Title:function(b){return this.createElementNSPlus("sld:Title",{value:b})},Abstract:function(b){return this.createElementNSPlus("sld:Abstract",{value:b})},NamedLayer:function(f){var e=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",f.name,e);if(f.namedStyles){for(var h=0,g=f.namedStyles.length;h<g;++h){this.writeNode("NamedStyle",f.namedStyles[h],e)}}if(f.userStyles){h=0;for(g=f.userStyles.length;h<g;++h){this.writeNode("UserStyle",f.userStyles[h],e)}}return e},NamedStyle:function(d){var c=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",d,c);return c},UserStyle:function(A){var z=this.createElementNSPlus("sld:UserStyle");A.name&&this.writeNode("Name",A.name,z);A.title&&this.writeNode("Title",A.title,z);A.description&&this.writeNode("Abstract",A.description,z);A.isDefault&&this.writeNode("IsDefault",A.isDefault,z);if(this.multipleSymbolizers&&A.rules){for(var y={"0":[]},x=[0],w,v,u,t,s,r=0,q=A.rules.length;r<q;++r){if(w=A.rules[r],w.symbolizers){v={};for(var p=0,o=w.symbolizers.length;p<o;++p){u=w.symbolizers[p],t=u.zIndex,t in v||(s=w.clone(),s.symbolizers=[],v[t]=s),v[t].symbolizers.push(u.clone())}for(t in v){t in y||(x.push(t),y[t]=[]),y[t].push(v[t])}}else{y[0].push(w.clone())}}x.sort();r=0;for(q=x.length;r<q;++r){w=y[x[r]],0<w.length&&(s=A.clone(),s.rules=y[x[r]],this.writeNode("FeatureTypeStyle",s,z))}}else{this.writeNode("FeatureTypeStyle",A,z)}return z},IsDefault:function(b){return this.createElementNSPlus("sld:IsDefault",{value:b?"1":"0"})},FeatureTypeStyle:function(f){for(var e=this.createElementNSPlus("sld:FeatureTypeStyle"),h=0,g=f.rules.length;h<g;++h){this.writeNode("Rule",f.rules[h],e)}return e},Rule:function(j){var h=this.createElementNSPlus("sld:Rule");j.name&&this.writeNode("Name",j.name,h);j.title&&this.writeNode("Title",j.title,h);j.description&&this.writeNode("Abstract",j.description,h);j.elseFilter?this.writeNode("ElseFilter",null,h):j.filter&&this.writeNode("ogc:Filter",j.filter,h);void 0!=j.minScaleDenominator&&this.writeNode("MinScaleDenominator",j.minScaleDenominator,h);void 0!=j.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",j.maxScaleDenominator,h);var p,o;if(this.multipleSymbolizers&&j.symbolizers){for(var m=0,l=j.symbolizers.length;m<l;++m){o=j.symbolizers[m],p=o.CLASS_NAME.split(".").pop(),this.writeNode(p+"Symbolizer",o,h)}}else{for(var l=OpenLayers.Style.SYMBOLIZER_PREFIXES,m=0,k=l.length;m<k;++m){p=l[m],(o=j.symbolizer[p])&&this.writeNode(p+"Symbolizer",o,h)}}return h},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(b){return this.createElementNSPlus("sld:MinScaleDenominator",{value:b})},MaxScaleDenominator:function(b){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:b})},LineSymbolizer:function(d){var c=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",d,c);return c},Stroke:function(d){var c=this.createElementNSPlus("sld:Stroke");void 0!=d.strokeColor&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeColor"},c);void 0!=d.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeOpacity"},c);void 0!=d.strokeWidth&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeWidth"},c);void 0!=d.strokeDashstyle&&"solid"!==d.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeDashstyle"},c);void 0!=d.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeLinecap"},c);return c},CssParameter:function(b){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(b.key)},value:b.symbolizer[b.key]})},TextSymbolizer:function(d){var c=this.createElementNSPlus("sld:TextSymbolizer");null!=d.label&&this.writeNode("Label",d.label,c);(null!=d.fontFamily||null!=d.fontSize||null!=d.fontWeight||null!=d.fontStyle)&&this.writeNode("Font",d,c);(null!=d.labelAnchorPointX||null!=d.labelAnchorPointY||null!=d.labelAlign||null!=d.labelXOffset||null!=d.labelYOffset||null!=d.labelRotation||null!=d.labelPerpendicularOffset)&&this.writeNode("LabelPlacement",d,c);(null!=d.haloRadius||null!=d.haloColor||null!=d.haloOpacity)&&this.writeNode("Halo",d,c);(null!=d.fontColor||null!=d.fontOpacity)&&this.writeNode("Fill",{fillColor:d.fontColor,fillOpacity:d.fontOpacity},c);return c},LabelPlacement:function(d){var c=this.createElementNSPlus("sld:LabelPlacement");(null!=d.labelAnchorPointX||null!=d.labelAnchorPointY||null!=d.labelAlign||null!=d.labelXOffset||null!=d.labelYOffset||null!=d.labelRotation)&&null==d.labelPerpendicularOffset&&this.writeNode("PointPlacement",d,c);null!=d.labelPerpendicularOffset&&this.writeNode("LinePlacement",d,c);return c},LinePlacement:function(d){var c=this.createElementNSPlus("sld:LinePlacement");this.writeNode("PerpendicularOffset",d.labelPerpendicularOffset,c);return c},PerpendicularOffset:function(b){return this.createElementNSPlus("sld:PerpendicularOffset",{value:b})},PointPlacement:function(d){var c=this.createElementNSPlus("sld:PointPlacement");(null!=d.labelAnchorPointX||null!=d.labelAnchorPointY||null!=d.labelAlign)&&this.writeNode("AnchorPoint",d,c);(null!=d.labelXOffset||null!=d.labelYOffset)&&this.writeNode("Displacement",d,c);null!=d.labelRotation&&this.writeNode("Rotation",d.labelRotation,c);return c},AnchorPoint:function(g){var f=this.createElementNSPlus("sld:AnchorPoint"),k=g.labelAnchorPointX,j=g.labelAnchorPointY;null!=k&&this.writeNode("AnchorPointX",k,f);null!=j&&this.writeNode("AnchorPointY",j,f);if(null==k&&null==j){var h=g.labelAlign.substr(0,1),g=g.labelAlign.substr(1,1);"l"===h?k=0:"c"===h?k=0.5:"r"===h&&(k=1);"b"===g?j=0:"m"===g?j=0.5:"t"===g&&(j=1);this.writeNode("AnchorPointX",k,f);this.writeNode("AnchorPointY",j,f)}return f},AnchorPointX:function(b){return this.createElementNSPlus("sld:AnchorPointX",{value:b})},AnchorPointY:function(b){return this.createElementNSPlus("sld:AnchorPointY",{value:b})},Displacement:function(d){var c=this.createElementNSPlus("sld:Displacement");null!=d.labelXOffset&&this.writeNode("DisplacementX",d.labelXOffset,c);null!=d.labelYOffset&&this.writeNode("DisplacementY",d.labelYOffset,c);return c},DisplacementX:function(b){return this.createElementNSPlus("sld:DisplacementX",{value:b})},DisplacementY:function(b){return this.createElementNSPlus("sld:DisplacementY",{value:b})},Font:function(d){var c=this.createElementNSPlus("sld:Font");d.fontFamily&&this.writeNode("CssParameter",{symbolizer:d,key:"fontFamily"},c);d.fontSize&&this.writeNode("CssParameter",{symbolizer:d,key:"fontSize"},c);d.fontWeight&&this.writeNode("CssParameter",{symbolizer:d,key:"fontWeight"},c);d.fontStyle&&this.writeNode("CssParameter",{symbolizer:d,key:"fontStyle"},c);return c},Label:function(b){return this.writers.sld._OGCExpression.call(this,"sld:Label",b)},Halo:function(d){var c=this.createElementNSPlus("sld:Halo");d.haloRadius&&this.writeNode("Radius",d.haloRadius,c);(d.haloColor||d.haloOpacity)&&this.writeNode("Fill",{fillColor:d.haloColor,fillOpacity:d.haloOpacity},c);return c},Radius:function(b){return this.createElementNSPlus("sld:Radius",{value:b})},RasterSymbolizer:function(d){var c=this.createElementNSPlus("sld:RasterSymbolizer");d.geometry&&this.writeNode("Geometry",d.geometry,c);d.opacity&&this.writeNode("Opacity",d.opacity,c);d.colorMap&&this.writeNode("ColorMap",d.colorMap,c);return c},Geometry:function(d){var c=this.createElementNSPlus("sld:Geometry");d.property&&this.writeNode("ogc:PropertyName",d,c);return c},ColorMap:function(f){for(var e=this.createElementNSPlus("sld:ColorMap"),h=0,g=f.length;h<g;++h){this.writeNode("ColorMapEntry",f[h],e)}return e},ColorMapEntry:function(d){var c=this.createElementNSPlus("sld:ColorMapEntry");c.setAttribute("color",d.color);void 0!==d.opacity&&c.setAttribute("opacity",parseFloat(d.opacity));void 0!==d.quantity&&c.setAttribute("quantity",parseFloat(d.quantity));void 0!==d.label&&c.setAttribute("label",d.label);return c},PolygonSymbolizer:function(d){var c=this.createElementNSPlus("sld:PolygonSymbolizer");!1!==d.fill&&this.writeNode("Fill",d,c);!1!==d.stroke&&this.writeNode("Stroke",d,c);return c},Fill:function(d){var c=this.createElementNSPlus("sld:Fill");d.fillColor&&this.writeNode("CssParameter",{symbolizer:d,key:"fillColor"},c);null!=d.fillOpacity&&this.writeNode("CssParameter",{symbolizer:d,key:"fillOpacity"},c);return c},PointSymbolizer:function(d){var c=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",d,c);return c},Graphic:function(d){var c=this.createElementNSPlus("sld:Graphic");void 0!=d.externalGraphic?this.writeNode("ExternalGraphic",d,c):this.writeNode("Mark",d,c);void 0!=d.graphicOpacity&&this.writeNode("Opacity",d.graphicOpacity,c);void 0!=d.pointRadius?this.writeNode("Size",2*d.pointRadius,c):void 0!=d.graphicWidth&&this.writeNode("Size",d.graphicWidth,c);void 0!=d.rotation&&this.writeNode("Rotation",d.rotation,c);return c},ExternalGraphic:function(d){var c=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",d.externalGraphic,c);this.writeNode("Format",d.graphicFormat||this.getGraphicFormat(d.externalGraphic),c);return c},Mark:function(d){var c=this.createElementNSPlus("sld:Mark");d.graphicName&&this.writeNode("WellKnownName",d.graphicName,c);!1!==d.fill&&this.writeNode("Fill",d,c);!1!==d.stroke&&this.writeNode("Stroke",d,c);return c},WellKnownName:function(b){return this.createElementNSPlus("sld:WellKnownName",{value:b})},Opacity:function(b){return this.createElementNSPlus("sld:Opacity",{value:b})},Size:function(b){return this.writers.sld._OGCExpression.call(this,"sld:Size",b)},Rotation:function(b){return this.createElementNSPlus("sld:Rotation",{value:b})},OnlineResource:function(b){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":b}})},Format:function(b){return this.createElementNSPlus("sld:Format",{value:b})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(g,f,k,j){var h=[],k=OpenLayers.Util.upperCaseObject(k);1.3<=parseFloat(k.VERSION)&&!k.EXCEPTIONS&&(k.EXCEPTIONS="INIMAGE");h.push(g,f,k,j);OpenLayers.Layer.Grid.prototype.initialize.apply(this,h);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()){if(null==j||!j.isBaseLayer){this.isBaseLayer=!1}"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png")}},clone:function(b){null==b&&(b=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},reverseAxisOrder:function(){var b=this.projection.getCode();return 1.3<=parseFloat(this.params.VERSION)&&!(!this.yx[b]&&!OpenLayers.Projection.defaults[b].yx)},getURL:function(f){var f=this.adjustBounds(f),e=this.getImageSize(),h={},g=this.reverseAxisOrder();h.BBOX=this.encodeBBOX?f.toBBOX(null,g):f.toArray(g);h.WIDTH=e.w;h.HEIGHT=e.h;return this.getFullRequestString(h)},mergeNewParams:function(b){b=[OpenLayers.Util.upperCaseObject(b)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,b)},getFullRequestString:function(e,d){var f=this.map.getProjectionObject(),f=this.projection&&this.projection.equals(f)?this.projection.getCode():f.getCode(),f="none"==f?null:f;1.3<=parseFloat(this.params.VERSION)?this.params.CRS=f:this.params.SRS=f;"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(b){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[b])},read_sld_MinScaleDenominator:function(e,d){var f=parseFloat(this.getChildValue(d));0<f&&(e.maxScale=f)},read_sld_MaxScaleDenominator:function(d,c){d.minScale=parseFloat(this.getChildValue(c))},read_wmc_SRS:function(d,c){"srs" in d||(d.srs={});d.srs[this.getChildValue(c)]=!0},write_wmc_Layer:function(f){var e=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[f]);if(f.maxScale){var h=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");h.appendChild(this.createTextNode(f.maxScale.toPrecision(16)));e.appendChild(h)}f.minScale&&(h=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator"),h.appendChild(this.createTextNode(f.minScale.toPrecision(16))),e.appendChild(h));if(f.srs){for(var g in f.srs){e.appendChild(this.createElementDefaultNS("SRS",g))}}e.appendChild(this.write_wmc_FormatList(f));e.appendChild(this.write_wmc_StyleList(f));f.dimensions&&e.appendChild(this.write_wmc_DimensionList(f));e.appendChild(this.write_wmc_LayerExtension(f));return e},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"});OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(e,d){OpenLayers.Util.applyDefaults(d,this.options);var f={};this.readChildNodes(e,f);return f},readers:{xls:{XLS:function(d,c){c.version=d.getAttribute("version");this.readChildNodes(d,c)},Response:function(d,c){this.readChildNodes(d,c)},GeocodeResponse:function(d,c){c.responseLists=[];this.readChildNodes(d,c)},GeocodeResponseList:function(e,d){var f={features:[],numberOfGeocodedAddresses:parseInt(e.getAttribute("numberOfGeocodedAddresses"))};d.responseLists.push(f);this.readChildNodes(e,f)},GeocodedAddress:function(e,d){var f=new OpenLayers.Feature.Vector;d.features.push(f);this.readChildNodes(e,f);f.geometry=f.components[0]},GeocodeMatchCode:function(d,c){c.attributes.matchCode={accuracy:parseFloat(d.getAttribute("accuracy")),matchType:d.getAttribute("matchType")}},Address:function(e,d){var f={countryCode:e.getAttribute("countryCode"),addressee:e.getAttribute("addressee"),street:[],place:[]};d.attributes.address=f;this.readChildNodes(e,f)},freeFormAddress:function(d,c){c.freeFormAddress=this.getChildValue(d)},StreetAddress:function(d,c){this.readChildNodes(d,c)},Building:function(d,c){c.building={number:d.getAttribute("number"),subdivision:d.getAttribute("subdivision"),buildingName:d.getAttribute("buildingName")}},Street:function(d,c){c.street.push(this.getChildValue(d))},Place:function(d,c){c.place[d.getAttribute("type")]=this.getChildValue(d)},PostalCode:function(d,c){c.postalCode=this.getChildValue(d)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(b){return this.writers.xls.XLS.apply(this,[b])},writers:{xls:{XLS:function(d){var c=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});this.writeNode("RequestHeader",d.header,c);this.writeNode("Request",d,c);return c},RequestHeader:function(){return this.createElementNSPlus("xls:RequestHeader")},Request:function(d){var c=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:d.requestID||"",version:this.VERSION}});this.writeNode("GeocodeRequest",d.addresses,c);return c},GeocodeRequest:function(f){for(var e=this.createElementNSPlus("xls:GeocodeRequest"),h=0,g=f.length;h<g;h++){this.writeNode("Address",f[h],e)}return e},Address:function(d){var c=this.createElementNSPlus("xls:Address",{attributes:{countryCode:d.countryCode}});d.freeFormAddress?this.writeNode("freeFormAddress",d.freeFormAddress,c):(d.street&&this.writeNode("StreetAddress",d,c),d.municipality&&this.writeNode("Municipality",d.municipality,c),d.countrySubdivision&&this.writeNode("CountrySubdivision",d.countrySubdivision,c),d.postalCode&&this.writeNode("PostalCode",d.postalCode,c));return c},freeFormAddress:function(b){return this.createElementNSPlus("freeFormAddress",{value:b})},StreetAddress:function(f){var e=this.createElementNSPlus("xls:StreetAddress");f.building&&this.writeNode(e,"Building",f.building);f=f.street;OpenLayers.Util.isArray(f)||(f=[f]);for(var h=0,g=f.length;h<g;h++){this.writeNode("Street",f[h],e)}return e},Building:function(b){return this.createElementNSPlus("xls:Building",{attributes:{number:b.number,subdivision:b.subdivision,buildingName:b.buildingName}})},Street:function(b){return this.createElementNSPlus("xls:Street",{value:b})},Municipality:function(b){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:b})},CountrySubdivision:function(b){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:b})},PostalCode:function(b){return this.createElementNSPlus("xls:PostalCode",{value:b})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"});OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"});OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0;OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(b){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(e,d,f){e+=f?0:this.translationParameters.x;d+=f?0:this.translationParameters.y;return e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL&&d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL},setExtent:function(g,f){var k=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),j=this.getResolution(),h=-g.left/j,j=g.top/j;if(f){return this.left=h,this.top=j,this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0}(h=this.translate(h-this.left+this.xOffset,j-this.top))||this.setExtent(g,!0);return k&&h},translate:function(e,d){if(this.inValidRange(e,d,!0)){var f="";if(e||d){f="translate("+e+","+d+")"}this.root.setAttributeNS(null,"transform",f);this.translationParameters={x:e,y:d};return !0}return !1},setSize:function(b){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,d){var f=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":f=d.externalGraphic?"image":this.isComplexSymbol(d.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":f="rect";break;case"OpenLayers.Geometry.LineString":f="polyline";break;case"OpenLayers.Geometry.LinearRing":f="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":f="path"}return f},setStyle:function(u,t,s){var t=t||u._style,s=s||u._options,r=parseFloat(u.getAttributeNS(null,"r")),q=1,p;if("OpenLayers.Geometry.Point"==u._geometryClass&&r){u.style.visibility="";if(!1===t.graphic){u.style.visibility="hidden"}else{if(t.externalGraphic){p=this.getPosition(u);t.graphicTitle&&(u.setAttributeNS(null,"title",t.graphicTitle),r=u.getElementsByTagName("title"),0<r.length?r[0].firstChild.textContent=t.graphicTitle:(r=this.nodeFactory(null,"title"),r.textContent=t.graphicTitle,u.appendChild(r)));t.graphicWidth&&t.graphicHeight&&u.setAttributeNS(null,"preserveAspectRatio","none");var r=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth,r=r?r:2*t.pointRadius,o=o?o:2*t.pointRadius,m=void 0!=t.graphicYOffset?t.graphicYOffset:-(0.5*o),l=t.graphicOpacity||t.fillOpacity;u.setAttributeNS(null,"x",(p.x+(void 0!=t.graphicXOffset?t.graphicXOffset:-(0.5*r))).toFixed());u.setAttributeNS(null,"y",(p.y+m).toFixed());u.setAttributeNS(null,"width",r);u.setAttributeNS(null,"height",o);u.setAttributeNS(this.xlinkns,"href",t.externalGraphic);u.setAttributeNS(null,"style","opacity: "+l);u.onclick=OpenLayers.Renderer.SVG.preventDefault}else{if(this.isComplexSymbol(t.graphicName)){var r=3*t.pointRadius,o=2*r,k=this.importSymbol(t.graphicName);p=this.getPosition(u);q=3*this.symbolMetrics[k.id][0]/o;m=u.parentNode;l=u.nextSibling;m&&m.removeChild(u);u.firstChild&&u.removeChild(u.firstChild);u.appendChild(k.firstChild.cloneNode(!0));u.setAttributeNS(null,"viewBox",k.getAttributeNS(null,"viewBox"));u.setAttributeNS(null,"width",o);u.setAttributeNS(null,"height",o);u.setAttributeNS(null,"x",p.x-r);u.setAttributeNS(null,"y",p.y-r);l?m.insertBefore(u,l):m&&m.appendChild(u)}else{u.setAttributeNS(null,"r",t.pointRadius)}}}r=t.rotation;if((void 0!==r||void 0!==u._rotation)&&p){u._rotation=r,r|=0,"svg"!==u.nodeName?u.setAttributeNS(null,"transform","rotate("+r+" "+p.x+" "+p.y+")"):(p=this.symbolMetrics[k.id],u.firstChild.setAttributeNS(null,"transform","rotate("+r+" "+p[1]+" "+p[2]+")"))}}s.isFilled?(u.setAttributeNS(null,"fill",t.fillColor),u.setAttributeNS(null,"fill-opacity",t.fillOpacity)):u.setAttributeNS(null,"fill","none");s.isStroked?(u.setAttributeNS(null,"stroke",t.strokeColor),u.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),u.setAttributeNS(null,"stroke-width",t.strokeWidth*q),u.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),u.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&u.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,q))):u.setAttributeNS(null,"stroke","none");t.pointerEvents&&u.setAttributeNS(null,"pointer-events",t.pointerEvents);null!=t.cursor&&u.setAttributeNS(null,"cursor",t.cursor);return u},dashStyle:function(f,e){var h=f.strokeWidth*e,g=f.strokeDashstyle;switch(g){case"solid":return"none";case"dot":return[1,4*h].join();case"dash":return[4*h,4*h].join();case"dashdot":return[4*h,4*h,1,4*h].join();case"longdash":return[8*h,4*h].join();case"longdashdot":return[8*h,4*h,1,4*h].join();default:return OpenLayers.String.trim(g).replace(/\s+/g,",")}},createNode:function(e,d){var f=document.createElementNS(this.xmlns,e);d&&f.setAttributeNS(null,"id",d);return f},nodeTypeCompare:function(d,c){return c==d.nodeName},createRenderRoot:function(){var b=this.nodeFactory(this.container.id+"_svgRoot","svg");b.style.display="block";return b},createRoot:function(b){return this.nodeFactory(this.container.id+b,"g")},createDefs:function(){var b=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(b);return b},drawPoint:function(d,c){return this.drawCircle(d,c,1)},drawCircle:function(g,f,k){var j=this.getResolution(),h=(f.x-this.featureDx)/j+this.left,f=this.top-f.y/j;return this.inValidRange(h,f)?(g.setAttributeNS(null,"cx",h),g.setAttributeNS(null,"cy",f),g.setAttributeNS(null,"r",k),g):!1},drawLineString:function(e,d){var f=this.getComponentsString(d.components);return f.path?(e.setAttributeNS(null,"points",f.path),f.complete?e:null):!1},drawLinearRing:function(e,d){var f=this.getComponentsString(d.components);return f.path?(e.setAttributeNS(null,"points",f.path),f.complete?e:null):!1},drawPolygon:function(s,r){for(var q="",p=!0,o=!0,m,l,k=0,j=r.components.length;k<j;k++){q+=" M",m=this.getComponentsString(r.components[k].components," "),(l=m.path)?(q+=" "+l,o=m.complete&&o):p=!1}return p?(s.setAttributeNS(null,"d",q+" z"),s.setAttributeNS(null,"fill-rule","evenodd"),o?s:null):!1},drawRectangle:function(g,f){var k=this.getResolution(),j=(f.x-this.featureDx)/k+this.left,h=this.top-f.y/k;return this.inValidRange(j,h)?(g.setAttributeNS(null,"x",j),g.setAttributeNS(null,"y",h),g.setAttributeNS(null,"width",f.width/k),g.setAttributeNS(null,"height",f.height/k),g):!1},drawText:function(y,x,w){var v=!!x.labelOutlineWidth;if(v){var u=OpenLayers.Util.extend({},x);u.fontColor=u.labelOutlineColor;u.fontStrokeColor=u.labelOutlineColor;u.fontStrokeWidth=x.labelOutlineWidth;delete u.labelOutlineWidth;this.drawText(y,u,w)}var t=this.getResolution(),u=(w.x-this.featureDx)/t+this.left,s=w.y/t-this.top,v=v?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,t=this.nodeFactory(y+v,"text");t.setAttributeNS(null,"x",u);t.setAttributeNS(null,"y",-s);x.fontColor&&t.setAttributeNS(null,"fill",x.fontColor);x.fontStrokeColor&&t.setAttributeNS(null,"stroke",x.fontStrokeColor);x.fontStrokeWidth&&t.setAttributeNS(null,"stroke-width",x.fontStrokeWidth);x.fontOpacity&&t.setAttributeNS(null,"opacity",x.fontOpacity);x.fontFamily&&t.setAttributeNS(null,"font-family",x.fontFamily);x.fontSize&&t.setAttributeNS(null,"font-size",x.fontSize);x.fontWeight&&t.setAttributeNS(null,"font-weight",x.fontWeight);x.fontStyle&&t.setAttributeNS(null,"font-style",x.fontStyle);!0===x.labelSelect?(t.setAttributeNS(null,"pointer-events","visible"),t._featureId=y):t.setAttributeNS(null,"pointer-events","none");s=x.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;t.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[s[0]]||"middle");!0===OpenLayers.IS_GECKO&&t.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[s[1]]||"central");for(var r=x.label.split("\n"),q=r.length;t.childNodes.length>q;){t.removeChild(t.lastChild)}for(var p=0;p<q;p++){var o=this.nodeFactory(y+v+"_tspan_"+p,"tspan");!0===x.labelSelect&&(o._featureId=y,o._geometry=w,o._geometryClass=w.CLASS_NAME);!1===OpenLayers.IS_GECKO&&o.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[s[1]]||"-35%");o.setAttribute("x",u);if(0==p){var m=OpenLayers.Renderer.SVG.LABEL_VFACTOR[s[1]];null==m&&(m=-0.5);o.setAttribute("dy",m*(q-1)+"em")}else{o.setAttribute("dy","1em")}o.textContent=""===r[p]?" ":r[p];o.parentNode||t.appendChild(o)}t.parentNode||this.textRoot.appendChild(t)},getComponentsString:function(k,j){for(var r=[],q=!0,p=k.length,o=[],m,l=0;l<p;l++){m=k[l],r.push(m),(m=this.getShortString(m))?o.push(m):(0<l&&this.getShortString(k[l-1])&&o.push(this.clipLine(k[l],k[l-1])),l<p-1&&this.getShortString(k[l+1])&&o.push(this.clipLine(k[l],k[l+1])),q=!1)}return{path:o.join(j||","),complete:q}},clipLine:function(s,r){if(r.equals(s)){return""}var q=this.getResolution(),p=this.MAX_PIXEL-this.translationParameters.x,o=this.MAX_PIXEL-this.translationParameters.y,m=(r.x-this.featureDx)/q+this.left,l=this.top-r.y/q,k=(s.x-this.featureDx)/q+this.left,q=this.top-s.y/q,j;if(k<-p||k>p){j=(q-l)/(k-m),k=0>k?-p:p,q=l+(k-m)*j}if(q<-o||q>o){j=(k-m)/(q-l),q=0>q?-o:o,k=m+(q-l)*j}return k+","+q},getShortString:function(e){var d=this.getResolution(),f=(e.x-this.featureDx)/d+this.left,e=this.top-e.y/d;return this.inValidRange(f,e)?f+","+e:!1},getPosition:function(b){return{x:parseFloat(b.getAttributeNS(null,"cx")),y:parseFloat(b.getAttributeNS(null,"cy"))}},importSymbol:function(s){this.defs||(this.defs=this.createDefs());var r=this.container.id+"-"+s,q=document.getElementById(r);if(null!=q){return q}var p=OpenLayers.Renderer.symbol[s];if(!p){throw Error(s+" is not a valid symbol name")}var s=this.nodeFactory(r,"symbol"),o=this.nodeFactory(null,"polygon");s.appendChild(o);for(var q=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),m=[],l,k,j=0;j<p.length;j+=2){l=p[j],k=p[j+1],q.left=Math.min(q.left,l),q.bottom=Math.min(q.bottom,k),q.right=Math.max(q.right,l),q.top=Math.max(q.top,k),m.push(l,",",k)}o.setAttributeNS(null,"points",m.join(" "));p=q.getWidth();o=q.getHeight();s.setAttributeNS(null,"viewBox",[q.left-p,q.bottom-o,3*p,3*o].join(" "));this.symbolMetrics[r]=[Math.max(p,o),q.getCenterLonLat().lon,q.getCenterLonLat().lat];this.defs.appendChild(s);return s},getFeatureIdFromEvent:function(d){var c=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);c||(c=d.target,c=c.parentNode&&c!=this.rendererRoot?c.parentNode._featureId:void 0);return c},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(b){b.preventDefault&&b.preventDefault()};OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(e,d){var f=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);"0.3.0"===f&&(f=this.defaultVersion);return f},toContext:function(d){var c={};"OpenLayers.Map"==d.CLASS_NAME&&(c.bounds=d.getExtent(),c.maxExtent=d.maxExtent,c.projection=d.projection,c.size=d.getSize(),c.layers=d.layers);return c},CLASS_NAME:"OpenLayers.Format.OWSContext"});OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(h){if(h.layersContext){for(var g=0,m=h.layersContext.length;g<m;g++){var l=h.layersContext[g],k=[],j=h.title||"";h.metadata&&h.metadata.nestingPath&&(k=h.metadata.nestingPath.slice());""!=j&&k.push(j);l.metadata.nestingPath=k;l.layersContext&&this.setNestingPath(l)}}},decomposeNestingPath:function(d){var c=[];if(OpenLayers.Util.isArray(d)){for(d=d.slice();0<d.length;){c.push(d.slice()),d.pop()}c.reverse()}return c},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);this.setNestingPath({layersContext:c.layersContext});d=[];this.processLayer(d,c);delete c.layersContext;c.layersContext=d;return c},processLayer:function(g,f){if(f.layersContext){for(var k=0,j=f.layersContext.length;k<j;k++){var h=f.layersContext[k];g.push(h);h.layersContext&&this.processLayer(g,h)}}},write:function(e,d){this.nestingLayerLookup={};d=d||{};OpenLayers.Util.applyDefaults(d,e);var f=this.writeNode("OWSContext",d);this.nestingLayerLookup=null;this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[f])},readers:{kml:{Document:function(d,c){c.features=(new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0})).read(d)}},owc:{OWSContext:function(d,c){this.readChildNodes(d,c)},General:function(d,c){this.readChildNodes(d,c)},ResourceList:function(d,c){this.readChildNodes(d,c)},Layer:function(e,d){var f={metadata:{},visibility:"1"!=e.getAttribute("hidden"),queryable:"1"==e.getAttribute("queryable"),opacity:null!=e.getAttribute("opacity")?parseFloat(e.getAttribute("opacity")):null,name:e.getAttribute("name"),categoryLayer:null==e.getAttribute("name"),formats:[],styles:[]};d.layersContext||(d.layersContext=[]);d.layersContext.push(f);this.readChildNodes(e,f)},InlineGeometry:function(f,e){e.features=[];var h=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMember"),g;1<=h.length&&(g=h[0]);g&&g.firstChild&&(h=g.firstChild.nextSibling?g.firstChild.nextSibling:g.firstChild,this.setNamespace("feature",h.namespaceURI),this.featureType=h.localName||h.nodeName.split(":").pop(),this.readChildNodes(f,e))},Server:function(d,c){if(!c.service&&!c.version||c.service!=OpenLayers.Format.Context.serviceTypes.WMS){c.service=d.getAttribute("service"),c.version=d.getAttribute("version"),this.readChildNodes(d,c)}},Name:function(d,c){c.name=this.getChildValue(d);this.readChildNodes(d,c)},Title:function(d,c){c.title=this.getChildValue(d);this.readChildNodes(d,c)},StyleList:function(d,c){this.readChildNodes(d,c.styles)},Style:function(e,d){var f={};d.push(f);this.readChildNodes(e,f)},LegendURL:function(e,d){var f={};d.legend=f;this.readChildNodes(e,f)},OnlineResource:function(d,c){c.url=this.getAttributeNS(d,this.namespaces.xlink,"href");this.readChildNodes(d,c)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(d){var c=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:d.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});this.writeNode("General",d,c);this.writeNode("ResourceList",d,c);return c},General:function(d){var c=this.createElementNSPlus("General");this.writeNode("ows:BoundingBox",d,c);this.writeNode("ows:Title",d.title||"OpenLayers OWSContext",c);return c},ResourceList:function(h){for(var g=this.createElementNSPlus("ResourceList"),m=0,l=h.layers.length;m<l;m++){var k=h.layers[m],j=this.decomposeNestingPath(k.metadata.nestingPath);this.writeNode("_Layer",{layer:k,subPaths:j},g)}return g},Server:function(d){var c=this.createElementNSPlus("Server",{attributes:{version:d.version,service:d.service}});this.writeNode("OnlineResource",d,c);return c},OnlineResource:function(b){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":b.url}})},InlineGeometry:function(f){var e=this.createElementNSPlus("InlineGeometry");this.writeNode("gml:boundedBy",f.getDataExtent(),e);for(var h=0,g=f.features.length;h<g;h++){this.writeNode("gml:featureMember",f.features[h],e)}return e},StyleList:function(f){for(var e=this.createElementNSPlus("StyleList"),h=0,g=f.length;h<g;h++){this.writeNode("Style",f[h],e)}return e},Style:function(d){var c=this.createElementNSPlus("Style");this.writeNode("Name",d,c);this.writeNode("Title",d,c);d.legend&&this.writeNode("LegendURL",d,c);return c},Name:function(b){return this.createElementNSPlus("Name",{value:b.name})},Title:function(b){return this.createElementNSPlus("Title",{value:b.title})},LegendURL:function(d){var c=this.createElementNSPlus("LegendURL");this.writeNode("OnlineResource",d.legend,c);return c},_WMS:function(d){var c=this.createElementNSPlus("Layer",{attributes:{name:d.params.LAYERS,queryable:d.queryable?"1":"0",hidden:d.visibility?"0":"1",opacity:d.hasOwnProperty("opacity")?d.opacity:null}});this.writeNode("ows:Title",d.name,c);this.writeNode("ows:OutputFormat",d.params.FORMAT,c);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:d.params.VERSION,url:d.url},c);d.metadata.styles&&0<d.metadata.styles.length&&this.writeNode("StyleList",d.metadata.styles,c);return c},_Layer:function(f){var e,h,g;e=f.layer;h=f.subPaths;g=null;0<h.length?(e=h[0].join("/"),h=e.lastIndexOf("/"),g=this.nestingLayerLookup[e],h=0<h?e.substring(h+1,e.length):e,g||(g=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",h,g),this.nestingLayerLookup[e]=g),f.subPaths.shift(),this.writeNode("_Layer",f,g)):(e instanceof OpenLayers.Layer.WMS?g=this.writeNode("_WMS",e):e instanceof OpenLayers.Layer.Vector&&(e.protocol instanceof OpenLayers.Protocol.WFS.v1?g=this.writeNode("_WFS",e):e.protocol instanceof OpenLayers.Protocol.HTTP?e.protocol.format instanceof OpenLayers.Format.GML?(e.protocol.format.version="2.1.2",g=this.writeNode("_GML",e)):e.protocol.format instanceof OpenLayers.Format.KML&&(e.protocol.format.version="2.2",g=this.writeNode("_KML",e)):(this.setNamespace("feature",this.featureNS),g=this.writeNode("_InlineGeometry",e))),e.options.maxScale&&this.writeNode("sld:MinScaleDenominator",e.options.maxScale,g),e.options.minScale&&this.writeNode("sld:MaxScaleDenominator",e.options.minScale,g),this.nestingLayerLookup[e.name]=g);return g},_WFS:function(d){var c=this.createElementNSPlus("Layer",{attributes:{name:d.protocol.featurePrefix+":"+d.protocol.featureType,hidden:d.visibility?"0":"1"}});this.writeNode("ows:Title",d.name,c);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:d.protocol.version,url:d.protocol.url},c);return c},_InlineGeometry:function(d){var c=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:d.visibility?"0":"1"}});this.writeNode("ows:Title",d.name,c);this.writeNode("InlineGeometry",d,c);return c},_GML:function(d){var c=this.createElementNSPlus("Layer");this.writeNode("ows:Title",d.name,c);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:d.protocol.url,version:d.protocol.format.version},c);return c},_KML:function(d){var c=this.createElementNSPlus("Layer");this.writeNode("ows:Title",d.name,c);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:d.protocol.format.version,url:d.protocol.url},c);return c}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(d){var c=this.createElementNSPlus("gml:boundedBy");this.writeNode("gml:Box",d,c);return c}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible");this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(d){var c=parseInt(Math.log(d)/Math.log(10)),c=Math.pow(10,c),d=parseInt(d/c);return(5<d?5:2<d?2:1)*c},update:function(){var u=this.map.getResolution();if(u){var t=this.map.getUnits(),s=OpenLayers.INCHES_PER_UNIT,r=this.maxWidth*u*s[t],q=1;!0===this.geodesic&&(q=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth/(r/s.km),r*=q);var p,o;100000<r?(p=this.topOutUnits,o=this.bottomOutUnits):(p=this.topInUnits,o=this.bottomInUnits);var m=r/s[p],l=r/s[o],r=this.getBarLen(m),k=this.getBarLen(l),m=r/s[t]*s[p],l=k/s[t]*s[o],t=m/u/q,u=l/u/q;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(u)+"px",this.eBottom.innerHTML=k+" "+o);"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(t)+"px",this.eTop.innerHTML=r+" "+p)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(f,e,h,g){this.url=f;this.size=e||{w:20,h:20};this.offset=h||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=g;f=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(f)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(b){null!=b&&(this.size=b);this.draw()},setUrl:function(b){null!=b&&(this.url=b);this.draw()},draw:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(b);return this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,b)},moveTo:function(b){null!=b&&(this.px=b);null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(b){this.imageDiv.style.display=b?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,d){this.lonlat=e;var f=d?d:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=f:(this.icon.url=f.url,this.icon.size=f.size,this.icon.offset=f.offset,this.icon.calculateOffset=f.calculateOffset);this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(b){return this.icon.draw(b)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(b){null!=b&&null!=this.icon&&this.icon.moveTo(b);this.lonlat=this.map.getLonLatFromLayerPx(b)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var b=!1;this.map&&(b=this.map.getExtent().containsLonLat(this.lonlat));return b},inflate:function(b){this.icon&&this.icon.setSize({w:this.icon.size.w*b,h:this.icon.size.h*b})},setOpacity:function(b){this.icon.setOpacity(b)},setUrl:function(b){this.icon.setUrl(b)},display:function(b){this.icon.display(b)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(f,e,h,g){this.layername=h;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[f,e,{},g]);this.extension=this.format.split("/")[1].toLowerCase();this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(b){null==b&&(b=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(h){function g(f,e){for(var f=""+f,p=[],o=0;o<e;++o){p.push("0")}return p.join("").substring(0,e-f.length)+f}var m=this.getServerResolution(),l=this.maxExtent,k=this.tileSize,j=Math.round((h.left-l.left)/(m*k.w)),h=Math.round((h.bottom-l.bottom)/(m*k.h)),m=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,m):this.map.getZoom(),j=[this.layername,g(m,2),g(parseInt(j/1000000),3),g(parseInt(j/1000)%1000,3),g(parseInt(j)%1000,3),g(parseInt(h/1000000),3),g(parseInt(h/1000)%1000,3),g(parseInt(h)%1000,3)+"."+this.extension].join("/"),m=this.url;OpenLayers.Util.isArray(m)&&(m=this.selectUrl(j,m));m="/"==m.charAt(m.length-1)?m:m+"/";return m+j},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(f,e,h,g){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(f){var f=this.adjustBounds(f),e=this.map.getResolution(),h=Math.round(10000*this.map.getScale())/10000,g=Math.round(f.left/e);return this.getFullRequestString({t:-Math.round(f.top/e),l:g,s:h})},calculateGridLayout:function(h,g,m){var g=m*this.tileSize.w,m=m*this.tileSize.h,l=h.left,k=Math.floor(l/g)-this.buffer,l=-(l/g-k)*this.tileSize.w,k=k*g,h=h.top,j=Math.ceil(h/m)+this.buffer;return{tilelon:g,tilelat:m,tileoffsetlon:k,tileoffsetlat:j*m,tileoffsetx:l,tileoffsety:-(j-h/m+1)*this.tileSize.h}},clone:function(b){null==b&&(b=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions()));b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b]);null!=this.tileSize&&(b.tileSize=this.tileSize.clone());b.grid=[];return b},getTileBounds:function(f){var e=this.getResolution(),h=e*this.tileSize.w,e=e*this.tileSize.h,g=this.getLonLatFromViewPortPx(f),f=h*Math.floor(g.lon/h),g=e*Math.floor(g.lat/e);return new OpenLayers.Bounds(f,g,f+h,g+e)},CLASS_NAME:"OpenLayers.Layer.KaMap"});OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(d,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.layer=d;this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"});this.createBox();this.createControl()},activate:function(){var b=!1;OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),b=!0);return b},setMap:function(b){this.dragControl.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(g,f){var f=OpenLayers.Util.applyDefaults(f,{rotation:0,scale:1,ratio:1}),k=this.rotation,j=this.center;OpenLayers.Util.extend(this,f);if(!1!==this.events.triggerEvent("beforesetfeature",{feature:g})){this.feature=g;this.activate();this._setfeature=!0;var h=this.feature.geometry.getBounds();this.box.move(h.getCenterLonLat());this.box.geometry.rotate(-k,j);this._angle=0;this.rotation?(k=g.geometry.clone(),k.rotate(-this.rotation,this.center),k=new OpenLayers.Feature.Vector(k.getBounds().toGeometry()),k.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(k.geometry.getBounds().getCenterLonLat()),k=k.geometry.components[0].components[0].getBounds().getCenterLonLat()):k=new OpenLayers.LonLat(h.left,h.bottom);this.handles[0].move(k);delete this._setfeature;this.events.triggerEvent("setfeature",{feature:g})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.ratio=this.scale=1)},createBox:function(){var A=this;this.center=new OpenLayers.Geometry.Point(0,0);this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent);this.box.geometry.move=function(a,d){A._moving=!0;OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);A.center.move(a,d);delete A._moving};for(var z=function(d,c){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(d,c);this._handle.geometry.move(d,c)},y=function(e,d,f){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(e,d,f);this._handle.geometry.resize(e,d,f)},x=function(d,c){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(d,c);this._handle.geometry.rotate(d,c)},w=function(J,I){var H=this.x,G=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,J,I);if(!A._moving){var F=A.dragControl.handlers.drag.evt,E=!(!A._setfeature&&A.preserveAspectRatio)&&!(F&&F.shiftKey),D=new OpenLayers.Geometry.Point(H,G),F=A.center;this.rotate(-A.rotation,F);D.rotate(-A.rotation,F);var C=this.x-F.x,B=this.y-F.y,m=C-(this.x-D.x),a=B-(this.y-D.y);A.irregular&&!A._setfeature&&(C-=(this.x-D.x)/2,B-=(this.y-D.y)/2);this.x=H;this.y=G;D=1;E?(B=0.00001>Math.abs(a)?1:B/a,D=(0.00001>Math.abs(m)?1:C/m)/B):(m=Math.sqrt(m*m+a*a),B=Math.sqrt(C*C+B*B)/m);A._moving=!0;A.box.geometry.rotate(-A.rotation,F);delete A._moving;A.box.geometry.resize(B,F,D);A.box.geometry.rotate(A.rotation,F);A.transformFeature({scale:B,ratio:D});A.irregular&&!A._setfeature&&(C=F.clone(),C.x+=0.00001>Math.abs(H-F.x)?0:this.x-H,C.y+=0.00001>Math.abs(G-F.y)?0:this.y-G,A.box.geometry.move(this.x-H,this.y-G),A.transformFeature({center:C}))}},v=function(a,D){var C=this.x,B=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,a,D);if(!A._moving){var m=A.dragControl.handlers.drag.evt,m=m&&m.shiftKey?45:1,l=A.center,k=this.x-l.x,j=this.y-l.y;this.x=C;this.y=B;C=Math.atan2(j-D,k-a);C=Math.atan2(j,k)-C;C*=180/Math.PI;A._angle=(A._angle+C)%360;C=A.rotation%m;if(Math.abs(A._angle)>=m||0!==C){C=Math.round(A._angle/m)*m-C,A._angle=0,A.box.geometry.rotate(C,l),A.transformFeature({rotation:C})}}},u=Array(8),t=Array(4),s,r,q,p="sw s se e ne n nw w".split(" "),o=0;8>o;++o){s=this.box.geometry.components[o],r=new OpenLayers.Feature.Vector(s.clone(),{role:p[o]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),0==o%2&&(q=new OpenLayers.Feature.Vector(s.clone(),{role:p[o]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),q.geometry.move=v,s._rotationHandle=q,t[o/2]=q),s.move=z,s.resize=y,s.rotate=x,r.geometry.move=w,s._handle=r,u[o]=r}this.rotationHandles=t;this.handles=u},createControl:function(){var b=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(a){this.feature===b.feature&&(this.feature=b.box);OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(a){a===b.box&&b.transformFeature({center:b.center})},onStart:function(a){var f=!b.geometryTypes||-1!==OpenLayers.Util.indexOf(b.geometryTypes,a.geometry.CLASS_NAME),e=OpenLayers.Util.indexOf(b.handles,a),e=e+OpenLayers.Util.indexOf(b.rotationHandles,a);a!==b.feature&&(a!==b.box&&-2==e&&f)&&b.setFeature(a)},onComplete:function(){b.events.triggerEvent("transformcomplete",{feature:b.feature})}})},drawHandles:function(){for(var d=this.layer,c=0;8>c;++c){this.rotate&&0===c%2&&d.drawFeature(this.rotationHandles[c/2],this.rotationHandleSymbolizer),d.drawFeature(this.handles[c],this.renderIntent)}},transformFeature:function(g){if(!this._setfeature){this.scale*=g.scale||1;this.ratio*=g.ratio||1;var f=this.rotation;this.rotation=(this.rotation+(g.rotation||0))%360;if(!1!==this.events.triggerEvent("beforetransform",g)){var k=this.feature,j=k.geometry,h=this.center;j.rotate(-f,h);g.scale||g.ratio?j.resize(g.scale,h,g.ratio):g.center&&k.move(g.center.getBounds().getCenterLonLat());j.rotate(this.rotation,h);this.layer.drawFeature(k);k.toState(OpenLayers.State.UPDATE);this.events.triggerEvent("transform",g)}}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){for(var d,c=0;8>c;++c){d=this.box.geometry.components[c],d._handle.destroy(),d._handle=null,d._rotationHandle&&d._rotationHandle.destroy(),d._rotationHandle=null}this.rotationHandles=this.rotationHandleSymbolizer=this.handles=this.feature=this.center=null;this.box.destroy();this.layer=this.box=null;this.dragControl.destroy();this.dragControl=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,d,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(b){OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(b)},startBox:function(){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(h){var g=this.dragHandler.start.x,m=this.dragHandler.start.y,l=Math.abs(g-h.x),k=Math.abs(m-h.y),j=this.getBoxOffsets();this.zoomBox.style.width=l+j.width+1+"px";this.zoomBox.style.height=k+j.height+1+"px";this.zoomBox.style.left=(h.x<g?g-l-j.left:g-j.left)+"px";this.zoomBox.style.top=(h.y<m?m-k-j.top:m-j.top)+"px"},endBox:function(g){var f;if(5<Math.abs(this.dragHandler.start.x-g.x)||5<Math.abs(this.dragHandler.start.y-g.y)){var k=this.dragHandler.start;f=Math.min(k.y,g.y);var j=Math.max(k.y,g.y),h=Math.min(k.x,g.x),g=Math.max(k.x,g.x);f=new OpenLayers.Bounds(h,j,g,f)}else{f=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[f])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.boxOffsets=this.zoomBox=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var g=document.createElement("div");g.style.position="absolute";g.style.border="1px solid black";g.style.width="3px";document.body.appendChild(g);var f=3==g.clientWidth;document.body.removeChild(g);var g=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),k=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),j=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),h=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:g,right:k,top:j,bottom:h,width:!1===f?g+k:0,height:!1===f?j+h:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(h){if(h instanceof OpenLayers.Bounds){var g;if(this.out){g=Math.abs(h.right-h.left);var m=Math.abs(h.top-h.bottom);g=Math.min(this.map.size.h/m,this.map.size.w/g);var m=this.map.getExtent(),l=this.map.getLonLatFromPixel(h.getCenterPixel()),h=l.lon-m.getWidth()/2*g,k=l.lon+m.getWidth()/2*g,j=l.lat-m.getHeight()/2*g;g=l.lat+m.getHeight()/2*g;g=new OpenLayers.Bounds(h,j,k,g)}else{g=this.map.getLonLatFromPixel({x:h.left,y:h.bottom}),m=this.map.getLonLatFromPixel({x:h.right,y:h.top}),g=new OpenLayers.Bounds(g.lon,g.lat,m.lon,m.lat)}m=this.map.getZoom();this.map.zoomToExtent(g);m==this.map.getZoom()&&!0==this.alwaysZoom&&this.map.zoomTo(m+(this.out?-1:1))}else{this.out?this.map.setCenter(this.map.getLonLatFromPixel(h),this.map.getZoom()-1):this.map.setCenter(this.map.getLonLatFromPixel(h),this.map.getZoom()+1)}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,draw:function(){if(this.enableKinetic){var b={interval:this.kineticInterval};"object"===typeof this.enableKinetic&&(b=OpenLayers.Util.extend(b,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(b)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(b){this.kinetic&&this.kinetic.update(b);this.panned=!0;this.map.pan(this.handler.last.x-b.x,this.handler.last.y-b.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var d=null;this.kinetic&&(d=this.kinetic.end(e));this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!d,animate:!1});if(d){var f=this;this.kinetic.move(d,function(g,c,h){f.map.pan(g,c,{dragging:!h,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,touch:!1,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(b){this.touch||(this.unregisterMouseListeners(),this.touch=!0);this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return !0},touchmove:function(b){this.last=this.getEventInfo(b);return !0},touchend:function(b){this.down&&(b.xy=this.last.xy,b.lastTouches=this.last.touches,this.handleSingle(b),this.down=null);return !0},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(b){this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return !0},mouseup:function(d){var c=!0;this.checkModifiers(d)&&(this.control.handleRightClicks&&OpenLayers.Event.isRightClick(d))&&(c=this.rightclick(d));return c},rightclick:function(b){if(this.passesTolerance(b)){if(null!=this.rightclickTimerId){return this.clearTimer(),this.callback("dblrightclick",[b]),!this.stopDouble}b=this["double"]?OpenLayers.Util.extend({},b):this.callback("rightclick",[b]);b=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(b,this.delay)}return !this.stopSingle},delayedRightCall:function(b){this.rightclickTimerId=null;b&&this.callback("rightclick",[b])},click:function(b){this.last||(this.last=this.getEventInfo(b));this.handleSingle(b);return !this.stopSingle},dblclick:function(b){this.handleDouble(b);return !this.stopDouble},handleDouble:function(b){this.passesDblclickTolerance(b)&&(this["double"]&&this.callback("dblclick",[b]),this.clearTimer())},handleSingle:function(b){this.passesTolerance(b)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.stop(b),this.handleDouble(b)),(!this.last.touches||2!==this.last.touches.length)&&this.clearTimer()):(this.first=this.getEventInfo(b),this.queuePotentialClick(this.single?OpenLayers.Util.extend({},b):null)))},queuePotentialClick:function(b){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay)},passesTolerance:function(e){var d=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(d=this.pixelTolerance>=this.down.xy.distanceTo(e.xy))&&this.touch&&this.down.touches.length===this.last.touches.length){for(var e=0,f=this.down.touches.length;e<f;++e){if(this.getTouchDistance(this.down.touches[e],this.last.touches[e])>this.pixelTolerance){d=!1;break}}}return d},getTouchDistance:function(d,c){return Math.sqrt(Math.pow(d.clientX-c.clientX,2)+Math.pow(d.clientY-c.clientY,2))},passesDblclickTolerance:function(){var b=!0;this.down&&this.first&&(b=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(b){this.timerId=null;b&&this.callback("click",[b])},getEventInfo:function(g){var f;if(g.touches){var k=g.touches.length;f=Array(k);for(var j,h=0;h<k;h++){j=g.touches[h],f[h]={clientX:j.clientX,clientY:j.clientY}}}return{xy:g.xy,touches:f}},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,this.touch=!1,b=!0);return b},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(b){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();this.zoomWheelEnabled&&this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBoxEnabled&&this.zoomBox.activate();this.pinchZoom&&this.pinchZoom.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.pinchZoom&&this.pinchZoom.deactivate();this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},{"double":!0,stopDouble:!0});this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(b){b.lastTouches&&2==b.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(b){this.map.setCenter(this.map.getLonLatFromViewPortPx(b.xy),this.map.zoom+1)},defaultDblRightClick:function(b){this.map.setCenter(this.map.getLonLatFromViewPortPx(b.xy),this.map.zoom-1)},wheelChange:function(j,h){var p=this.map.getZoom(),o=this.map.getZoom()+Math.round(h),o=Math.max(o,0),o=Math.min(o,this.map.getNumZoomLevels());if(o!==p){var m=this.map.getSize(),p=m.w/2-j.xy.x,m=j.xy.y-m.h/2,l=this.map.baseLayer.getResolutionForZoom(o),k=this.map.getLonLatFromPixel(j.xy);this.map.setCenter(new OpenLayers.LonLat(k.lon+p*l,k.lat+m*l),o)}},wheelUp:function(d,c){this.wheelChange(d,c||1)},wheelDown:function(d,c){this.wheelChange(d,c||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},handlerOptions:null,initialize:function(e,d,f){OpenLayers.Control.prototype.initialize.apply(this,[f]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(g,c){this.layer.events.triggerEvent("sketchmodified",{vertex:g,feature:c})},create:function(g,c){this.layer.events.triggerEvent("sketchstarted",{vertex:g,feature:c})}},this.callbacks);this.layer=e;this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions});"multi" in this.handlerOptions||(this.handlerOptions.multi=this.multi);if(e=this.layer.styleMap&&this.layer.styleMap.styles.temporary){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":e})})}this.handler=new d(this,this.callbacks,this.handlerOptions)},drawFeature:function(b){b=new OpenLayers.Feature.Vector(b);!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:b})&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},insertXY:function(d,c){this.handler&&this.handler.line&&this.handler.insertXY(d,c)},insertDeltaXY:function(d,c){this.handler&&this.handler.line&&this.handler.insertDeltaXY(d,c)},insertDirectionLength:function(d,c){this.handler&&this.handler.line&&this.handler.insertDirectionLength(d,c)},insertDeflectionLength:function(d,c){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(d,c)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(g){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier]){for(var f=this.point.geometry,k=this.control.layer.features,j,h=k.length-1;0<=h;--h){if(j=k[h].geometry,(j instanceof OpenLayers.Geometry.Polygon||j instanceof OpenLayers.Geometry.MultiPolygon)&&j.intersects(f)){f=k[h];this.control.layer.removeFeatures([f],{silent:!0});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);f.geometry.addComponent(this.line.geometry);this.polygon=f;this.drawingHole=!0;break}}}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(d){var d=d.vertex,c=this.line.geometry.components;this.polygon.geometry.intersects(d)||(c=c[c.length-3],d.x=c.x,d.y=c.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var j=this.line.geometry,h=0!==j.getArea();if(h){for(var p=this.polygon.geometry.components,o=p.length-2;0<=o;--o){if(j.intersects(p[o])){h=!1;break}}if(h){o=p.length-2;j:for(;0<o;--o){for(var m=p[o].components,l=0,k=m.length;l<k;++l){if(j.containsPoint(m[l])){h=!1;break j}}}}}h?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(j);this.restoreFeature();return !1},cancel:function(){this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0));return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(b){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=!1;b||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(b){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,b);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var b=this.polygon&&this.polygon.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiPolygon([b]));return b},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(d,c){OpenLayers.Control.Panel.prototype.initialize.apply(this,[c]);this.addControls([new OpenLayers.Control.Navigation]);this.addControls([new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})])},draw:function(){var b=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return b},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);b&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update());return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this});return b},update:function(d){var c=this.getMapBounds();if(null!==c&&(d&&d.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(c))){this.calculateBounds(c),this.resolution=this.layer.map.getResolution(),this.triggerRead(d)}},getMapBounds:function(){if(null===this.layer.map){return null}var b=this.layer.map.getExtent();b&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(b=b.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection));return b},invalidBounds:function(b){b||(b=this.getMapBounds());b=!this.bounds||!this.bounds.containsBounds(b);!b&&this.resFactor&&(b=this.resolution/this.layer.map.getResolution(),b=b>=this.resFactor||b<=1/this.resFactor);return b},calculateBounds:function(e){e||(e=this.getMapBounds());var d=e.getCenterLonLat(),f=e.getWidth()*this.ratio,e=e.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(d.lon-f/2,d.lat-e/2,d.lon+f/2,d.lat+e/2)},triggerRead:function(b){this.response&&!(b&&!0===b.noAbort)&&(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));this.layer.events.triggerEvent("loadstart");this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},b))},createFilter:function(){var b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});this.layer.filter&&(b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,b]}));return b},merge:function(h){this.layer.destroyFeatures();if((h=h.features)&&0<h.length){var g=this.layer.projection,m=this.layer.map.getProjectionObject();if(!m.equals(g)){for(var l,k=0,j=h.length;k<j;++k){(l=h[k].geometry)&&l.transform(g,m)}}this.layer.addFeatures(h)}this.response=null;this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(h,g,m,l,k,j){this.lzd=m;this.zoomLevels=l;m=[];m.push(h,g,k,j);OpenLayers.Layer.Grid.prototype.initialize.apply(this,m);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var b=this.map.getZoom();this.map.getMaxExtent();return b-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(g){var g=this.adjustBounds(g),f=this.getZoom(),k=this.map.getMaxExtent(),j=this.lzd/Math.pow(2,this.getZoom()),h=Math.floor((g.left-k.left)/j),g=Math.floor((g.bottom-k.bottom)/j);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:f,X:h,Y:g}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"});OpenLayers.Protocol.CSW=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Protocol.CSW.DEFAULTS),c=OpenLayers.Protocol.CSW["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported CSW version: "+d.version}return new c(d)};OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"};OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(s,r){var q,p={layer:!0,matrixSet:!0},o;for(o in p){if(!(o in r)){throw Error("Missing property '"+o+"' in layer configuration.")}}p=s.contents;o=p.tileMatrixSets[r.matrixSet];for(var m,l=0,k=p.layers.length;l<k;++l){if(p.layers[l].identifier===r.layer){m=p.layers[l];break}}if(m&&o){for(var j,l=0,k=m.styles.length;l<k&&!(j=m.styles[l],j.isDefault);++l){}q=new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(r,{url:"REST"===r.requestEncoding&&m.resourceUrl?m.resourceUrl.tile.template:s.operationsMetadata.GetTile.dcp.http.get[0].url,name:m.title,style:j.identifier,matrixIds:o.matrixIds,tileFullExtent:o.bounds}))}return q},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var d,c=OpenLayers.Layer.Google.cache[this.map.id];c?(d=c.mapObject,++c.count):(c=this.map.viewPortDiv,d=document.createElement("div"),d.id=this.map.id+"_GMapContainer",d.style.position="absolute",d.style.width="100%",d.style.height="100%",c.appendChild(d),c=this.map.getCenter(),d=new google.maps.Map(d,{center:c?new google.maps.LatLng(c.lat,c.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),c={mapObject:d,count:1},OpenLayers.Layer.Google.cache[this.map.id]=c,this.repositionListener=google.maps.event.addListenerOnce(d,"center_changed",OpenLayers.Function.bind(this.repositionMapElements,this)));this.mapObject=d;this.setGMapVisibility(this.visibility)},repositionMapElements:function(){google.maps.event.trigger(this.mapObject,"resize");var g=this.mapObject.getDiv().firstChild;if(!g||3>g.childNodes.length){return this.repositionTimer=window.setTimeout(OpenLayers.Function.bind(this.repositionMapElements,this),250),!1}for(var f=OpenLayers.Layer.Google.cache[this.map.id],k=this.map.viewPortDiv,j=g.children.length-1;0<=j;--j){if(1000001==g.children[j].style.zIndex){var h=g.children[j];k.appendChild(h);h.style.zIndex="1100";h.style.bottom="";h.className="olLayerGoogleCopyright olLayerGoogleV3";h.style.display="";f.termsOfUse=h}1000000==g.children[j].style.zIndex&&(h=g.children[j],k.appendChild(h),h.style.zIndex="1100",h.style.bottom="",h.className="olLayerGooglePoweredBy olLayerGoogleV3 gmnoprint",h.style.display="",f.poweredBy=h);10000002==g.children[j].style.zIndex&&k.appendChild(g.children[j])}this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility){google.maps.event.trigger(this.mapObject,"resize")}else{var d=OpenLayers.Layer.Google.cache[this.map.id];if(!d.resized){var c=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){google.maps.event.trigger(c.mapObject,"resize");c.moveTo(c.map.getCenter(),c.map.getZoom());delete d.resized})}d.resized=!0}},setGMapVisibility:function(h){var g=OpenLayers.Layer.Google.cache[this.map.id];if(g){for(var m=this.type,l=this.map.layers,k,j=l.length-1;0<=j;--j){if(k=l[j],k instanceof OpenLayers.Layer.Google&&!0===k.visibility&&!0===k.inRange){m=k.type;h=!0;break}}l=this.mapObject.getDiv();!0===h?(this.mapObject.setMapTypeId(m),l.style.left="",g.termsOfUse&&g.termsOfUse.style&&(g.termsOfUse.style.left="",g.termsOfUse.style.display="",g.poweredBy.style.display=""),g.displayed=this.id):(delete g.displayed,l.style.left="-9999px",g.termsOfUse&&g.termsOfUse.style&&(g.termsOfUse.style.display="none",g.termsOfUse.style.left="-9999px",g.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(d){var c=null;null!=d&&(c=this.sphericalMercator?this.inverseMercator(d.bottom,d.left):new OpenLayers.LonLat(d.bottom,d.left),d=this.sphericalMercator?this.inverseMercator(d.top,d.right):new OpenLayers.LonLat(d.top,d.right),c=new google.maps.LatLngBounds(new google.maps.LatLng(c.lat,c.lon),new google.maps.LatLng(d.lat,d.lon)));return c},getMapObjectLonLatFromMapObjectPixel:function(g){var f=this.map.getSize(),k=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),j=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),h=this.map.getResolution(),g=new OpenLayers.LonLat(k+(g.x-f.w/2)*h,j-(g.y-f.h/2)*h);this.wrapDateLine&&(g=g.wrapDateLine(this.maxExtent));return this.getMapObjectLonLatFromLonLat(g.lon,g.lat)},getMapObjectPixelFromMapObjectLonLat:function(f){var e=this.getLongitudeFromMapObjectLonLat(f),f=this.getLatitudeFromMapObjectLonLat(f),h=this.map.getResolution(),g=this.map.getExtent();return this.getMapObjectPixelFromXY(1/h*(e-g.left),1/h*(g.top-f))},setMapObjectCenter:function(e,d){if(!1===this.animationEnabled&&d!=this.mapObject.zoom){var f=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){f.style.visibility=""});f.style.visibility="hidden"}this.mapObject.setOptions({center:e,zoom:d})},getMapObjectZoomFromMapObjectBounds:function(b){return this.mapObject.getBoundsZoomLevel(b)},getMapObjectLonLatFromLonLat:function(e,d){var f;this.sphericalMercator?(f=this.inverseMercator(e,d),f=new google.maps.LatLng(f.lat,f.lon)):f=new google.maps.LatLng(d,e);return f},getMapObjectPixelFromXY:function(d,c){return new google.maps.Point(d,c)},destroy:function(){this.repositionListener&&google.maps.event.removeListener(this.repositionListener);this.repositionTimer&&window.clearTimeout(this.repositionTimer);OpenLayers.Layer.Google.prototype.destroy.apply(this,arguments)}};OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{wps:{ProcessDescriptions:function(d,c){c.processDescriptions={};this.readChildNodes(d,c.processDescriptions)},ProcessDescription:function(e,d){var f={processVersion:this.getAttributeNS(e,this.namespaces.wps,"processVersion"),statusSupported:"true"===e.getAttribute("statusSupported"),storeSupported:"true"===e.getAttribute("storeSupported")};this.readChildNodes(e,f);d[f.identifier]=f},DataInputs:function(d,c){c.dataInputs=[];this.readChildNodes(d,c.dataInputs)},ProcessOutputs:function(d,c){c.processOutputs=[];this.readChildNodes(d,c.processOutputs)},Output:function(e,d){var f={};this.readChildNodes(e,f);d.push(f)},ComplexOutput:function(d,c){c.complexOutput={};this.readChildNodes(d,c.complexOutput)},Input:function(e,d){var f={maxOccurs:parseInt(e.getAttribute("maxOccurs")),minOccurs:parseInt(e.getAttribute("minOccurs"))};this.readChildNodes(e,f);d.push(f)},BoundingBoxData:function(d,c){c.boundingBoxData={};this.readChildNodes(d,c.boundingBoxData)},CRS:function(d,c){c.CRSs||(c.CRSs={});c.CRSs[this.getChildValue(d)]=!0},LiteralData:function(d,c){c.literalData={};this.readChildNodes(d,c.literalData)},ComplexData:function(d,c){c.complexData={};this.readChildNodes(d,c.complexData)},Default:function(d,c){c["default"]={};this.readChildNodes(d,c["default"])},Supported:function(d,c){c.supported={};this.readChildNodes(d,c.supported)},Format:function(e,d){var f={};this.readChildNodes(e,f);d.formats||(d.formats={});d.formats[f.mimeType]=!0},MimeType:function(d,c){c.mimeType=this.getChildValue(d)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{csw:{GetRecordsResponse:function(e,d){d.records=[];this.readChildNodes(e,d);var f=this.getAttributeNS(e,"","version");""!=f&&(d.version=f)},RequestId:function(d,c){c.RequestId=this.getChildValue(d)},SearchStatus:function(e,d){d.SearchStatus={};var f=this.getAttributeNS(e,"","timestamp");""!=f&&(d.SearchStatus.timestamp=f)},SearchResults:function(h,g){this.readChildNodes(h,g);for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]="numberOfRecordsMatched"==m[k].name||"numberOfRecordsReturned"==m[k].name||"nextRecord"==m[k].name?parseInt(m[k].nodeValue):m[k].nodeValue}g.SearchResults=l},SummaryRecord:function(e,d){var f={type:"SummaryRecord"};this.readChildNodes(e,f);d.records.push(f)},BriefRecord:function(e,d){var f={type:"BriefRecord"};this.readChildNodes(e,f);d.records.push(f)},DCMIRecord:function(e,d){var f={type:"DCMIRecord"};this.readChildNodes(e,f);d.records.push(f)},Record:function(e,d){var f={type:"Record"};this.readChildNodes(e,f);d.records.push(f)},"*":function(e,d){var f=e.localName||e.nodeName.split(":").pop();d[f]=this.getChildValue(e)}},geonet:{info:function(e,d){var f={};this.readChildNodes(e,f);d.gninfo=f}},dc:{"*":function(j,h){var p=j.localName||j.nodeName.split(":").pop();OpenLayers.Util.isArray(h[p])||(h[p]=[]);for(var o={},m=j.attributes,l=0,k=m.length;l<k;++l){o[m[l].name]=m[l].nodeValue}o.value=this.getChildValue(j);""!=o.value&&h[p].push(o)}},dct:{"*":function(e,d){var f=e.localName||e.nodeName.split(":").pop();OpenLayers.Util.isArray(d[f])||(d[f]=[]);d[f].push(this.getChildValue(e))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(d,c){c.bounds&&(c.BoundingBox=[{crs:c.projection,value:[c.bounds.left,c.bounds.bottom,c.bounds.right,c.bounds.top]}],delete c.projection,delete c.bounds);OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(b){b=this.writeNode("csw:GetRecords",b);b.setAttribute("xmlns:gmd",this.namespaces.gmd);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetRecords:function(g){g||(g={});var f=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:g.requestId||this.requestId,resultType:g.resultType||this.resultType,outputFormat:g.outputFormat||this.outputFormat,outputSchema:g.outputSchema||this.outputSchema,startPosition:g.startPosition||this.startPosition,maxRecords:g.maxRecords||this.maxRecords}});if(g.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",g.DistributedSearch||this.DistributedSearch,f)}var k=g.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(k)&&0<k.length){for(var j=0,h=k.length;j<h;j++){this.writeNode("csw:ResponseHandler",k[j],f)}}this.writeNode("Query",g.Query||this.Query,f);return f},DistributedSearch:function(b){return this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:b.hopCount}})},ResponseHandler:function(b){return this.createElementNSPlus("csw:ResponseHandler",{value:b.value})},Query:function(g){g||(g={});var f=this.createElementNSPlus("csw:Query",{attributes:{typeNames:g.typeNames||"csw:Record"}}),k=g.ElementName;if(OpenLayers.Util.isArray(k)&&0<k.length){for(var j=0,h=k.length;j<h;j++){this.writeNode("csw:ElementName",k[j],f)}}else{this.writeNode("csw:ElementSetName",g.ElementSetName||{value:"summary"},f)}g.Constraint&&this.writeNode("csw:Constraint",g.Constraint,f);g.SortBy&&this.writeNode("ogc:SortBy",g.SortBy,f);return f},ElementName:function(b){return this.createElementNSPlus("csw:ElementName",{value:b.value})},ElementSetName:function(b){return this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:b.typeNames},value:b.value})},Constraint:function(e){var d=this.createElementNSPlus("csw:Constraint",{attributes:{version:e.version}});if(e.Filter){var f=new OpenLayers.Format.Filter({version:e.version});d.appendChild(f.write(e.Filter))}else{e.CqlText&&(e=this.createElementNSPlus("CqlText",{value:e.CqlText.value}),d.appendChild(e))}return d}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(e,d,f){this.bounds=e;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div);this.setBorder(d,f)},destroy:function(){this.div=this.bounds=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(d,c){d||(d="red");c||(c=2);this.div.style.border=c+"px solid "+d},draw:function(d,c){OpenLayers.Util.modifyDOMElement(this.div,null,d,c);return this.div},onScreen:function(){var b=!1;this.map&&(b=this.map.getExtent().containsBounds(this.bounds,!0,!0));return b},display:function(b){this.div.style.display=b?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(b){b=b||{};!1!==b.extractStyles&&(b.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5});OpenLayers.Format.prototype.initialize.apply(this,[b])},read:function(w){for(var w=w.split("\n"),v,u=[],t=0;t<w.length-1;t++){var s=w[t].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=s.charAt(0)){if(v){for(var s=s.split("\t"),r=new OpenLayers.Geometry.Point(0,0),q={},p=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,o=!1,m=0;m<s.length;m++){if(s[m]){if("point"==v[m]){o=s[m].split(","),r.y=parseFloat(o[0]),r.x=parseFloat(o[1]),o=!0}else{if("lat"==v[m]){r.y=parseFloat(s[m]),o=!0}else{if("lon"==v[m]){r.x=parseFloat(s[m]),o=!0}else{if("title"==v[m]){q.title=s[m]}else{if("image"==v[m]||"icon"==v[m]&&p){p.externalGraphic=s[m]}else{if("iconSize"==v[m]&&p){var l=s[m].split(",");p.graphicWidth=parseFloat(l[0]);p.graphicHeight=parseFloat(l[1])}else{"iconOffset"==v[m]&&p?(l=s[m].split(","),p.graphicXOffset=parseFloat(l[0]),p.graphicYOffset=parseFloat(l[1])):"description"==v[m]?q.description=s[m]:"overflow"==v[m]?q.overflow=s[m]:q[v[m]]=s[m]}}}}}}}}o&&(this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection),s=new OpenLayers.Feature.Vector(r,q,p),u.push(s))}else{v=s.split("\t")}}}return u},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(d,c){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){!this.loaded&&null!=this.location&&(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:function(){this.events.triggerEvent("loadend")},scope:this}),this.loaded=!0)},moveTo:function(e,d,f){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadText()},parseData:function(k){var k=k.responseText,j={};OpenLayers.Util.extend(j,this.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(j.externalProjection=this.projection,j.internalProjection=this.map.getProjectionObject());for(var k=(new OpenLayers.Format.Text(j)).read(k),j=0,r=k.length;j<r;j++){var q={},p=k[j],o,m,l;o=new OpenLayers.LonLat(p.geometry.x,p.geometry.y);p.style.graphicWidth&&p.style.graphicHeight&&(m=new OpenLayers.Size(p.style.graphicWidth,p.style.graphicHeight));void 0!==p.style.graphicXOffset&&void 0!==p.style.graphicYOffset&&(l=new OpenLayers.Pixel(p.style.graphicXOffset,p.style.graphicYOffset));null!=p.style.externalGraphic?q.icon=new OpenLayers.Icon(p.style.externalGraphic,m,l):(q.icon=OpenLayers.Marker.defaultIcon(),null!=m&&q.icon.setSize(m));null!=p.attributes.title&&null!=p.attributes.description&&(q.popupContentHTML="<h2>"+p.attributes.title+"</h2><p>"+p.attributes.description+"</p>");q.overflow=p.attributes.overflow||"auto";q=new OpenLayers.Feature(this,o,q);this.features.push(q);o=q.createMarker();null!=p.attributes.title&&null!=p.attributes.description&&o.events.register("click",q,this.markerClick);this.addMarker(o)}this.events.triggerEvent("loadend")},markerClick:function(f){var e=this==this.layer.selectedFeature;this.layer.selectedFeature=!e?this:null;for(var h=0,g=this.layer.map.popups.length;h<g;h++){this.layer.map.removePopup(this.layer.map.popups[h])}e||this.layer.map.addPopup(this.createPopup());OpenLayers.Event.stop(f)},clearFeatures:function(){if(null!=this.features){for(;0<this.features.length;){var b=this.features[0];OpenLayers.Util.removeItem(this.features,b);b.destroy()}}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(e,d,f){if(!f||!f.layerOptions||!f.layerOptions.styleMap){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.Drag.prototype.initialize.apply(this,[e,d,f]);this.options=f?f:{}},setOptions:function(b){OpenLayers.Util.extend(this.options,b);OpenLayers.Util.extend(this,b)},activate:function(){var b=!1;OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&&(b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b),this.map.addLayer(this.layer),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.feature=this.layer=null,b=!0);return b},down:function(b){this.fixedRadius=!!this.radius;b=this.layer.getLonLatFromViewPortPx(b.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()}this.persist&&this.clear();this.feature=new OpenLayers.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:!0});this.layer.drawFeature(this.feature,this.style)},move:function(d){var c=this.layer.getLonLatFromViewPortPx(d.xy),c=new OpenLayers.Geometry.Point(c.lon,c.lat);this.irregular?(d=Math.sqrt(2)*Math.abs(c.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,d)):this.fixedRadius?this.origin=c:(this.calculateAngle(c,d),this.radius=Math.max(this.map.getResolution()/2,c.distanceTo(this.origin)));this.modifyGeometry();this.irregular&&(d=c.x-this.origin.x,c=c.y-this.origin.y,this.feature.geometry.resize(1,this.origin,0==c?d/(this.radius*Math.sqrt(2)):d/c),this.feature.geometry.move(d/2,c/2));this.layer.drawFeature(this.feature,this.style)},up:function(b){this.finalize();this.start==this.last&&this.callback("done",[b.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-0.5);this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180));this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var f,e,h=this.feature.geometry.components[0];h.components.length!=this.sides+1&&(this.createGeometry(),h=this.feature.geometry.components[0]);for(var g=0;g<this.sides;++g){e=h.components[g],f=this.angle+2*g*Math.PI/this.sides,e.x=this.origin.x+this.radius*Math.cos(f),e.y=this.origin.y+this.radius*Math.sin(f),e.clearBounds()}},calculateAngle:function(f,e){var h=Math.atan2(f.y-this.origin.y,f.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!e[this.snapToggle]){var g=Math.PI/180*this.snapAngle;this.angle=Math.round(h/g)*g}else{this.angle=h}},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(b){this.callbacks[b]&&this.callbacks[b].apply(this.control,[this.feature.geometry.clone()]);!this.persist&&("done"==b||"cancel"==b)&&this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,handlerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(d,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}});this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})}));this.handler=new d(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var b in this.layerCache){delete this.layerCache[b]}for(b in this.wfsCache){delete this.wfsCache[b]}OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(b){this.setVisibility(b.object.getVisibility())},createSelectionLayer:function(d){var c;if(this.layerCache[d.id]){c=this.layerCache[d.id]}else{c=new OpenLayers.Layer.WMS(d.name,d.url,d.params,OpenLayers.Util.applyDefaults(this.layerOptions,d.getOptions()));this.layerCache[d.id]=c;if(!1===this.layerOptions.displayInLayerSwitcher){d.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:c})}this.map.addLayer(c)}return c},createSLD:function(u,t,s){for(var r={version:"1.0.0",namedLayers:{}},q=(""+u.params.LAYERS).split(","),p=0,o=q.length;p<o;p++){var m=q[p];r.namedLayers[m]={name:m,userStyles:[]};var l=this.selectionSymbolizer,k=s[p];0<=k.type.indexOf("Polygon")?l={Polygon:this.selectionSymbolizer.Polygon}:0<=k.type.indexOf("LineString")?l={Line:this.selectionSymbolizer.Line}:0<=k.type.indexOf("Point")&&(l={Point:this.selectionSymbolizer.Point});r.namedLayers[m].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:l,filter:t[p],maxScaleDenominator:u.options.minScale})]})}return(new OpenLayers.Format.SLD({srsName:this.map.getProjection()})).write(r)},parseDescribeLayer:function(g){var f=new OpenLayers.Format.WMSDescribeLayer,k=g.responseXML;if(!k||!k.documentElement){k=g.responseText}for(var g=f.read(k),f=[],k=null,j=0,h=g.length;j<h;j++){"WFS"==g[j].owsType&&(f.push(g[j].typeName),k=g[j].owsURL)}OpenLayers.Request.GET({url:k,params:{SERVICE:"WFS",TYPENAME:f.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(e){var d=new OpenLayers.Format.WFSDescribeFeatureType,l=e.responseXML;if(!l||!l.documentElement){l=e.responseText}this.control.wfsCache[this.layer.id]=d.read(l);this.control._queue&&this.control.applySelection()},scope:this})},getGeometryAttributes:function(s){for(var r=[],s=this.wfsCache[s.id],q=0,p=s.featureTypes.length;q<p;q++){for(var o=s.featureTypes[q].properties,m=0,l=o.length;m<l;m++){var k=o[m],j=k.type;(0<=j.indexOf("LineString")||0<=j.indexOf("GeometryAssociationType")||0<=j.indexOf("GeometryPropertyType")||0<=j.indexOf("Point")||0<=j.indexOf("Polygon"))&&r.push(k)}}return r},activate:function(){var f=OpenLayers.Control.prototype.activate.call(this);if(f){for(var e=0,h=this.layers.length;e<h;e++){var g=this.layers[e];g&&!this.wfsCache[g.id]&&OpenLayers.Request.GET({url:g.url,params:{SERVICE:"WMS",VERSION:g.params.VERSION,LAYERS:g.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:g,control:this}})}}return f},deactivate:function(){var h=OpenLayers.Control.prototype.deactivate.call(this);if(h){for(var g=0,m=this.layers.length;g<m;g++){var l=this.layers[g];if(l&&!0===this.clearOnDeactivate){var k=this.layerCache,j=k[l.id];j&&(l.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:j}),j.destroy(),delete k[l.id])}}}return h},setLayers:function(b){this.active?(this.deactivate(),this.layers=b,this.activate()):this.layers=b},createFilter:function(e,d){var f=null;this.handler instanceof OpenLayers.Handler.RegularPolygon?f=!0===this.handler.irregular?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:e.name,value:d.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:d}):this.handler instanceof OpenLayers.Handler.Polygon?f=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:d}):this.handler instanceof OpenLayers.Handler.Path?f=0<=e.type.indexOf("Point")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:d}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:d}):this.handler instanceof OpenLayers.Handler.Click&&(f=0<=e.type.indexOf("Polygon")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:d}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:d}));return f},select:function(b){this._queue=function(){for(var s=0,r=this.layers.length;s<r;s++){for(var q=this.layers[s],p=this.getGeometryAttributes(q),o=[],m=0,l=p.length;m<l;m++){var k=p[m];if(null!==k){if(!(b instanceof OpenLayers.Geometry)){var a=this.map.getLonLatFromPixel(b.xy);b=new OpenLayers.Geometry.Point(a.lon,a.lat)}k=this.createFilter(k,b);null!==k&&o.push(k)}}m=this.createSelectionLayer(q);p=this.createSLD(q,o,p);this.events.triggerEvent("selected",{layer:q,filters:o});m.mergeNewParams({SLD_BODY:p});delete this._queue}};this.applySelection()},applySelection:function(){for(var e=!0,d=0,f=this.layers.length;d<f;d++){if(!this.wfsCache[this.layers[d].id]){e=!1;break}}e&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(d,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.element=OpenLayers.Util.getElement(d)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element));this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var b;if(!0===this.geodesic){if(!this.map.getUnits()){return}b=OpenLayers.INCHES_PER_UNIT;b=(this.map.getGeodesicPixelSize().w||0.000001)*b.km*OpenLayers.DOTS_PER_INCH}else{b=this.map.getScale()}b&&(b=9500<=b&&950000>=b?Math.round(b/1000)+"K":950000<=b?Math.round(b/1000000)+"M":Math.round(b),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:b}))},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(f,e,h,g){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(null==g||null==g.isBaseLayer){this.isBaseLayer="true"!=this.transparent&&!0!=this.transparent}g&&null!=g.useOverlay&&(this.useOverlay=g.useOverlay);this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(b){null==b&&(b=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(e){var d;d=e.getCenterLonLat();var f=this.map.getSize();this.singleTile?(e={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:f.h*this.ratio,setdisplaywidth:f.w*this.ratio,setviewcenterx:d.lon,setviewcentery:d.lat,setviewscale:this.map.getScale()},this.useOverlay&&!this.useAsyncOverlay&&(d={},d=OpenLayers.Util.extend(d,e),d.operation="GETVISIBLEMAPEXTENT",d.version="1.0.0",d.session=this.params.session,d.mapName=this.params.mapName,d.format="text/xml",d=this.getFullRequestString(d),OpenLayers.Request.GET({url:d,async:!1})),d=this.getFullRequestString(e)):(f=this.map.getResolution(),d=Math.floor((e.left-this.maxExtent.left)/f),d=Math.round(d/this.tileSize.w),e=Math.floor((this.maxExtent.top-e.top)/f),e=Math.round(e/this.tileSize.h),d=this.useHttpTile?this.getImageFilePath({tilecol:d,tilerow:e,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:d,tilerow:e,scaleindex:this.resolutions.length-this.map.zoom-1}));return d},getFullRequestString:function(j,h){var p=null==h?this.url:h;"object"==typeof p&&(p=p[Math.floor(Math.random()*p.length)]);var o=p,m=OpenLayers.Util.extend({},this.params),m=OpenLayers.Util.extend(m,j),l=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(p)),k;for(k in m){k.toUpperCase() in l&&delete m[k]}m=OpenLayers.Util.getParameterString(m);m=m.replace(/,/g,"+");""!=m&&(l=p.charAt(p.length-1),o="&"==l||"?"==l?o+m:-1==p.indexOf("?")?o+("?"+m):o+("&"+m));return o},getImageFilePath:function(g,f){var k=null==f?this.url:f;"object"==typeof k&&(k=k[Math.floor(Math.random()*k.length)]);var j="",h="";0>g.tilerow&&(j="-");j=0==g.tilerow?j+"0":j+Math.floor(Math.abs(g.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder;0>g.tilecol&&(h="-");h=0==g.tilecol?h+"0":h+Math.floor(Math.abs(g.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;j="/S"+Math.floor(g.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+j+"/C"+h+"/"+g.tilerow%this.params.tileRowsPerFolder+"_"+g.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;this.params.querystring&&(j+="?"+this.params.querystring);return k+j},calculateGridLayout:function(j,h,p){var o=p*this.tileSize.w,p=p*this.tileSize.h,m=j.left-h.lon,l=Math.floor(m/o)-this.buffer,j=h.lat-j.top+p,k=Math.floor(j/p)-this.buffer;return{tilelon:o,tilelat:p,tileoffsetlon:h.lon+l*o,tileoffsetlat:h.lat-p*k,tileoffsetx:-(m/o-l)*this.tileSize.w,tileoffsety:(k-j/p)*this.tileSize.h}},CLASS_NAME:"OpenLayers.Layer.MapGuide"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);var f={done:this.measureComplete,point:this.measurePartial};this.immediate&&(f.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(f,this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(b){(this.immediate=b)?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,d){var f=this.active;f&&this.deactivate();this.handler=new e(this,this.callbacks,d);f&&this.activate()},measureComplete:function(b){this.cancelDelay();this.measure(b,"measure")},measurePartial:function(d,c){this.cancelDelay();c=c.clone();this.handler.freehandMode(this.handler.evt)?this.measure(c,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(c,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,d,f){f&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(d.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(f,e){var h,g;-1<f.CLASS_NAME.indexOf("LineString")?(h=this.getBestLength(f),g=1):(h=this.getBestArea(f),g=2);this.events.triggerEvent(e,{measure:h[0],units:h[1],order:g,geometry:f})},getBestArea:function(h){for(var g=this.displaySystemUnits[this.displaySystem],m,l,k=0,j=g.length;k<j&&!(m=g[k],l=this.getArea(h,m),1<l);++k){}return[l,m]},getArea:function(g,f){var k,j;this.geodesic?(k=g.getGeodesicArea(this.map.getProjectionObject()),j="m"):(k=g.getArea(),j=this.map.getUnits());var h=OpenLayers.INCHES_PER_UNIT[f];h&&(k*=Math.pow(OpenLayers.INCHES_PER_UNIT[j]/h,2));return k},getBestLength:function(h){for(var g=this.displaySystemUnits[this.displaySystem],m,l,k=0,j=g.length;k<j&&!(m=g[k],l=this.getLength(h,m),1<l);++k){}return[l,m]},getLength:function(g,f){var k,j;this.geodesic?(k=g.getGeodesicLength(this.map.getProjectionObject()),j="m"):(k=g.getLength(),j=this.map.getUnits());var h=OpenLayers.INCHES_PER_UNIT[f];h&&(k*=OpenLayers.INCHES_PER_UNIT[j]/h);return k},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(b){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[b])},read_wmc_SRS:function(g,f){var k=this.getChildValue(f);"object"!=typeof g.projections&&(g.projections={});for(var k=k.split(/ +/),j=0,h=k.length;j<h;j++){g.projections[k[j]]=!0}},write_wmc_Layer:function(f){var e=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[f]);if(f.srs){var h=[],g;for(g in f.srs){h.push(g)}e.appendChild(this.createElementDefaultNS("SRS",h.join(" ")))}e.appendChild(this.write_wmc_FormatList(f));e.appendChild(this.write_wmc_StyleList(f));f.dimensions&&e.appendChild(this.write_wmc_DimensionList(f));e.appendChild(this.write_wmc_LayerExtension(f))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(j,h,p,o,m,l,k){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(){return this.relativePosition});this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;l&&(this.closeDiv.style.zIndex=1);this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.isAlphaImage=this.imageSize=this.imageSrc=null;this.fixedRelativePosition=!1;this.positionBlocks=null;for(var d=0;d<this.blocks.length;d++){var c=this.blocks[d];c.image&&c.div.removeChild(c.image);c.image=null;c.div&&this.groupDiv.removeChild(c.div);c.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(){},setBorder:function(){},setOpacity:function(){},setSize:function(b){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+this.padding.right+"px";this.closeDiv.style.top=b.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(d){var c=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return c=c.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var e=null,d;for(d in this.positionBlocks){e=d;break}e=this.positionBlocks[e];for(d=0;d<e.blocks.length;d++){var f={};this.blocks.push(f);f.div=OpenLayers.Util.createDiv(this.id+"_FrameDecorationDiv_"+d,null,null,null,"absolute",null,"hidden",null);f.image=(this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage)(this.id+"_FrameDecorationImg_"+d,null,this.imageSize,this.imageSrc,"absolute",null,null,null);f.div.appendChild(f.image);this.groupDiv.appendChild(f.div)}},updateBlocks:function(){this.blocks||this.createBlocks();if(this.size&&this.relativePosition){for(var u=this.positionBlocks[this.relativePosition],t=0;t<u.blocks.length;t++){var s=u.blocks[t],r=this.blocks[t],q=s.anchor.left,p=s.anchor.bottom,o=s.anchor.right,m=s.anchor.top,l=isNaN(s.size.w)?this.size.w-(o+q):s.size.w,k=isNaN(s.size.h)?this.size.h-(p+m):s.size.h;r.div.style.width=(0>l?0:l)+"px";r.div.style.height=(0>k?0:k)+"px";r.div.style.left=null!=q?q+"px":"";r.div.style.bottom=null!=p?p+"px":"";r.div.style.right=null!=o?o+"px":"";r.div.style.top=null!=m?m+"px":"";r.image.style.left=s.position.x+"px";r.image.style.top=s.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(j,h,p,o,m,l,k){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Tile.Image.IFrame={useIFrame:null,draw:function(){if(OpenLayers.Tile.Image.prototype.shouldDraw.call(this)){var d=this.layer.getURL(this.bounds),c=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&d.length>this.maxGetUrlLength;d=c&&!this.useIFrame;c=!c&&this.useIFrame;if(d||c){this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,d?(this.blankImageUrl=this._blankImageUrl,this.frame.removeChild(this.frame.firstChild)):(this._blankImageUrl=this.blankImageUrl,this.blankImageUrl="about:blank")}}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(!0===this.useIFrame){if(!this.frame.childNodes.length){var d=document.createElement("div"),c=d.style;c.position="absolute";c.width="100%";c.height="100%";c.zIndex=1;c.backgroundImage="url("+this._blankImageUrl+")";this.frame.appendChild(d)}d=this.id+"_iFrame";9>parseFloat(navigator.appVersion.split("MSIE")[1])?(c=document.createElement('<iframe name="'+d+'">'),c.style.backgroundColor="#FFFFFF",c.style.filter="chroma(color=#FFFFFF)"):(c=document.createElement("iframe"),c.style.backgroundColor="transparent",c.name=d);c.scrolling="no";c.marginWidth="0px";c.marginHeight="0px";c.frameBorder="0";c.style.position="absolute";c.style.width="100%";c.style.height="100%";1>this.layer.opacity&&OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,this.layer.opacity);this.frame.appendChild(c);return this.imgDiv=c}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var f=document.createElement("form");f.method="POST";var e=this.layer.params._OLSALT,e=(e?e+"_":"")+this.bounds.toBBOX();f.action=OpenLayers.Util.urlAppend(this.layer.url,e);f.target=this.id+"_iFrame";this.layer.getImageSize();var e=OpenLayers.Util.getParameters(this.url),h,g;for(g in e){h=document.createElement("input"),h.type="hidden",h.name=g,h.value=e[g],f.appendChild(h)}return f},setImgSrc:function(d){if(!0===this.useIFrame){if(d){var c=this.createRequestForm();this.frame.appendChild(c);c.submit();this.frame.removeChild(c)}else{this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null)}}else{OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)}},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments);!0===this.useIFrame&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var b;!1===this.useIFrame&&(b=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this));return b}};OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"});OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{gml:OpenLayers.Util.applyDefaults({name:function(d,c){c.name=this.getChildValue(d)},TimePeriod:function(d,c){c.timePeriod={};this.readChildNodes(d,c.timePeriod)},beginPosition:function(d,c){c.beginPosition=this.getChildValue(d)},endPosition:function(d,c){c.endPosition=this.getChildValue(d)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(d,c){this.readChildNodes(d,c)},Contents:function(d,c){c.contents={};this.readChildNodes(d,c.contents)},ObservationOfferingList:function(d,c){c.offeringList={};this.readChildNodes(d,c.offeringList)},ObservationOffering:function(e,d){var f=this.getAttributeNS(e,this.namespaces.gml,"id");d[f]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]};this.readChildNodes(e,d[f])},time:function(d,c){c.time={};this.readChildNodes(d,c.time)},procedure:function(d,c){c.procedures.push(this.getAttributeNS(d,this.namespaces.xlink,"href"))},observedProperty:function(d,c){c.observedProperties.push(this.getAttributeNS(d,this.namespaces.xlink,"href"))},featureOfInterest:function(d,c){c.featureOfInterestIds.push(this.getAttributeNS(d,this.namespaces.xlink,"href"))},responseFormat:function(d,c){c.responseFormats.push(this.getChildValue(d))},resultModel:function(d,c){c.resultModels.push(this.getChildValue(d))},responseMode:function(d,c){c.responseModes.push(this.getChildValue(d))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(d){var c=!0;this.pinching=!1;OpenLayers.Event.isMultiTouch(d)?(this.started=!0,this.last=this.start={distance:this.getDistance(d.touches),delta:0,scale:1},this.callback("start",[d,this.start]),c=!this.stopDown):(this.started=!1,this.last=this.start=null);OpenLayers.Event.stop(d);return c},touchmove:function(d){if(this.started&&OpenLayers.Event.isMultiTouch(d)){this.pinching=!0;var c=this.getPinchData(d);this.callback("move",[d,c]);this.last=c;OpenLayers.Event.stop(d)}return !0},touchend:function(b){this.started&&(this.pinching=this.started=!1,this.callback("done",[b,this.start,this.last]),this.last=this.start=null);return !0},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,b=!0);return b},getDistance:function(d){var c=d[0],d=d[1];return Math.sqrt(Math.pow(c.clientX-d.clientX,2)+Math.pow(c.clientY-d.clientY,2))},getPinchData:function(b){b=this.getDistance(b.touches);return{distance:b,delta:this.last.distance-b,scale:b/this.start.distance}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var b=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return b},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);b&&(!0===this.layer.visibility&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this}));return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.stop();return b},reset:function(){!0===this.layer.visibility?this.start():this.stop()},start:function(){this.interval&&("number"===typeof this.interval&&0<this.interval)&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&(this.layer.refresh&&"function"==typeof this.layer.refresh)&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"});OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(g,f,k,j){var h=[],k=OpenLayers.Util.upperCaseObject(k);h.push(g,f,k,j);OpenLayers.Layer.Grid.prototype.initialize.apply(this,h);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()){if(null==j||!j.isBaseLayer){this.isBaseLayer=!1}"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png")}},clone:function(b){null==b&&(b=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(f){var f=this.adjustBounds(f),e=this.projection.getCode().split(":"),e=e[e.length-1],h=this.getImageSize(),f={BBOX:f.toBBOX(),SIZE:h.w+","+h.h,F:"image",BBOXSR:e,IMAGESR:e};if(this.layerDefs){var e=[],g;for(g in this.layerDefs){this.layerDefs.hasOwnProperty(g)&&this.layerDefs[g]&&(e.push(g),e.push(":"),e.push(this.layerDefs[g]),e.push(";"))}0<e.length&&(f.LAYERDEFS=e.join(""))}return this.getFullRequestString(f)},setLayerFilter:function(d,c){this.layerDefs||(this.layerDefs={});c?this.layerDefs[d]=c:delete this.layerDefs[d]},clearLayerFilter:function(b){b?delete this.layerDefs[b]:delete this.layerDefs},mergeNewParams:function(b){b=[OpenLayers.Util.upperCaseObject(b)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,b)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(b){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[b])},read:function(e){var d,f,e=e.replace(/[\n\r]/g," ");if(f=this.regExes.typeStr.exec(e)){if(e=f[1].toLowerCase(),f=f[2],this.parse[e]&&(d=this.parse[e].apply(this,[f])),this.internalProjection&&this.externalProjection){if(d&&"OpenLayers.Feature.Vector"==d.CLASS_NAME){d.geometry.transform(this.externalProjection,this.internalProjection)}else{if(d&&"geometrycollection"!=e&&"object"==typeof d){e=0;for(f=d.length;e<f;e++){d[e].geometry.transform(this.externalProjection,this.internalProjection)}}}}}return d},write:function(h){var g,m;h.constructor==Array?m=!0:(h=[h],m=!1);var l=[];m&&l.push("GEOMETRYCOLLECTION(");for(var k=0,j=h.length;k<j;++k){m&&0<k&&l.push(","),g=h[k].geometry,l.push(this.extractGeometry(g))}m&&l.push(")");return l.join("")},extractGeometry:function(d){var c=d.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[c]){return null}this.internalProjection&&this.externalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));return("collection"==c?"GEOMETRYCOLLECTION":c.toUpperCase())+"("+this.extract[c].apply(this,[d])+")"},extract:{point:function(b){return b.x+" "+b.y},multipoint:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push("("+this.extract.point.apply(this,[f.components[h]])+")")}return e.join(",")},linestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.point.apply(this,[f.components[h]]))}return e.join(",")},multilinestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push("("+this.extract.linestring.apply(this,[f.components[h]])+")")}return e.join(",")},polygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push("("+this.extract.linestring.apply(this,[f.components[h]])+")")}return e.join(",")},multipolygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push("("+this.extract.polygon.apply(this,[f.components[h]])+")")}return e.join(",")},collection:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extractGeometry.apply(this,[f.components[h]]))}return e.join(",")}},parse:{point:function(b){b=OpenLayers.String.trim(b).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b[0],b[1]))},multipoint:function(g){for(var f=OpenLayers.String.trim(g).split(","),k=[],j=0,h=f.length;j<h;++j){g=f[j].replace(this.regExes.trimParens,"$1"),k.push(this.parse.point.apply(this,[g]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(k))},linestring:function(f){for(var f=OpenLayers.String.trim(f).split(","),e=[],h=0,g=f.length;h<g;++h){e.push(this.parse.point.apply(this,[f[h]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(e))},multilinestring:function(g){for(var f=OpenLayers.String.trim(g).split(this.regExes.parenComma),k=[],j=0,h=f.length;j<h;++j){g=f[j].replace(this.regExes.trimParens,"$1"),k.push(this.parse.linestring.apply(this,[g]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(k))},polygon:function(g){for(var f,g=OpenLayers.String.trim(g).split(this.regExes.parenComma),k=[],j=0,h=g.length;j<h;++j){f=g[j].replace(this.regExes.trimParens,"$1"),f=this.parse.linestring.apply(this,[f]).geometry,f=new OpenLayers.Geometry.LinearRing(f.components),k.push(f)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(k))},multipolygon:function(g){for(var f=OpenLayers.String.trim(g).split(this.regExes.doubleParenComma),k=[],j=0,h=f.length;j<h;++j){g=f[j].replace(this.regExes.trimParens,"$1"),k.push(this.parse.polygon.apply(this,[g]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(k))},geometrycollection:function(f){for(var f=f.replace(/,\s*([A-Za-z])/g,"|$1"),f=OpenLayers.String.trim(f).split("|"),e=[],h=0,g=f.length;h<g;++h){e.push(OpenLayers.Format.WKT.prototype.read.apply(this,[f[h]]))}return e}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(b){this.passesTolerance(b.xy)&&(this.clearTimer(),this.callback("move",[b]),this.px=b.xy,b=OpenLayers.Util.extend({},b),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay));return !this.stopMove},mouseout:function(b){OpenLayers.Util.mouseLeft(b,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[b]));return !0},passesTolerance:function(d){var c=!0;this.pixelTolerance&&this.px&&Math.sqrt(Math.pow(this.px.x-d.x,2)+Math.pow(this.px.y-d.y,2))<this.pixelTolerance&&(c=!1);return c},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(b){this.callback("pause",[b])},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),b=!0);return b},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(b){b.handlerOptions=b.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[b]);this.features={};this.handlers={};this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{}));this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"})));this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active){for(var b in this.handlers){this.handlers[b].activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){for(var b in this.handlers){this.handlers[b].deactivate()}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(d){var c=this.pixelToBounds(d.xy);this.setModifiers(d);this.request(c,{single:this.single})},selectBox:function(d){var c;if(d instanceof OpenLayers.Bounds){c=this.map.getLonLatFromPixel({x:d.left,y:d.bottom}),d=this.map.getLonLatFromPixel({x:d.right,y:d.top}),c=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)}else{if(this.click){return}c=this.pixelToBounds(d)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(c)},selectHover:function(b){this.request(this.pixelToBounds(b.xy),{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(e,d){var d=d||{},f=new OpenLayers.Filter.Spatial({type:this.filterType,value:e});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");f=this.protocol.read({maxFeatures:!0==d.single?this.maxFeatures:void 0,filter:f,callback:function(a){a.success()&&(a.features.length?!0==d.single?this.selectBestFeature(a.features,e.getCenterLonLat(),d):this.select(a.features):d.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll()));OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});!0==d.hover&&(this.hoverResponse=f)},selectBestFeature:function(k,j,r){r=r||{};if(k.length){for(var j=new OpenLayers.Geometry.Point(j.lon,j.lat),q,p,o,m=Number.MAX_VALUE,l=0;l<k.length&&!(q=k[l],q.geometry&&(o=j.distanceTo(q.geometry,{edge:!1}),o<m&&(m=o,p=q,0==m)));++l){}!0==r.hover?this.hoverSelect(p):this.select(p||k)}},setModifiers:function(b){this.modifiers={multiple:this.multiple||this.multipleKey&&b[this.multipleKey],toggle:this.toggle||this.toggleKey&&b[this.toggleKey]}},select:function(h){!this.modifiers.multiple&&!this.modifiers.toggle&&this.unselectAll();OpenLayers.Util.isArray(h)||(h=[h]);var g=this.events.triggerEvent("beforefeaturesselected",{features:h});if(!1!==g){for(var m=[],l,k=0,j=h.length;k<j;++k){l=h[k],this.features[l.fid||l.id]?this.modifiers.toggle&&this.unselect(this.features[l.fid||l.id]):(g=this.events.triggerEvent("beforefeatureselected",{feature:l}),!1!==g&&(this.features[l.fid||l.id]=l,m.push(l),this.events.triggerEvent("featureselected",{feature:l})))}this.events.triggerEvent("featuresselected",{features:m})}},hoverSelect:function(e){var d=e?e.fid||e.id:null,f=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;f&&f!=d&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null);d&&d!=f&&(this.events.triggerEvent("hoverfeature",{feature:e}),this.hoverFeature=e)},unselect:function(b){delete this.features[b.fid||b.id];this.events.triggerEvent("featureunselected",{feature:b})},unselectAll:function(){for(var b in this.features){this.unselect(this.features[b])}},setMap:function(d){for(var c in this.handlers){this.handlers[c].setMap(d)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(d){var c=d.add(-this.clickTolerance/2,this.clickTolerance/2),d=d.add(this.clickTolerance/2,-this.clickTolerance/2),c=this.map.getLonLatFromPixel(c),d=this.map.getLonLatFromPixel(d);return new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});OpenLayers.Format.QueryStringFilter=function(){function d(b){b=b.replace(/%/g,"\\%");b=b.replace(/\\\\\.(\*)?/g,function(f,e){return e?f:"\\\\_"});b=b.replace(/\\\\\.\*/g,"\\\\%");b=b.replace(/(\\)?\.(\*)?/g,function(f,e,g){return e||g?f:"_"});b=b.replace(/(\\)?\.\*/g,function(f,e){return e?f:"%"});b=b.replace(/\\\./g,".");return b=b.replace(/(\\)?\\\*/g,function(f,e){return e?f:"*"})}var c={};c[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";c[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";c[OpenLayers.Filter.Comparison.LESS_THAN]="lt";c[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";c[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";c[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";c[OpenLayers.Filter.Comparison.LIKE]="ilike";return OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(h,g){var g=g||{},b=h.CLASS_NAME,b=b.substring(b.lastIndexOf(".")+1);switch(b){case"Spatial":switch(h.type){case OpenLayers.Filter.Spatial.BBOX:g.bbox=h.value.toArray();this.srsInBBOX&&h.projection&&g.bbox.push(h.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:g.tolerance=h.distance;case OpenLayers.Filter.Spatial.WITHIN:g.lon=h.value.x;g.lat=h.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+h.type)}break;case"Comparison":b=c[h.type];if(void 0!==b){var a=h.value;h.type==OpenLayers.Filter.Comparison.LIKE&&(a=d(a),this.wildcarded&&(a="%"+a+"%"));g[h.property+"__"+b]=a;g.queryable=g.queryable||[];g.queryable.push(h.property)}else{OpenLayers.Console.warn("Unknown comparison filter type "+h.type)}break;case"Logical":if(h.type===OpenLayers.Filter.Logical.AND){b=0;for(a=h.filters.length;b<a;b++){g=this.write(h.filters[b],g)}}else{OpenLayers.Console.warn("Unsupported logical filter type "+h.type)}break;default:OpenLayers.Console.warn("Unknown filter type "+b)}return g},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}();OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.div.left="",this.div.top="",this.element=this.div);return this.div},redraw:function(d){var c;if(null==d){this.reset()}else{if(null==this.lastXy||Math.abs(d.xy.x-this.lastXy.x)>this.granularity||Math.abs(d.xy.y-this.lastXy.y)>this.granularity){this.lastXy=d.xy}else{if(c=this.map.getLonLatFromPixel(d.xy)){this.displayProjection&&c.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=d.xy,d=this.formatOutput(c),d!=this.element.innerHTML&&(this.element.innerHTML=d)}}}},reset:function(){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(d){var c=parseInt(this.numDigits);return this.prefix+d.lon.toFixed(c)+this.separator+d.lat.toFixed(c)+this.suffix},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:navigator.geolocation,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return !this.geolocation?(this.events.triggerEvent("locationuncapable"),!1):OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1},deactivate:function(){this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId);return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(d){var c=(new OpenLayers.LonLat(d.coords.longitude,d.coords.latitude)).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(c);this.events.triggerEvent("locationupdated",{position:d,point:new OpenLayers.Geometry.Point(c.lon,c.lat)})},getCurrentLocation:function(){if(!this.active||this.watch){return !1}this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);return !0},failure:function(b){this.events.triggerEvent("locationfailed",{error:b})},CLASS_NAME:"OpenLayers.Control.Geolocate"});OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var d=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(d){if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var c=new OpenLayers.Protocol.Script({url:this.url,callback:function(b){this.isLoading=false;this.events.triggerEvent("loadend");this.json=b.data},scope:this});c.read();this.request=c}else{this.request=OpenLayers.Request.GET({url:this.url,callback:function(b){this.isLoading=false;this.events.triggerEvent("loadend");b.status===200&&this.parseData(b.responseText)},scope:this})}}else{this.unload()}return d},abortLoading:function(){this.request&&(this.request.abort(),delete this.request);this.isLoading=!1},getFeatureInfo:function(f,e){var h=null;if(this.json){var g=this.getFeatureId(f,e);null!==g&&(h={id:g,data:this.json.data[g]})}return h},getFeatureId:function(g,f){var k=null;if(this.json){var j=this.utfgridResolution,j=this.indexFromCharCode(this.json.grid[Math.floor(f/j)].charCodeAt(Math.floor(g/j))),h=this.json.keys;!isNaN(j)&&j in h&&(k=h[j])}return k},indexFromCharCode:function(b){93<=b&&b--;35<=b&&b--;return b-32},parseData:function(b){this.format||(this.format=new OpenLayers.Format.JSON);this.json=this.format.read(b)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions);this.previous=new OpenLayers.Control.Button(b);b={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(b,this.nextOptions);this.next=new OpenLayers.Control.Button(b);this.clear()},onPreviousChange:function(b){b&&!this.previous.active?this.previous.activate():!b&&this.previous.active&&this.previous.deactivate()},onNextChange:function(b){b&&!this.next.active?this.next.activate():!b&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var b in this){this[b]=null}},setMap:function(b){this.map=b;this.next.setMap(b);this.previous.setMap(b)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var d=this.previousStack.shift(),c=this.previousStack.shift();void 0!=c?(this.nextStack.unshift(d),this.previousStack.unshift(c),this.restoring=!0,this.restore(c),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(d);return c},nextTrigger:function(){var b=this.nextStack.shift();void 0!=b&&(this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1));return b},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(f){var e,h;if(this.map.getProjectionObject()==f.projection){h=this.map.getZoomForResolution(f.resolution),e=f.center}else{e=f.center.clone();e.transform(f.projection,this.map.getProjectionObject());h=f.units;var g=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;h=this.map.getZoomForResolution((h&&g?OpenLayers.INCHES_PER_UNIT[h]/OpenLayers.INCHES_PER_UNIT[g]:1)*f.resolution)}this.map.setCenter(e,h)},setListeners:function(){this.listeners={};for(var b in this.registry){this.listeners[b]=OpenLayers.Function.bind(function(){if(!this.restoring){this.previousStack.unshift(this.registry[b].apply(this,arguments));if(1<this.previousStack.length){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}this.previousStack.length>this.limit+1&&this.previousStack.pop();0<this.nextStack.length&&(this.nextStack=[],this.onNextChange(null,0))}return !0},this)}},activate:function(){var d=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var c in this.listeners){this.map.events.register(c,this,this.listeners[c])}d=!0;0==this.previousStack.length&&this.initStack()}return d},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var d=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var c in this.listeners){this.map.events.unregister(c,this,this.listeners[c])}this.clearOnDeactivate&&this.clear();d=!0}return d},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(d){d=d||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var c=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(b,e){return c.write(b,e)}}},destroy:function(){this.headers=this.params=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=e||{};e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params);e=OpenLayers.Util.applyDefaults(e,this.options);e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var d=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,f=new OpenLayers.Protocol.Response({requestType:"read"});d?(d=e.headers||{},d["Content-Type"]="application/x-www-form-urlencoded",f.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,f,e),data:OpenLayers.Util.getParameterString(e.params),headers:d})):f.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,f,e),params:e.params,headers:e.headers});return f},handleRead:function(d,c){this.handleResponse(d,c)},create:function(e,d){var d=OpenLayers.Util.applyDefaults(d,this.options),f=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});f.priv=OpenLayers.Request.POST({url:d.url,callback:this.createCallback(this.handleCreate,f,d),headers:d.headers,data:this.format.write(e)});return f},handleCreate:function(d,c){this.handleResponse(d,c)},update:function(f,e){var e=e||{},h=e.url||f.url||this.options.url+"/"+f.fid,e=OpenLayers.Util.applyDefaults(e,this.options),g=new OpenLayers.Protocol.Response({reqFeatures:f,requestType:"update"});g.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"]({url:h,callback:this.createCallback(this.handleUpdate,g,e),headers:e.headers,data:this.format.write(f)});return g},handleUpdate:function(d,c){this.handleResponse(d,c)},"delete":function(g,f){var f=f||{},k=f.url||g.url||this.options.url+"/"+g.fid,f=OpenLayers.Util.applyDefaults(f,this.options),j=new OpenLayers.Protocol.Response({reqFeatures:g,requestType:"delete"}),h=this.deleteWithPOST?"POST":"DELETE",k={url:k,callback:this.createCallback(this.handleDelete,j,f),headers:f.headers};this.deleteWithPOST&&(k.data=this.format.write(g));j.priv=OpenLayers.Request[h](k);return j},handleDelete:function(d,c){this.handleResponse(d,c)},handleResponse:function(e,d){var f=e.priv;d.callback&&(200<=f.status&&300>f.status?("delete"!=e.requestType&&(e.features=this.parseFeatures(f)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,d.callback.call(d.scope,e))},parseFeatures:function(d){var c=d.responseXML;if(!c||!c.documentElement){c=d.responseText}return !c||0>=c.length?null:this.format.read(c)},commit:function(D,C){function B(f){for(var d=f.features?f.features.length:0,h=Array(d),g=0;g<d;++g){h[g]=f.features[g].fid}p.insertIds=h;A.apply(this,[f])}function A(b){this.callUserCallback(b,C);q=q&&b.success();y++;y>=r&&C.callback&&(p.code=q?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,C.callback.apply(C.scope,[p]))}var C=OpenLayers.Util.applyDefaults(C,this.options),z=[],y=0,x={};x[OpenLayers.State.INSERT]=[];x[OpenLayers.State.UPDATE]=[];x[OpenLayers.State.DELETE]=[];for(var w,v,u=[],t=0,s=D.length;t<s;++t){if(w=D[t],v=x[w.state]){v.push(w),u.push(w)}}var r=(0<x[OpenLayers.State.INSERT].length?1:0)+x[OpenLayers.State.UPDATE].length+x[OpenLayers.State.DELETE].length,q=!0,p=new OpenLayers.Protocol.Response({reqFeatures:u});w=x[OpenLayers.State.INSERT];0<w.length&&z.push(this.create(w,OpenLayers.Util.applyDefaults({callback:B,scope:this},C.create)));w=x[OpenLayers.State.UPDATE];for(t=w.length-1;0<=t;--t){z.push(this.update(w[t],OpenLayers.Util.applyDefaults({callback:A,scope:this},C.update)))}w=x[OpenLayers.State.DELETE];for(t=w.length-1;0<=t;--t){z.push(this["delete"](w[t],OpenLayers.Util.applyDefaults({callback:A,scope:this},C["delete"])))}return z},abort:function(b){b&&b.priv.abort()},callUserCallback:function(e,d){var f=d[e.requestType];f&&f.callback&&f.callback.call(f.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this}));return b},cacheFeatures:function(d){var c=!0;this.clustering||(this.clearCache(),this.features=d.features,this.cluster(),c=!1);return c},clearCache:function(){this.features=null},cluster:function(h){if((!h||h.zoomChanged)&&this.features){if(h=this.layer.map.getResolution(),h!=this.resolution||!this.clustersExist()){this.resolution=h;for(var h=[],g,m,l,k=0;k<this.features.length;++k){if(g=this.features[k],g.geometry){m=!1;for(var j=h.length-1;0<=j;--j){if(l=h[j],this.shouldCluster(l,g)){this.addToCluster(l,g);m=!0;break}}m||h.push(this.createCluster(this.features[k]))}}this.layer.removeAllFeatures();if(0<h.length){if(1<this.threshold){g=h.slice();h=[];k=0;for(l=g.length;k<l;++k){m=g[k],m.attributes.count<this.threshold?Array.prototype.push.apply(h,m.cluster):h.push(m)}}this.clustering=!0;this.layer.addFeatures(h);this.clustering=!1}this.clusters=h}}},clustersExist:function(){var d=!1;if(this.clusters&&0<this.clusters.length&&this.clusters.length==this.layer.features.length){for(var d=!0,c=0;c<this.clusters.length;++c){if(this.clusters[c]!=this.layer.features[c]){d=!1;break}}}return d},shouldCluster:function(f,e){var h=f.geometry.getBounds().getCenterLonLat(),g=e.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(h.lon-g.lon,2)+Math.pow(h.lat-g.lat,2))/this.resolution<=this.distance},addToCluster:function(d,c){d.cluster.push(c);d.attributes.count+=1},createCluster:function(d){var c=d.geometry.getBounds().getCenterLonLat(),c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat),{count:1});c.cluster=[d];return c},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var b=OpenLayers.Strategy.prototype.activate.apply(this,arguments);b&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}));return b},deactivate:function(){this.cache=null;this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this});return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(g){if(!this.caching&&this.filter){var f=g.features;g.features=[];for(var k,j=0,h=f.length;j<h;++j){k=f[j],this.filter.evaluate(k)?g.features.push(k):this.cache.push(k)}}},handleRemove:function(){this.caching||(this.cache=[])},setFilter:function(b){this.filter=b;b=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});0<this.cache.length&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1);0<b.length&&(b={features:b},this.handleAdd(b),0<b.features.length&&(this.caching=!0,this.layer.addFeatures(b.features),this.caching=!1))},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Protocol.SOS=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Protocol.SOS.DEFAULTS),c=OpenLayers.Protocol.SOS["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported SOS version: "+d.version}return new c(d)};OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(s,r){var q=[],p={};this.readChildNodes(s,{complexTypes:q,customTypes:p});for(var o=s.attributes,m,l,k=0,j=o.length;k<j;++k){m=o[k],l=m.name,0==l.indexOf("xmlns")?this.setNamespace(l.split(":")[1]||"",m.value):r[l]=m.value}r.featureTypes=q;r.targetPrefix=this.namespaceAlias[r.targetNamespace];k=0;for(j=q.length;k<j;++k){o=q[k],m=p[o.typeName],p[o.typeName]&&(o.typeName=m.name)}},complexType:function(e,d){var f={typeName:e.getAttribute("name")};this.readChildNodes(e,f);d.complexTypes.push(f)},complexContent:function(d,c){this.readChildNodes(d,c)},extension:function(d,c){this.readChildNodes(d,c)},sequence:function(e,d){var f={elements:[]};this.readChildNodes(e,f);d.properties=f.elements},element:function(j,h){if(h.elements){for(var p={},o=j.attributes,m,l=0,k=o.length;l<k;++l){m=o[l],p[m.name]=m.value}o=p.type;o||(o={},this.readChildNodes(j,o),p.restriction=o,p.type=o.base);p.localType=(o.base||o).split(":").pop();h.elements.push(p)}h.complexTypes&&(o=j.getAttribute("type"),p=o.split(":").pop(),h.customTypes[p]={name:j.getAttribute("name"),type:o})},simpleType:function(d,c){this.readChildNodes(d,c)},restriction:function(d,c){c.base=d.getAttribute("base");this.readRestriction(d,c)}}},readRestriction:function(j,h){for(var p=j.childNodes,o,m,l=0,k=p.length;l<k;++l){o=p[l],1==o.nodeType&&(m=o.nodeName.split(":").pop(),o=o.getAttribute("value"),h[m]?("string"==typeof h[m]&&(h[m]=[h[m]]),h[m].push(o)):h[m]=o)}},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(k){var j=this.getElementsByTagNameNS(k,this.georssns,"point"),r=this.getElementsByTagNameNS(k,this.geons,"lat"),q=this.getElementsByTagNameNS(k,this.geons,"long"),p=this.getElementsByTagNameNS(k,this.georssns,"line"),o=this.getElementsByTagNameNS(k,this.georssns,"polygon"),m=this.getElementsByTagNameNS(k,this.georssns,"where"),k=this.getElementsByTagNameNS(k,this.georssns,"box");if(0<j.length||0<r.length&&0<q.length){0<j.length?(r=OpenLayers.String.trim(j[0].firstChild.nodeValue).split(/\s+/),2!=r.length&&(r=OpenLayers.String.trim(j[0].firstChild.nodeValue).split(/\s*,\s*/))):r=[parseFloat(r[0].firstChild.nodeValue),parseFloat(q[0].firstChild.nodeValue)];var l=new OpenLayers.Geometry.Point(r[1],r[0])}else{if(0<p.length){r=OpenLayers.String.trim(this.getChildValue(p[0])).split(/\s+/);q=[];p=0;for(o=r.length;p<o;p+=2){j=new OpenLayers.Geometry.Point(r[p+1],r[p]),q.push(j)}l=new OpenLayers.Geometry.LineString(q)}else{if(0<o.length){r=OpenLayers.String.trim(this.getChildValue(o[0])).split(/\s+/);q=[];p=0;for(o=r.length;p<o;p+=2){j=new OpenLayers.Geometry.Point(r[p+1],r[p]),q.push(j)}l=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(q)])}else{0<m.length?(this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})),l=this.gmlParser.parseFeature(m[0]).geometry):0<k.length&&(r=OpenLayers.String.trim(k[0].firstChild.nodeValue).split(/\s+/),q=[],3<r.length&&(j=new OpenLayers.Geometry.Point(r[1],r[0]),q.push(j),j=new OpenLayers.Geometry.Point(r[1],r[2]),q.push(j),j=new OpenLayers.Geometry.Point(r[3],r[2]),q.push(j),j=new OpenLayers.Geometry.Point(r[3],r[0]),q.push(j),j=new OpenLayers.Geometry.Point(r[1],r[0]),q.push(j)),l=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(q)]))}}}l&&(this.internalProjection&&this.externalProjection)&&l.transform(this.externalProjection,this.internalProjection);return l},createFeatureFromItem:function(h){var g=this.createGeometryFromItem(h),m=this._getChildValue(h,"*","title",this.featureTitle),l=this._getChildValue(h,"*","description",this._getChildValue(h,"*","content",this._getChildValue(h,"*","summary",this.featureDescription))),k=this._getChildValue(h,"*","link");if(!k){try{k=this.getElementsByTagNameNS(h,"*","link")[0].getAttribute("href")}catch(j){k=null}}h=this._getChildValue(h,"*","id",null);g=new OpenLayers.Feature.Vector(g,{title:m,description:l,link:k});g.fid=h;return g},_getChildValue:function(f,e,h,g){return(f=this.getElementsByTagNameNS(f,e,h))&&f[0]&&f[0].firstChild&&f[0].firstChild.nodeValue?this.getChildValue(f[0]):void 0==g?"":g},read:function(f){"string"==typeof f&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));var e=null,e=this.getElementsByTagNameNS(f,"*","item");0==e.length&&(e=this.getElementsByTagNameNS(f,"*","entry"));for(var f=e.length,h=Array(f),g=0;g<f;g++){h[g]=this.createFeatureFromItem(e[g])}return h},write:function(f){var e;if(OpenLayers.Util.isArray(f)){e=this.createElementNS(this.rssns,"rss");for(var h=0,g=f.length;h<g;h++){e.appendChild(this.createFeatureXML(f[h]))}}else{e=this.createFeatureXML(f)}return OpenLayers.Format.XML.prototype.write.apply(this,[e])},createFeatureXML:function(h){var g=this.buildGeometryNode(h.geometry),m=this.createElementNS(this.rssns,"item"),l=this.createElementNS(this.rssns,"title");l.appendChild(this.createTextNode(h.attributes.title?h.attributes.title:""));var k=this.createElementNS(this.rssns,"description");k.appendChild(this.createTextNode(h.attributes.description?h.attributes.description:""));m.appendChild(l);m.appendChild(k);h.attributes.link&&(l=this.createElementNS(this.rssns,"link"),l.appendChild(this.createTextNode(h.attributes.link)),m.appendChild(l));for(var j in h.attributes){"link"==j||("title"==j||"description"==j)||(l=this.createTextNode(h.attributes[j]),k=j,-1!=j.search(":")&&(k=j.split(":")[1]),k=this.createElementNS(this.featureNS,"feature:"+k),k.appendChild(l),m.appendChild(k))}m.appendChild(g);return m},buildGeometryNode:function(d){this.internalProjection&&this.externalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));var c;if("OpenLayers.Geometry.Polygon"==d.CLASS_NAME){c=this.createElementNS(this.georssns,"georss:polygon"),c.appendChild(this.buildCoordinatesNode(d.components[0]))}else{if("OpenLayers.Geometry.LineString"==d.CLASS_NAME){c=this.createElementNS(this.georssns,"georss:line"),c.appendChild(this.buildCoordinatesNode(d))}else{if("OpenLayers.Geometry.Point"==d.CLASS_NAME){c=this.createElementNS(this.georssns,"georss:point"),c.appendChild(this.buildCoordinatesNode(d))}else{throw"Couldn't parse "+d.CLASS_NAME}}}return c},buildCoordinatesNode:function(f){var e=null;f.components&&(e=f.components);if(e){for(var f=e.length,h=Array(f),g=0;g<f;g++){h[g]=e[g].y+" "+e[g].x}e=h.join(" ")}else{e=f.y+" "+f.x}return this.createTextNode(e)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"});OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{wps:{Capabilities:function(d,c){this.readChildNodes(d,c)},ProcessOfferings:function(d,c){c.processOfferings={};this.readChildNodes(d,c.processOfferings)},Process:function(e,d){var f={processVersion:this.getAttributeNS(e,this.namespaces.wps,"processVersion")};this.readChildNodes(e,f);d[f.identifier]=f},Languages:function(d,c){c.languages=[];this.readChildNodes(d,c.languages)},Default:function(e,d){var f={isDefault:!0};this.readChildNodes(e,f);d.push(f)},Supported:function(e,d){var f={};this.readChildNodes(e,f);d.push(f)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerCenter:null,pinchOrigin:null,currentCenter:null,autoActivate:!0,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},activate:function(){var b=OpenLayers.Control.prototype.activate.apply(this,arguments);b&&(this.map.events.on({moveend:this.updateContainerCenter,scope:this}),this.updateContainerCenter());return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.apply(this,arguments);this.map&&this.map.events&&this.map.events.un({moveend:this.updateContainerCenter,scope:this});return b},updateContainerCenter:function(){var b=this.map.layerContainerDiv;this.containerCenter={x:parseInt(b.style.left,10)+50,y:parseInt(b.style.top,10)+50}},pinchStart:function(b){this.currentCenter=this.pinchOrigin=b.xy},pinchMove:function(j,h){var p=h.scale,o=this.containerCenter,m=this.pinchOrigin,l=j.xy,k=Math.round(l.x-m.x+(p-1)*(o.x-m.x)),o=Math.round(l.y-m.y+(p-1)*(o.y-m.y));this.applyTransform("translate("+k+"px, "+o+"px) scale("+p+")");this.currentCenter=l},applyTransform:function(d){var c=this.map.layerContainerDiv.style;c["-webkit-transform"]=d;c["-moz-transform"]=d},pinchDone:function(g,f,k){this.applyTransform("");g=this.map.getZoomForResolution(this.map.getResolution()/k.scale,!0);if(g!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var f=this.map.getResolutionForZoom(g),k=this.map.getLonLatFromPixel(this.pinchOrigin),j=this.currentCenter,h=this.map.getSize();k.lon+=f*(h.w/2-j.x);k.lat-=f*(h.h/2-j.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(k,g)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(b){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom);OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var d={click:this.defaultClick,dblclick:this.defaultDblClick},c=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,d,c);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(b){b.lastTouches&&2==b.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(b){this.map.setCenter(this.map.getLonLatFromViewPortPx(b.xy),this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(b){OpenLayers.Util.extend(this,b);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var d=0,c=this.rules.length;d<c;d++){this.rules[d].destroy()}delete this.rules},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var d=0,f=this.rules.length;d<f;++d){e.rules.push(this.rules[d].clone())}}return new OpenLayers.Style2(e)},CLASS_NAME:"OpenLayers.Style2"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(d,c){OpenLayers.Format.GML.prototype.initialize.apply(this,[d]);this.layer=c;this.layer.featureNS&&(this.featureNS=this.layer.featureNS);this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column);this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(e){var d=this.createElementNS(this.wfsns,"wfs:Transaction");d.setAttribute("version","1.0.0");d.setAttribute("service","WFS");for(var f=0;f<e.length;f++){switch(e[f].state){case OpenLayers.State.INSERT:d.appendChild(this.insert(e[f]));break;case OpenLayers.State.UPDATE:d.appendChild(this.update(e[f]));break;case OpenLayers.State.DELETE:d.appendChild(this.remove(e[f]))}}return OpenLayers.Format.XML.prototype.write.apply(this,[d])},createFeatureXML:function(g){var f=this.buildGeometryNode(g.geometry),k=this.createElementNS(this.featureNS,"feature:"+this.geometryName);k.appendChild(f);f=this.createElementNS(this.featureNS,"feature:"+this.featureName);f.appendChild(k);for(var j in g.attributes){var k=this.createTextNode(g.attributes[j]),h=j;-1!=j.search(":")&&(h=j.split(":")[1]);h=this.createElementNS(this.featureNS,"feature:"+h);h.appendChild(k);f.appendChild(h)}return f},insert:function(d){var c=this.createElementNS(this.wfsns,"wfs:Insert");c.appendChild(this.createFeatureXML(d));return c},update:function(h){h.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var g=this.createElementNS(this.wfsns,"wfs:Update");g.setAttribute("typeName",this.featurePrefix+":"+this.featureName);g.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var m=this.createElementNS(this.wfsns,"wfs:Property"),l=this.createElementNS(this.wfsns,"wfs:Name"),k=this.createTextNode(this.geometryName);l.appendChild(k);m.appendChild(l);l=this.createElementNS(this.wfsns,"wfs:Value");k=this.buildGeometryNode(h.geometry);h.layer&&k.setAttribute("srsName",h.layer.projection.getCode());l.appendChild(k);m.appendChild(l);g.appendChild(m);for(var j in h.attributes){m=this.createElementNS(this.wfsns,"wfs:Property"),l=this.createElementNS(this.wfsns,"wfs:Name"),l.appendChild(this.createTextNode(j)),m.appendChild(l),l=this.createElementNS(this.wfsns,"wfs:Value"),l.appendChild(this.createTextNode(h.attributes[j])),m.appendChild(l),g.appendChild(m)}m=this.createElementNS(this.ogcns,"ogc:Filter");j=this.createElementNS(this.ogcns,"ogc:FeatureId");j.setAttribute("fid",h.fid);m.appendChild(j);g.appendChild(m);return g},remove:function(f){if(!f.fid){return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1}var e=this.createElementNS(this.wfsns,"wfs:Delete");e.setAttribute("typeName",this.featurePrefix+":"+this.featureName);e.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var h=this.createElementNS(this.ogcns,"ogc:Filter"),g=this.createElementNS(this.ogcns,"ogc:FeatureId");g.setAttribute("fid",f.fid);h.appendChild(g);e.appendChild(h);return e},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.priority=f)},VendorOption:function(d,c){c.vendorOptions||(c.vendorOptions={});c.vendorOptions[d.getAttribute("name")]=this.getChildValue(d)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(b){return this.writers.sld._OGCExpression.call(this,"sld:Priority",b)},VendorOption:function(b){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:b.name},value:b.value})},TextSymbolizer:function(d){var c=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.TextSymbolizer.apply(this,arguments);!1!==d.graphic&&(d.externalGraphic||d.graphicName)&&this.writeNode("Graphic",d,c);"priority" in d&&this.writeNode("Priority",d.priority,c);return this.addVendorOptions(c,d)},PointSymbolizer:function(b){return this.addVendorOptions(OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PointSymbolizer.apply(this,arguments),b)},LineSymbolizer:function(b){return this.addVendorOptions(OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.LineSymbolizer.apply(this,arguments),b)},PolygonSymbolizer:function(b){return this.addVendorOptions(OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PolygonSymbolizer.apply(this,arguments),b)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(e,d){if(d.vendorOptions){for(var f in d.vendorOptions){this.writeNode("VendorOption",{name:f,value:d.vendorOptions[f]},e)}}return e},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(e){var d=this.map.getLayerPxFromLonLat({lon:e.bounds.left,lat:e.bounds.top}),f=this.map.getLayerPxFromLonLat({lon:e.bounds.right,lat:e.bounds.bottom});null==f||null==d?e.display(!1):(d=e.draw(d,{w:Math.max(1,f.x-d.x),h:Math.max(1,f.y-d.y)}),e.drawn||(this.div.appendChild(d),e.drawn=!0))},removeMarker:function(b){OpenLayers.Util.removeItem(this.markers,b);null!=b.div&&b.div.parentNode==this.div&&this.div.removeChild(b.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"});OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(d,c){c.service={};this.readChildNodes(d,c.service)},Fees:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.fees=f)},AccessConstraints:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.accessConstraints=f)},OnlineResource:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.onlineResource=f)},Keywords:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.keywords=f.split(", "))},Capability:function(d,c){c.capability={};this.readChildNodes(d,c.capability)},Request:function(d,c){c.request={};this.readChildNodes(d,c.request)},GetFeature:function(d,c){c.getfeature={href:{},formats:[]};this.readChildNodes(d,c.getfeature)},ResultFormat:function(g,f){for(var k=g.childNodes,j,h=0;h<k.length;h++){j=k[h],1==j.nodeType&&f.formats.push(j.nodeName)}},DCPType:function(d,c){this.readChildNodes(d,c)},HTTP:function(d,c){this.readChildNodes(d,c.href)},Get:function(d,c){c.get=d.getAttribute("onlineResource")},Post:function(d,c){c.post=d.getAttribute("onlineResource")},SRS:function(e,d){var f=this.getChildValue(e);f&&(d.srs=f)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var d=e;e&&9==e.nodeType&&(e=e.documentElement);var f={};this.readNode(e,f);void 0===f.service&&(e=new OpenLayers.Format.OGCExceptionReport,f.error=e.read(d));return f},readers:{wms:{Service:function(d,c){c.service={};this.readChildNodes(d,c.service)},Name:function(d,c){c.name=this.getChildValue(d)},Title:function(d,c){c.title=this.getChildValue(d)},Abstract:function(d,c){c["abstract"]=this.getChildValue(d)},BoundingBox:function(d){var c={};c.bbox=[parseFloat(d.getAttribute("minx")),parseFloat(d.getAttribute("miny")),parseFloat(d.getAttribute("maxx")),parseFloat(d.getAttribute("maxy"))];d={x:parseFloat(d.getAttribute("resx")),y:parseFloat(d.getAttribute("resy"))};if(!isNaN(d.x)||!isNaN(d.y)){c.res=d}return c},OnlineResource:function(d,c){c.href=this.getAttributeNS(d,this.namespaces.xlink,"href")},ContactInformation:function(d,c){c.contactInformation={};this.readChildNodes(d,c.contactInformation)},ContactPersonPrimary:function(d,c){c.personPrimary={};this.readChildNodes(d,c.personPrimary)},ContactPerson:function(d,c){c.person=this.getChildValue(d)},ContactOrganization:function(d,c){c.organization=this.getChildValue(d)},ContactPosition:function(d,c){c.position=this.getChildValue(d)},ContactAddress:function(d,c){c.contactAddress={};this.readChildNodes(d,c.contactAddress)},AddressType:function(d,c){c.type=this.getChildValue(d)},Address:function(d,c){c.address=this.getChildValue(d)},City:function(d,c){c.city=this.getChildValue(d)},StateOrProvince:function(d,c){c.stateOrProvince=this.getChildValue(d)},PostCode:function(d,c){c.postcode=this.getChildValue(d)},Country:function(d,c){c.country=this.getChildValue(d)},ContactVoiceTelephone:function(d,c){c.phone=this.getChildValue(d)},ContactFacsimileTelephone:function(d,c){c.fax=this.getChildValue(d)},ContactElectronicMailAddress:function(d,c){c.email=this.getChildValue(d)},Fees:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.fees=f)},AccessConstraints:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.accessConstraints=f)},Capability:function(d,c){c.capability={nestedLayers:[],layers:[]};this.readChildNodes(d,c.capability)},Request:function(d,c){c.request={};this.readChildNodes(d,c.request)},GetCapabilities:function(d,c){c.getcapabilities={formats:[]};this.readChildNodes(d,c.getcapabilities)},Format:function(d,c){OpenLayers.Util.isArray(c.formats)?c.formats.push(this.getChildValue(d)):c.format=this.getChildValue(d)},DCPType:function(d,c){this.readChildNodes(d,c)},HTTP:function(d,c){this.readChildNodes(d,c)},Get:function(d,c){c.get={};this.readChildNodes(d,c.get);c.href||(c.href=c.get.href)},Post:function(d,c){c.post={};this.readChildNodes(d,c.post);c.href||(c.href=c.get.href)},GetMap:function(d,c){c.getmap={formats:[]};this.readChildNodes(d,c.getmap)},GetFeatureInfo:function(d,c){c.getfeatureinfo={formats:[]};this.readChildNodes(d,c.getfeatureinfo)},Exception:function(d,c){c.exception={formats:[]};this.readChildNodes(d,c.exception)},Layer:function(y,x){var w,v;x.capability?(v=x.capability,w=x):v=x;var u=y.getAttributeNode("queryable"),t=u&&u.specified?y.getAttribute("queryable"):null,s=(u=y.getAttributeNode("cascaded"))&&u.specified?y.getAttribute("cascaded"):null,u=(u=y.getAttributeNode("opaque"))&&u.specified?y.getAttribute("opaque"):null,r=y.getAttribute("noSubsets"),q=y.getAttribute("fixedWidth"),p=y.getAttribute("fixedHeight"),o=w||{},m=OpenLayers.Util.extend;w={nestedLayers:[],styles:w?[].concat(w.styles):[],srs:w?m({},o.srs):{},metadataURLs:[],bbox:w?m({},o.bbox):{},llbbox:o.llbbox,dimensions:w?m({},o.dimensions):{},authorityURLs:w?m({},o.authorityURLs):{},identifiers:{},keywords:[],queryable:t&&""!==t?"1"===t||"true"===t:o.queryable||!1,cascaded:null!==s?parseInt(s):o.cascaded||0,opaque:u?"1"===u||"true"===u:o.opaque||!1,noSubsets:null!==r?"1"===r||"true"===r:o.noSubsets||!1,fixedWidth:null!=q?parseInt(q):o.fixedWidth||0,fixedHeight:null!=p?parseInt(p):o.fixedHeight||0,minScale:o.minScale,maxScale:o.maxScale,attribution:o.attribution};x.nestedLayers.push(w);w.capability=v;this.readChildNodes(y,w);delete w.capability;if(w.name&&(t=w.name.split(":"),s=v.request,u=s.getfeatureinfo,0<t.length&&(w.prefix=t[0]),v.layers.push(w),void 0===w.formats&&(w.formats=s.getmap.formats),void 0===w.infoFormats&&u)){w.infoFormats=u.formats}},Attribution:function(d,c){c.attribution={};this.readChildNodes(d,c.attribution)},LogoURL:function(d,c){c.logo={width:d.getAttribute("width"),height:d.getAttribute("height")};this.readChildNodes(d,c.logo)},Style:function(e,d){var f={};d.styles.push(f);this.readChildNodes(e,f)},LegendURL:function(e,d){var f={width:e.getAttribute("width"),height:e.getAttribute("height")};d.legend=f;this.readChildNodes(e,f)},MetadataURL:function(e,d){var f={type:e.getAttribute("type")};d.metadataURLs.push(f);this.readChildNodes(e,f)},DataURL:function(d,c){c.dataURL={};this.readChildNodes(d,c.dataURL)},FeatureListURL:function(d,c){c.featureListURL={};this.readChildNodes(d,c.featureListURL)},AuthorityURL:function(f,e){var h=f.getAttribute("name"),g={};this.readChildNodes(f,g);e.authorityURLs[h]=g.href},Identifier:function(e,d){var f=e.getAttribute("authority");d.identifiers[f]=this.getChildValue(e)},KeywordList:function(d,c){this.readChildNodes(d,c)},SRS:function(d,c){c.srs[this.getChildValue(d)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(d,c){this.readChildNodes(d,c)},LayerLimit:function(d,c){c.layerLimit=parseInt(this.getChildValue(d))},MaxWidth:function(d,c){c.maxWidth=parseInt(this.getChildValue(d))},MaxHeight:function(d,c){c.maxHeight=parseInt(this.getChildValue(d))},BoundingBox:function(e,d){var f=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,d]);f.srs=e.getAttribute("CRS");d.bbox[f.srs]=f},CRS:function(d,c){this.readers.wms.SRS.apply(this,[d,c])},EX_GeographicBoundingBox:function(d,c){c.llbbox=[];this.readChildNodes(d,c.llbbox)},westBoundLongitude:function(d,c){c[0]=this.getChildValue(d)},eastBoundLongitude:function(d,c){c[2]=this.getChildValue(d)},southBoundLatitude:function(d,c){c[1]=this.getChildValue(d)},northBoundLatitude:function(d,c){c[3]=this.getChildValue(d)},MinScaleDenominator:function(d,c){c.maxScale=parseFloat(this.getChildValue(d)).toPrecision(16)},MaxScaleDenominator:function(d,c){c.minScale=parseFloat(this.getChildValue(d)).toPrecision(16)},Dimension:function(e,d){var f={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),"default":e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};d.dimensions[f.name]=f},Keyword:function(e,d){var f={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};d.keywords&&d.keywords.push(f)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(d,c){this.readers.wms.UserDefinedSymbolization.apply(this,[d,c]);c.userSymbols.inlineFeature=1==parseInt(d.getAttribute("InlineFeature"));c.userSymbols.remoteWCS=1==parseInt(d.getAttribute("RemoteWCS"))},DescribeLayer:function(d,c){this.readers.wms.DescribeLayer.apply(this,[d,c])},GetLegendGraphic:function(d,c){this.readers.wms.GetLegendGraphic.apply(this,[d,c])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(f,e,h,g){this.initializeZoomify(h);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[f,e,h,{},g])},initializeZoomify:function(d){var d=d.clone(),c=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize));this.tierSizeInTiles=[c];for(this.tierImageSize=[d];d.w>this.standardTileSize||d.h>this.standardTileSize;){d=new OpenLayers.Size(Math.floor(d.w/2),Math.floor(d.h/2)),c=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize)),this.tierSizeInTiles.push(c),this.tierImageSize.push(d)}this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;this.tileCountUpToTier=[0];for(d=1;d<this.numberOfTiers;d++){this.tileCountUpToTier.push(this.tierSizeInTiles[d-1].w*this.tierSizeInTiles[d-1].h+this.tileCountUpToTier[d-1])}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(b){null==b&&(b=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(e){var e=this.adjustBounds(e),d=this.map.getResolution(),f=Math.round((e.left-this.tileOrigin.lon)/(d*this.tileSize.w)),e=Math.round((this.tileOrigin.lat-e.top)/(d*this.tileSize.h)),d=this.map.getZoom(),f="TileGroup"+Math.floor((f+e*this.tierSizeInTiles[d].w+this.tileCountUpToTier[d])/256)+"/"+d+"-"+f+"-"+e+".jpg",e=this.url;OpenLayers.Util.isArray(e)&&(e=this.selectUrl(f,e));return e+f},getImageSize:function(){if(0<arguments.length){var g=this.adjustBounds(arguments[0]),f=this.map.getResolution(),k=Math.round((g.left-this.tileOrigin.lon)/(f*this.tileSize.w)),g=Math.round((this.tileOrigin.lat-g.top)/(f*this.tileSize.h)),f=this.map.getZoom(),j=this.standardTileSize,h=this.standardTileSize;k==this.tierSizeInTiles[f].w-1&&(j=this.tierImageSize[f].w%this.standardTileSize);g==this.tierSizeInTiles[f].h-1&&(h=this.tierImageSize[f].h%this.standardTileSize);return new OpenLayers.Size(j,h)}return this.tileSize},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},calculateGridLayout:function(j,h,p){var o=p*this.tileSize.w,p=p*this.tileSize.h,m=j.left-h.lon,l=Math.floor(m/o)-this.buffer,j=h.lat-j.top+p,k=Math.floor(j/p)-this.buffer;return{tilelon:o,tilelat:p,tileoffsetlon:h.lon+l*o,tileoffsetlat:h.lat-p*k,tileoffsetx:-(m/o-l)*this.tileSize.w,tileoffsety:(k-j/p)*this.tileSize.h}},CLASS_NAME:"OpenLayers.Layer.Zoomify"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(f,e,h,g){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(null==g||null==g.isBaseLayer){this.isBaseLayer="true"!=this.params.transparent&&!0!=this.params.transparent}},clone:function(b){null==b&&(b=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(d){var d=this.adjustBounds(d),d=[d.left,d.bottom,d.right,d.top],c=this.getImageSize();return this.getFullRequestString({mapext:d,imgext:d,map_size:[c.w,c.h],imgx:c.w/2,imgy:c.h/2,imgxy:[c.w,c.h]})},getFullRequestString:function(h,g){var m=null==g?this.url:g,l=OpenLayers.Util.extend({},this.params),l=OpenLayers.Util.extend(l,h),k=OpenLayers.Util.getParameterString(l);OpenLayers.Util.isArray(m)&&(m=this.selectUrl(k,m));var k=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(m)),j;for(j in l){j.toUpperCase() in k&&delete l[j]}k=OpenLayers.Util.getParameterString(l);l=m;k=k.replace(/,/g,"+");""!=k&&(j=m.charAt(m.length-1),l="&"==j||"?"==j?l+k:-1==m.indexOf("?")?l+("?"+k):l+("&"+k));return l},CLASS_NAME:"OpenLayers.Layer.MapServer"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(g){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var f=document.createStyleSheet(),k="shape rect oval fill stroke imagedata group textbox".split(" "),j=0,h=k.length;j<h;j++){f.addRule("olv\\:"+k[j],"behavior: url(#default#VML); position: absolute; display: inline-block;")}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return !!document.namespaces},setExtent:function(j,h){var p=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),o=this.getResolution(),m=j.left/o|0,o=j.top/o-this.size.h|0;h||!this.offset?(this.offset={x:m,y:o},o=m=0):(m-=this.offset.x,o-=this.offset.y);this.root.coordorigin=m-this.xOffset+" "+o;for(var m=[this.root,this.vectorRoot,this.textRoot],l=0,k=m.length;l<k;++l){o=m[l],o.coordsize=this.size.w+" "+this.size.h}this.root.style.flip="y";return p},setSize:function(j){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var h=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],p=this.size.w+"px",o=this.size.h+"px",m,l=0,k=h.length;l<k;++l){m=h[l],m.style.width=p,m.style.height=o}},getNodeType:function(e,d){var f=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":f=d.externalGraphic?"olv:rect":this.isComplexSymbol(d.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":f="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":f="olv:shape"}return f},setStyle:function(s,r,q,p){var r=r||s._style,q=q||s._options,o=r.fillColor;if("OpenLayers.Geometry.Point"===s._geometryClass){if(r.externalGraphic){q.isFilled=!0;r.graphicTitle&&(s.title=r.graphicTitle);var o=r.graphicWidth||r.graphicHeight,m=r.graphicHeight||r.graphicWidth,o=o?o:2*r.pointRadius,m=m?m:2*r.pointRadius,l=this.getResolution(),k=void 0!=r.graphicXOffset?r.graphicXOffset:-(0.5*o),j=void 0!=r.graphicYOffset?r.graphicYOffset:-(0.5*m);s.style.left=((p.x-this.featureDx)/l-this.offset.x+k|0)+"px";s.style.top=(p.y/l-this.offset.y-(j+m)|0)+"px";s.style.width=o+"px";s.style.height=m+"px";s.style.flip="y";o="none";q.isStroked=!1}else{this.isComplexSymbol(r.graphicName)?(m=this.importSymbol(r.graphicName),s.path=m.path,s.coordorigin=m.left+","+m.bottom,m=m.size,s.coordsize=m+","+m,this.drawCircle(s,p,r.pointRadius),s.style.flip="y"):this.drawCircle(s,p,r.pointRadius)}}q.isFilled?s.fillcolor=o:s.filled="false";p=s.getElementsByTagName("fill");p=0==p.length?null:p[0];if(q.isFilled){p||(p=this.createNode("olv:fill",s.id+"_fill"));p.opacity=r.fillOpacity;if("OpenLayers.Geometry.Point"===s._geometryClass&&r.externalGraphic&&(r.graphicOpacity&&(p.opacity=r.graphicOpacity),p.src=r.externalGraphic,p.type="frame",!r.graphicWidth||!r.graphicHeight)){p.aspect="atmost"}p.parentNode!=s&&s.appendChild(p)}else{p&&s.removeChild(p)}o=r.rotation;if(void 0!==o||void 0!==s._rotation){s._rotation=o,r.externalGraphic?(this.graphicRotate(s,k,j,r),p.opacity=0):"OpenLayers.Geometry.Point"===s._geometryClass&&(s.style.rotation=o||0)}k=s.getElementsByTagName("stroke");k=0==k.length?null:k[0];if(q.isStroked){if(k||(k=this.createNode("olv:stroke",s.id+"_stroke"),s.appendChild(k)),k.on=!0,k.color=r.strokeColor,k.weight=r.strokeWidth+"px",k.opacity=r.strokeOpacity,k.endcap="butt"==r.strokeLinecap?"flat":r.strokeLinecap||"round",r.strokeDashstyle){k.dashstyle=this.dashStyle(r)}}else{s.stroked=!1,k&&(k.on=!1)}"inherit"!=r.cursor&&null!=r.cursor&&(s.style.cursor=r.cursor);return s},graphicRotate:function(w,v,u,t){var t=t||w._style,s=t.rotation||0,r,q;if(!t.graphicWidth||!t.graphicHeight){var p=new Image;p.onreadystatechange=OpenLayers.Function.bind(function(){if("complete"==p.readyState||"interactive"==p.readyState){r=p.width/p.height,q=Math.max(2*t.pointRadius,t.graphicWidth||0,t.graphicHeight||0),v*=r,t.graphicWidth=q*r,t.graphicHeight=q,this.graphicRotate(w,v,u,t)}},this);p.src=t.externalGraphic}else{q=Math.max(t.graphicWidth,t.graphicHeight);r=t.graphicWidth/t.graphicHeight;var o=Math.round(t.graphicWidth||q*r),m=Math.round(t.graphicHeight||q);w.style.width=o+"px";w.style.height=m+"px";var l=document.getElementById(w.id+"_image");l||(l=this.createNode("olv:imagedata",w.id+"_image"),w.appendChild(l));l.style.width=o+"px";l.style.height=m+"px";l.src=t.externalGraphic;l.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";l=s*Math.PI/180;s=Math.sin(l);l=Math.cos(l);s="progid:DXImageTransform.Microsoft.Matrix(M11="+l+",M12="+-s+",M21="+s+",M22="+l+",SizingMethod='auto expand')\n";(l=t.graphicOpacity||t.fillOpacity)&&1!=l&&(s+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+l+")\n");w.style.filter=s;s=new OpenLayers.Geometry.Point(-v,-u);o=(new OpenLayers.Bounds(0,0,o,m)).toGeometry();o.rotate(t.rotation,s);o=o.getBounds();w.style.left=Math.round(parseInt(w.style.left)+o.left)+"px";w.style.top=Math.round(parseInt(w.style.top)-o.bottom)+"px"}},postDraw:function(e){e.style.visibility="visible";var d=e._style.fillColor,f=e._style.strokeColor;"none"==d&&e.fillcolor!=d&&(e.fillcolor=d);"none"==f&&e.strokecolor!=f&&(e.strokecolor=f)},setNodeDimension:function(f,e){var h=e.getBounds();if(h){var g=this.getResolution(),h=new OpenLayers.Bounds((h.left-this.featureDx)/g-this.offset.x|0,h.bottom/g-this.offset.y|0,(h.right-this.featureDx)/g-this.offset.x|0,h.top/g-this.offset.y|0);f.style.left=h.left+"px";f.style.top=h.top+"px";f.style.width=h.getWidth()+"px";f.style.height=h.getHeight()+"px";f.coordorigin=h.left+" "+h.top;f.coordsize=h.getWidth()+" "+h.getHeight()}},dashStyle:function(b){b=b.strokeDashstyle;switch(b){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return b;default:return b=b.split(/[ ,]/),2==b.length?1*b[0]>=2*b[1]?"longdash":1==b[0]||1==b[1]?"dot":"dash":4==b.length?1*b[0]>=2*b[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,d){var f=document.createElement(e);d&&(f.id=d);f.unselectable="on";f.onselectstart=OpenLayers.Function.False;return f},nodeTypeCompare:function(g,f){var k=f,j=k.indexOf(":");-1!=j&&(k=k.substr(j+1));var h=g.nodeName,j=h.indexOf(":");-1!=j&&(h=h.substr(j+1));return k==h},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(b){return this.nodeFactory(this.container.id+b,"olv:group")},drawPoint:function(d,c){return this.drawCircle(d,c,1)},drawCircle:function(f,e,h){if(!isNaN(e.x)&&!isNaN(e.y)){var g=this.getResolution();f.style.left=((e.x-this.featureDx)/g-this.offset.x|0)-h+"px";f.style.top=(e.y/g-this.offset.y|0)-h+"px";e=2*h;f.style.width=e+"px";f.style.height=e+"px";return f}return !1},drawLineString:function(d,c){return this.drawLine(d,c,!1)},drawLinearRing:function(d,c){return this.drawLine(d,c,!0)},drawLine:function(s,r,q){this.setNodeDimension(s,r);for(var p=this.getResolution(),o=r.components.length,m=Array(o),l,k,j=0;j<o;j++){l=r.components[j],k=(l.x-this.featureDx)/p-this.offset.x|0,l=l.y/p-this.offset.y|0,m[j]=" "+k+","+l+" l "}s.path="m"+m.join("")+(q?" x e":" e");return s},drawPolygon:function(B,A){this.setNodeDimension(B,A);var z=this.getResolution(),y=[],x,w,v,u,t,s,r,q,p,o;x=0;for(w=A.components.length;x<w;x++){y.push("m");v=A.components[x].components;u=0===x;s=t=null;r=0;for(q=v.length;r<q;r++){p=v[r],o=(p.x-this.featureDx)/z-this.offset.x|0,p=p.y/z-this.offset.y|0,o=" "+o+","+p,y.push(o),0==r&&y.push(" l"),u||(t?t!=o&&(s?s!=o&&(u=!0):s=o):t=o)}y.push(u?" x ":" ")}y.push("e");B.path=y.join("");return B},drawRectangle:function(e,d){var f=this.getResolution();e.style.left=((d.x-this.featureDx)/f-this.offset.x|0)+"px";e.style.top=(d.y/f-this.offset.y|0)+"px";e.style.width=(d.width/f|0)+"px";e.style.height=(d.height/f|0)+"px";return e},drawText:function(h,g,m){var l=this.nodeFactory(h+this.LABEL_ID_SUFFIX,"olv:rect"),k=this.nodeFactory(h+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),j=this.getResolution();l.style.left=((m.x-this.featureDx)/j-this.offset.x|0)+"px";l.style.top=(m.y/j-this.offset.y|0)+"px";l.style.flip="y";k.innerText=g.label;"inherit"!=g.cursor&&null!=g.cursor&&(k.style.cursor=g.cursor);g.fontColor&&(k.style.color=g.fontColor);g.fontOpacity&&(k.style.filter="alpha(opacity="+100*g.fontOpacity+")");g.fontFamily&&(k.style.fontFamily=g.fontFamily);g.fontSize&&(k.style.fontSize=g.fontSize);g.fontWeight&&(k.style.fontWeight=g.fontWeight);g.fontStyle&&(k.style.fontStyle=g.fontStyle);!0===g.labelSelect&&(l._featureId=h,k._featureId=h,k._geometry=m,k._geometryClass=m.CLASS_NAME);k.style.whiteSpace="nowrap";k.inset="1px,0px,0px,0px";l.parentNode||(l.appendChild(k),this.textRoot.appendChild(l));g=g.labelAlign||"cm";1==g.length&&(g+="m");h=k.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)];k=k.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(1,1)];l.style.left=parseInt(l.style.left)-h-1+"px";l.style.top=parseInt(l.style.top)+k+"px"},moveRoot:function(d){var c=this.map.getLayer(d.container.id);c instanceof OpenLayers.Layer.Vector.RootContainer&&(c=this.map.getLayer(this.container.id));c&&c.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);c&&c.redraw()},importSymbol:function(j){var h=this.container.id+"-"+j,p=this.symbolCache[h];if(p){return p}p=OpenLayers.Renderer.symbol[j];if(!p){throw Error(j+" is not a valid symbol name")}for(var j=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),o=["m"],m=0;m<p.length;m+=2){var l=p[m],k=p[m+1];j.left=Math.min(j.left,l);j.bottom=Math.min(j.bottom,k);j.right=Math.max(j.right,l);j.top=Math.max(j.top,k);o.push(l);o.push(k);0==m&&o.push("l")}o.push("x e");p=o.join(" ");o=(j.getWidth()-j.getHeight())/2;0<o?(j.bottom-=o,j.top+=o):(j.left+=o,j.right-=o);p={path:p,size:j.getWidth(),left:j.left,bottom:j.bottom};return this.symbolCache[h]=p},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);var d,f=this.layers||e.layers;for(d=f.length-1;0<=d;--d){this.addLayer({layer:f[d]})}if(!this.layers){e.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(b){b.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(b){b.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(e){if(this.active&&window.localStorage&&e.tile instanceof OpenLayers.Tile.Image){var d=e.tile,f=d.url;!d.layer.crossOriginKeyword&&(OpenLayers.ProxyHost&&0===f.indexOf(OpenLayers.ProxyHost))&&(f=OpenLayers.Control.CacheWrite.urlMap[f]);if(f=window.localStorage.getItem("olCache_"+f)){d.url=f,"tileerror"===e.type&&d.setImgSrc(f)}}},destroy:function(){if(this.layers||this.map){var d,c=this.layers||this.map.layers;for(d=c.length-1;0<=d;--d){this.removeLayer({layer:c[d]})}}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var d=e.documentElement;if(d){var f=this["read_"+d.nodeName],e=f?f.call(this,d):(new OpenLayers.Format.GML(this.options?this.options:{})).read(e)}return e},read_msGMLOutput:function(s){var r=[];if(s=this.getSiblingNodesByTagCriteria(s,this.layerIdentifier)){for(var q=0,p=s.length;q<p;++q){var o=s[q],m=o.nodeName;o.prefix&&(m=m.split(":")[1]);m=m.replace(this.layerIdentifier,"");if(o=this.getSiblingNodesByTagCriteria(o,this.featureIdentifier)){for(var l=0;l<o.length;l++){var k=o[l],j=this.parseGeometry(k),k=this.parseAttributes(k),k=new OpenLayers.Feature.Vector(j.geometry,k,null);k.bounds=j.bounds;k.type=m;r.push(k)}}}}return r},read_FeatureInfoResponse:function(s){for(var r=[],s=this.getElementsByTagNameNS(s,"*","FIELDS"),q=0,p=s.length;q<p;q++){var o=s[q],m={},l,k=o.attributes.length;if(0<k){for(l=0;l<k;l++){var j=o.attributes[l];m[j.nodeName]=j.nodeValue}}else{o=o.childNodes;l=0;for(k=o.length;l<k;++l){j=o[l],3!=j.nodeType&&(m[j.getAttribute("name")]=j.getAttribute("value"))}}r.push(new OpenLayers.Feature.Vector(null,m,null))}return r},getSiblingNodesByTagCriteria:function(k,j){var r=[],q,p,o,m;if(k&&k.hasChildNodes()){q=k.childNodes;o=q.length;for(var l=0;l<o;l++){for(m=q[l];m&&1!=m.nodeType;){m=m.nextSibling,l++}p=m?m.nodeName:"";0<p.length&&-1<p.indexOf(j)?r.push(m):(p=this.getSiblingNodesByTagCriteria(m,j),0<p.length&&(0==r.length?r=p:r.push(p)))}}return r},parseAttributes:function(h){var g={};if(1==h.nodeType){for(var h=h.childNodes,m=h.length,l=0;l<m;++l){var k=h[l];if(1==k.nodeType){var j=k.childNodes,k=k.prefix?k.nodeName.split(":")[1]:k.nodeName;if(0==j.length){g[k]=null}else{if(1==j.length&&(j=j[0],3==j.nodeType||4==j.nodeType)){j=j.nodeValue.replace(this.regExes.trimSpace,""),g[k]=j}}}}}return g},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var e=this.gmlFormat.parseFeature(e),d,f=null;e&&(d=e.geometry&&e.geometry.clone(),f=e.bounds&&e.bounds.clone(),e.destroy());return{geometry:d,bounds:f}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(b){b=b||{};b.handlerOptions=b.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[b]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(b.formatOptions));!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(b={},b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{}))},getInfoForClick:function(b){this.request(b.xy,{})},getInfoForHover:function(b){this.request(b.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var f=this.layers||this.map.layers,e=[],h,g=f.length-1;0<=g;--g){if(h=f[g],h instanceof OpenLayers.Layer.WMTS&&h.requestEncoding===this.requestEncoding&&(!this.queryVisible||h.getVisibility())){if(e.push(h),!this.drillDown||this.hover){break}}}return e},buildRequestOptions:function(f,e){var h=this.map.getLonLatFromPixel(e),g=f.getURL(new OpenLayers.Bounds(h.lon,h.lat,h.lon,h.lat)),g=OpenLayers.Util.getParameters(g),h=f.getTileInfo(h);OpenLayers.Util.extend(g,{service:"WMTS",version:f.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:h.i,j:h.j});OpenLayers.Util.applyDefaults(g,this.vendorParams);return{url:OpenLayers.Util.isArray(f.url)?f.url[0]:f.url,params:OpenLayers.Util.upperCaseObject(g),callback:function(a){this.handleResponse(e,a,f)},scope:this}},request:function(j,h){var h=h||{},p=this.findLayers();if(0<p.length){for(var o,m,l=0,k=p.length;l<k;l++){m=p[l],o=this.events.triggerEvent("beforegetfeatureinfo",{xy:j,layer:m}),!1!==o&&(++this.pending,o=this.buildRequestOptions(m,j),o=OpenLayers.Request.GET(o),!0===h.hover&&(this.hoverRequest=o))}0<this.pending&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(j,h,p){--this.pending;0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0);if(h.status&&(200>h.status||300<=h.status)){this.events.triggerEvent("exception",{xy:j,request:h,layer:p})}else{var o=h.responseXML;if(!o||!o.documentElement){o=h.responseText}var m,l;try{m=this.format.read(o)}catch(k){l=!0,this.events.triggerEvent("exception",{xy:j,request:h,error:k,layer:p})}l||this.events.triggerEvent("getfeatureinfo",{text:h.responseText,features:m,request:h,xy:j,layer:p})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this})}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this}));return b},cacheFeatures:function(b){this.paging||(this.clearCache(),this.features=b.features,this.pageNext(b))},clearCache:function(){if(this.features){for(var b=0;b<this.features.length;++b){this.features[b].destroy()}}this.num=this.features=null},pageCount:function(){return Math.ceil((this.features?this.features.length:0)/this.length)},pageNum:function(){return this.num},pageLength:function(b){b&&0<b&&(this.length=b);return this.length},pageNext:function(d){var c=!1;this.features&&(null===this.num&&(this.num=-1),c=this.page((this.num+1)*this.length,d));return c},pagePrevious:function(){var b=!1;this.features&&(null===this.num&&(this.num=this.pageCount()),b=this.page((this.num-1)*this.length));return b},page:function(f,e){var h=!1;if(this.features&&0<=f&&f<this.features.length){var g=Math.floor(f/this.length);g!=this.num&&(this.paging=!0,h=this.features.slice(f,f+this.length),this.layer.removeFeatures(this.layer.features),this.num=g,e&&e.features?e.features=h:this.layer.addFeatures(h),this.paging=!1,h=!0)}return h},CLASS_NAME:"OpenLayers.Strategy.Paging"});OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var d=new OpenLayers.Protocol.Response({requestType:"read"}),f=this.format.write(e.params);d.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,d,e),params:e.params,headers:e.headers,data:f});return d},handleRead:function(e,d){if(d.callback){var f=e.priv;200<=f.status&&300>f.status?(e.data=this.parseData(f),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE;d.callback.call(d.scope,e)}},parseData:function(d){var c=d.responseXML;if(!c||!c.documentElement){c=d.responseText}return !c||0>=c.length?null:this.format.read(c)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(d,c){this.readChildNodes(d,c)},Keyword:function(d,c){c.keywords&&c.keywords.push(this.getChildValue(d))},DescribeLayer:function(d,c){c.describelayer={formats:[]};this.readChildNodes(d,c.describelayer)},GetLegendGraphic:function(d,c){c.getlegendgraphic={formats:[]};this.readChildNodes(d,c.getlegendgraphic)},GetStyles:function(d,c){c.getstyles={formats:[]};this.readChildNodes(d,c.getstyles)},PutStyles:function(d,c){c.putstyles={formats:[]};this.readChildNodes(d,c.putstyles)},UserDefinedSymbolization:function(e,d){var f={supportSLD:1==parseInt(e.getAttribute("SupportSLD")),userLayer:1==parseInt(e.getAttribute("UserLayer")),userStyle:1==parseInt(e.getAttribute("UserStyle")),remoteWFS:1==parseInt(e.getAttribute("RemoteWFS"))};d.userSymbols=f},LatLonBoundingBox:function(d,c){c.llbbox=[parseFloat(d.getAttribute("minx")),parseFloat(d.getAttribute("miny")),parseFloat(d.getAttribute("maxx")),parseFloat(d.getAttribute("maxy"))]},BoundingBox:function(e,d){var f=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,d]);f.srs=e.getAttribute("SRS");d.bbox[f.srs]=f},ScaleHint:function(h,g){var m=h.getAttribute("min"),l=h.getAttribute("max"),k=Math.pow(2,0.5),j=OpenLayers.INCHES_PER_UNIT.m;g.maxScale=parseFloat((m/k*j*OpenLayers.DOTS_PER_INCH).toPrecision(13));g.minScale=parseFloat((l/k*j*OpenLayers.DOTS_PER_INCH).toPrecision(13))},Dimension:function(e,d){var f={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};d.dimensions[f.name]=f},Extent:function(f,e){var h=f.getAttribute("name").toLowerCase();if(h in e.dimensions){h=e.dimensions[h];h.nearestVal="1"===f.getAttribute("nearestValue");h.multipleVal="1"===f.getAttribute("multipleValues");h.current="1"===f.getAttribute("current");h["default"]=f.getAttribute("default")||"";var g=this.getChildValue(f);h.values=g.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,0.5,0.2,0.1,0.05,0.01,0.005,0.002,0.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:0.5},labelSymbolizer:{},gratLayer:null,initialize:function(b){b=b||{};b.layerName=b.layerName||OpenLayers.i18n("Graticule");OpenLayers.Control.prototype.initialize.apply(this,[b]);this.labelSymbolizer.stroke=!1;this.labelSymbolizer.fill=!1;this.labelSymbolizer.label="${label}";this.labelSymbolizer.labelAlign="${labelAlign}";this.labelSymbolizer.labelXOffset="${xOffset}";this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.gratLayer){var b=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":b}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var B=this.map.getExtent();if(B){this.gratLayer.destroyFeatures();var A=new OpenLayers.Projection("EPSG:4326"),z=this.map.getProjectionObject(),y=this.map.getResolution();z.proj&&"longlat"==z.proj.projName&&(this.numPoints=1);var x=this.map.getCenter(),w=new OpenLayers.Pixel(x.lon,x.lat);OpenLayers.Projection.transform(w,z,A);for(var x=this.targetSize*y,x=x*x,v,y=0;y<this.intervals.length;++y){v=this.intervals[y];var u=v/2,t=w.offset({x:-u,y:-u}),u=w.offset({x:u,y:u});OpenLayers.Projection.transform(t,A,z);OpenLayers.Projection.transform(u,A,z);if((t.x-u.x)*(t.x-u.x)+(t.y-u.y)*(t.y-u.y)<=x){break}}w.x=Math.floor(w.x/v)*v;w.y=Math.floor(w.y/v)*v;var y=0,x=[w.clone()],u=w.clone(),s;do{u=u.offset({x:0,y:v}),s=OpenLayers.Projection.transform(u.clone(),A,z),x.unshift(u)}while(B.containsPixel(s)&&1000>++y);u=w.clone();do{u=u.offset({x:0,y:-v}),s=OpenLayers.Projection.transform(u.clone(),A,z),x.push(u)}while(B.containsPixel(s)&&1000>++y);y=0;t=[w.clone()];u=w.clone();do{u=u.offset({x:-v,y:0}),s=OpenLayers.Projection.transform(u.clone(),A,z),t.unshift(u)}while(B.containsPixel(s)&&1000>++y);u=w.clone();do{u=u.offset({x:v,y:0}),s=OpenLayers.Projection.transform(u.clone(),A,z),t.push(u)}while(B.containsPixel(s)&&1000>++y);v=[];for(y=0;y<t.length;++y){s=t[y].x;for(var w=[],r=null,q=Math.min(x[0].y,90),u=Math.max(x[x.length-1].y,-90),p=(q-u)/this.numPoints,q=u,u=0;u<=this.numPoints;++u){var o=new OpenLayers.Geometry.Point(s,q);o.transform(A,z);w.push(o);q+=p;o.y>=B.bottom&&!r&&(r=o)}this.labelled&&(r=new OpenLayers.Geometry.Point(r.x,B.bottom),s={value:s,label:this.labelled?OpenLayers.Util.getFormattedLonLat(s,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(r,s)));w=new OpenLayers.Geometry.LineString(w);v.push(new OpenLayers.Feature.Vector(w))}for(u=0;u<x.length;++u){if(q=x[u].y,!(-90>q||90<q)){w=[];y=t[0].x;p=(t[t.length-1].x-y)/this.numPoints;s=y;r=null;for(y=0;y<=this.numPoints;++y){o=new OpenLayers.Geometry.Point(s,q),o.transform(A,z),w.push(o),s+=p,o.x<B.right&&(r=o)}this.labelled&&(r=new OpenLayers.Geometry.Point(B.right,r.y),s={value:q,label:this.labelled?OpenLayers.Util.getFormattedLonLat(q,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(r,s)));w=new OpenLayers.Geometry.LineString(w);v.push(new OpenLayers.Feature.Vector(w))}}this.gratLayer.addFeatures(v)}},CLASS_NAME:"OpenLayers.Control.Graticule"});OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(b){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[b.name,b.url,{},b]);this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},clone:function(b){null==b&&(b=new OpenLayers.Layer.UTFGrid(this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getFeatureInfo:function(d){var c=null,d=this.getTileData(d);d.tile&&(c=d.tile.getFeatureInfo(d.i,d.j));return c},getFeatureId:function(d){var c=null,d=this.getTileData(d);d.tile&&(c=d.tile.getFeatureId(d.i,d.j));return c},CLASS_NAME:"OpenLayers.Layer.UTFGrid"});OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(s,r,q){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0]));if(this.layerInfo){var p=this.layerInfo,o=new OpenLayers.Bounds(p.fullExtent.xmin,p.fullExtent.ymin,p.fullExtent.xmax,p.fullExtent.ymax);this.projection="EPSG:"+p.spatialReference.wkid;this.sphericalMercator=102100==p.spatialReference.wkid;this.units="esriFeet"==p.units?"ft":"m";if(p.tileInfo){this.tileSize=new OpenLayers.Size(p.tileInfo.width||p.tileInfo.cols,p.tileInfo.height||p.tileInfo.rows);this.tileOrigin=new OpenLayers.LonLat(p.tileInfo.origin.x,p.tileInfo.origin.y);var m=new OpenLayers.Geometry.Point(o.left,o.top),o=new OpenLayers.Geometry.Point(o.right,o.bottom);this.useScales?this.scales=[]:this.resolutions=[];this.lods=[];for(var l in p.tileInfo.lods){if(p.tileInfo.lods.hasOwnProperty(l)){var k=p.tileInfo.lods[l];this.useScales?this.scales.push(k.scale):this.resolutions.push(k.resolution);var j=this.getContainingTileCoords(m,k.resolution);k.startTileCol=j.x;k.startTileRow=j.y;j=this.getContainingTileCoords(o,k.resolution);k.endTileCol=j.x;k.endTileRow=j.y;this.lods.push(k)}}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);this.serverResolutions=this.resolutions;this.overrideDPI&&p.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=p.tileInfo.dpi)}}},getContainingTileCoords:function(d,c){return new OpenLayers.Pixel(Math.max(Math.floor((d.x-this.tileOrigin.lon)/(this.tileSize.w*c)),0),Math.max(Math.floor((this.tileOrigin.lat-d.y)/(this.tileSize.h*c)),0))},calculateMaxExtentWithLOD:function(e){var d=this.tileOrigin.lon+e.startTileCol*this.tileSize.w*e.resolution,f=this.tileOrigin.lat-e.startTileRow*this.tileSize.h*e.resolution;return new OpenLayers.Bounds(d,f-(e.endTileRow-e.startTileRow+1)*this.tileSize.h*e.resolution,d+(e.endTileCol-e.startTileCol+1)*this.tileSize.w*e.resolution,f)},calculateMaxExtentWithExtent:function(f,e){var h=new OpenLayers.Geometry.Point(f.left,f.top),g=new OpenLayers.Geometry.Point(f.right,f.bottom),h=this.getContainingTileCoords(h,e),g=this.getContainingTileCoords(g,e);return this.calculateMaxExtentWithLOD({resolution:e,startTileCol:h.x,startTileRow:h.y,endTileCol:g.x,endTileRow:g.y})},getUpperLeftTileCoord:function(b){return this.getContainingTileCoords(new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top),b)},getLowerRightTileCoord:function(b){return this.getContainingTileCoords(new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom),b)},getMaxExtentForResolution:function(g){var f=this.getUpperLeftTileCoord(g),k=this.getLowerRightTileCoord(g),j=this.tileOrigin.lon+f.x*this.tileSize.w*g,h=this.tileOrigin.lat-f.y*this.tileSize.h*g;return new OpenLayers.Bounds(j,h-(k.y-f.y+1)*this.tileSize.h*g,j+(k.x-f.x+1)*this.tileSize.w*g,h)},clone:function(b){null==b&&(b=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options));return OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},getMaxExtent:function(){return this.maxExtent=this.getMaxExtentForResolution(this.map.getResolution())},getTileOrigin:function(){var b=this.getMaxExtent();return new OpenLayers.LonLat(b.left,b.bottom)},getURL:function(g){var f=this.getResolution(),k=this.tileOrigin.lon+f*this.tileSize.w/2,j=this.tileOrigin.lat-f*this.tileSize.h/2,g=g.getCenterLonLat(),k=Math.round(Math.abs((g.lon-k)/(f*this.tileSize.w))),j=Math.round(Math.abs((j-g.lat)/(f*this.tileSize.h))),g=this.map.getZoom();if(this.lods){if(f=this.lods[this.map.getZoom()],k<f.startTileCol||k>f.endTileCol||j<f.startTileRow||j>f.endTileRow){return null}}else{var h=this.getUpperLeftTileCoord(f),f=this.getLowerRightTileCoord(f);if(k<h.x||k>=f.x||j<h.y||j>=f.y){return null}}f=this.url;h=""+k+j+g;OpenLayers.Util.isArray(f)&&(f=this.selectUrl(h,f));this.useArcGISServer?f+="/tile/${z}/${y}/${x}":(k="C"+this.zeroPad(k,8,16),j="R"+this.zeroPad(j,8,16),g="L"+this.zeroPad(g,2,16),f=f+"/${z}/${y}/${x}."+this.type);f=OpenLayers.String.format(f,{x:k,y:j,z:g});return OpenLayers.Util.urlAppend(f,OpenLayers.Util.getParameterString(this.params))},zeroPad:function(e,d,f){for(e=e.toString(f||10);e.length<d;){e="0"+e}return e},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,initialize:function(b){b=b||{};b.handlerOptions=b.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[b]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(b.formatOptions));!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(b={},b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{}))},getInfoForClick:function(b){this.events.triggerEvent("beforegetfeatureinfo",{xy:b.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(b.xy,{})},getInfoForHover:function(b){this.events.triggerEvent("beforegetfeatureinfo",{xy:b.xy});this.request(b.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var g=this.layers||this.map.layers,f=[],k,j,h=g.length-1;0<=h;--h){if(k=g[h],k instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||k.getVisibility())){j=OpenLayers.Util.isArray(k.url)?k.url[0]:k.url,!1===this.drillDown&&!this.url&&(this.url=j),(!0===this.drillDown||this.urlMatches(j))&&f.push(k)}}return f},urlMatches:function(f){var e=OpenLayers.Util.isEquivalentUrl(this.url,f);if(!e&&this.layerUrls){for(var h=0,g=this.layerUrls.length;h<g;++h){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[h],f)){e=!0;break}}}return e},buildWMSOptions:function(k,j,r,q){for(var p=[],o=[],m=0,l=j.length;m<l;m++){null!=j[m].params.LAYERS&&(p=p.concat(j[m].params.LAYERS),o=o.concat(this.getStyleNames(j[m])))}j=j[0];m=this.map.getProjection();(l=j.projection)&&l.equals(this.map.getProjectionObject())&&(m=l.getCode());q=OpenLayers.Util.extend({service:"WMS",version:j.params.VERSION,request:"GetFeatureInfo",exceptions:j.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,j.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:q,info_format:j.params.INFO_FORMAT||this.infoFormat},1.3<=parseFloat(j.params.VERSION)?{crs:m,i:parseInt(r.x),j:parseInt(r.y)}:{srs:m,x:parseInt(r.x),y:parseInt(r.y)});0!=p.length&&(q=OpenLayers.Util.extend({layers:p,query_layers:p,styles:o},q));OpenLayers.Util.applyDefaults(q,this.vendorParams);return{url:k,params:OpenLayers.Util.upperCaseObject(q),callback:function(a){this.handleResponse(r,a,k)},scope:this}},getStyleNames:function(b){return b.params.STYLES?b.params.STYLES:OpenLayers.Util.isArray(b.params.LAYERS)?Array(b.params.LAYERS.length):b.params.LAYERS.replace(/[^,]/g,"")},request:function(k,j){var r=this.findLayers();if(0==r.length){this.events.triggerEvent("nogetfeatureinfo"),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}else{if(j=j||{},!1===this.drillDown){var r=this.buildWMSOptions(this.url,r,k,r[0].params.FORMAT),q=OpenLayers.Request.GET(r);!0===j.hover&&(this.hoverRequest=q)}else{this._numRequests=this._requestCount=0;this.features=[];for(var q={},p,o=0,m=r.length;o<m;o++){var l=r[o];p=OpenLayers.Util.isArray(l.url)?l.url[0]:l.url;p in q?q[p].push(l):(this._numRequests++,q[p]=[l])}for(p in q){r=q[p],r=this.buildWMSOptions(p,r,k,r[0].params.FORMAT),OpenLayers.Request.GET(r)}}}},triggerGetFeatureInfo:function(e,d,f){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:f,request:e,xy:d});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(f,e,h){var g=e.responseXML;if(!g||!g.documentElement){g=e.responseText}g=this.format.read(g);!1===this.drillDown?this.triggerGetFeatureInfo(e,f,g):(this._requestCount++,this._features="object"===this.output?(this._features||[]).concat({url:h,features:g}):(this._features||[]).concat(g),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(e,f,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(g){"string"==typeof g&&(g=OpenLayers.Format.XML.prototype.read.apply(this,[g]));g&&9==g.nodeType&&(g=g.documentElement);var f={features:[]};this.readNode(g,f);for(var g=[],k=0,j=f.features.length;k<j;k++){var h=f.features[k];this.internalProjection&&(this.externalProjection&&h.components[0])&&h.components[0].transform(this.externalProjection,this.internalProjection);h=new OpenLayers.Feature.Vector(h.components[0],h.attributes);g.push(h)}return g},readers:{sa:{SamplingPoint:function(e,d){if(!d.attributes){var f={attributes:{}};d.features.push(f);d=f}d.attributes.id=this.getAttributeNS(e,this.namespaces.gml,"id");this.readChildNodes(e,d)},position:function(d,c){this.readChildNodes(d,c)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(d,c){this.readChildNodes(d,c)},featureMember:function(e,d){var f={attributes:{}};d.features.push(f);this.readChildNodes(e,f)},name:function(d,c){c.attributes.name=this.getChildValue(d)},pos:function(d,c){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(d.getAttribute("srsName")));OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[d,c])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(f){for(var e=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),h=0,g=f.fois.length;h<g;h++){this.writeNode("FeatureOfInterestId",{foi:f.fois[h]},e)}return e},FeatureOfInterestId:function(b){return this.createElementNSPlus("FeatureOfInterestId",{value:b.foi})}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"});OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={measurements:[],observations:[]};this.readNode(d,c);return c},write:function(b){b=this.writeNode("sos:GetObservation",b);b.setAttribute("xmlns:om",this.namespaces.om);b.setAttribute("xmlns:ogc",this.namespaces.ogc);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},readers:{om:{ObservationCollection:function(d,c){c.id=this.getAttributeNS(d,this.namespaces.gml,"id");this.readChildNodes(d,c)},member:function(d,c){this.readChildNodes(d,c)},Measurement:function(e,d){var f={};d.measurements.push(f);this.readChildNodes(e,f)},Observation:function(e,d){var f={};d.observations.push(f);this.readChildNodes(e,f)},samplingTime:function(e,d){var f={};d.samplingTime=f;this.readChildNodes(e,f)},observedProperty:function(d,c){c.observedProperty=this.getAttributeNS(d,this.namespaces.xlink,"href");this.readChildNodes(d,c)},procedure:function(d,c){c.procedure=this.getAttributeNS(d,this.namespaces.xlink,"href");this.readChildNodes(d,c)},featureOfInterest:function(j,h){var p={features:[]};h.fois=[];h.fois.push(p);this.readChildNodes(j,p);for(var o=[],m=0,l=p.features.length;m<l;m++){var k=p.features[m];o.push(new OpenLayers.Feature.Vector(k.components[0],k.attributes))}p.features=o},result:function(e,d){var f={};d.result=f;""!==this.getChildValue(e)?(f.value=this.getChildValue(e),f.uom=e.getAttribute("uom")):this.readChildNodes(e,f)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(e,d){var f={};d.timeInstant=f;this.readChildNodes(e,f)},timePosition:function(d,c){c.timePosition=this.getChildValue(d)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(f){var e=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",f,e);f.eventTime&&this.writeNode("eventTime",f,e);for(var h in f.procedures){this.writeNode("procedure",f.procedures[h],e)}for(var g in f.observedProperties){this.writeNode("observedProperty",f.observedProperties[g],e)}f.foi&&this.writeNode("featureOfInterest",f.foi,e);this.writeNode("responseFormat",f,e);f.resultModel&&this.writeNode("resultModel",f,e);f.responseMode&&this.writeNode("responseMode",f,e);return e},featureOfInterest:function(d){var c=this.createElementNSPlus("featureOfInterest");this.writeNode("ObjectID",d.objectId,c);return c},ObjectID:function(b){return this.createElementNSPlus("ObjectID",{value:b})},responseFormat:function(b){return this.createElementNSPlus("responseFormat",{value:b.responseFormat})},procedure:function(b){return this.createElementNSPlus("procedure",{value:b})},offering:function(b){return this.createElementNSPlus("offering",{value:b.offering})},observedProperty:function(b){return this.createElementNSPlus("observedProperty",{value:b})},eventTime:function(d){var c=this.createElementNSPlus("eventTime");"latest"===d.eventTime&&this.writeNode("ogc:TM_Equals",d,c);return c},resultModel:function(b){return this.createElementNSPlus("resultModel",{value:b.resultModel})},responseMode:function(b){return this.createElementNSPlus("responseMode",{value:b.responseMode})}},ogc:{TM_Equals:function(d){var c=this.createElementNSPlus("ogc:TM_Equals");this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},c);"latest"===d.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},c);return c},PropertyName:function(b){return this.createElementNSPlus("ogc:PropertyName",{value:b.property})}},gml:{TimeInstant:function(d){var c=this.createElementNSPlus("gml:TimeInstant");this.writeNode("gml:timePosition",d,c);return c},timePosition:function(b){return this.createElementNSPlus("gml:timePosition",{value:b.value})}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"});OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(b){this.handlerMode=b;this.resetHandler()},resetHandler:function(){this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null);"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions));return this.handler?!0:!1},initialize:function(b){b=b||{};b.handlerOptions=b.handlerOptions||this.defaultHandlerOptions;OpenLayers.Control.prototype.initialize.apply(this,[b]);this.resetHandler()},handleEvent:function(k){if(null==k){this.reset()}else{var j=this.map.getLonLatFromPixel(k.xy);if(j){var r=this.findLayers();if(0<r.length){for(var q={},p,o,m=0,l=r.length;m<l;m++){p=r[m],o=OpenLayers.Util.indexOf(this.map.layers,p),q[o]=p.getFeatureInfo(j)}this.callback(q,j,k.xy)}}}},callback:function(){},reset:function(){this.callback(null)},findLayers:function(){for(var f=this.layers||this.map.layers,e=[],h,g=f.length-1;0<=g;--g){h=f[g],h instanceof OpenLayers.Layer.UTFGrid&&e.push(h)}return e},CLASS_NAME:"OpenLayers.Control.UTFGrid"});OpenLayers.Format.CQL=function(){function s(f){function d(){var b=u.pop();switch(b.type){case"LOGICAL":var y=d(),x=d();return new OpenLayers.Filter.Logical({filters:[x,y],type:m[b.text.toUpperCase()]});case"NOT":return y=d(),new OpenLayers.Filter.Logical({filters:[y],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":return u.pop(),x=d(),b=d(),y=d(),new OpenLayers.Filter.Comparison({property:y,lowerBoundary:b,upperBoundary:x,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":return x=d(),y=d(),new OpenLayers.Filter.Comparison({property:y,value:x,type:p[b.text.toUpperCase()]});case"VALUE":return/^'.*'$/.test(b.text)?b.text.substr(1,b.text.length-2):Number(b.text);case"SPATIAL":switch(b.text.toUpperCase()){case"BBOX":var y=d(),b=d(),x=d(),w=d(),e=d();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:e,value:OpenLayers.Bounds.fromArray([w,x,b,y])});case"INTERSECTS":return x=d(),y=d(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:y,value:x});case"WITHIN":return x=d(),y=d(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:y,value:x});case"CONTAINS":return x=d(),y=d(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:y,value:x});case"DWITHIN":return b=d(),x=d(),y=d(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:x,property:y,distance:Number(b)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(b.text);default:return b.text}}for(var v=[],u=[];f.length;){var t=f.shift();switch(t.type){case"PROPERTY":case"GEOMETRY":case"VALUE":u.push(t);break;case"COMPARISON":case"BETWEEN":case"LOGICAL":for(var h=k[t.type];0<v.length&&k[v[v.length-1].type]<=h;){u.push(v.pop())}v.push(t);break;case"SPATIAL":case"NOT":case"LPAREN":v.push(t);break;case"RPAREN":for(;0<v.length&&"LPAREN"!=v[v.length-1].type;){u.push(v.pop())}v.pop();0<v.length&&"SPATIAL"==v[v.length-1].type&&u.push(v.pop());case"COMMA":case"END":break;default:throw Error("Unknown token type "+t.type)}}for(;0<v.length;){u.push(v.pop())}f=d();if(0<u.length){f="Remaining tokens after building AST: \n";for(v=u.length-1;0<=v;v--){f+=u[v].type+": "+u[v].text+"\n"}throw Error(f)}return f}var r={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('\w+'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(f){var e=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(f);if(e){var h=f.length,e=f.indexOf("(",e[0].length);if(-1<e){for(var g=1;e<h&&0<g;){switch(e++,f.charAt(e)){case"(":g++;break;case")":g--}}}return[f.substr(0,e+1)]}},END:/^$/},q={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA"],BETWEEN:["VALUE"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},p={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN},o={},m={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},l={},k={RPAREN:3,LOGICAL:2,COMPARISON:1},j;for(j in p){p.hasOwnProperty(j)&&(o[p[j]]=j)}for(j in m){m.hasOwnProperty(j)&&(l[m[j]]=j)}return OpenLayers.Class(OpenLayers.Format,{read:function(w){var v=w,w=[],t,c=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{s:{t=c;for(var b=void 0,c=void 0,a=t.length,b=0;b<a;b++){var c=t[b],u=r[c] instanceof RegExp?r[c].exec(v):(0,r[c])(v);if(u){t=u[0];v=v.substr(t.length).replace(/^\s*/,"");t={type:c,text:t,remainder:v};break s}}w="ERROR: In parsing: ["+v+"], expected one of: ";for(b=0;b<a;b++){c=t[b],w+="\n    "+c+": "+r[c]}throw Error(w)}v=t.remainder;c=q[t.type];if("END"!=t.type&&!c){throw Error("No follows list for "+t.type)}w.push(t)}while("END"!=t.type);w=s(w);this.keepData&&(this.data=w);return w},write:function(f){if(f instanceof OpenLayers.Geometry){return f.toString()}switch(f.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(f.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+f.property+","+f.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+f.property+", "+this.write(f.value)+", "+f.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+f.property+", "+this.write(f.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+f.property+", "+this.write(f.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+f.property+", "+this.write(f.value)+")";default:throw Error("Unknown spatial filter type: "+f.type)}case"OpenLayers.Filter.Logical":if(f.type==OpenLayers.Filter.Logical.NOT){return"NOT ("+this.write(f.filters[0])+")"}for(var e="(",h=!0,g=0;g<f.filters.length;g++){h?h=!1:e+=") "+l[f.type]+" (",e+=this.write(f.filters[g])}return e+")";case"OpenLayers.Filter.Comparison":return f.type==OpenLayers.Filter.Comparison.BETWEEN?f.property+" BETWEEN "+this.write(f.lowerBoundary)+" AND "+this.write(f.upperBoundary):f.property+" "+o[f.type]+" "+this.write(f.value);case void 0:if("string"===typeof f){return"'"+f+"'"}if("number"===typeof f){return""+f}default:throw Error("Can't encode: "+f.CLASS_NAME+" "+f)}},CLASS_NAME:"OpenLayers.Format.CQL"})}();OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.options=b||{};this.options.source&&this.setSource(this.options.source)},setSource:function(b){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=b,this.activate()):this.source=b},activate:function(){var b=OpenLayers.Control.prototype.activate.call(this);if(b){if(this.source){if(this.source.events){this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}else{this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(c){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(c)})}},{layerOptions:this.sourceOptions})),this.handler.activate()}}return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.call(this);b&&this.source&&this.source.events&&this.layer.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this});return b},onSketchComplete:function(b){this.feature=null;return !this.considerSplit(b.feature)},afterFeatureModified:function(b){b.modified&&"function"===typeof b.feature.geometry.split&&(this.feature=b.feature,this.considerSplit(b.feature))},removeByGeometry:function(f,e){for(var h=0,g=f.length;h<g;++h){if(f[h].geometry===e){f.splice(h,1);break}}},isEligible:function(b){return b.geometry?b.state!==OpenLayers.State.DELETE&&"function"===typeof b.geometry.split&&this.feature!==b&&(!this.targetFilter||this.targetFilter.evaluate(b.attributes)):!1},considerSplit:function(J){var I=!1,H=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(J.attributes)){for(var G=this.layer&&this.layer.features||[],F,E,D=[],C=[],B=this.layer===this.source&&this.mutual,A={edge:this.edge,tolerance:this.tolerance,mutual:B},z=[J.geometry],y,x,w,v=0,u=G.length;v<u;++v){if(y=G[v],this.isEligible(y)){x=[y.geometry];for(var t=0;t<z.length;++t){w=z[t];for(var s=0;s<x.length;++s){if(F=x[s],w.getBounds().intersectsBounds(F.getBounds())&&(F=w.split(F,A))){if(E=this.events.triggerEvent("beforesplit",{source:J,target:y}),!1!==E&&(B&&(E=F[0],1<E.length&&(E.unshift(t,1),Array.prototype.splice.apply(z,E),t+=E.length-3),F=F[1]),1<F.length)){F.unshift(s,1),Array.prototype.splice.apply(x,F),s+=F.length-3}}}}x&&1<x.length&&(this.geomsToFeatures(y,x),this.events.triggerEvent("split",{original:y,features:x}),Array.prototype.push.apply(D,x),C.push(y),H=!0)}}z&&1<z.length&&(this.geomsToFeatures(J,z),this.events.triggerEvent("split",{original:J,features:z}),Array.prototype.push.apply(D,z),C.push(J),I=!0);if(I||H){if(this.deferDelete){G=[];v=0;for(u=C.length;v<u;++v){H=C[v],H.state===OpenLayers.State.INSERT?G.push(H):(H.state=OpenLayers.State.DELETE,this.layer.drawFeature(H))}this.layer.destroyFeatures(G,{silent:!0});v=0;for(u=D.length;v<u;++v){D[v].state=OpenLayers.State.INSERT}}else{this.layer.destroyFeatures(C,{silent:!0})}this.layer.addFeatures(D,{silent:!0});this.events.triggerEvent("aftersplit",{source:J,features:D})}}return I},geomsToFeatures:function(h,g){var m=h.clone();delete m.geometry;for(var l,k=0,j=g.length;k<j;++k){l=m.clone(),l.geometry=g[k],l.state=OpenLayers.State.INSERT,g[k]=l}},destroy:function(){this.active&&this.deactivate();OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var d={url:!0,layer:!0,style:!0,matrixSet:!0},f;for(f in d){if(!(f in e)){throw Error("Missing property '"+f+"' in layer configuration.")}}e.params=OpenLayers.Util.upperCaseObject(e.params);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e.name,e.url,e.params,e]);this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop());if(this.matrixIds&&(e=this.matrixIds.length)&&"string"===typeof this.matrixIds[0]){d=this.matrixIds;this.matrixIds=Array(e);for(f=0;f<e;++f){this.matrixIds[f]={identifier:d[f]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.updateMatrixProperties()},updateMatrixProperties:function(){if(this.matrix=this.getMatrix()){if(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),!this.tileFullExtent){this.tileFullExtent=this.maxExtent}}},moveTo:function(e,d,f){(d||!this.matrix)&&this.updateMatrixProperties();return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.WMTS(this.options));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var h;if(!this.matrixIds||0===this.matrixIds.length){h={identifier:this.getIdentifier()}}else{if("scaleDenominator" in this.matrixIds[0]){for(var g=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/0.00028,m=Number.POSITIVE_INFINITY,l,k=0,j=this.matrixIds.length;k<j;++k){l=Math.abs(1-this.matrixIds[k].scaleDenominator/g),l<m&&(m=l,h=this.matrixIds[k])}}else{h=this.matrixIds[this.getIdentifier()]}}return h},getTileInfo:function(f){var e=this.getServerResolution(),h=(f.lon-this.tileOrigin.lon)/(e*this.tileSize.w),f=(this.tileOrigin.lat-f.lat)/(e*this.tileSize.h),e=Math.floor(h),g=Math.floor(f);return{col:e,row:g,i:Math.floor((h-e)*this.tileSize.w),j:Math.floor((f-g)*this.tileSize.h)}},getURL:function(h){var h=this.adjustBounds(h),g="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(h)){var m=this.getTileInfo(h.getCenterLonLat()),h=this.dimensions;if("REST"===this.requestEncoding.toUpperCase()){if(g=this.params,"string"===typeof this.url&&-1!==this.url.indexOf("{")){var l=this.url.replace(/\{/g,"${"),m={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:m.row,TileCol:m.col};if(h){var k,j;for(j=h.length-1;0<=j;--j){k=h[j],m[k]=g[k.toUpperCase()]}}g=OpenLayers.String.format(l,m)}else{l=this.version+"/"+this.layer+"/"+this.style+"/";if(h){for(j=0;j<h.length;j++){g[h[j]]&&(l=l+g[h[j]]+"/")}}l=l+this.matrixSet+"/"+this.matrix.identifier+"/"+m.row+"/"+m.col+"."+this.formatSuffix;g=OpenLayers.Util.isArray(this.url)?this.selectUrl(l,this.url):this.url;g.match(/\/$/)||(g+="/");g+=l}}else{"KVP"===this.requestEncoding.toUpperCase()&&(g={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:m.row,TILECOL:m.col,FORMAT:this.format},g=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[g]))}}return g},mergeNewParams:function(b){if("KVP"===this.requestEncoding.toUpperCase()){return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(b)])}},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var d=new OpenLayers.Protocol.Response({requestType:"read"}),f=this.format,f=OpenLayers.Format.XML.prototype.write.apply(f,[f.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);d.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,d,e),data:f});return d},handleRead:function(e,d){if(d.callback){var f=e.priv;200<=f.status&&300>f.status?(e.features=this.parseFeatures(f),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE;d.callback.call(d.scope,e)}},parseFeatures:function(d){var c=d.responseXML;if(!c||!c.documentElement){c=d.responseText}return !c||0>=c.length?null:this.format.read(c)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(f,e,h,g){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(g){var g=this.adjustBounds(g),f=this.map.getResolution(),k=Math.round(10000*this.map.getScale())/10000,j=Math.round(g.left/f),g=-Math.round(g.top/f),f=Math.floor(j/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,h=Math.floor(g/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,k=["/",this.params.map,"/",k,"/",this.params.g.replace(/\s/g,"_"),"/def/t",h,"/l",f,"/t",g,"l",j,".",this.extension],j=this.url;OpenLayers.Util.isArray(j)&&(j=this.selectUrl(k.join(""),j));return j+k.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(b){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(d,c){c.srs[this.getChildValue(d)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(d,c){c.vendorSpecific={tileSets:[]};this.readChildNodes(d,c.vendorSpecific)},TileSet:function(e,d){var f={srs:{},bbox:{},resolutions:[]};this.readChildNodes(e,f);d.tileSets.push(f)},Resolutions:function(g,f){for(var k=this.getChildValue(g).split(" "),j=0,h=k.length;j<h;j++){""!=k[j]&&f.resolutions.push(parseFloat(k[j]))}},Width:function(d,c){c.width=parseInt(this.getChildValue(d))},Height:function(d,c){c.height=parseInt(this.getChildValue(d))},Layers:function(d,c){c.layers=this.getChildValue(d)},Styles:function(d,c){c.styles=this.getChildValue(d)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(g,f){for(var k=this.getChildValue(g).split(/ +/),j=0,h=k.length;j<h;j++){f.srs[k[j]]=!0}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:!1,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[];this.roundedCorner&&OpenLayers.Console.warn("roundedCorner option is deprecated")},destroy:function(){this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();this.outsideViewport||this.minimizeControl();this.redraw();return this.div},onButtonClick:function(b){b=b.buttonElement;b===this.minimizeDiv?this.minimizeControl():b===this.maximizeDiv?this.maximizeControl():b._layerSwitcher===this.id&&(b["for"]&&(b=document.getElementById(b["for"])),b.disabled||("radio"==b.type?(b.checked=!0,this.map.setBaseLayer(this.map.getLayer(b._layer))):(b.checked=!b.checked,this.updateMap())))},clearLayersArray:function(b){this[b+"LayersDiv"].innerHTML="";this[b+"Layers"]=[]},checkRedraw:function(){var g=!1;if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length){g=!0}else{for(var f=0,k=this.layerStates.length;f<k;f++){var j=this.layerStates[f],h=this.map.layers[f];if(j.name!=h.name||j.inRange!=h.inRange||j.id!=h.id||j.visibility!=h.visibility){g=!0;break}}}return g},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var u=!1,t=!1,s=this.map.layers.length;this.layerStates=Array(s);for(var r=0;r<s;r++){var q=this.map.layers[r];this.layerStates[r]={name:q.name,visibility:q.visibility,inRange:q.inRange,id:q.id}}var p=this.map.layers.slice();this.ascending||p.reverse();r=0;for(s=p.length;r<s;r++){var q=p[r],o=q.isBaseLayer;if(q.displayInLayerSwitcher){o?t=!0:u=!0;var m=o?q==this.map.baseLayer:q.getVisibility(),l=document.createElement("input");l.id=this.id+"_input_"+q.name;l.name=o?this.id+"_baseLayers":q.name;l.type=o?"radio":"checkbox";l.value=q.name;l.checked=m;l.defaultChecked=m;l.className="olButton";l._layer=q.id;l._layerSwitcher=this.id;!o&&!q.inRange&&(l.disabled=!0);m=document.createElement("label");m["for"]=l.id;OpenLayers.Element.addClass(m,"labelSpan olButton");m._layer=q.id;m._layerSwitcher=this.id;!o&&!q.inRange&&(m.style.color="gray");m.innerHTML=q.name;m.style.verticalAlign=o?"bottom":"baseline";var k=document.createElement("br");(o?this.baseLayers:this.dataLayers).push({layer:q,inputElem:l,labelSpan:m});q=o?this.baseLayersDiv:this.dataLayersDiv;q.appendChild(l);q.appendChild(m);q.appendChild(k)}}this.dataLbl.style.display=u?"":"none";this.baseLbl.style.display=t?"":"none";return this.div},updateMap:function(){for(var e=0,d=this.baseLayers.length;e<d;e++){var f=this.baseLayers[e];f.inputElem.checked&&this.map.setBaseLayer(f.layer,!1)}e=0;for(d=this.dataLayers.length;e<d;e++){f=this.dataLayers[e],f.layer.setVisibility(f.inputElem.checked)}},maximizeControl:function(b){this.div.style.width="";this.div.style.height="";this.showControls(!1);null!=b&&OpenLayers.Event.stop(b)},minimizeControl:function(b){this.div.style.width="0px";this.div.style.height="0px";this.showControls(!0);null!=b&&OpenLayers.Event.stop(b)},showControls:function(b){this.maximizeDiv.style.display=b?"":"none";this.minimizeDiv.style.display=b?"none":"";this.layersDiv.style.display=b?"none":""},loadContents:function(){this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";OpenLayers.Element.addClass(this.layersDiv,"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer");OpenLayers.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("Overlays");OpenLayers.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv");this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv));this.div.appendChild(this.layersDiv);this.roundedCorner&&(OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:!1}),OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,0.75));var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,b,"absolute");OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton");this.maximizeDiv.style.display="none";this.div.appendChild(this.maximizeDiv);b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,b,"absolute");OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton");this.minimizeDiv.style.display="none";this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(b){"string"==typeof b&&(b=OpenLayers.Format.XML.prototype.read.apply(this,[b]));return this.parseFeatures(b)},write:function(f){var e;if(OpenLayers.Util.isArray(f)){e=this.createElementNSPlus("atom:feed");e.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var h=0,g=f.length;h<g;h++){e.appendChild(this.buildEntryNode(f[h]))}}else{e=this.buildEntryNode(f)}return OpenLayers.Format.XML.prototype.write.apply(this,[e])},buildContentNode:function(d){var c=this.createElementNSPlus("atom:content",{attributes:{type:d.type||null}});if(d.src){c.setAttribute("src",d.src)}else{if("text"==d.type||null==d.type){c.appendChild(this.createTextNode(d.value))}else{if("html"==d.type){if("string"!=typeof d.value){throw"HTML content must be in form of an escaped string"}c.appendChild(this.createTextNode(d.value))}else{"xhtml"==d.type?c.appendChild(d.value):"xhtml"==d.type||d.type.match(/(\+|\/)xml$/)?c.appendChild(d.value):c.appendChild(this.createTextNode(d.value))}}}return c},buildEntryNode:function(k){var j=k.attributes,r=j.atom||{},q=this.createElementNSPlus("atom:entry");if(r.authors){for(var p=OpenLayers.Util.isArray(r.authors)?r.authors:[r.authors],o=0,m=p.length;o<m;o++){q.appendChild(this.buildPersonConstructNode("author",p[o]))}}if(r.categories){for(var p=OpenLayers.Util.isArray(r.categories)?r.categories:[r.categories],l,o=0,m=p.length;o<m;o++){l=p[o],q.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:l.term,scheme:l.scheme||null,label:l.label||null}}))}}r.content&&q.appendChild(this.buildContentNode(r.content));if(r.contributors){p=OpenLayers.Util.isArray(r.contributors)?r.contributors:[r.contributors];o=0;for(m=p.length;o<m;o++){q.appendChild(this.buildPersonConstructNode("contributor",p[o]))}}k.fid&&q.appendChild(this.createElementNSPlus("atom:id",{value:k.fid}));if(r.links){p=OpenLayers.Util.isArray(r.links)?r.links:[r.links];o=0;for(m=p.length;o<m;o++){l=p[o],q.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:l.href,rel:l.rel||null,type:l.type||null,hreflang:l.hreflang||null,title:l.title||null,length:l.length||null}}))}}r.published&&q.appendChild(this.createElementNSPlus("atom:published",{value:r.published}));r.rights&&q.appendChild(this.createElementNSPlus("atom:rights",{value:r.rights}));if(r.summary||j.description){q.appendChild(this.createElementNSPlus("atom:summary",{value:r.summary||j.description}))}q.appendChild(this.createElementNSPlus("atom:title",{value:r.title||j.title||this.defaultEntryTitle}));r.updated&&q.appendChild(this.createElementNSPlus("atom:updated",{value:r.updated}));k.geometry&&(j=this.createElementNSPlus("georss:where"),j.appendChild(this.buildGeometryNode(k.geometry)),q.appendChild(j));return q},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(b){this.gmlParser||this.initGmlParser();return this.gmlParser.writeNode("feature:_geometry",b).firstChild},buildPersonConstructNode:function(h,g){var m=["uri","email"],l=this.createElementNSPlus("atom:"+h);l.appendChild(this.createElementNSPlus("atom:name",{value:g.name}));for(var k=0,j=m.length;k<j;k++){g[m[k]]&&l.appendChild(this.createElementNSPlus("atom:"+m[k],{value:g[m[k]]}))}return l},getFirstChildValue:function(f,e,h,g){return(f=this.getElementsByTagNameNS(f,e,h))&&0<f.length?this.getChildValue(f[0],g):g},parseFeature:function(w){var v={},u=null,t=null,s=null,r=this.namespaces.atom;this.parsePersonConstructs(w,"author",v);t=this.getElementsByTagNameNS(w,r,"category");0<t.length&&(v.categories=[]);for(var q=0,p=t.length;q<p;q++){u={};u.term=t[q].getAttribute("term");if(s=t[q].getAttribute("scheme")){u.scheme=s}if(s=t[q].getAttribute("label")){u.label=s}v.categories.push(u)}t=this.getElementsByTagNameNS(w,r,"content");if(0<t.length){u={};if(s=t[0].getAttribute("type")){u.type=s}(s=t[0].getAttribute("src"))?u.src=s:(u.value="text"==u.type||"html"==u.type||null==u.type?this.getFirstChildValue(w,r,"content",null):"xhtml"==u.type||u.type.match(/(\+|\/)xml$/)?this.getChildEl(t[0]):this.getFirstChildValue(w,r,"content",null),v.content=u)}this.parsePersonConstructs(w,"contributor",v);v.id=this.getFirstChildValue(w,r,"id",null);t=this.getElementsByTagNameNS(w,r,"link");0<t.length&&(v.links=Array(t.length));for(var o=["rel","type","hreflang","title","length"],q=0,p=t.length;q<p;q++){u={};u.href=t[q].getAttribute("href");for(var m=0,l=o.length;m<l;m++){(s=t[q].getAttribute(o[m]))&&(u[o[m]]=s)}v.links[q]=u}if(u=this.getFirstChildValue(w,r,"published",null)){v.published=u}if(u=this.getFirstChildValue(w,r,"rights",null)){v.rights=u}if(u=this.getFirstChildValue(w,r,"summary",null)){v.summary=u}v.title=this.getFirstChildValue(w,r,"title",null);v.updated=this.getFirstChildValue(w,r,"updated",null);u={title:v.title,description:v.summary,atom:v};w=this.parseLocations(w)[0];w=new OpenLayers.Feature.Vector(w,u);w.fid=v.id;return w},parseFeatures:function(f){var e=[],h=this.getElementsByTagNameNS(f,this.namespaces.atom,"entry");0==h.length&&(h=[f]);for(var f=0,g=h.length;f<g;f++){e.push(this.parseFeature(h[f]))}return e},parseLocations:function(w){var v=this.namespaces.georss,u={components:[]},t=this.getElementsByTagNameNS(w,v,"where");if(t&&0<t.length){this.gmlParser||this.initGmlParser();for(var s=0,r=t.length;s<r;s++){this.gmlParser.readChildNodes(t[s],u)}}u=u.components;if((t=this.getElementsByTagNameNS(w,v,"point"))&&0<t.length){s=0;for(r=t.length;s<r;s++){var q=OpenLayers.String.trim(t[s].firstChild.nodeValue).split(/\s+/);2!=q.length&&(q=OpenLayers.String.trim(t[s].firstChild.nodeValue).split(/\s*,\s*/));u.push(new OpenLayers.Geometry.Point(q[1],q[0]))}}var p=this.getElementsByTagNameNS(w,v,"line");if(p&&0<p.length){for(var o,s=0,r=p.length;s<r;s++){t=OpenLayers.String.trim(p[s].firstChild.nodeValue).split(/\s+/);o=[];for(var m=0,l=t.length;m<l;m+=2){q=new OpenLayers.Geometry.Point(t[m+1],t[m]),o.push(q)}u.push(new OpenLayers.Geometry.LineString(o))}}if((w=this.getElementsByTagNameNS(w,v,"polygon"))&&0<w.length){s=0;for(r=w.length;s<r;s++){t=OpenLayers.String.trim(w[s].firstChild.nodeValue).split(/\s+/);o=[];m=0;for(l=t.length;m<l;m+=2){q=new OpenLayers.Geometry.Point(t[m+1],t[m]),o.push(q)}u.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(u)]))}}if(this.internalProjection&&this.externalProjection){s=0;for(r=u.length;s<r;s++){u[s]&&u[s].transform(this.externalProjection,this.internalProjection)}}return u},parsePersonConstructs:function(y,x,w){for(var v=[],u=this.namespaces.atom,y=this.getElementsByTagNameNS(y,u,x),t=["uri","email"],s=0,r=y.length;s<r;s++){var q={};q.name=this.getFirstChildValue(y[s],u,"name",null);for(var p=0,o=t.length;p<o;p++){var m=this.getFirstChildValue(y[s],u,t[p],null);m&&(q[t[p]]=m)}v.push(q)}0<v.length&&(w[x+"s"]=v)},CLASS_NAME:"OpenLayers.Format.Atom"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:this.observeElement||document})},defaultKeyPress:function(e){var d,f=!0;switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:d=this.map.getSize();this.map.pan(0,-0.75*d.h);break;case 34:d=this.map.getSize();this.map.pan(0,0.75*d.h);break;case 35:d=this.map.getSize();this.map.pan(0.75*d.w,0);break;case 36:d=this.map.getSize();this.map.pan(-0.75*d.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:f=!1}f&&OpenLayers.Event.stop(e)},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b;b=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(b,this.yx)},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);c.version=this.version;return c},readers:{wmts:{Capabilities:function(d,c){this.readChildNodes(d,c)},Contents:function(d,c){c.contents={};c.contents.layers=[];c.contents.tileMatrixSets={};this.readChildNodes(d,c.contents)},Layer:function(e,d){var f={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[],layers:[]};this.readChildNodes(e,f);d.layers.push(f)},Style:function(e,d){var f={};f.isDefault="true"===e.getAttribute("isDefault");this.readChildNodes(e,f);d.styles.push(f)},Format:function(d,c){c.formats.push(this.getChildValue(d))},TileMatrixSetLink:function(e,d){var f={};this.readChildNodes(e,f);d.tileMatrixSetLinks.push(f)},TileMatrixSet:function(e,d){if(d.layers){var f={matrixIds:[]};this.readChildNodes(e,f);d.tileMatrixSets[f.identifier]=f}else{d.tileMatrixSet=this.getChildValue(e)}},TileMatrix:function(e,d){var f={supportedCRS:d.supportedCRS};this.readChildNodes(e,f);d.matrixIds.push(f)},ScaleDenominator:function(d,c){c.scaleDenominator=parseFloat(this.getChildValue(d))},TopLeftCorner:function(f,e){var h=this.getChildValue(f).split(" "),g;e.supportedCRS&&(g=!!this.yx[e.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2")]);e.topLeftCorner=g?new OpenLayers.LonLat(h[1],h[0]):new OpenLayers.LonLat(h[0],h[1])},TileWidth:function(d,c){c.tileWidth=parseInt(this.getChildValue(d))},TileHeight:function(d,c){c.tileHeight=parseInt(this.getChildValue(d))},MatrixWidth:function(d,c){c.matrixWidth=parseInt(this.getChildValue(d))},MatrixHeight:function(d,c){c.matrixHeight=parseInt(this.getChildValue(d))},ResourceURL:function(d,c){c.resourceUrl=c.resourceUrl||{};c.resourceUrl[d.getAttribute("resourceType")]={format:d.getAttribute("format"),template:d.getAttribute("template")}},WSDL:function(d,c){c.wsdl={};c.wsdl.href=d.getAttribute("xlink:href")},ServiceMetadataURL:function(d,c){c.serviceMetadataUrl={};c.serviceMetadataUrl.href=d.getAttribute("xlink:href")},LegendURL:function(d,c){c.legend={};c.legend.href=d.getAttribute("xlink:href");c.legend.format=d.getAttribute("format")},Dimension:function(e,d){var f={values:[]};this.readChildNodes(e,f);d.dimensions.push(f)},Default:function(d,c){c["default"]=this.getChildValue(d)},Value:function(d,c){c.values.push(this.getChildValue(d))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});var Tooltips={en:{locationType:"Location type",selectLocationType:"Select location type",mapType:"Background map",selectMapType:"Select background map",selectOverlay:"Select layer for spatial filtering",overlays:"Select layer",mapSelectorTools:"Map selector tools",overlaySelector:"Selection layer",square:"Square selection: Mouse down for the center and mouse move to set square bounds",circle:"Circle selection: Mouse down for the center and mouse move to set circle radius",polygon:"Polygon selection: Click to add vertex and double click to complete the polygon",country:"Country selection: Click inside the political borders of a country",singleEntry:"Only 1 entry available",resultsLocation:"with location information",home:"Reset map to initial view",zoomIn:"Zoom in",zoomOut:"Zoom out",zoomSlider:"Zoom slider",dragSelection:"Drag&Drop shape",zoomSelection:"Zoom into selection",clearSelection:"Clear selection",contemporaryMap:"Contemporary Map",activateGeoLocation:"Show my location",deactivateGeoLocation:"Hide my location",mapOf:"Map of",close:"Close",genericBinning:"delaunay",squareBinning:"square",hexagonalBinning:"hexagonal",triangularBinning:"triangular",noBinning:"none",selectBinningType:"Select aggregation type",binningType:"Aggregation type",binningTooltip:"Select the aggregation type for the data sources",results:"results",result:"result",timeType:"Time type",timeUnit:"Time unit:",selectTimeType:"Select time type",timeAnimation:"Animation",resultsTime:"with time information",animationDisabled:"Animation control (disabled)",animationPlay:"Animate selected time range",animationPause:"Pause animation",leftHandle:"Drag&Drop left border",rightHandle:"Drag&Drop right border",dragTimeRange:"Drag&Drop time range",connectionsOn:"Switch on time-dependent connections between map circles",connectionsOff:"Switch off time-dependent connections",timeFeather:"Adjust time range feather to smoothen map animations",allResults:"all",pageInfo:"Page PAGE_ID of PAGES_ID",resultsInfo:"RESULTS_FROM_ID-RESULTS_TO_ID of RESULTS_ID Results",otherResults:"others",mapAggregation:"Aggregation",aggregation:"Circle aggregation",noAggregation:"No circle aggregation",showBoxTitle:"Boundingbox",showBbox:"Shows given Boundingbox extension",hideBbox:"Hides given Boundingbox extension",spaceHelp:"A point on the map corresponds to one or more objects from the result list. ",timeHelp:"On the timeline are the search results sorted by year. You can choose different time-based categories as basis for the representation.",selectTablePageItemsHelp:"Click to select all rows of this page",deselectTablePageItemsHelp:"Click to deselect all rows of this page",selectAllTableItemsHelp:"Click to select all rows of the table",deselectAllTableItemsHelp:"Click to deselect all rows of the table",filter:"Filter",filterSelectedItemsHelp:"Filter the selected items",inverseFilterSelectedItemsHelp:"Apply an inverse filter on the selected items removing them from the views",undoFilterSelection:"Undo the last filter / inverse filter",cancelSelection:"Discard the current selection (all items appear as deselected)",showSelectedHelp:"Show only elements within the selection",showAllElementsHelp:"Show all elements",paginationFirsPageHelp:"Show first page",paginationPreviousPageHelp:"Show previous page",paginationNextPageHelp:"Show next page",paginationLastPageHelp:"Show last page",sortAZHelp:"Sort table elements ascending according this column",sortZAHelp:"Sort table elements descending according this column",paginationDropdownHelp:"Select number of elements per page",selectTimeUnit:"Select Time Unit",valueScale:"Value Scale",linearPlot:"Linear Value Scale",logarithmicPlot:"Logarithmic Value Scale",playButton:"Animate Selected Range",pauseButton:"Pause Animation"},de:{locationType:"Ortsfacette",selectLocationType:"W&auml;hle Ortsfacette",mapType:"Kartentyp",selectMapType:"W&auml;hle Kartentyp",selectOverlay:"Kartenauswahl f&uuml;r r&auml;mliches filtern",overlays:"W&auml;hle layer",mapSelectorTools:"Bereichsauswahl",overlaySelector:"Selection layer",square:"Quadratauswahl: Maus ziehen und loslassen um Mittelpunkt und Seitenl&auml;nge des Quadrats zu bestimmen",circle:"Kreisauswahl: Maus ziehen und loslassen um Mittelpunkt und Radius des Kreises zu bestimmen",polygon:"Polygonauswahl: Mausklick zum Hinzuf&uuml;gen eines Eckpunktes, Doppelklick zum Fertigstellen",country:"Landauswahl: Mausklick innerhalb politischer Grenze eines Landes",singleEntry:"Nur 1 Eintrag vorhanden",resultsLocation:"mit Geoinformation",home:"Zur&uuml;cksetzen zur initialen Sicht",zoomIn:"Vergr&ouml;&szlig;ern",zoomOut:"Verkleinern",zoomSlider:"Zoomregler",dragSelection:"Verschiebe Auswahl",zoomSelection:"Vergr&ouml;&szlig;ere Auswahl",clearSelection:"Entferne Auswahlbereich",contemporaryMap:"Aktuelle Weltkarte",activateGeoLocation:"Meinen Standort anzeigen",deactivateGeoLocation:"Meinen Standort ausblenden",mapOf:"Karte von",close:"Schliessen",genericBinning:"Generisch",squareBinning:"Quadrate",hexagonalBinning:"Hexagone",triangularBinning:"Dreiecke",noBinning:"Keine Bins",selectBinningType:"W&auml;hle Binningart",binningTooltip:"W&aunl;hle die Binninart f�r die Datenquellen",binningType:"Binningart",results:"Resultate",result:"Resultat",timeType:"Zeitfacette",timeUnit:"Zeiteinheit",selectTimeType:"W&auml;hle Zeitfacette",timeAnimation:"Animation",resultsTime:"mit Zeitinformation",animationDisabled:"Animationswerkzeug (deaktiviert)",animationPlay:"Animiere ausgew&auml;hlten Zeitbereich",animationPause:"Animation anhalten",leftHandle:"Verschiebe linke Grenze",rightHandle:"Verschiebe rechte Grenze",dragTimeRange:"Verschiebe Zeitbereich",connectionsOn:"Aktiviere zeitabhängige Verbindungen zwischen Kreisen auf der Karte",connectionsOff:"Deaktiviere zeitabhängige Verbindungen",timeFeather:"Ver&auml;ndere Zeitbereichs&uuml;berg&auml;nge zum Gl&auml;tten der Animation",pageInfo:"Seite PAGE_ID von PAGES_ID",resultsInfo:"RESULTS_FROM_ID-RESULTS_TO_ID von RESULTS_ID Ergebnissen",allResults:"alle",otherResults:"sonstige",mapAggregation:"Aggregation",aggregation:"Kreise aggregiert",noAggregation:"Kreise nicht aggregiert",showBbox:"Geografische Ausdehnung anzeigen",hideBbox:"Geografische Ausdehnung ausblenden",spaceHelp:"Jeder Punkt auf der Karte entspricht einem oder mehreren Objekten der Ergebnisliste. Sie k&ouml;nnen verschiedene ortsbezogene Kategorien als Grundlage f&uuml;r die Darstellung w&auml;hlen (Auswahlfeld <strong>Ortsfacette</strong>) und verschiedene Kartentypen. <br> Da es Objekte geben kann, die keine Ortsangabe in ihrer Beschreibung enthalten, ist die Menge der in der Karte dargestellten Objekte in der Regel kleiner als in der Ergebnisliste (Anzahl darstellbarer Objekte siehe rechts oben über der Karte). <br> Mit der Karte können Sie die Suchergebnisse weiter eingrenzen, indem Sie auf einen der Punkte klicken. Wählen Sie einen Ort aus und klicken Sie auf die kleine Lupe, um die Ergebnisliste so einzuschränken, dass nur noch die diesem Ort zugeordneten Objekte als Suchergebnis erscheinen. Mehr zur Karte im Benutzerhandbuch ...",timeHelp:"In der Zeitleiste sind die Suchergebnisse nach Jahren geordnet. Sie k&ouml;nnen verschiedene zeitbezogene Kategorien als Grundlage f&uuml;r die Darstellung w&auml;hlen (Auswahlfeld <strong>Zeitfacette</strong>). <br> Da es Objekte geben kann, die keine Zeitangabe in ihrer Beschreibung enthalten, ist die Zahl der in der Zeitleiste dargestellten Objekte in der Regel kleiner als in der Ergebnisliste. Die Angabe über darstellbare Objekte finden Sie rechts über der Zeitleiste. <br>Mit der Zeitleiste können Sie die Suchergebnisse weiter eingrenzen. Wählen Sie ein Jahr oder einen Zeitraum durch Klicken und Ziehen und klicken Sie auf die kleine Lupe. Die Ergebnisliste zeigt nur noch die Objekte in diesem Zeitraum. Mehr zur Zeitleiste im Benutzerhandbuch ...",selectTablePageItemsHelp:"Click to select all rows of this page",deselectTablePageItemsHelp:"Click to deselect all rows of this page",selectAllTableItemsHelp:"Click to select all rows of the table",deselectAllTableItemsHelp:"Click to deselect all rows of the table",filter:"Filter",filterSelectedItemsHelp:"Filter the selected items",inverseFilterSelectedItemsHelp:"Apply an inverse filter on the selected items removing them from the views",undoFilterSelection:"Undo the last filter / inverse filter",cancelSelection:"Discard the current selection (all items appear as deselected)",showSelectedHelp:"Show only elements within the selection",showAllElementsHelp:"Show all elements",paginationFirsPageHelp:"Show first page",paginationPreviousPageHelp:"Show previous page",paginationNextPageHelp:"Show next page",paginationLastPageHelp:"Show last page",sortAZHelp:"Sort table elements ascending according this column",sortZAHelp:"Sort table elements descending according this column",paginationDropdownHelp:"Select number of elements per page",selectTimeUnit:"W�hle Zeitinervalle",valueScale:"Value Scale",linearPlot:"Linear Value Scale",logarithmicPlot:"Logarithmic Value Scale",playButton:"Animate Selected Range",pauseButton:"Pause Animation"}};var GeoTemConfig={incompleteData:true,inverseFilter:true,mouseWheelZoom:true,language:"en",allowFilter:true,highlightEvents:true,selectionEvents:true,colors:[{r1:255,g1:101,b1:0,r0:253,g0:229,b0:205},{r1:144,g1:26,b1:255,r0:230,g0:225,b0:255},{r1:0,g1:217,b1:0,r0:213,g0:255,b0:213},{r1:240,g1:220,b1:0,r0:247,g0:244,b0:197}]};GeoTemConfig.ie=false;GeoTemConfig.ie8=false;GeoTemConfig.independentMapId=0;GeoTemConfig.independentTimeId=0;if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){GeoTemConfig.ie=true;var ieversion=new Number(RegExp.$1);if(ieversion==8){GeoTemConfig.ie8=true}}GeoTemConfig.getIndependentId=function(a){if(a=="map"){return ++GeoTemConfig.independentMapId}if(a=="time"){return ++GeoTemConfig.independentTimeId}return 0};GeoTemConfig.setHexColor=function(c,b,d){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c);if(d){GeoTemConfig.colors[b].r0=parseInt(a[1],16);GeoTemConfig.colors[b].g0=parseInt(a[2],16);GeoTemConfig.colors[b].b0=parseInt(a[3],16)}else{GeoTemConfig.colors[b].r1=parseInt(a[1],16);GeoTemConfig.colors[b].g1=parseInt(a[2],16);GeoTemConfig.colors[b].b1=parseInt(a[3],16)}};GeoTemConfig.setRgbColor=function(e,d,a,c,f){if(f){GeoTemConfig.colors[c].r0=e;GeoTemConfig.colors[c].g0=d;GeoTemConfig.colors[c].b0=a}else{GeoTemConfig.colors[c].r1=e;GeoTemConfig.colors[c].g1=d;GeoTemConfig.colors[c].b1=a}};GeoTemConfig.configure=function(a){GeoTemConfig.urlPrefix=a;GeoTemConfig.path=GeoTemConfig.urlPrefix+"images/"};GeoTemConfig.getUrlPrefix=function(){return GeoTemConfig.urlPrefix};GeoTemConfig.applySettings=function(a){$.extend(this,a)};GeoTemConfig.getColor=function(a){if(GeoTemConfig.colors.length<=a){GeoTemConfig.colors.push({r1:Math.floor((Math.random()*255)+1),g1:Math.floor((Math.random()*255)+1),b1:Math.floor((Math.random()*255)+1),r0:230,g0:230,b0:230})}return GeoTemConfig.colors[a]};GeoTemConfig.getString=function(a){if(typeof Tooltips[GeoTemConfig.language]=="undefined"){GeoTemConfig.language="en"}return Tooltips[GeoTemConfig.language][a]};GeoTemConfig.getMousePosition=function(b){if(!b){b=window.event}var a=(window.document.compatMode&&window.document.compatMode=="CSS1Compat")?window.document.documentElement:window.document.body;return{top:b.pageY?b.pageY:b.clientY,left:b.pageX?b.pageX:b.clientX}};GeoTemConfig.getJson=function(a){var b;$.ajax({url:a,async:false,dataType:"json",success:function(c){b=c}});return b};GeoTemConfig.mergeObjects=function(f,e){var a=[];var d=[];for(var c=0;c<f.length;c++){a.push([]);d.push([]);for(var b=0;b<f[c].length;b++){a[c][f[c][b].index]=true;d[c].push(f[c][b])}}for(var c=0;c<e.length;c++){for(var b=0;b<e[c].length;b++){if(!a[c][e[c][b].index]){d[c].push(e[c][b])}}}return d};GeoTemConfig.getKml=function(a,d){var c;var b=false;if(d){b=true}$.ajax({url:a,async:b,dataType:"xml",success:function(e){if(d){d(e)}else{c=e}}});if(!b){return c}};GeoTemConfig.getTimeData=function(k){if(!k){return}var b;try{var g=false;if(k.startsWith("-")){g=true;k=k.substring(1)}var a=k.split("T");var j=a[0].split("-");for(var f=0;f<j.length;f++){parseInt(j[f])}if(g){j[0]="-"+j[0]}if(a.length==1){b=j}else{var c;if(a[1].indexOf("Z")!=-1){c=a[1].substring(0,a[1].indexOf("Z")-1).split(":")}else{c=a[1].substring(0,a[1].indexOf("+")-1).split(":")}for(var f=0;f<j.length;f++){parseInt(c[f])}b=j.concat(c)}}catch(d){return null}var e,h;if(b.length==6){h=SimileAjax.DateTime.SECOND;e=new Date(Date.UTC(b[0],b[1]-1,b[2],b[3],b[4],b[5]))}else{if(b.length==3){h=SimileAjax.DateTime.DAY;e=new Date(Date.UTC(b[0],b[1]-1,b[2]))}else{if(b.length==2){h=SimileAjax.DateTime.MONTH;e=new Date(Date.UTC(b[0],b[1]-1,1))}else{if(b.length==1){h=SimileAjax.DateTime.YEAR;e=new Date(Date.UTC(b[0],0,1))}}}}if(j[0]&&j[0]<100){e.setFullYear(j[0])}return{date:e,granularity:h}};GeoTemConfig.loadJson=function(a){var l=[];var k=0;for(var r in a){try{var u=a[r];var g=u.index||u.id||k++;var w=u.name||"";var p=u.description||"";var t=u.tableContent||[];var v=[];if(u.location instanceof Array){for(var q=0;q<u.location.length;q++){var m=u.location[q].place||"unknown";var b=u.location[q].lon||"";var f=u.location[q].lat||"";if((b==""||f==""||isNaN(b)||isNaN(f))&&!GeoTemConfig.incompleteData){throw"e"}v.push({longitude:b,latitude:f,place:m})}}else{var m=u.place||"unknown";var b=u.lon||"";var f=u.lat||"";if((b==""||f==""||isNaN(b)||isNaN(f))&&!GeoTemConfig.incompleteData){throw"e"}v.push({longitude:b,latitude:f,place:m})}var d=[];if(u.time instanceof Array){for(var q=0;q<u.time.length;q++){var h=GeoTemConfig.getTimeData(u.time[q]);if(h==null&&!GeoTemConfig.incompleteData){throw"e"}d.push(h)}}else{var h=GeoTemConfig.getTimeData(u.time);if(h==null&&!GeoTemConfig.incompleteData){throw"e"}if(h!=null){d.push(h)}}var o=u.weight||1;var c=new DataObject(w,p,v,d,o,t);c.setIndex(g);l.push(c)}catch(s){continue}}return l};GeoTemConfig.loadKml=function(B){var v=[];var q=B.getElementsByTagName("Placemark");if(q.length==0){return[]}var k=0;for(var u=0;u<q.length;u++){var y=q[u];var C,t,o,c,g,j,x=[],l=[],b=[];var p=1;var a=false,s=false;try{C=y.getElementsByTagName("name")[0].childNodes[0].nodeValue;x.name=C}catch(w){C=""}try{t=y.getElementsByTagName("description")[0].childNodes[0].nodeValue;x.description=t}catch(w){t=""}try{o=y.getElementsByTagName("address")[0].childNodes[0].nodeValue;x.place=o}catch(w){o=""}try{var d=y.getElementsByTagName("Point")[0].getElementsByTagName("coordinates")[0].childNodes[0].nodeValue;var m=d.split(",");g=m[0];j=m[1];if(g==""||j==""||isNaN(g)||isNaN(j)){throw"e"}b.push({longitude:g,latitude:j,place:o})}catch(w){if(!GeoTemConfig.incompleteData){continue}}try{var r=GeoTemConfig.getTimeData(y.getElementsByTagName("TimeStamp")[0].getElementsByTagName("when")[0].childNodes[0].nodeValue);if(r!=null){l.push(r);a=true}else{if(!GeoTemConfig.incompleteData){continue}}}catch(w){try{throw"e";var z=y.getElementsByTagName("TimeSpan")[0];var h=GeoTemConfig.getTimeData(z.getElementsByTagName("begin")[0].childNodes[0].nodeValue);timeStart=h.d;c=h.g;var f=GeoTemConfig.getTimeData(z.getElementsByTagName("end")[0].childNodes[0].nodeValue);timeEnd=f.d;if(f.g>c){c=f.g}a=true}catch(w){if(!GeoTemConfig.incompleteData){continue}}}var A=new DataObject(C,t,b,l,1,x);A.setIndex(k);k++;v.push(A)}return v};function MapControl(e,c,b,f,a){var d=this;this.button=c;this.enabled=true;this.activated=false;this.label=b;if(this.button!=null){$(this.button).addClass(b+"Deactivated");$(this.button).attr("title",GeoTemConfig.getString(GeoTemConfig.language,b));$(this.button).click(function(){d.checkStatus()})}this.checkStatus=function(){if(d.enabled){if(typeof e.activeControl!="undefined"){if(d.activated){d.deactivate()}else{e.activeControl.deactivate();d.activate()}}else{d.activate()}}};this.setButtonClass=function(h,g){if(this.button!=null){$(this.button).removeClass(b+h);$(this.button).addClass(b+g);$(this.button).attr("title",GeoTemConfig.getString(GeoTemConfig.language,b))}};this.disable=function(){this.enabled=false;this.setButtonClass("Deactivated","Disabled")};this.enable=function(){this.enabled=true;this.setButtonClass("Disabled","Deactivated")};this.activate=function(){f();this.activated=true;this.setButtonClass("Deactivated","Activated");e.activeControl=this};this.deactivate=function(){a();this.activated=false;this.setButtonClass("Activated","Deactivated");e.activeControl=undefined}}CircleObject=function(h,g,f,e,a,d,j,c,b){this.originX=h;this.originY=g;this.shiftX=f;this.shiftY=e;this.elements=a;this.radius=d;this.search=j;this.weight=c;this.overlay=0;this.smoothness=0;this.fatherBin=b;this.feature;this.olFeature;this.percentage=0;this.selected=false};CircleObject.prototype={setFeature:function(a){this.feature=a},setOlFeature:function(a){this.olFeature=a},reset:function(){this.overlay=0;this.smoothness=0},setSelection:function(a){this.selected=a},toggleSelection:function(){this.selected=!this.selected}};function FilterBar(a,c){var b=this;this.filter=document.createElement("div");this.filter.setAttribute("class","smallButton filterDisabled");this.filter.onclick=function(){a.filtering()};this.filterInverse=document.createElement("div");this.filterInverse.setAttribute("class","smallButton filterInverseDisabled");this.filterInverse.onclick=function(){a.inverseFiltering()};if(!GeoTemConfig.inverseFilter){this.filterInverse.style.display="none"}this.cancelSelection=document.createElement("div");this.cancelSelection.setAttribute("class","smallButton filterCancelDisabled");this.cancelSelection.onclick=function(){a.deselection()};this.appendTo=function(d){d.appendChild(this.filter);d.appendChild(this.filterInverse);d.appendChild(this.cancelSelection)};if(typeof c!="undefined"){this.appendTo(c)}this.reset=function(d){if(d){this.filter.setAttribute("class","smallButton filter");this.filterInverse.setAttribute("class","smallButton filterInverse");this.cancelSelection.setAttribute("class","smallButton filterCancel")}else{this.filter.setAttribute("class","smallButton filterDisabled");this.filterInverse.setAttribute("class","smallButton filterInverseDisabled");this.cancelSelection.setAttribute("class","smallButton filterCancelDisabled")}}}function Selection(c,b){this.objects=c;if(typeof c=="undefined"){this.objects=[];for(var a=0;a<GeoTemConfig.datasets;a++){this.objects.push([])}}this.widget=b;this.getObjects=function(e){if(!this.equal(e)){return this.objects}this.objects=[];for(var d=0;d<GeoTemConfig.datasets;d++){this.objects.push([])}return this.objects};this.equal=function(d){if(this.valid()&&this.widget!=d){return false}return true};this.valid=function(){if(typeof this.widget!="undefined"){return true}return false}}function PlacenameTags(b,a){this.circle=b;this.map=a;this.placeLabels;this.selectedLabel;this.allLabel;this.othersLabel;this.unknownLabel;this.calculate=function(){this.calculateLabels();this.calculatePlacenameTags()};this.calculateLabels=function(){var d=this.circle.elements;var f=this.circle.search;var m=0;var o=[];var e=this.map.getLevelOfDetail();for(var l=0;l<d.length;l++){m+=d[l].weight;var t=false;var r=d[l].getPlace(this.map.options.mapIndex,e);if(r==""){r="unknown"}for(var h=0;h<o.length;h++){if(o[h].place==r){o[h].elements.push(d[l]);o[h].weight+=d[l].weight;t=true;break}}if(!t){o.push({id:d[l].name,place:r,elements:new Array(d[l]),weight:d[l].weight,index:f})}}var q=function(j,c){if(j.weight>c.weight){return -1}return 1};o.sort(q);if(a.options.maxPlaceLabels){var g=a.options.maxPlaceLabels;if(g==1){o=[];o.push({place:"all",elements:d,weight:m,index:f})}if(g==2){g++}if(g>2&&o.length+1>g){var p=[];var s=0;for(var l=g-2;l<o.length;l++){p=p.concat(o[l].elements);s+=o[l].weight}o=o.slice(0,g-2);o.push({place:"others",elements:p,weight:s,index:f})}}if(o.length>1){o.push({place:"all",elements:d,weight:m,index:f})}this.placeLabels=o};this.calculatePlacenameTags=function(){var k=this;var o=GeoTemConfig.getColor(this.circle.search);var t="rgb("+o.r0+","+o.g0+","+o.b0+")";var s="rgb("+o.r1+","+o.g1+","+o.b1+")";var g="",j="",p="",q="",r="";if(GeoTemConfig.ie){p+=a.options.ieHighlightLabel.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";";j+=a.options.ieHoveredLabel.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";";q+=a.options.ieSelectedLabel.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";";r+=a.options.ieUnselectedLabel.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";"}else{p+=a.options.highlightLabel.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";";j+=a.options.hoveredLabel.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";";q+=a.options.selectedLabel.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";";r+=a.options.unselectedLabel.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";"}var f=function(c){c.div.onclick=function(){k.changeLabelSelection(c)}};var e=this.count;for(var m=0;m<this.placeLabels.length;m++){var h=this.placeLabels[m];h.selected=false;var d=document.createElement("div");d.setAttribute("class","tagCloudItem");var u=1+(h.weight-1)/this.map.count*a.options.maxLabelIncrease;if(h.place=="all"){u=1}d.style.fontSize=u+"em";h.allStyle=g+"font-size: "+u+"em;";h.selectedStyle=q;h.unselectedStyle=r;h.highlightStyle=p;h.hoverStyle=j;d.innerHTML=h.place+"<span style='font-size:"+(1/u)+"em'>&nbsp;("+h.weight+")</span>";h.div=d;f(h)}if(a.options.labelGrid){this.showPlacelabels()}else{for(var m=0;m<this.placeLabels.length;m++){this.placeLabels[m].div.setAttribute("style",this.placeLabels[m].allStyle+""+this.placeLabels[m].highlightStyle)}}};this.selectLabel=function(c){if(typeof c=="undefined"){c=this.placeLabels[this.placeLabels.length-1]}if(this.map.popup){this.map.popup.showLabelContent(c)}this.selectedLabel=c;this.selectedLabel.div.setAttribute("style",this.selectedLabel.allStyle+""+this.selectedLabel.selectedStyle);this.map.mapLabelSelection(c)};this.changeLabelSelection=function(c){if(this.selectedLabel==c){return}if(typeof this.selectedLabel!="undefined"){this.selectedLabel.div.setAttribute("style",this.selectedLabel.allStyle+""+this.selectedLabel.unselectedStyle)}this.selectLabel(c)};this.showPlacelabels=function(){this.leftDiv=document.createElement("div");this.leftDiv.setAttribute("class","tagCloudDiv");this.map.gui.mapWindow.appendChild(this.leftDiv);this.rightDiv=document.createElement("div");this.rightDiv.setAttribute("class","tagCloudDiv");this.map.gui.mapWindow.appendChild(this.rightDiv);for(var c=0;c<this.placeLabels.length;c++){if(c%2==0){this.leftDiv.appendChild(this.placeLabels[c].div)}else{this.rightDiv.appendChild(this.placeLabels[c].div)}this.placeLabels[c].div.setAttribute("style",this.placeLabels[c].allStyle+""+this.placeLabels[c].highlightStyle)}this.placeTagCloud()};this.placeTagCloud=function(){var h=new OpenLayers.LonLat(this.circle.feature.geometry.x,this.circle.feature.geometry.y);var c=a.openlayersMap.getPixelFromLonLat(h);var j=this.circle.feature.style.pointRadius;var e=this.leftDiv.offsetWidth;var d=this.rightDiv.offsetWidth;this.leftDiv.style.left=(c.x-j-e-5)+"px";this.rightDiv.style.left=(c.x+j+5)+"px";var l=this.leftDiv.offsetHeight;var k=this.rightDiv.offsetHeight;var g=c.y-l/2;var f=c.y-k/2;this.leftDiv.style.top=g+"px";this.rightDiv.style.top=f+"px"};this.remove=function(){$(this.leftDiv).remove();$(this.rightDiv).remove()}}function PackPlacenameTags(b,a){this.circle=b;this.map=a;this.placeLabels;this.selectedLabel;this.allLabel;this.othersLabel;this.unknownLabel;this.calculate=function(){this.calculateLabels();this.calculatePlacenameTags()};this.getLabelList=function(e){var d=e.elements;var g=e.search;var p=0;var q=[];var f=this.map.getLevelOfDetail();for(var m=0;m<d.length;m++){p+=d[m].weight;var x=false;var u=d[m].getPlace(this.map.options.mapIndex,f);if(u==""){u="unknown"}for(var l=0;l<q.length;l++){if(q[l].place==u){q[l].elements.push(d[m]);q[l].weight+=d[m].weight;x=true;break}}if(!x){q.push({id:d[m].name,place:u,elements:new Array(d[m]),weight:d[m].weight,index:g})}}var t=function(j,c){if(j.weight>c.weight){return -1}return 1};q.sort(t);var o=[];if(a.options.maxPlaceLabels){var h=a.options.maxPlaceLabels;if(h==1){q=[];q.push({place:"all",elements:d,weight:p,index:g})}if(h==2){h++}if(h>2&&q.length+1>h){var s=[];var v=0;for(var m=h-2;m<q.length;m++){s=s.concat(q[m].elements);v+=q[m].weight;o.push(q[m])}q=q.slice(0,h-2);var r={place:"others",elements:s,weight:v,index:g};q.push(r);this.othersLabels.push(r)}}if(q.length>1){q.push({place:"all",elements:d,weight:p,index:g})}this.placeLabels.push(q);this.droppedLabels.push(o)};this.calculateLabels=function(){var d=this.circle.circles;this.placeLabels=[];this.droppedLabels=[];this.othersLabels=[];for(var c=0;c<d.length;c++){this.getLabelList(d[c])}};this.calculatePlacenameTags=function(){var m=this;var z=[];var j=[];var e=[];for(var u=0;u<this.placeLabels.length;u++){var y=GeoTemConfig.getColor(this.circle.circles[u].search);var x="rgb("+y.r0+","+y.g0+","+y.b0+")";var w="rgb("+y.r1+","+y.g1+","+y.b1+")";var p="",o="",h="",s="",g="";if(GeoTemConfig.ie){h+=a.options.ieHighlightLabel.replace(/COLOR1/g,w).replace(/COLOR0/g,x)+";";o+=a.options.ieHoveredLabel.replace(/COLOR1/g,w).replace(/COLOR0/g,x)+";";s+=a.options.ieSelectedLabel.replace(/COLOR1/g,w).replace(/COLOR0/g,x)+";";g+=a.options.ieUnselectedLabel.replace(/COLOR1/g,w).replace(/COLOR0/g,x)+";"}else{h+=a.options.highlightLabel.replace(/COLOR1/g,w).replace(/COLOR0/g,x)+";";o+=a.options.hoveredLabel.replace(/COLOR1/g,w).replace(/COLOR0/g,x)+";";s+=a.options.selectedLabel.replace(/COLOR1/g,w).replace(/COLOR0/g,x)+";";g+=a.options.unselectedLabel.replace(/COLOR1/g,w).replace(/COLOR0/g,x)+";"}p+="margin-right:5px;";p+="margin-left:5px;";z.push(g);j.push(s);e.push(o);var d=function(c,k){c.div.onmouseover=function(){if(!c.opposite){var D,B;c.div.setAttribute("style",p+""+j[k]);var E=GeoTemConfig.getColor(k);var l="rgb("+E.r0+","+E.g0+","+E.b0+")";if(k==0){for(var A=0;A<m.droppedLabels[1].length;A++){if(m.droppedLabels[1][A].place==c.place){D=m.droppedLabels[1][A];m.rightDiv.appendChild(D.div);m.drawLine(m.ctxOl,c.div,D.div);var C=m.othersLabels[1].div;C.innerHTML=C.innerHTML.replace(/\(\d*\)/g,"("+(m.othersLabels[1].weight-D.weight)+")");break}}}else{for(var A=0;A<m.droppedLabels[0].length;A++){if(m.droppedLabels[0][A].place==c.place){D=m.droppedLabels[0][A];m.leftDiv.appendChild(D.div);m.drawLine(m.ctxOl,D.div,c.div);var C=m.othersLabels[0].div;C.innerHTML=C.innerHTML.replace(/\(\d*\)/g,"("+(m.othersLabels[0].weight-D.weight)+")");break}}}if(typeof D=="undefined"){D={div:m.naDiv};if(k==0){m.rightDiv.appendChild(m.naDiv);m.drawLine(m.ctxOl,c.div,m.naDiv);D.div.setAttribute("style",p+""+j[1])}else{m.leftDiv.appendChild(m.naDiv);m.drawLine(m.ctxOl,m.naDiv,c.div);D.div.setAttribute("style",p+""+j[0])}m.map.mapLabelHighlight(c)}else{m.map.mapLabelHighlight([c,D])}c.div.onmouseout=function(){c.div.setAttribute("style",p+""+z[k]);var G=m.othersLabels[0].div;G.innerHTML=G.innerHTML.replace(/\(\d*\)/g,"("+m.othersLabels[0].weight+")");var F=m.othersLabels[1].div;F.innerHTML=F.innerHTML.replace(/\(\d*\)/g,"("+m.othersLabels[1].weight+")");$(D.div).remove();m.ctxOl.clearRect(0,0,m.cvOl.width,m.cvOl.height);m.map.mapLabelHighlight()}}}};var q=this.count;for(var v=0;v<this.placeLabels[u].length;v++){var t=this.placeLabels[u][v];t.selected=false;var r=document.createElement("div");r.setAttribute("class","tagCloudItem");var f=1+(t.weight-1)/this.map.count*a.options.maxLabelIncrease;if(t.place=="all"){f=1}r.style.fontSize=f+"em";t.allStyle=p+"font-size: "+f+"em;";t.selectedStyle=s;t.unselectedStyle=g;t.hoverStyle=o;r.innerHTML=t.place+"<span style='font-size:"+(1/f)+"em'>&nbsp;("+t.weight+")</span>";t.div=r;d(t,u)}for(var v=0;v<this.droppedLabels[u].length;v++){var t=this.droppedLabels[u][v];t.selected=false;var r=document.createElement("div");r.setAttribute("class","tagCloudItem");var f=1+(t.weight-1)/this.map.count*a.options.maxLabelIncrease;r.style.fontSize=f+"em";t.allStyle=p+"font-size: "+f+"em;";t.selectedStyle=s;t.unselectedStyle=g;t.hoverStyle=o;r.innerHTML=t.place+"<span style='font-size:"+(1/f)+"em'>&nbsp;("+t.weight+")</span>";t.div=r;r.setAttribute("style",p+""+s)}}this.naDiv=document.createElement("div");this.naDiv.setAttribute("class","tagCloudItem");var f=1;r.style.fontSize=f+"em";t.allStyle=p+"font-size: "+f+"em;";t.selectedStyle=s;t.unselectedStyle=g;t.hoverStyle=o;this.naDiv.innerHTML="Not available";t.div=this.naDiv;if(a.options.labelGrid){this.showPlacelabels()}};this.showPlacelabels=function(){this.leftDiv=document.createElement("div");this.leftDiv.setAttribute("class","tagCloudDiv");this.leftDiv.style.textAlign="right";this.map.gui.mapWindow.appendChild(this.leftDiv);this.centerDiv=document.createElement("div");this.centerDiv.setAttribute("class","tagCloudDiv");this.centerDiv.style.opacity=0.7;this.map.gui.mapWindow.appendChild(this.centerDiv);this.centerDivOl=document.createElement("div");this.centerDivOl.setAttribute("class","tagCloudDiv");this.centerDivOl.style.opacity=0.7;this.map.gui.mapWindow.appendChild(this.centerDivOl);this.rightDiv=document.createElement("div");this.rightDiv.setAttribute("class","tagCloudDiv");this.rightDiv.style.textAlign="left";this.map.gui.mapWindow.appendChild(this.rightDiv);for(var d=0;d<this.placeLabels.length;d++){for(var c=0;c<this.placeLabels[d].length;c++){if(d==0){this.leftDiv.appendChild(this.placeLabels[d][c].div)}else{this.rightDiv.appendChild(this.placeLabels[d][c].div)}this.placeLabels[d][c].div.setAttribute("style",this.placeLabels[d][c].allStyle+""+this.placeLabels[d][c].unselectedStyle)}}this.placeTagCloud();this.setCanvas()};this.placeTagCloud=function(){var h=new OpenLayers.LonLat(this.circle.feature.geometry.x,this.circle.feature.geometry.y);var c=a.openlayersMap.getPixelFromLonLat(h);var j=this.circle.feature.style.pointRadius;var e=this.leftDiv.offsetWidth;var d=this.rightDiv.offsetWidth;this.leftDiv.style.left=(c.x-j-e-5)+"px";this.rightDiv.style.left=(c.x+j+5)+"px";var l=this.leftDiv.offsetHeight;var k=this.rightDiv.offsetHeight;var g=c.y-l/2;var f=c.y-k/2;this.leftDiv.style.top=g+"px";this.rightDiv.style.top=f+"px"};this.setCanvas=function(){var c=Math.max(this.leftDiv.offsetHeight,this.rightDiv.offsetHeight);var h=Math.min(this.leftDiv.offsetTop,this.rightDiv.offsetTop);var g=this.leftDiv.offsetLeft+this.leftDiv.offsetWidth;this.width=this.rightDiv.offsetLeft-g;this.centerDiv.style.left=g+"px";this.centerDiv.style.top=h+"px";this.centerDiv.style.height=c+"px";this.centerDiv.style.width=this.width+"px";this.centerDivOl.style.left=g+"px";this.centerDivOl.style.top=h+"px";this.centerDivOl.style.height=c+"px";this.centerDivOl.style.width=this.width+"px";var d=document.createElement("canvas");this.centerDiv.appendChild(d);if(!d.getContext&&G_vmlCanvasManager){d=G_vmlCanvasManager.initElement(d)}d.width=this.width;d.height=c;ctx=d.getContext("2d");this.cvOl=document.createElement("canvas");this.centerDivOl.appendChild(this.cvOl);if(!this.cvOl.getContext&&G_vmlCanvasManager){this.cvOl=G_vmlCanvasManager.initElement(this.cvOl)}this.cvOl.width=this.width;this.cvOl.height=c+50;this.ctxOl=this.cvOl.getContext("2d");for(var f=0;f<this.placeLabels[0].length;f++){this.placeLabels[0][f].opposite=false}for(var f=0;f<this.placeLabels[1].length;f++){this.placeLabels[1][f].opposite=false}for(var f=0;f<this.placeLabels[0].length;f++){for(var e=0;e<this.placeLabels[1].length;e++){if(this.placeLabels[0][f].place==this.placeLabels[1][e].place){this.drawLine(ctx,this.placeLabels[0][f].div,this.placeLabels[1][e].div);this.placeLabels[0][f].opposite=true;this.placeLabels[1][e].opposite=true}}}};this.drawLine=function(c,j,h){var e=5;var d=this.width-5;var g=j.offsetTop+j.offsetHeight/2;var f=h.offsetTop+h.offsetHeight/2;if(this.leftDiv.offsetTop>this.rightDiv.offsetTop){g+=this.leftDiv.offsetTop-this.rightDiv.offsetTop}else{f+=this.rightDiv.offsetTop-this.leftDiv.offsetTop}c.lineCap="round";c.lineWidth=5;c.beginPath();c.moveTo(e,g);c.lineTo(d,f);c.strokeStyle="#555";c.stroke()};this.remove=function(){$(this.leftDiv).remove();$(this.rightDiv).remove();$(this.centerDiv).remove();$(this.centerDivOl).remove()}}function MapConfig(a){this.options={mapWidth:false,mapHeight:"580px",mapTitle:"GeoTemCo Map View",mapIndex:0,alternativeMap:false,googleMaps:false,bingMaps:false,bingApiKey:"none",osmMaps:true,baseLayer:"Open Street Map",resetMap:true,countrySelect:true,polygonSelect:true,circleSelect:true,squareSelect:true,multiSelection:true,popups:true,olNavigation:false,olLayerSwitcher:false,olMapOverview:false,olKeyboardDefaults:true,olScaleLine:false,geoLocation:true,boundaries:{minLon:-29,minLat:35,maxLon:44,maxLat:67},mapBackground:"#bbd0ed",labelGrid:true,maxPlaceLabels:6,selectDefault:true,maxLabelIncrease:2,labelHover:false,ieHighlightLabel:"color: COLOR1; background-color: COLOR0; filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=80)';-ms-filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=80)';",highlightLabel:"color: COLOR0; text-shadow: 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em COLOR0;",ieSelectedLabel:"color: COLOR1; font-weight: bold;",selectedLabel:"color: COLOR1; font-weight: bold;",ieUnselectedLabel:"color: COLOR1; font-weight: normal;",unselectedLabel:"color: COLOR1; font-weight: normal;",ieHoveredLabel:"color: COLOR1; font-weight: bold;",hoveredLabel:"color: COLOR1; font-weight: bold;",circleGap:0,circleOverlap:{type:"area",overlap:0},minimumRadius:4,circleOutline:2,circleOpacity:"balloon",minTransparency:0.4,maxTransparency:0.8,binning:"generic",noBinningRadii:"dynamic",circlePackings:true,binCount:10,showDescriptions:true,mapSelection:true,binningSelection:false,mapSelectionTools:true,dataInformation:true,overlayVisibility:false,proxyHost:""};if(typeof a!="undefined"){$.extend(this.options,a)}}function MapGui(b,a,m,l){this.map=b;this.container=a;if(m.mapWidth){this.container.style.width=m.mapWidth}if(m.mapHeight){this.container.style.height=m.mapHeight}this.container.style.position="relative";this.mapWindow=document.createElement("div");this.mapWindow.setAttribute("class","mapWindow");this.mapWindow.id="mapWindow"+l;this.mapWindow.style.background=m.mapBackground;this.container.appendChild(this.mapWindow);this.mapContainer=document.createElement("div");this.mapContainer.setAttribute("class","mapContainer");this.mapContainer.id="mapContainer"+l;this.mapContainer.style.position="absolute";this.mapContainer.style.zIndex=0;this.mapWindow.appendChild(this.mapContainer);var h=document.createElement("table");h.setAttribute("class","absoluteToolbar ddbToolbar");this.container.appendChild(h);this.mapToolbar=h;var f=document.createElement("tr");h.appendChild(f);var g=document.createElement("tr");h.appendChild(g);if(m.mapSelection){this.mapTypeTitle=document.createElement("td");f.appendChild(this.mapTypeTitle);this.mapTypeTitle.innerHTML=GeoTemConfig.getString("mapType");this.mapTypeSelector=document.createElement("td");g.appendChild(this.mapTypeSelector)}if(m.mapSelectionTools){this.mapSelectorTitle=document.createElement("td");f.appendChild(this.mapSelectorTitle);this.mapSelectorTitle.innerHTML=GeoTemConfig.getString("mapSelectorTools");var j=document.createElement("td");var k=this.map.initSelectorTools();for(var e in k){j.appendChild(k[e].button)}g.appendChild(j)}if(m.binningSelection){this.binningTitle=document.createElement("td");f.appendChild(this.binningTitle);this.binningTitle.innerHTML=GeoTemConfig.getString("binningType");this.binningSelector=document.createElement("td");g.appendChild(this.binningSelector)}if(GeoTemConfig.allowFilter){this.filterTitle=document.createElement("td");f.appendChild(this.filterTitle);this.filterTitle.innerHTML=GeoTemConfig.getString("filter");this.filterOptions=document.createElement("td");g.appendChild(this.filterOptions)}if(m.dataInformation){this.infoTitle=document.createElement("td");this.infoTitle.innerHTML=m.mapTitle;f.appendChild(this.infoTitle);var d=document.createElement("td");this.mapElements=document.createElement("div");this.mapElements.setAttribute("class","ddbElementsCount");d.appendChild(this.mapElements);g.appendChild(d)}var c=this;if(navigator.geolocation&&m.geoLocation){this.geoActive=false;this.geoLocation=document.createElement("div");this.geoLocation.setAttribute("class","geoLocationOff");this.geoLocation.title=GeoTemConfig.getString("activateGeoLocation");this.container.appendChild(this.geoLocation);this.geoLocation.style.left="20px";this.geoLocation.onclick=function(){var o=function(){if(c.geoActive){c.geoLocation.setAttribute("class","geoLocationOn");c.geoLocation.title=GeoTemConfig.getString(GeoTemConfig.language,"deactivateGeoLocation")}else{c.geoLocation.setAttribute("class","geoLocationOff");c.geoLocation.title=GeoTemConfig.getString(GeoTemConfig.language,"activateGeoLocation")}};if(!c.geoActive){if(typeof c.longitude=="undefined"){navigator.geolocation.getCurrentPosition(function(p){c.longitude=p.coords.longitude;c.latitude=p.coords.latitude;c.map.setMarker(c.longitude,c.latitude);c.geoActive=true;o()},function(p){console.log(typeof p=="string"?p:"error")})}else{c.map.setMarker(c.longitude,c.latitude);c.geoActive=true;o()}}else{c.map.removeMarker();c.geoActive=false;o()}}}if(!m.olNavigation){this.map.zoomSlider=new MapZoomSlider(this.map,"vertical");this.container.appendChild(this.map.zoomSlider.div);this.map.zoomSlider.div.style.left="20px"}if(m.resetMap){this.homeButton=document.createElement("div");this.homeButton.setAttribute("class","mapHome");this.homeButton.title=GeoTemConfig.getString("home");this.container.appendChild(this.homeButton);this.homeButton.style.left="20px";this.homeButton.onclick=function(){c.map.drawObjectLayer(true)}}this.resize=function(){var p=this.container.offsetWidth;var q=this.container.offsetHeight;this.mapWindow.style.height=q+"px";this.mapContainer.style.height=q+"px";var s=h.offsetHeight+20;if(m.olLayerSwitcher){var r=$(".olControlLayerSwitcher")[0];$(r).css("top",s+"px")}if(typeof this.geoLocation!="undefined"){this.geoLocation.style.top=s+"px";s+=this.geoLocation.offsetHeight+4}if(m.olNavigation){var t=$(".olControlPanZoom")[0];$(t).css("top",s+"px");$(t).css("left","12px");var o=document.getElementById("OpenLayers.Control.PanZoom_23_zoomout");s+=$(o).height()+$(o).position().top+4}else{this.map.zoomSlider.div.style.top=s+"px";s+=this.map.zoomSlider.div.offsetHeight+2}if(m.resetMap){this.homeButton.style.top=s+"px"}this.headerHeight=h.offsetHeight;this.headerWidth=h.offsetWidth};this.updateSpaceQuantity=function(o){if(!m.dataInformation){return}this.mapCount=o;if(o!=1){this.mapElements.innerHTML=this.beautifyCount(o)+" "+GeoTemConfig.getString("results")}else{this.mapElements.innerHTML=this.beautifyCount(o)+" "+GeoTemConfig.getString("result")}};this.setMapsDropdown=function(){if(!m.mapSelection){return}$(this.mapTypeSelector).empty();var r=[];var p=this;var o=function(t,s){var u=function(){p.map.setMap(s)};r.push({name:t,onclick:u})};for(var q=0;q<this.map.baseLayers.length;q++){o(this.map.baseLayers[q].name,q)}this.mapTypeDropdown=new Dropdown(this.mapTypeSelector,r,GeoTemConfig.getString("selectMapType"))};this.setMap=function(){if(m.mapSelection){this.mapTypeDropdown.setEntry(this.map.baselayerIndex)}};this.setBinningDropdown=function(){if(!m.binningSelection){return}$(this.binningSelector).empty();var q=[];var o=this;var p=0;var t;var s=function(v,w){if(m.binning==w){t=p}else{p++}var u=function(){m.binning=w;o.map.initWidget(o.map.datasets,false);o.map.riseLayer()};q.push({name:v,onclick:u})};s(GeoTemConfig.getString("genericBinning"),"generic");s(GeoTemConfig.getString("squareBinning"),"square");s(GeoTemConfig.getString("hexagonalBinning"),"hexagonal");s(GeoTemConfig.getString("triangularBinning"),"triangular");s(GeoTemConfig.getString("noBinning"),false);var r=new Dropdown(this.binningSelector,q,GeoTemConfig.getString("binningTooltip"));r.setEntry(t)};this.setBinningDropdown();this.beautifyCount=function(q){var s=q+"";var r=0;var o=s.length;while(o-r>3){r+=3;s=s.substring(0,o-r)+"."+s.substring(o-r);r++;o++}return s}}function MapWidget(a,c,b){this.core=a;this.core.setWidget(this);this.openlayersMap;this.baseLayers;this.objectLayer;this.drawPolygon;this.drawCircle;this.selectCountry;this.dragArea;this.selectFeature;this.navigation;this.div=c;this.iid=GeoTemConfig.getIndependentId("map");this.options=(new MapConfig(b)).options;this.formerCP=this.options.circlePackings;this.gui=new MapGui(this,this.div,this.options,this.iid);this.initialize()}MapWidget.prototype={initialize:function(){var d=this;if(d.options.proxyHost){OpenLayers.ProxyHost=d.options.proxyHost}this.polygons=[];this.connections=[];this.selection=new Selection();this.wmsOverlays=[];this.layerZIndex=1;this.zIndices=[];var e=function(){d.dragArea.activate()};var c=function(){d.dragArea.deactivate()};this.dragControl=new MapControl(this,null,"drag",e,c);var o="http://www.openstreetmap.org/";var q="http://creativecommons.org/licenses/by-sa/2.0/";this.osmLink=document.createElement("div");this.osmLink.setAttribute("class","osmLink");this.osmLink.innerHTML="(c) <a href="+o+">OpenStreetMap contributors</a>, <a href="+q+">CC-BY-SA</a>";this.gui.mapWindow.appendChild(this.osmLink);this.filterBar=new FilterBar(this,this.gui.filterOptions);this.objectLayer=new OpenLayers.Layer.Vector("Data Objects",{projection:"EPSG:4326",displayInLayerSwitcher:false,rendererOptions:{zIndexing:true}});this.markerLayer=new OpenLayers.Layer.Markers("Markers");this.navigation=new OpenLayers.Control.Navigation({zoomWheelEnabled:GeoTemConfig.mouseWheelZoom});this.navigation.defaultDblClick=function(t){var s=this.map.getLonLatFromViewPortPx(t.xy);this.map.setCenter(s,this.map.zoom+1);d.drawObjectLayer(false);if(d.zoomSlider){d.zoomSlider.setValue(d.openlayersMap.getZoom())}};this.navigation.wheelUp=function(s){this.wheelChange(s,1);d.drawObjectLayer(false);if(d.zoomSlider){d.zoomSlider.setValue(d.openlayersMap.getZoom())}d.core.triggerHighlight([])};this.navigation.wheelDown=function(s){this.wheelChange(s,-1);d.drawObjectLayer(false);if(d.zoomSlider){d.zoomSlider.setValue(d.openlayersMap.getZoom())}d.core.triggerHighlight([])};this.resolutions=[78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677];var r={controls:[this.navigation],projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),resolutions:this.resolutions,units:"meters",maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34)};this.openlayersMap=new OpenLayers.Map("mapContainer"+this.iid,r);if(d.options.navigate){this.activeControl="navigate"}this.mds=new MapDataSource(this.openlayersMap,this.options);if(d.options.olNavigation){var g=new OpenLayers.Control.PanZoom();g.onButtonClick=function(s){var t=s.buttonElement;switch(t.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":d.zoom(1);break;case"zoomout":d.zoom(-1);break;case"zoomworld":if(this.map){d.zoom(this.map.zoom*-1)}break}};this.openlayersMap.addControl(g)}if(d.options.popups){var h=function(){if(d.selectedGlyph){var t=new OpenLayers.LonLat(d.selectedGlyph.lon,d.selectedGlyph.lat);var s=d.openlayersMap.getPixelFromLonLat(t);if(d.popup){d.popup.shift(s.x,s.y)}}};this.openlayersMap.events.register("move",this.openlayersMap,h)}if(d.options.olMapOverview){this.openlayersMap.addControl(new OpenLayers.Control.OverviewMap())}if(d.options.olKeyboardDefaults){var l=new OpenLayers.Control.KeyboardDefaults();l.defaultKeyPress=function(s){switch(s.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:var t=this.map.getSize();this.map.pan(0,-0.75*t.h);break;case 34:var t=this.map.getSize();this.map.pan(0,0.75*t.h);break;case 35:var t=this.map.getSize();this.map.pan(0.75*t.w,0);break;case 36:var t=this.map.getSize();this.map.pan(-0.75*t.w,0);break;case 43:case 61:case 187:case 107:d.zoom(1);break;case 45:case 109:case 189:case 95:d.zoom(-1);break}};this.openlayersMap.addControl(l)}if(d.options.olLayerSwitcher){this.openlayersMap.addControl(new OpenLayers.Control.LayerSwitcher())}if(d.options.olScaleLine){this.openlayersMap.addControl(new OpenLayers.Control.ScaleLine())}this.gui.resize();this.openlayersMap.updateSize();this.setBaseLayers();this.gui.setMapsDropdown();this.gui.setMap();this.openlayersMap.addLayers([this.objectLayer,this.markerLayer]);if(d.options.boundaries){var f=d.options.boundaries;var b=new OpenLayers.Bounds(f.minLon,f.minLat,f.maxLon,f.maxLat);var p=b.transform(this.openlayersMap.displayProjection,this.openlayersMap.projection);this.openlayersMap.zoomToExtent(p)}else{this.openlayersMap.zoomToMaxExtent()}this.drawnPolygonHandler=function(A){if(d.mds.getAllObjects()==null){return}var t;if(A instanceof OpenLayers.Geometry.Polygon){t=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon([A]))}else{if(A instanceof OpenLayers.Geometry.MultiPolygon){t=new OpenLayers.Feature.Vector(A)}}d.polygons.push(t);var s=$.extend(true,{},OpenLayers.Feature.Vector.style["default"]);s.graphicZIndex=0;t.style=s;d.objectLayer.addFeatures([t]);try{d.activeControl.deactivate()}catch(y){}var x=d.mds.getObjectsByZoom();for(var w=0;w<x.length;w++){for(var v=0;v<x[w].length;v++){var z=x[w][v];if(d.inPolygon(z)){if(typeof z.fatherBin!="undefined"){for(var u=0;u<z.fatherBin.circles.length;u++){if(z.fatherBin.circles[u]){z.fatherBin.circles[u].setSelection(true)}}}else{z.setSelection(true)}}}}d.mapSelection()};this.polygonDeselection=function(){var u=d.mds.getObjectsByZoom();for(var t=0;t<u.length;t++){for(var s=0;s<u[t].length;s++){var v=u[t][s];if(d.inPolygon(v)){v.setSelection(false)}}}};this.snapper=function(){if(d.polygons.length==0||!d.options.multiSelection){d.deselection()}};if(d.options.polygonSelect){this.drawPolygon=new OpenLayers.Control.DrawFeature(d.objectLayer,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",callbacks:{done:d.drawnPolygonHandler,create:d.snapper}});this.openlayersMap.addControl(this.drawPolygon)}if(d.options.circleSelect){this.drawCircle=new OpenLayers.Control.DrawFeature(d.objectLayer,OpenLayers.Handler.RegularPolygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{sides:40},callbacks:{done:d.drawnPolygonHandler,create:d.snapper}});this.openlayersMap.addControl(this.drawCircle)}if(d.options.squareSelect){this.drawSquare=new OpenLayers.Control.DrawFeature(d.objectLayer,OpenLayers.Handler.RegularPolygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{sides:4},callbacks:{done:d.drawnPolygonHandler,create:d.snapper}});this.openlayersMap.addControl(this.drawSquare)}if(d.options.polygonSelect||d.options.circleSelect||d.options.squareSelect){this.dragArea=new OpenLayers.Control.DragFeature(d.objectLayer,{onStart:function(s){s.style.graphicZIndex=10000;d.polygonDeselection()},onComplete:function(s){s.style.graphicZIndex=0;d.drawnPolygonHandler(s.geometry)}});this.openlayersMap.addControl(this.dragArea);this.modifyArea=new OpenLayers.Control.ModifyFeature(d.objectLayer,{onStart:function(s){s.style.graphicZIndex=10000;d.polygonDeselection()},onComplete:function(s){s.style.graphicZIndex=0;d.drawnPolygonHandler(s.geometry)}});this.openlayersMap.addControl(this.modifyArea);this.modifyArea.mode=OpenLayers.Control.ModifyFeature.RESHAPE}var a=function(t){var s=t.feature;if(s.geometry instanceof OpenLayers.Geometry.Point){if(typeof d.placenameTags!="undefined"){d.placenameTags.remove()}var u=t.feature.parent;if(u instanceof CircleObject){u.placenameTags=new PlacenameTags(u,d);d.placenameTags=u.placenameTags}else{return}u.placenameTags.calculate();d.mapCircleHighlight(s.parent,false);if(typeof d.featureInfo!="undefined"){d.featureInfo.deactivate()}}else{d.dragControl.checkStatus()}};var j=function(t){var s=t.feature;if(s.geometry instanceof OpenLayers.Geometry.Point){var u=t.feature.parent;if(!(u instanceof CircleObject)){return}u.placenameTags.remove();d.mapCircleHighlight(s.parent,true);if(typeof d.featureInfo!="undefined"){d.featureInfo.activate()}}else{d.dragControl.deactivate()}};var m=new OpenLayers.Control.SelectFeature(this.objectLayer,{hover:true,highlightOnly:true,renderIntent:"temporary",eventListeners:{featurehighlighted:a,featureunhighlighted:j}});this.openlayersMap.addControl(m);m.activate();this.selectFeature=new OpenLayers.Control.SelectFeature(this.objectLayer);document.onkeydown=function(s){if(s.ctrlKey){d.ctrlKey=true}};document.onkeyup=function(s){d.ctrlKey=false};var k=function(u,s){if(!(u.feature.geometry instanceof OpenLayers.Geometry.Point)){return}var w=u.feature.parent;if(d.options.multiSelection&&d.ctrlKey){if(d.popup){d.popup.reset();d.selectedGlyph=false}w.toggleSelection();d.mapSelection();return}d.reset();w.setSelection(true);d.objectLayer.drawFeature(w.feature);if(d.options.popups){if(d.popup){d.popup.reset()}var v=u.feature.geometry.getBounds().getCenterLonLat();var t=d.openlayersMap.getPixelFromLonLat(v);d.selectedGlyph={lon:v.lon,lat:v.lat};d.popup=new PlacenamePopup(d);d.popup.createPopup(t.x,t.y,w.placenameTags.placeLabels);if(d.options.selectDefault){w.placenameTags.selectLabel()}}};this.objectLayer.events.on({featureselected:k});this.openlayersMap.addControl(this.selectFeature);this.selectFeature.activate();if(this.zoomSlider){this.zoomSlider.setMaxAndLevels(1000,this.openlayersMap.getNumZoomLevels());this.zoomSlider.setValue(this.openlayersMap.getZoom())}},shift:function(b,a){this.openlayersMap.pan(b,a)},addBaseLayers:function(c){if(c instanceof Array){for(var b in c){var a=new OpenLayers.Layer.WMS(c[b].name,c[b].url,{projection:"EPSG:4326",layers:c[b].layer,transparent:"true",format:"image/png"},{isBaseLayer:true});this.baseLayers.push(a);this.openlayersMap.addLayers([a])}}this.gui.setMapsDropdown()},setBaseLayers:function(){this.baseLayers=[];if(this.options.googleMaps){var a=new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN,minZoomLevel:1,maxZoomLevel:19});var b=new OpenLayers.Layer.Google("Google Streets",{minZoomLevel:1,maxZoomLevel:19});var e=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,minZoomLevel:1,maxZoomLevel:19});var d=new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,minZoomLevel:1,maxZoomLevel:19});this.baseLayers.push(a);this.baseLayers.push(b);this.baseLayers.push(e);this.baseLayers.push(d)}if(this.options.bingMaps){var g=this.options.bingApiKey;var c=new OpenLayers.Layer.Bing({name:"Road",key:g,type:"Road"});var j=new OpenLayers.Layer.Bing({name:"Hybrid",key:g,type:"AerialWithLabels"});var h=new OpenLayers.Layer.Bing({name:"Aerial",key:g,type:"Aerial"});this.baseLayers.push(c);this.baseLayers.push(j);this.baseLayers.push(h)}if(this.options.osmMaps){this.baseLayers.push(new OpenLayers.Layer.OSM("Open Street Map","",{sphericalMercator:true,zoomOffset:1,resolutions:this.resolutions}))}for(var f=0;f<this.baseLayers.length;f++){this.openlayersMap.addLayers([this.baseLayers[f]])}if(this.options.alternativeMap){this.addBaseLayers([this.options.alternativeMap])}this.setBaseLayerByName(this.options.baseLayer)},setBaseLayerByName:function(a){for(var b=0;b<this.baseLayers.length;b++){if(this.baseLayers[b].name==a){this.setMap(b)}}},getBaseLayerName:function(){return this.openlayersMap.baseLayer.name},setOverlays:function(e){var d=this;for(var b in this.wmsOverlays){this.openlayersMap.removeLayer(this.wmsOverlays[b])}this.wmsOverlays=[];var c=[];if(e instanceof Array){for(var b in e){var a=new OpenLayers.Layer.WMS(e[b].name,e[b].url,{projection:"EPSG:4326",layers:e[b].layer,transparent:"true",format:"image/png"},{isBaseLayer:false,visibility:d.options.overlayVisibility});this.wmsOverlays.push(a);if(e[b].featureInfo){c.push(a)}}this.openlayersMap.addLayers(this.wmsOverlays)}if(this.wmsOverlays.length>0&&d.options.overlayVisibility){var d=this;if(typeof this.featureInfo!="undefined"){this.featureInfo.deactivate();this.openlayersMap.removeControl(this.featureInfo)}this.featureInfo=new OpenLayers.Control.WMSGetFeatureInfo({url:"/geoserver/wms",layers:c,eventListeners:{getfeatureinfo:function(f){if(f.text==""){return}var g=d.openlayersMap.getLonLatFromPixel(new OpenLayers.Pixel(f.xy.x,f.xy.y));d.selectedGlyph={lon:g.lon,lat:g.lat};if(typeof d.popup!="undefined"){d.popup.reset()}d.popup=new MapPopup(d);d.popup.initialize(f.xy.x,f.xy.y);d.popup.setContent(f.text)}}});this.openlayersMap.addControl(this.featureInfo);this.featureInfo.activate();this.activateCountrySelector(this.wmsOverlays[this.wmsOverlays.length-1])}else{this.deactivateCountrySelector();if(this.openlayersMap.baseLayer instanceof OpenLayers.Layer.WMS){this.activateCountrySelector(this.openlayersMap.baseLayer)}}},addBaseLayer:function(b){this.baseLayers.push(b);this.openlayersMap.addLayers([b]);for(var a in this.baseLayers){if(this.baseLayers[a].name==this.options.baseLayer){this.setMap(a)}}},drawObjectLayer:function(b){if(typeof this.placenameTags!="undefined"){this.placenameTags.remove()}var w=this.mds.getAllObjects();if(w==null){return}this.objectLayer.removeAllFeatures();if(b){var c,s,a,m;var f=w[w.length-1];for(var z=0;z<f.length;z++){for(var v=0;v<f[z].length;v++){var t=f[z][v];if(a==null||t.originX<a){a=t.originX}if(m==null||t.originX>m){m=t.originX}if(c==null||t.originY<c){c=t.originY}if(s==null||t.originY>s){s=t.originY}}}if(a==m&&c==s){this.openlayersMap.setCenter(new OpenLayers.LonLat(a,c))}else{var g=0.1*(m-a);var e=0.1*(s-c);var d=(this.gui.headerHeight/this.gui.mapWindow.offsetHeight+0.1)*(s-c);this.openlayersMap.zoomToExtent(new OpenLayers.Bounds(a-g,c-e,m+g,s+d));this.openlayersMap.zoomTo(Math.floor(this.openlayersMap.getZoom()))}if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}}var h=this.mds.getObjectsByZoom();var u=this.openlayersMap.getResolution();for(var z=0;z<h.length;z++){for(var v=0;v<h[z].length;v++){var q=h[z][v];var l=q.originX+u*q.shiftX;var k=q.originY+u*q.shiftY;q.feature.geometry.x=l;q.feature.geometry.y=k;q.olFeature.geometry.x=l;q.olFeature.geometry.y=k;q.feature.style.graphicZIndex=this.zIndices[z];q.olFeature.style.graphicZIndex=this.zIndices[z]+1;this.objectLayer.addFeatures([q.feature]);this.objectLayer.addFeatures([q.olFeature])}}var o=this.openlayersMap.getZoom();var r=function(p,j){return Math.sqrt((p.x-j.x)*(p.x-j.x)+(p.y-j.y)*(p.y-j.y))};this.highlightChanged(this.selection.getObjects(this.core))},riseLayer:function(a){this.lastId=a;if(typeof a=="undefined"){a=this.lastId||0}this.zIndices[a]=this.layerZIndex;this.layerZIndex+=2;this.reset();this.drawObjectLayer(false)},initWidget:function(o,a){this.clearMap();this.datasets=o;var B=[];for(var z=0;z<o.length;z++){B.push(o[z].objects)}if(B.length>4){this.options.circlePackings=false}else{this.options.circlePackings=this.formerCP}if(typeof B=="undefined"){return}this.count=0;this.objectCount=0;for(var z=0;z<B.length;z++){var D=0;for(var w=0;w<B[z].length;w++){if(B[z][w].isGeospatial){D+=B[z][w].weight;this.objectCount++}}this.count+=D;this.zIndices.push(this.layerZIndex);this.layerZIndex+=2}this.mds.initialize(B);var x=this.mds.getAllObjects();if(x==null){return}var p=function(c){return Math.PI*c*c};for(var z=0;z<x.length;z++){var C=0;var m=0;for(var w=0;w<x[z].length;w++){for(var v=0;v<x[z][w].length;v++){if(x[z][w][v].radius>m){m=x[z][w][v].radius;C=p(m)}}}var h=p(this.options.minimumRadius);var q=C-h;for(var w=0;w<x[z].length;w++){for(var v=0;v<x[z][w].length;v++){var s=x[z][w][v];var D=GeoTemConfig.getColor(s.search);var f;if(this.options.circleOpacity=="balloon"){var t=this.options.minTransparency;var y=this.options.maxTransparency;f=t+Math.abs(t-y)*(1-(p(s.radius)-h)/q)}else{f=this.options.circleOpacity}var g=false,u=0;if(this.options.circleOutline){g=true;u=this.options.circleOutline}var A={fillColor:"rgb("+D.r0+","+D.g0+","+D.b0+")",fillOpacity:f,strokeWidth:u,strokeColor:"rgb("+D.r1+","+D.g1+","+D.b1+")",stroke:g,pointRadius:s.radius,cursor:"pointer"};var e=new OpenLayers.Geometry.Point(s.originX,s.originY,null);var l=new OpenLayers.Feature.Vector(e);l.style=A;l.parent=s;s.setFeature(l);var b={fillColor:"rgb("+D.r1+","+D.g1+","+D.b1+")",fillOpacity:f,stroke:false,pointRadius:0,cursor:"pointer"};var d=new OpenLayers.Geometry.Point(s.originX,s.originY,null);var r=new OpenLayers.Feature.Vector(d);r.style=b;r.parent=s;s.setOlFeature(r)}}}if(typeof a=="undefined"){this.drawObjectLayer(true)}else{this.drawObjectLayer(a)}this.gui.updateSpaceQuantity(this.count)},reset:function(){if(typeof this.placenameTags!="undefined"){this.placenameTags.remove()}this.objectLayer.removeFeatures(this.polygons);this.polygons=[];this.objectLayer.removeFeatures(this.connections);this.connections=[];this.selectFeature.unselectAll();this.selectedGlyph=false;if(this.dragControl.activated){this.dragControl.deactivate()}if(this.popup){this.popup.reset()}this.filterBar.reset(false);var c=this.mds.getObjectsByZoom();if(c==null){return}for(var b=0;b<c.length;b++){for(var a=0;a<c[b].length;a++){c[b][a].setSelection(false)}}},clearMap:function(){this.reset();this.selection=new Selection();this.zIndices=[];this.layerZIndex=1;this.objectLayer.destroyFeatures()},updatePoint:function(a,b){var c=this.mds.binning.getRadius(a.overlay);if(c!=a.olFeature.style.pointRadius){a.olFeature.style.pointRadius=c;if(b.containsPoint(a.feature.geometry)){this.objectLayer.drawFeature(a.olFeature)}}},highlightChanged:function(e){if(!GeoTemConfig.highlightEvents){return}this.mds.clearOverlay();if(this.selection.valid()){this.mds.setOverlay(GeoTemConfig.mergeObjects(e,this.selection.getObjects()))}else{this.mds.setOverlay(e)}var d=this.mds.getObjectsByZoom();var c=this.openlayersMap.getExtent().toGeometry();for(var b in d){for(var a in d[b]){this.updatePoint(d[b][a],c)}}this.displayConnections()},selectionChanged:function(a){if(!GeoTemConfig.selectionEvents){return}this.reset();this.selection=a;this.highlightChanged(a.objects)},inPolygon:function(a){for(var d=0;d<this.polygons.length;d++){var c=this.polygons[d].geometry;for(var b=0;b<c.components.length;b++){if(c.components[b].containsPoint(a.feature.geometry)){return true}}}return false},mapSelection:function(){var a=[];for(var d=0;d<this.mds.size();d++){a.push([])}var e=this.mds.getObjectsByZoom();for(var d=0;d<e.length;d++){for(var b=0;b<e[d].length;b++){var f=e[d][b];if(f.selected){a[d]=a[d].concat(f.elements)}}}this.selection=new Selection(a,this);this.highlightChanged(a);this.core.triggerSelection(this.selection);this.filterBar.reset(true)},deselection:function(){this.reset();this.selection=new Selection();this.highlightChanged([]);this.core.triggerSelection(this.selection)},filtering:function(){for(var a=0;a<this.datasets.length;a++){this.datasets[a].objects=this.selection.objects[a]}this.core.triggerRefining(this.datasets)},inverseFiltering:function(){var a=[];for(var d=0;d<this.mds.size();d++){a.push([])}var e=this.mds.getObjectsByZoom();for(var d=0;d<e.length;d++){for(var b=0;b<e[d].length;b++){var f=e[d][b];if(!f.selected){a[d]=a[d].concat(f.elements)}}}this.selection=new Selection(a,this);this.filtering()},mapCircleHighlight:function(d,a){if(this.polygons.length>0&&this.inPolygon(d)){return}var c=[];for(var b=0;b<this.mds.size();b++){c.push([])}if(!a&&!d.selected){c[d.search]=d.elements}this.objectLayer.drawFeature(d.feature);this.core.triggerHighlight(c)},mapLabelSelection:function(b){var a=[];for(var c=0;c<this.mds.size();c++){a.push([])}a[b.index]=b.elements;this.selection=new Selection(a,this);this.highlightChanged(a);this.core.triggerSelection(this.selection);this.filterBar.reset(true)},displayConnections:function(){return;if(typeof this.connection!="undefined"){this.objectLayer.removeFeatures(this.connections);this.connections=[]}if(this.options.connections){var v=this.mds.getObjectsByZoom();for(var w in v){for(var u in v[w]){}}var b=this.core.timeplot.getSlices();for(var w=0;w<b.length;w++){for(var u=0;u<b[w].stacks.length;u++){var y=b[w].stacks[u].elements;if(y.length==0){continue}var v=[];for(var s=0;s<y.length;s++){var q=this.mds.getCircle(u,y[s].index).feature.geometry;if(arrayIndex(v,q)==-1){v.push(q)}}var t=new AdjMatrix(v.length);for(var s=0;s<v.length-1;s++){for(var r=s+1;r<v.length;r++){t.setEdge(s,r,dist(v[s],v[r]))}}var p=Prim(t);var a=[];for(var g=0;g<p.length;g++){a.push(new OpenLayers.Geometry.LineString(new Array(v[p[g].v1],v[p[g].v2])))}this.connections[u].push({first:this.mds.getCircle(u,y[0].index).feature.geometry,last:this.mds.getCircle(u,y[y.length-1].index).feature.geometry,lines:a,time:b[w].date})}}var B=this.core.timeplot.leftFlagTime;var f=this.core.timeplot.rightFlagTime;if(B==undefined||B==null){return}else{B=B.getTime();f=f.getTime()}if(thisConnections){for(var w=0;w<this.connections.length;w++){var A=GeoTemConfig.colors[w];var x={strokeColor:"rgb("+A.r1+","+A.g1+","+A.b1+")",strokeOpacity:0.5,strokeWidth:3};var o=[];var h=undefined;for(var u=0;u<this.connections[w].length;u++){var A=this.connections[w][u];var d=A.time.getTime();if(d>=B&&d<=f){if(h!=undefined){var m=new OpenLayers.Geometry.LineString(new Array(h,A.first));this.connectionLayer.addFeatures([new OpenLayers.Feature.Vector(m,null,x)])}for(var s=0;s<A.lines.length;s++){this.connectionLayer.addFeatures([new OpenLayers.Feature.Vector(A.lines[s],null,x)])}h=A.last}}}}}},zoom:function(b){var a=this.openlayersMap.getZoom()+b;if(this.openlayersMap.baseLayer instanceof OpenLayers.Layer.WMS){this.openlayersMap.zoomTo(a)}else{this.openlayersMap.zoomTo(Math.round(a));if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}}this.drawObjectLayer(false);return true},deactivateCountrySelector:function(){this.openlayersMap.removeControl(this.selectCountry);this.selectCountry=undefined},activateCountrySelector:function(a){var b=this;if(this.options.countrySelect&&this.options.mapSelectionTools){this.selectCountry=new OpenLayers.Control.GetFeature({protocol:OpenLayers.Protocol.WFS.fromWMSLayer(a),click:true});this.selectCountry.events.register("featureselected",this,function(c){b.snapper();b.drawnPolygonHandler(c.feature.geometry)});this.openlayersMap.addControl(this.selectCountry);this.countrySelectionControl.enable()}},setMap:function(a){this.baselayerIndex=a;if(this.selectCountry){this.deactivateCountrySelector()}if(this.baseLayers[a] instanceof OpenLayers.Layer.WMS){this.activateCountrySelector(this.baseLayers[a])}else{if(this.countrySelectionControl){this.countrySelectionControl.disable()}}this.openlayersMap.zoomTo(Math.floor(this.openlayersMap.getZoom()));this.openlayersMap.setBaseLayer(this.baseLayers[a]);if(this.baseLayers[a].name=="Open Street Map"){this.osmLink.style.visibility="visible"}else{this.osmLink.style.visibility="hidden"}},initSelectorTools:function(){var d=this;this.mapControls=[];if(this.options.squareSelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.drawSquare.activate()};var c=function(){d.drawSquare.deactivate()};this.mapControls.push(new MapControl(this,a,"square",b,c))}if(this.options.circleSelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.drawCircle.activate()};var c=function(){d.drawCircle.deactivate()};this.mapControls.push(new MapControl(this,a,"circle",b,c))}if(this.options.polygonSelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.drawPolygon.activate()};var c=function(){d.drawPolygon.deactivate()};this.mapControls.push(new MapControl(this,a,"polygon",b,c))}if(this.options.countrySelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.selectCountry.activate();d.dragControl.disable()};var c=function(){d.selectCountry.deactivate();d.dragControl.enable()};this.countrySelectionControl=new MapControl(this,a,"country",b,c);this.mapControls.push(this.countrySelectionControl)}return this.mapControls},getZoom:function(){return this.openlayersMap.getZoom()},setMarker:function(b,g){var q=new OpenLayers.Geometry.Point(b,g,null);q.transform(this.openlayersMap.displayProjection,this.openlayersMap.projection);this.openlayersMap.setCenter(new OpenLayers.LonLat(q.x,q.y));var l=new OpenLayers.Size(22,33);var f=new OpenLayers.Pixel(-(l.w/2),-l.h);var y=new OpenLayers.Icon(GeoTemConfig.path+"marker.png",l,f);var h=new OpenLayers.Marker(new OpenLayers.LonLat(q.x,q.y),y);h.setOpacity(0.9);this.markerLayer.setZIndex(parseInt(this.objectLayer.getZIndex())+1);this.markerLayer.addMarker(h);var m;var v=this.mds.getAllObjects();if(v==null){return}var r=function(j,d){return Math.sqrt((j.x-d.x)*(j.x-d.x)+(j.y-d.y)*(j.y-d.y))};var C=this.openlayersMap.getNumZoomLevels();var a=v[C-1];var A=undefined;var c;for(var w=0;w<a.length;w++){for(var u=0;u<a[w].length;u++){var t=a[w][u].feature.geometry;var z=r(t,q);if(!A||z<A){A=z;c=t}}}var o=0;var e=this.gui.mapWindow.offsetWidth/2-o;var x=this.gui.mapWindow.offsetHeight/2-o;var B=Math.abs(q.x-c.x);var k=Math.abs(q.y-c.y);for(var w=0;w<C;w++){var s=this.openlayersMap.getResolutionForZoom(C-w-1);if(B/s<e&&k/s<x){this.openlayersMap.zoomTo(C-w-1);if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}this.drawObjectLayer(false);break}}},removeMarker:function(){this.markerLayer.removeMarker(this.markerLayer.markers[0])},getLevelOfDetail:function(){var a=Math.floor(this.openlayersMap.getZoom());if(a<=1){return 0}else{if(a<=3){return 1}else{if(a<=8){return 2}else{return 3}}}}};function TimeConfig(a){this.options={timeTitle:"GeoTemCo Time View",timeIndex:0,timeWidth:false,timeHeight:"100px",defaultMinDate:new Date(2012,0,1),defaultMaxDate:new Date(),timeCanvasFrom:"#EEE",timeCanvasTo:"#EEE",rangeBoxColor:"white",rangeBorder:"1px solid #de7708",dataInformation:true,rangeAnimation:true,scaleSelection:true,linearScale:true,unitSelection:true,timeUnit:-1};if(typeof a!="undefined"){$.extend(this.options,a)}}function TimeGui(p,f,b,k){var g=this;this.plot=p;this.container=f;if(b.timeWidth){this.container.style.width=b.timeWidth}if(b.timeHeight){this.container.style.height=b.timeHeight}this.container.style.position="relative";var e=this.container.offsetWidth;var s=this.container.offsetHeight;var r=document.createElement("table");r.setAttribute("class","ddbToolbar");this.container.appendChild(r);this.plotWindow=document.createElement("div");this.plotWindow.id="plotWindow"+k;this.plotWindow.setAttribute("class","plotWindow");this.plotWindow.style.height=(s+12)+"px";this.container.style.height=(s+12)+"px";this.plotWindow.onmousedown=function(){return false};this.plotContainer=document.createElement("div");this.plotContainer.id="plotContainer"+k;this.plotContainer.setAttribute("class","plotContainer");this.plotContainer.style.height=s+"px";this.plotContainer.style.position="absolute";this.plotContainer.style.zIndex=0;this.plotContainer.style.top="12px";this.plotWindow.appendChild(this.plotContainer);this.container.appendChild(this.plotWindow);this.timeplotDiv=document.createElement("div");this.timeplotDiv.style.left="16px";this.timeplotDiv.style.width=(e-32)+"px";this.timeplotDiv.style.height=s+"px";this.plotContainer.appendChild(this.timeplotDiv);var c=document.createElement("canvas");c.setAttribute("class","plotCanvas");this.plotWindow.appendChild(c);if(!c.getContext&&G_vmlCanvasManager){c=G_vmlCanvasManager.initElement(c)}var l=c.getContext("2d");var u=function(){c.width=g.plotWindow.clientWidth;c.height=g.plotWindow.clientHeight;var h=l.createLinearGradient(0,0,0,g.plotWindow.clientHeight);h.addColorStop(0,b.timeCanvasFrom);h.addColorStop(1,b.timeCanvasTo);l.fillStyle=h;l.fillRect(0,0,g.plotWindow.clientWidth,g.plotWindow.clientHeight)};u();this.resize=function(){g.timeplotDiv.style.width=(g.container.offsetWidth-32)+"px";l.clearRect(0,0,g.plotWindow.clientWidth,g.plotWindow.clientHeight);if(typeof p.datasets!="undefined"){p.redrawPlot();p.resetOpacityPlots()}u()};var v=document.createElement("tr");r.appendChild(v);var t=document.createElement("tr");r.appendChild(t);this.timeUnitTitle=document.createElement("td");this.timeUnitTitle.innerHTML=GeoTemConfig.getString("timeUnit");this.timeUnitSelector=document.createElement("td");if(b.unitSelection){t.appendChild(this.timeUnitSelector);v.appendChild(this.timeUnitTitle)}this.timeAnimation=document.createElement("td");this.timeAnimation.innerHTML=GeoTemConfig.getString("timeAnimation");var j=document.createElement("td");var m;this.updateAnimationButtons=function(h){m=h;if(m==0){g.playButton.setAttribute("class","smallButton playDisabled");g.pauseButton.setAttribute("class","smallButton pauseDisabled")}else{if(m==1){g.playButton.setAttribute("class","smallButton playEnabled");g.pauseButton.setAttribute("class","smallButton pauseDisabled")}else{g.playButton.setAttribute("class","smallButton playDisabled");g.pauseButton.setAttribute("class","smallButton pauseEnabled")}}};this.playButton=document.createElement("div");this.playButton.title=GeoTemConfig.getString("playButton");j.appendChild(this.playButton);this.playButton.onclick=function(){if(m==1){p.play()}};this.pauseButton=document.createElement("div");this.pauseButton.title=GeoTemConfig.getString("pauseButton");j.appendChild(this.pauseButton);this.pauseButton.onclick=function(){if(m==2){p.stop()}};this.valueScale=document.createElement("td");this.valueScale.innerHTML=GeoTemConfig.getString("valueScale");var o=document.createElement("td");var d;var q=function(h){if(d!=h){d=h;if(d){g.linButton.setAttribute("class","smallButton linearPlotActivated");g.logButton.setAttribute("class","smallButton logarithmicPlotDeactivated");p.drawLinearPlot()}else{g.linButton.setAttribute("class","smallButton linearPlotDeactivated");g.logButton.setAttribute("class","smallButton logarithmicPlotActivated");p.drawLogarithmicPlot()}}};this.linButton=document.createElement("div");this.linButton.title=GeoTemConfig.getString("linearPlot");o.appendChild(this.linButton);this.linButton.onclick=function(){q(true)};this.logButton=document.createElement("div");this.logButton.title=GeoTemConfig.getString("logarithmicPlot");o.appendChild(this.logButton);this.logButton.onclick=function(){q(false)};if(b.rangeAnimation){v.appendChild(this.timeAnimation);t.appendChild(j);this.updateAnimationButtons(0)}if(b.scaleSelection){v.appendChild(this.valueScale);t.appendChild(o);q(b.linearScale)}if(GeoTemConfig.allowFilter){this.filterTitle=document.createElement("td");v.appendChild(this.filterTitle);this.filterTitle.innerHTML=GeoTemConfig.getString("filter");this.filterOptions=document.createElement("td");t.appendChild(this.filterOptions)}if(b.dataInformation){this.infoTitle=document.createElement("td");this.infoTitle.innerHTML=b.timeTitle;v.appendChild(this.infoTitle);var a=document.createElement("td");this.timeElements=document.createElement("div");this.timeElements.setAttribute("class","ddbElementsCount");a.appendChild(this.timeElements);t.appendChild(a)}this.setHeight=function(){this.container.style.height=(this.plotWindow.offsetHeight+r.offsetHeight)+"px"};this.updateTimeQuantity=function(h){if(b.dataInformation){this.plotCount=h;if(h!=1){this.timeElements.innerHTML=this.beautifyCount(h)+" "+GeoTemConfig.getString("results")}else{this.timeElements.innerHTML=this.beautifyCount(h)+" "+GeoTemConfig.getString("result")}}};this.setTimeUnitDropdown=function(x){$(this.timeUnitSelector).empty();var w=this;var h=[];var z=function(C,B){var A=function(){w.plot.setTimeUnit(C.unit)};h.push({name:C.label,onclick:A})};for(var y=0;y<x.length;y++){z(x[y],y)}this.timeUnitDropdown=new Dropdown(this.timeUnitSelector,h,GeoTemConfig.getString("selectTimeUnit"));this.timeUnitDropdown.setEntry(0)};this.setTimeUnitDropdown([{name:"none",id:-1}]);this.beautifyCount=function(w){var y=w+"";var x=0;var h=y.length;while(h-x>3){x+=3;y=y.substring(0,h-x)+"."+y.substring(h-x);x++;h++}return y};this.hideTimeUnitSelection=function(){this.timeUnitTitle.style.display="none";this.timeUnitSelector.style.display="none"}}function TimeWidget(a,c,b){this.core=a;this.core.setWidget(this);this.timeplot;this.dataSources;this.eventSources;this.tds;this.timeGeometry;this.valueGeometry;this.canvas;this.leftFlagPole;this.rightFlagPole;this.rangeBox;this.leftHandle;this.rightHandle;this.leftFlagPos=null;this.leftFlagTime=null;this.rightFlagPos=null;this.rightFlagTime=null;this.mouseDownTime;this.mouseUpTime;this.mouseTempTime;this.mouseDownPos;this.mouseUpPos;this.mouseTempPos;this.status;this.slider;this.iid=GeoTemConfig.getIndependentId("time");this.options=(new TimeConfig(b)).options;this.gui=new TimeGui(this,c,this.options,this.iid);this.initialize()}TimeWidget.prototype={clearTimeplot:function(){this.timeplot._clearCanvas();this.timeGeometry._earliestDate=null;this.timeGeometry._latestDate=null;this.valueGeometry._minValue=0;this.valueGeometry._maxValue=0;this.highlightedSlice=undefined;this.timeGeometry._clearLabels();this.selection=new Selection()},initWidget:function(h){this.datasets=h;var f=[];for(var l=0;l<h.length;l++){f.push(h[l].objects)}this.clearTimeplot();this.reset();for(var l=0;l<this.timeplot._plots.length;l++){this.timeplot._plots[l].dispose()}this.dataSources=new Array();this.plotInfos=new Array();this.eventSources=new Array();var p=0;this.count=0;for(var l=0;l<f.length;l++){var e=new Timeplot.DefaultEventSource();var a=new Timeplot.ColumnSource(e,1);this.dataSources.push(a);this.eventSources.push(e);var q=GeoTemConfig.getColor(l);var b=Timeplot.createPlotInfo({id:"plot"+l,dataSource:a,timeGeometry:this.timeGeometry,valueGeometry:this.valueGeometry,fillGradient:false,lineColor:"rgba("+q.r1+","+q.g1+","+q.b1+", 1)",fillColor:"rgba("+q.r0+","+q.g0+","+q.b0+", 0.3)",showValues:true});this.plotInfos.push(b);for(var k=0;k<f[l].length;k++){var d=f[l][k];if(d.isTemporal){var m=d.dates[this.options.timeIndex].granularity;if(m==null){continue}else{if(m>p){p=m}}this.count+=d.weight}}}this.timeGeometry._granularity=p;this.timeGeometry._clearLabels();this.timeplot.resetPlots(this.plotInfos);if(this.plotInfos.length==0){this.initLabels(this.timeplot.regularGrid());return}this.timeGeometry.extendedDataSource=this.tds;this.tds.initialize(this.dataSources,this.eventSources,f,p,this.options.timeUnit,this.gui.timeplotDiv.offsetWidth);this.gui.setTimeUnitDropdown(this.tds.availableUnits);this.gui.timeUnitDropdown.setEntry(this.tds.getUnitIndex());var t=this.timeplot._plots;for(var l=0;l<t.length;l++){t[l].pins=[];t[l].style=this.style;for(var k=0;k<this.tds.getSliceNumber();k++){t[l].pins.push({height:0,count:0})}}this.timeplot.repaint();this.timeplot._resizeCanvas();var s=this.tds.timeSlices.length;var r=Math.floor(s/this.canvas.width*this.canvas.height+0.5);this.initLabels([]);this.initOverview();this.gui.updateTimeQuantity(this.count)},setTimeUnit:function(c){this.clearTimeplot();this.reset();this.tds.setTimeUnit(c);var d=this.timeplot._plots;for(var b=0;b<d.length;b++){d[b].pins=[];d[b].style=this.style;for(var a=0;a<this.tds.getSliceNumber();a++){d[b].pins.push({height:0,count:0})}}this.initLabels([])},initialize:function(){this.status=0;this.selection=new Selection();this.paused=true;this.dataSources=new Array();this.plotInfos=new Array();this.eventSources=new Array();this.timeGeometry=new Timeplot.DefaultTimeGeometry({gridColor:"#000000",axisLabelsPlacement:"top"});this.style="graph";this.timeGeometry._hideLabels=true;this.timeGeometry._granularity=0;this.valueGeometry=new Timeplot.LogarithmicValueGeometry({min:0});this.valueGeometry.actLinear();var x=this;this.timeplot=Timeplot.create(this.gui.timeplotDiv,this.plotInfos);this.tds=new TimeDataSource(this.options);this.canvas=this.timeplot.getCanvas();this.leftFlagPole=this.timeplot.putDiv("leftflagpole","timeplot-dayflag-pole");this.rightFlagPole=this.timeplot.putDiv("rightflagpole","timeplot-dayflag-pole");SimileAjax.Graphics.setOpacity(this.leftFlagPole,50);SimileAjax.Graphics.setOpacity(this.rightFlagPole,50);this.rangeBox=this.timeplot.putDiv("rangebox","range-box");this.rangeBox.style.backgroundColor=x.options.rangeBoxColor;this.rangeBox.style.border=x.options.rangeBorder;this.leftHandle=document.createElement("div");this.rightHandle=document.createElement("div");this.gui.plotWindow.appendChild(this.leftHandle);this.gui.plotWindow.appendChild(this.rightHandle);this.leftHandle.title=GeoTemConfig.getString("leftHandle");this.rightHandle.title=GeoTemConfig.getString("rightHandle");this.leftHandle.style.backgroundImage="url("+GeoTemConfig.path+"leftHandle.png)";this.leftHandle.setAttribute("class","plotHandle plotHandleIcon");this.rightHandle.style.backgroundImage="url("+GeoTemConfig.path+"rightHandle.png)";this.rightHandle.setAttribute("class","plotHandle plotHandleIcon");this.poles=this.timeplot.putDiv("poles","pole");this.timeplot.placeDiv(this.poles,{left:0,bottom:0,width:this.canvas.width,height:this.canvas.height,display:"block"});this.poles.appendChild(document.createElement("canvas"));this.filterBar=new FilterBar(this,this.gui.filterOptions);var x=this;this.dragButton=document.createElement("div");this.dragButton.title=GeoTemConfig.getString("dragTimeRange");this.cancelButton=document.createElement("div");this.cancelButton.title=GeoTemConfig.getString("clearSelection");this.cancelButton.onclick=function(){x.deselection()};this.toolbar=document.createElement("div");this.toolbar.setAttribute("class","plotToolbar");this.toolbar.style.borderTop=x.options.rangeBorder;this.toolbar.style.textAlign="center";this.gui.plotWindow.appendChild(this.toolbar);this.toolbarAbsoluteDiv=document.createElement("div");this.toolbarAbsoluteDiv.setAttribute("class","absoluteToolbar");this.toolbar.appendChild(this.toolbarAbsoluteDiv);this.dragButton.setAttribute("class","dragTimeRangeAlt");this.dragButton.style.backgroundImage="url("+GeoTemConfig.path+"drag.png)";this.cancelButton.setAttribute("class","cancelRangeAlt");this.toolbarAbsoluteDiv.appendChild(this.dragButton);this.toolbarAbsoluteDiv.style.width=this.dragButton.offsetWidth+"px";this.gui.plotWindow.appendChild(this.cancelButton);this.overview=document.createElement("div");this.overview.setAttribute("class","timeOverview");this.gui.plotWindow.appendChild(this.overview);var v=false;this.shift=function(D){if(!v){return}if(x.tds.setShift(D)){x.redrawPlot()}setTimeout(function(){x.shift(D)},200)};var k=function(D){v=true;document.onmouseup=function(){v=false;document.onmouseup=null};x.shift(D)};this.shiftLeft=document.createElement("div");this.shiftLeft.setAttribute("class","shiftLeft");this.gui.plotWindow.appendChild(this.shiftLeft);this.shiftLeft.onmousedown=function(){k(1)};this.shiftRight=document.createElement("div");this.shiftRight.setAttribute("class","shiftRight");this.gui.plotWindow.appendChild(this.shiftRight);this.shiftRight.onmousedown=function(){k(-1)};this.plotLabels=document.createElement("div");this.plotLabels.setAttribute("class","plotLabels");this.gui.plotWindow.appendChild(this.plotLabels);this.initLabels(this.timeplot.regularGrid());var r=function(D){if(D>=x.canvas.width){D=x.canvas.width}if(isNaN(D)||D<0){D=0}var E=x.timeGeometry.fromScreen(D);if(E==0){return}return x.dataSources[0].getClosestValidTime(E)};var C=function(E){var D=x.timeGeometry.toScreen(E);if(D>=x.canvas.width){D=x.canvas.width}if(isNaN(D)||D<0){D=0}return D};var g=function(E,D){if(E>D){x.leftFlagPos=D;x.rightFlagPos=E}else{x.leftFlagPos=E;x.rightFlagPos=D}x.leftFlagTime=x.dataSources[0].getClosestValidTime(x.timeGeometry.fromScreen(x.leftFlagPos));x.rightFlagTime=x.dataSources[0].getClosestValidTime(x.timeGeometry.fromScreen(x.rightFlagPos))};var h=function(){x.leftFlagPole.style.visibility="visible";x.rightFlagPole.style.visibility="visible";x.rangeBox.style.visibility="visible";x.timeplot.placeDiv(x.leftFlagPole,{left:x.leftFlagPos,bottom:0,height:x.canvas.height,display:"block"});x.timeplot.placeDiv(x.rightFlagPole,{left:x.rightFlagPos,bottom:0,height:x.canvas.height,display:"block"});var H=x.rightFlagPos-x.leftFlagPos;if(x.popup){x.popupClickDiv.style.visibility="visible";x.timeplot.placeDiv(x.popupClickDiv,{left:x.leftFlagPos,width:H+1,height:x.canvas.height,display:"block"})}x.timeplot.placeDiv(x.rangeBox,{left:x.leftFlagPos,width:H+1,height:x.canvas.height,display:"block"});var O=x.timeplot._plots;for(i=0;i<O.length;i++){O[i].fullOpacityPlot(x.leftFlagTime,x.rightFlagTime,x.leftFlagPos,x.rightFlagPos,GeoTemConfig.getColor(i));O[i].opacityPlot.style.visibility="visible"}var M=x.tds.unit;var L=x.gui.plotContainer.offsetTop;var F=x.gui.plotContainer.offsetLeft;var G=x.leftFlagPole.offsetLeft+x.timeplot.getElement().offsetLeft;var J=x.rightFlagPole.offsetLeft+x.timeplot.getElement().offsetLeft;var I=J-G;var E=x.canvas.width;var K=x.timeplot.getElement().offsetLeft;var D=L+Math.floor(x.gui.timeplotDiv.offsetHeight/2-x.leftHandle.offsetHeight/2);x.leftHandle.style.visibility="visible";x.rightHandle.style.visibility="visible";x.leftHandle.style.left=(G-x.leftHandle.offsetWidth/2)+"px";x.rightHandle.style.left=(J-x.rightHandle.offsetWidth+1+x.rightHandle.offsetWidth/2)+"px";x.leftHandle.style.top=D+"px";x.rightHandle.style.top=D+"px";if(J==G){x.rightHandle.style.visibility="hidden";x.leftHandle.style.backgroundImage="url("+GeoTemConfig.path+"mergedHandle.png)"}else{x.leftHandle.style.backgroundImage="url("+GeoTemConfig.path+"leftHandle.png)"}x.cancelButton.style.visibility="visible";x.cancelButton.style.top=L+"px";if(I>x.cancelButton.offsetWidth){x.cancelButton.style.left=(F+J-x.cancelButton.offsetWidth)+"px"}else{x.cancelButton.style.left=(F+J)+"px"}var N=x.toolbarAbsoluteDiv.offsetWidth;if(I>=N){x.toolbar.style.left=G+"px";x.toolbar.style.width=(I+1)+"px";x.toolbarAbsoluteDiv.style.left=((I-N)/2)+"px"}else{x.toolbar.style.left=(K+x.leftFlagPos*(E-N)/(E-I))+"px";x.toolbar.style.width=(N+2)+"px";x.toolbarAbsoluteDiv.style.left="0px"}x.toolbar.style.top=(L+x.timeplot.getElement().offsetHeight)+"px";x.toolbar.style.visibility="visible";x.toolbarAbsoluteDiv.style.visibility="visible"};var o=function(E){var D=0;while(E){D+=E.offsetLeft;E=E.offsetParent}return D};var m=o(x.timeplot.getElement());var j=function(D){if(x.style=="bars"&&x.leftFlagTime==x.rightFlagTime){var E=x.tds.getSliceIndex(x.leftFlagTime);var I=x.leftFlagTime;var G=x.leftFlagPos;var H,F;if(E==0){H=x.tds.getSliceTime(E+1)}else{if(E==x.tds.getSliceNumber()-1){H=x.tds.getSliceTime(E-1)}else{if(D<x.leftFlagPos){H=x.tds.getSliceTime(E-1)}else{H=x.tds.getSliceTime(E+1)}}}F=x.timeGeometry.toScreen(H);g(G,F,I,H)}};var A,z,p;var c=function(I,H){var F=H-I;if(x.status==2){var E=r(A+F);if(E==x.mouseTempTime){return}x.mouseTempTime=E;x.mouseTempPos=x.timeGeometry.toScreen(x.mouseTempTime);g(x.mouseDownPos,x.mouseTempPos)}else{if(x.status==3){F*=p;var D=H-m;if(D<=x.canvas.width/2){var E=r(A+F);if(E==x.leftFlagTime){return}x.leftFlagTime=E;var G=x.leftFlagPos;x.leftFlagPos=x.timeGeometry.toScreen(x.leftFlagTime);G-=x.leftFlagPos;x.rightFlagTime=r(x.rightFlagPos-G);x.rightFlagPos=x.timeGeometry.toScreen(x.rightFlagTime)}else{var E=r(z+F);if(E==x.rightFlagTime){return}x.rightFlagTime=E;var G=x.rightFlagPos;x.rightFlagPos=x.timeGeometry.toScreen(x.rightFlagTime);G-=x.rightFlagPos;x.leftFlagTime=r(x.leftFlagPos-G);x.leftFlagPos=x.timeGeometry.toScreen(x.leftFlagTime)}}}j(H-m);h();x.timeSelection()};var d=function(H,G,E){if(!x.paused){var D=x.canvas.width/(x.tds.timeSlices.length-1)/5;var F=20*D;if(E){G=0}c(H,G);if(x.rightFlagPos>=x.canvas.width){E=true;F=1000}else{E=false}setTimeout(function(){d(H,G+D,E)},F)}};var y=function(){var E=x.rightFlagPos-x.leftFlagPos;var D=x.toolbarAbsoluteDiv.offsetWidth;var F=x.canvas.width;if(E<D){p=(F-E)/(F-D)}else{p=1}};this.play=function(){if(this.leftFlagPos==null){return}x.paused=false;x.gui.updateAnimationButtons(2);x.status=3;y();A=x.leftFlagPos;z=x.rightFlagPos;var D=Math.round(x.leftFlagPos);d(D,D+1,false)};this.stop=function(){x.paused=true;x.status=0;x.gui.updateAnimationButtons(1)};var t=function(D){var E=GeoTemConfig.getMousePosition(D).left;document.onmousemove=function(F){c(E,GeoTemConfig.getMousePosition(F).left);if(x.popup){x.popup.reset()}}};var q=function(){x.mouseDownTime=x.rightFlagTime;x.mouseTempTime=x.leftFlagTime;x.mouseDownPos=x.timeGeometry.toScreen(x.mouseDownTime);A=x.leftFlagPos};var w=function(){x.mouseDownTime=x.leftFlagTime;x.mouseTempTime=x.rightFlagTime;x.mouseDownPos=x.timeGeometry.toScreen(x.mouseDownTime);A=x.rightFlagPos};var b=function(){A=x.leftFlagPos;z=x.rightFlagPos;y()};var f=function(){if(x.style=="bars"&&x.mouseUpTime==x.mouseDownTime){var D=x.tds.getSliceIndex(x.mouseUpTime);if(D==0){x.mouseUpTime=x.tds.getSliceTime(D+1)}else{if(D==x.tds.getSliceNumber()-1){x.mouseUpTime=x.tds.getSliceTime(D-1)}else{if(x.x<x.leftFlagPos){x.mouseUpTime=x.tds.getSliceTime(D-1)}else{x.mouseUpTime=x.tds.getSliceTime(D+1)}}}}};this.leftHandle.onmousedown=function(D){if(x.status!=2){q();x.status=2;t(D);document.onmouseup=function(){document.onmousemove=null;document.onmouseup=null;x.stop()}}};this.rightHandle.onmousedown=function(D){if(x.status!=2){w();x.status=2;t(D);document.onmouseup=function(){document.onmousemove=null;document.onmouseup=null;x.stop()}}};this.dragButton.onmousedown=function(D){if(x.status!=3){x.status=3;b();t(D);document.onmouseup=function(){document.onmousemove=null;document.onmouseup=null;x.stop()}}};var a=function(F,R,N){if(x.dataSources.length>0){x.x=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(R,x.canvas).x);if(x.status==0){var G=r(x.x);if(x.leftFlagPos!=null&&x.popup&&G>=x.leftFlagTime&&G<=x.rightFlagTime){var Q=x.leftFlagPos+(x.rightFlagPos-x.leftFlagPos)/2;var D=[];for(var J=0;J<x.dataSources.length;J++){D.push([])}for(var J=0;J<x.selectedObjects.length;J++){if(x.selectedObjects[J].value==1){for(var I=0;I<x.selectedObjects[J].objects.length;I++){D[I]=D[I].concat(x.selectedObjects[J].objects[I])}}}var M=[];for(var J=0;J<D.length;J++){if(D[J].length==0){continue}var O=GeoTemConfig.getColor(J);var H="rgb("+O.r0+","+O.g0+","+O.b0+")";var E=document.createElement("div");E.setAttribute("class","tagCloudItem");E.style.color=H;var P={div:E,elements:D[J]};var K=0;for(I in D[J]){K+=D[J][I].weight}var L=2*K/1000;if(L>2){L=2}E.style.fontSize=(1+L)+"em";E.style.textShadow="0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em "+O.hex;if(K==1){E.innerHTML=K+" object"}else{E.innerHTML=K+" objects"}var S=function(U,V,T){V.onclick=function(){x.popup.showLabelContent(U);V.style.textShadow="0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em "+T};V.onmouseover=function(){V.style.textShadow="0 -1px "+T+", 1px 0 "+T+", 0 1px "+T+", -1px 0 "+T};V.onmouseout=function(){V.style.textShadow="0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em "+T}};S(P,E,O.hex);M.push(P)}if(M.length>0){x.popup.createPopup(Q+20,0,M)}}else{x.deselection();x.status=1;x.mouseDownTime=G;x.mouseTempTime=x.mouseDownTime;x.mouseDownPos=x.timeGeometry.toScreen(x.mouseDownTime);g(x.mouseDownPos,x.mouseDownPos,x.mouseDownTime,x.mouseDownTime);document.onmouseup=function(){if(x.status==1){x.mouseUpTime=x.mouseTempTime;x.mouseUpPos=x.timeGeometry.toScreen(x.mouseUpTime);g(x.mouseDownPos,x.mouseUpPos,x.mouseDownTime,x.mouseUpTime);j(x.x);h();x.timeSelection();x.gui.updateAnimationButtons(1);document.onmouseup=null;x.status=0}}}}}};var e=function(E,D,F){if(x.dataSources.length>0){x.x=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(D,x.canvas).x);if(x.status==1){x.mouseTempTime=r(x.x);x.mouseTempPos=x.timeGeometry.toScreen(x.mouseTempTime);g(x.mouseDownPos,x.mouseTempPos,x.mouseDownTime,x.mouseTempTime);j(x.x);h()}}};var s=function(F,E,G){if(x.dataSources.length>0){var D=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(E,x.canvas).x);var H=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(E,x.canvas).y);if(D>x.canvas.width-2||isNaN(D)||D<2){x.timeHighlight(true);x.highlightedSlice=undefined}else{if(H>x.canvas.height-2||isNaN(H)||H<2){x.timeHighlight(true);x.highlightedSlice=undefined}}}};var B=function(D,L,H){if(x.dataSources.length>0){var J=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(L,x.canvas).x);var E=r(J);if(E==undefined){return}var F;var K=x.tds.timeSlices;var G=x.tds.getSliceIndex(E);if(x.style=="graph"){F=K[G]}if(x.style=="bars"){var I=x.timeGeometry.toScreen(E);if(J<I&&G>0){F=K[G-1]}else{F=K[G]}}if(x.highlightedSlice==undefined||x.highlightedSlice!=F){x.highlightedSlice=F;x.timeHighlight(false)}}};this.redrawPlot=function(){x.clearTimeplot();x.tds.reset(this.timeGeometry);x.timeplot._prepareCanvas();x.timeplot.repaint();if(x.leftFlagPos!=null){x.leftFlagPos=C(x.leftFlagTime);x.rightFlagPos=C(x.rightFlagTime);h()}else{x.displayOverlay()}x.initLabels([]);x.updateOverview()};this.resetOpacityPlots=function(){var E=x.timeplot._plots;for(var D=0;D<E.length;D++){E[D]._opacityCanvas.width=this.canvas.width;E[D]._opacityCanvas.height=this.canvas.height;if(x.leftFlagTime!=null){E[D].fullOpacityPlot(x.leftFlagTime,x.rightFlagTime,x.leftFlagPos,x.rightFlagPos,GeoTemConfig.getColor(D))}}};var u=function(F,E,H){if(E.preventDefault){E.preventDefault()}if(x.dataSources.length==0){return}var I=0;if(!E){E=window.event}if(E.wheelDelta){I=E.wheelDelta/120;if(window.opera){I=-I}}else{if(E.detail){I=-E.detail/3}}if(I){var D=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(E,x.canvas).x);var G=r(D);x.zoom(I,G)}};var l=this.timeplot.getElement();SimileAjax.DOM.registerEvent(l,"mousedown",a);SimileAjax.DOM.registerEvent(l,"mousemove",e);SimileAjax.DOM.registerEvent(l,"mousemove",B);SimileAjax.DOM.registerEvent(l,"mouseout",s);if(GeoTemConfig.mouseWheelZoom){}this.gui.setHeight()},resetOverlay:function(){this.poles.style.visibility="hidden";var c=this.timeplot._plots;for(var b=0;b<c.length;b++){for(var a=0;a<c[b].pins.length;a++){c[b].pins[a]={height:0,count:0}}}},reset:function(){this.leftFlagPole.style.visibility="hidden";this.rightFlagPole.style.visibility="hidden";this.rangeBox.style.visibility="hidden";this.leftHandle.style.visibility="hidden";this.rightHandle.style.visibility="hidden";this.toolbar.style.visibility="hidden";this.toolbarAbsoluteDiv.style.visibility="hidden";this.cancelButton.style.visibility="hidden";var c=this.timeplot._plots;for(var a=0;a<c.length;a++){c[a].opacityPlot.style.visibility="hidden"}this.resetOverlay();this.filterBar.reset(false);var b=this.tds.timeSlices;if(b!=undefined){for(var a=0;a<b.length;a++){b[a].reset()}}this.status=0;this.stop();this.gui.updateAnimationButtons(0);this.leftFlagPos=null;this.leftFlagTime=null;this.rightFlagPos=null;this.rightFlagTime=null;this.mouseDownTime=null;this.mouseUpTime=null;this.mouseTempTime=null;this.mouseDownPos=null;this.mouseUpPos=null;this.mouseTempPos=null;if(this.popup){this.popup.reset();this.popupClickDiv.style.visibility="hidden"}},displayOverlay:function(){this.poles.style.visibility="visible";var o=this.poles.getElementsByTagName("canvas")[0];o.width=this.canvas.width;o.height=this.canvas.height;if(!o.getContext&&G_vmlCanvasManager){o=G_vmlCanvasManager.initElement(o)}var v=o.getContext("2d");v.clearRect(0,0,this.canvas.width,this.canvas.height);var s=this.timeplot._plots;var t=this.tds.timeSlices;for(var m=0;m<t.length;m++){if(this.style=="bars"&&m+1==t.length){return}if(t[m].overlay()==0){continue}var c=t[m].stacks;var d=t[m].date;var r;if(this.style=="graph"){r=this.timeGeometry.toScreen(d)}else{if(this.style=="bars"){var b=this.timeGeometry.toScreen(d);var a=this.timeGeometry.toScreen(t[m+1].date);r=(b+a)/2}}var q=[];var p=0;for(var g=0;g<c.length;g++){var l=s[g]._dataSource.getData();for(var f=0;f<l.times.length;f++){if(l.times[f].getTime()==d.getTime()){var u=s[g]._valueGeometry.toScreen(s[g]._dataSource.getData().values[f])*c[g].overlay/c[g].value;q.push(u);s[g].pins[m]={height:u,count:c[g].overlay};if(u>p){p=u}break}}}v.fillStyle="rgb(102,102,102)";v.beginPath();v.rect(r-1,this.canvas.height-p,2,p);v.fill();for(var g=0;g<q.length;g++){if(q[g]>0){var e=GeoTemConfig.getColor(g);v.fillStyle="rgba("+e.r1+","+e.g1+","+e.b1+",0.6)";v.beginPath();v.arc(r,this.canvas.height-q[g],2.5,0,Math.PI*2,true);v.closePath();v.fill()}}}},highlightChanged:function(a){if(!GeoTemConfig.highlightEvents){return}this.resetOverlay();if(this.selection.valid()){if(!this.selection.equal(this)){this.tds.setOverlay(GeoTemConfig.mergeObjects(a,this.selection.getObjects(this)))}else{this.tds.setOverlay(a)}}else{this.tds.setOverlay(a)}this.displayOverlay()},selectionChanged:function(a){if(!GeoTemConfig.selectionEvents){return}this.reset();this.selection=a;this.tds.setOverlay(a.objects);this.displayOverlay()},getOverviewLeft:function(f){var a=this.overview.offsetWidth;var c=this.tds.earliest().getTime();var d=this.tds.latest().getTime();var b=f.getTime();return Math.round(a*(b-c)/(d-c))},initOverview:function(){var e=this.timeGeometry._grid;if(e.length==0){var d=this;setTimeout(function(){d.initOverview()},10);return}this.overview.style.width=this.canvas.width+"px";var c=this.gui.timeplotDiv.offsetLeft;this.overview.innerHTML="";this.overview.style.left=c+"px";this.overviewRange=document.createElement("div");this.overviewRange.setAttribute("class","overviewRange");this.overview.appendChild(this.overviewRange);for(var b=0;b<e.length;b++){var a=document.createElement("div");a.setAttribute("class","overviewLabel");a.innerHTML=e[b].label;a.style.left=Math.floor(e[b].x)+"px";this.overview.appendChild(a)}this.updateOverview()},initLabels:function(e){if(e.length==0){e=this.timeGeometry._grid;if(e.length==0){var d=this;setTimeout(function(){d.initLabels([])},10);return}}this.plotLabels.style.width=this.canvas.width+"px";var c=this.gui.timeplotDiv.offsetLeft;this.plotLabels.style.left=c+"px";this.plotLabels.innerHTML="";for(var b=0;b<e.length;b++){var a=document.createElement("div");a.setAttribute("class","plotLabel");a.innerHTML=e[b].label;a.style.left=Math.floor(e[b].x)+"px";this.plotLabels.appendChild(a)}},updateOverview:function(){if(this.tds.getZoom()>0){this.plotLabels.style.visibility="hidden";this.timeGeometry._hideLabels=false;this.overview.style.visibility="visible";this.shiftLeft.style.visibility="visible";this.shiftRight.style.visibility="visible";var b=this.getOverviewLeft(this.tds.timeSlices[this.tds.leftSlice].date);var a=this.getOverviewLeft(this.tds.timeSlices[this.tds.rightSlice].date);this.overviewRange.style.left=b+"px";this.overviewRange.style.width=(a-b)+"px"}else{this.timeGeometry._hideLabels=true;this.plotLabels.style.visibility="visible";this.overview.style.visibility="hidden";this.shiftLeft.style.visibility="hidden";this.shiftRight.style.visibility="hidden"}},getSlices:function(){return this.tds.timeSlices},timeSelection:function(){var f=this.tds.timeSlices;var b,c;for(var e=0;e<f.length;e++){if(f[e].date.getTime()==this.leftFlagTime.getTime()){b=e}if(f[e].date.getTime()==this.rightFlagTime.getTime()){if(this.style=="graph"){c=e}if(this.style=="bars"){c=e-1}}}var a=[];for(var e=0;e<GeoTemConfig.datasets;e++){a.push([])}for(var e=0;e<f.length;e++){if(e>=b&&e<=c){for(var d in f[e].stacks){a[d]=a[d].concat(f[e].stacks[d].elements)}}}this.selection=new Selection(a,this);this.core.triggerSelection(this.selection);this.filterBar.reset(true)},deselection:function(){this.reset();this.selection=new Selection();this.core.triggerSelection(this.selection)},filtering:function(){for(var a=0;a<this.datasets.length;a++){this.datasets[a].objects=this.selection.objects[a]}this.core.triggerRefining(this.datasets)},inverseFiltering:function(){var f=this.tds.timeSlices;var b,c;for(var e=0;e<f.length;e++){if(f[e].date.getTime()==this.leftFlagTime.getTime()){b=e}if(f[e].date.getTime()==this.rightFlagTime.getTime()){if(this.style=="graph"){c=e}if(this.style=="bars"){c=e-1}}}var a=[];for(var e=0;e<GeoTemConfig.datasets;e++){a.push([])}for(var e=0;e<f.length;e++){if(e>=b&&e<=c){continue}for(var d in f[e].stacks){a[d]=a[d].concat(f[e].stacks[d].elements)}}this.selection=new Selection(a,this);this.filtering()},timeHighlight:function(b){if(this.status==0){var d=this.highlightedSlice;var a=[];for(var c=0;c<this.tds.size();c++){a.push([])}var e=true;if(this.leftFlagTime!=null){if(this.style=="graph"&&d.date>=this.leftFlagTime&&d.date<=this.rightFlagTime){e=false}if(this.style=="bars"&&d.date>=this.leftFlagTime&&d.date<this.rightFlagTime){e=false}}if(!b&&e){for(var c in d.stacks){a[c]=a[c].concat(d.stacks[c].elements)}}this.core.triggerHighlight(a)}},timeRefining:function(){this.core.triggerRefining(this.selection.objects)},setStyle:function(a){this.style=a},drawLinearPlot:function(){if(typeof this.valueGeometry!="undefined"){this.valueGeometry.actLinear();this.timeplot.repaint();this.resetOpacityPlots();this.displayOverlay()}},drawLogarithmicPlot:function(){if(typeof this.valueGeometry!="undefined"){this.valueGeometry.actLogarithmic();this.timeplot.repaint();this.resetOpacityPlots();this.displayOverlay()}}};function TableConfig(a){this.options={tableWidth:false,tableHeight:false,validResultsPerPage:[10,20,50,100],initialResultsPerPage:10,tableSorting:true,tableContentOffset:250,tableSelectPage:true,tableSelectAll:false,tableShowSelected:true,unselectedCellColor:"#EEE"};if(typeof a!="undefined"){$.extend(this.options,a)}}function TableGui(b,c,a){this.tableContainer=c;if(a.tableWidth){this.tableContainer.style.width=a.tableWidth}if(a.tableHeight){this.tableContainer.style.height=a.tableHeight}this.tableContainer.style.position="relative";this.tabs=document.createElement("div");this.tabs.setAttribute("class","tableTabs");c.appendChild(this.tabs);this.input=document.createElement("div");this.input.setAttribute("class","tableInput");c.appendChild(this.input)}function TableWidget(a,c,b){this.core=a;this.core.setWidget(this);this.tables=[];this.tableTabs=[];this.tableElements=[];this.tableHash=[];this.options=(new TableConfig(b)).options;this.gui=new TableGui(this,c,this.options);this.filterBar=new FilterBar(this)}TableWidget.prototype={initWidget:function(g){$(this.gui.tabs).empty();$(this.gui.input).empty();this.activeTable=undefined;this.tables=[];this.tableTabs=[];this.tableElements=[];this.tableHash=[];this.selection=new Selection();this.filterBar.reset(false);var a=this;var h=function(k,j){var l=document.createElement("div");l.setAttribute("class","tableTab");l.style.backgroundColor=a.options.unselectedCellColor;l.onclick=function(){a.selectTable(j)};l.innerHTML=k;return l};for(var c in g){this.tableHash.push([]);var f=h(g[c].label,c);this.gui.tabs.appendChild(f);this.tableTabs.push(f);var e=[];for(var b in g[c].objects){e.push(new TableElement(g[c].objects[b]));this.tableHash[c][g[c].objects[b].index]=e[e.length-1]}var d=new Table(e,this,c);this.tables.push(d);this.tableElements.push(e)}if(g.length>0){this.selectTable(0)}},getHeight:function(){if(this.options.tableHeight){return this.gui.tableContainer.offsetHeight-this.gui.tabs.offsetHeight}return false},selectTable:function(a){if(this.activeTable!=a){if(typeof this.activeTable!="undefined"){this.tables[this.activeTable].hide();this.tableTabs[this.activeTable].style.backgroundColor=this.options.unselectedCellColor}this.activeTable=a;this.tables[this.activeTable].show();var b=GeoTemConfig.getColor(this.activeTable);this.tableTabs[this.activeTable].style.backgroundColor="rgb("+b.r0+","+b.g0+","+b.b0+")";this.core.triggerRise(a)}},highlightChanged:function(c){if(!GeoTemConfig.highlightEvents){return}if(this.tables.length>0){return}for(var b=0;b<this.tableElements.length;b++){for(var a=0;a<this.tableElements[b].length;a++){this.tableElements[b][a].highlighted=false}}for(var b=0;b<c.length;b++){for(var a=0;a<c[b].length;a++){this.tableHash[b][c[b][a].index].highlighted=true}}this.tables[this.activeTable].update()},selectionChanged:function(c){if(!GeoTemConfig.selectionEvents){return}this.reset();if(this.tables.length==0){return}this.selection=c;for(var b=0;b<this.tableElements.length;b++){for(var a=0;a<this.tableElements[b].length;a++){this.tableElements[b][a].selected=false;this.tableElements[b][a].highlighted=false}}var d=c.getObjects(this);for(var b=0;b<d.length;b++){for(var a=0;a<d[b].length;a++){this.tableHash[b][d[b][a].index].selected=true}}this.tables[this.activeTable].reset();this.tables[this.activeTable].update()},triggerHighlight:function(c){var a=[];for(var b=0;b<GeoTemConfig.datasets;b++){a.push([])}if(typeof c!="undefined"){a[this.activeTable].push(c)}this.core.triggerHighlight(a)},tableSelection:function(){var a=[];for(var c=0;c<GeoTemConfig.datasets;c++){a.push([])}var d=false;for(var c=0;c<this.tableElements.length;c++){for(var b=0;b<this.tableElements[c].length;b++){var f=this.tableElements[c][b];if(f.selected){a[c].push(f.object);d=true}}}this.selection=new Selection();if(d){this.selection=new Selection(a,this)}this.core.triggerSelection(this.selection);this.filterBar.reset(true)},deselection:function(){this.reset();this.selection=new Selection();this.core.triggerSelection(this.selection)},filtering:function(){this.core.triggerRefining(this.selection.objects)},inverseFiltering:function(){var a=[];for(var c=0;c<GeoTemConfig.datasets;c++){a.push([])}var d=false;for(var c=0;c<this.tableElements.length;c++){for(var b=0;b<this.tableElements[c].length;b++){var f=this.tableElements[c][b];if(!f.selected){a[c].push(f.object);d=true}}}this.selection=new Selection();if(d){this.selection=new Selection(a,this)}this.filtering()},triggerRefining:function(){this.core.triggerRefining(this.selection.objects)},reset:function(){this.filterBar.reset(false);if(this.tables.length>0){this.tables[this.activeTable].resetElements();this.tables[this.activeTable].reset();this.tables[this.activeTable].update()}}};function Table(b,a,c){this.elements=b;this.showElementsLength=b.length;this.parent=a;this.id=c;this.options=a.options;this.validResultsPerPage=[10,20,50,100];this.keyHeaderList=[];this.initialize()}Table.prototype={initToolbar:function(){var r=this;this.toolbar=document.createElement("table");this.toolbar.setAttribute("class","ddbToolbar");this.toolbar.style.overflow="auto";this.tableDiv.appendChild(this.toolbar);var b=document.createElement("tr");this.toolbar.appendChild(b);var d=document.createElement("td");b.appendChild(d);if(r.options.tableSelectPage){var f=true;this.selectPage=document.createElement("div");this.selectPage.setAttribute("class","smallButton selectPage");this.selectPage.title=GeoTemConfig.getString("selectTablePageItemsHelp");d.appendChild(this.selectPage);this.selectPage.onclick=function(){f=!f;if(f){var u=0;for(var v=r.first;v<r.elements.length;v++){r.elements[v].selected=false;u++;if(u==r.resultsPerPage){break}}r.selectPage.setAttribute("class","smallButton selectPage");r.selectPage.title=GeoTemConfig.getString("selectTablePageItemsHelp")}else{var u=0;for(var v=r.first;v<r.elements.length;v++){r.elements[v].selected=true;u++;if(u==r.resultsPerPage){break}}r.selectPage.setAttribute("class","smallButton deselectPage");r.selectPage.title=GeoTemConfig.getString("deselectTablePageItemsHelp")}r.update();r.parent.tableSelection()}}if(r.options.tableSelectAll){var t=true;this.selectAll=document.createElement("div");this.selectAll.setAttribute("class","smallButton selectAll");r.selectAll.title=GeoTemConfig.getString("selectAllTableItemsHelp");d.appendChild(this.selectAll);this.selectAll.onclick=function(){t=!t;if(t){for(var u=0;u<r.elements.length;u++){r.elements[u].selected=false}r.selectAll.setAttribute("class","smallButton selectAll");r.selectAll.title=GeoTemConfig.getString("selectAllTableItemsHelp")}else{for(var u=0;u<r.elements.length;u++){r.elements[u].selected=true}r.selectAll.setAttribute("class","smallButton deselectAll");r.selectAll.title=GeoTemConfig.getString("deselectAllTableItemsHelp")}r.update();r.parent.tableSelection()}}this.showSelectedItems=false;if(r.options.tableShowSelected){this.showSelected=document.createElement("div");this.showSelected.setAttribute("class","smallButton showSelected");r.showSelected.title=GeoTemConfig.getString("showSelectedHelp");d.appendChild(this.showSelected);this.showSelected.onclick=function(){r.showSelectedItems=!r.showSelectedItems;if(r.showSelectedItems){r.showElementsLength=0;for(var u=0;u<r.elements.length;u++){if(r.elements[u].selected){r.showElementsLength++}}r.showSelected.setAttribute("class","smallButton showAll")}else{r.showElementsLength=r.elements.length;r.showSelected.setAttribute("class","smallButton showSelected")}r.updateIndices(r.resultsPerPage);r.update()}}this.selectors=d;var k=document.createElement("td");b.appendChild(k);var p=document.createElement("td");b.appendChild(p);this.resultsInfo=document.createElement("div");this.resultsInfo.setAttribute("class","resultsInfo");k.appendChild(this.resultsInfo);this.firstPage=document.createElement("div");this.firstPage.setAttribute("class","paginationButton");this.firstPage.title=GeoTemConfig.getString("paginationFirsPageHelp");p.appendChild(this.firstPage);this.firstPage.onclick=function(){if(r.page!=0){r.page=0;r.update()}};this.previousPage=document.createElement("div");this.previousPage.setAttribute("class","paginationButton");this.previousPage.title=GeoTemConfig.getString("paginationPreviousPageHelp");p.appendChild(this.previousPage);this.previousPage.onclick=function(){if(r.page>0){r.page--;r.update()}};this.pageInfo=document.createElement("div");this.pageInfo.setAttribute("class","pageInfo");p.appendChild(this.pageInfo);this.nextPage=document.createElement("div");this.nextPage.setAttribute("class","paginationButton");this.nextPage.title=GeoTemConfig.getString("paginationNextPageHelp");p.appendChild(this.nextPage);this.nextPage.onclick=function(){if(r.page<r.pages-1){r.page++;r.update()}};this.lastPage=document.createElement("div");this.lastPage.setAttribute("class","paginationButton");this.lastPage.title=GeoTemConfig.getString("paginationLastPageHelp");p.appendChild(this.lastPage);this.lastPage.onclick=function(){if(r.page!=r.pages-1){r.page=r.pages-1;r.update()}};this.resultsDropdown=document.createElement("div");this.resultsDropdown.setAttribute("class","resultsDropdown");p.appendChild(this.resultsDropdown);var c=[];var e=function(w,u){var v=function(){r.updateIndices(w);r.update()};c.push({name:w,onclick:v})};for(var m=0;m<r.options.validResultsPerPage.length;m++){e(r.options.validResultsPerPage[m],m)}var o=new Dropdown(this.resultsDropdown,c,"selectMapType");for(var m=0;m<r.options.validResultsPerPage.length;m++){if(r.options.initialResultsPerPage==r.options.validResultsPerPage[m]){o.setEntry(m);break}}o.div.title=GeoTemConfig.getString("paginationDropdownHelp");this.input=document.createElement("div");this.input.style.overflow="auto";this.tableDiv.appendChild(this.input);this.elementList=document.createElement("table");this.elementList.setAttribute("class","resultList");this.input.appendChild(this.elementList);var j=this.parent.getHeight();if(j){this.input.style.height=(j-p.offsetHeight)+"px";this.input.style.overflowY="auto"}this.elementListHeader=document.createElement("tr");this.elementList.appendChild(this.elementListHeader);if(GeoTemConfig.allowFilter){var a=document.createElement("th");this.elementListHeader.appendChild(a)}if(typeof(this.elements[0])=="undefined"){return}var q=[];var l=[];var h=function(){for(var u in q){q[u].setAttribute("class","sort sortAscDeactive")}for(var u in l){l[u].setAttribute("class","sort sortDescDeactive")}};var g=function(w){r.keyHeaderList.push(w);var u=document.createElement("th");r.elementListHeader.appendChild(u);var y=document.createElement("div");var v=document.createElement("div");var x=document.createElement("div");x.setAttribute("class","headerLabel");x.innerHTML=w;u.appendChild(v);u.appendChild(x);u.appendChild(y);y.setAttribute("class","sort sortAscDeactive");y.title=GeoTemConfig.getString("sortAZHelp");v.setAttribute("class","sort sortDescDeactive");v.title=GeoTemConfig.getString("sortZAHelp");q.push(y);l.push(v);y.onclick=function(){h();y.setAttribute("class","sort sortAscActive");r.sortAscending(w);r.update()};v.onclick=function(){h();v.setAttribute("class","sort sortDescActive");r.sortDescending(w);r.update()}};for(var s in this.elements[0].object.tableContent){g(s)}},sortAscending:function(b){var a=function(d,c){if(d.object.tableContent[b]<c.object.tableContent[b]){return -1}return 1};this.elements.sort(a)},sortDescending:function(b){var a=function(d,c){if(d.object.tableContent[b]>c.object.tableContent[b]){return -1}return 1};this.elements.sort(a)},setPagesText:function(){var a=GeoTemConfig.getString("pageInfo");a=a.replace("PAGES_ID",this.pages);a=a.replace("PAGE_ID",this.page+1);this.pageInfo.innerHTML=a},setResultsText:function(){if(this.elements.length==0){this.resultsInfo.innerHTML="0 Results"}else{var b=GeoTemConfig.getString("resultsInfo");var c=this.page*this.resultsPerPage+1;var a=(this.page+1==this.pages)?this.showElementsLength:c+this.resultsPerPage-1;b=b.replace("RESULTS_FROM_ID",c);b=b.replace("RESULTS_TO_ID",a);b=b.replace("RESULTS_ID",this.showElementsLength);this.resultsInfo.innerHTML=b}},updateIndices:function(b){if(typeof this.resultsPerPage=="undefined"){this.page=0;this.resultsPerPage=0}var a=this.page*this.resultsPerPage;this.resultsPerPage=b;if(this.showSelectedItems){a=0}this.pages=Math.floor(this.showElementsLength/this.resultsPerPage);if(this.showElementsLength%this.resultsPerPage!=0){this.pages++}this.page=Math.floor(a/this.resultsPerPage)},update:function(){var s=this;$(this.elementList).find("tr:gt(0)").remove();if(this.page==0){this.previousPage.setAttribute("class","paginationButton previousPageDisabled");this.firstPage.setAttribute("class","paginationButton firstPageDisabled")}else{this.previousPage.setAttribute("class","paginationButton previousPageEnabled");this.firstPage.setAttribute("class","paginationButton firstPageEnabled")}if(this.page==this.pages-1){this.nextPage.setAttribute("class","paginationButton nextPageDisabled");this.lastPage.setAttribute("class","paginationButton lastPageDisabled")}else{this.nextPage.setAttribute("class","paginationButton nextPageEnabled");this.lastPage.setAttribute("class","paginationButton lastPageEnabled")}this.setPagesText();this.setResultsText();if(this.showSelectedItems){var f=this.page*this.resultsPerPage;var m=0;for(var q=0;q<this.elements.length;q++){if(m==f){this.first=q;break}if(this.elements[q].selected){m++}}}else{this.first=this.page*this.resultsPerPage}var u=GeoTemConfig.getColor(this.id);var h=[];var o=function(){for(var c=0;c<h.length;c++){if(!h[c].e.selected){h[c].e.highlighted=false;$(h[c].div).css("background-color",s.options.unselectedCellColor)}}};var v=function(e,x){var k=function(){o();if(!e.selected){e.highlighted=true;$(x).css("background-color","rgb("+u.r0+","+u.g0+","+u.b0+")");s.parent.triggerHighlight(e.object)}};var c=function(){o();if(!e.selected){s.parent.triggerHighlight()}};$(x).hover(k,c);$(x).mousemove(function(){if(!e.selected&&!e.highlighted){e.highlighted=true;$(x).css("background-color","rgb("+u.r0+","+u.g0+","+u.b0+")");s.parent.triggerHighlight(e.object)}})};var g=function(e,x,k){var c=function(z){var y=$(k).is(":checked");if(y){e.selected=true;e.highlighted=false}else{e.selected=false;e.highlighted=true}s.parent.tableSelection()};$(k).click(c)};this.checkboxes=[];var m=0;for(var q=this.first;q<this.elements.length;q++){var t=this.elements[q];if(typeof(t)=="undefined"){continue}if(this.showSelectedItems&&!t.selected){continue}var d=$("<tr/>").appendTo(this.elementList);if(GeoTemConfig.allowFilter){var r=$("<td/>").appendTo(d);var l=$("<input type='checkbox'/>").appendTo(r);$(l).attr("checked",t.selected)}var a=function(c,z){var x=z.substring(0,s.options.tableContentOffset);x=x.substring(0,x.lastIndexOf(" "));x+=" ... ";var k=$("<div style='display:inline-block;'/>").appendTo(c);$(k).html(x);var e=false;var y=$("<div style='display:inline-block;'><a href='javascript:void(0)'>>></a></div>").appendTo(c);$(y).click(function(){e=!e;if(e){$(k).html(z);$(y).html('<a href="javascript:void(0)"><<</a>')}else{$(k).html(x);$(y).html('<a href="javascript:void(0)">>></a>')}})};for(var p=0;p<s.keyHeaderList.length;p++){var w=s.keyHeaderList[p];var j=t.object.tableContent[w];var b=$("<td/>").appendTo(d);if(s.options.tableContentOffset&&j.length<s.options.tableContentOffset){$(b).html(j)}else{a(b,j)}}if(t.selected||t.highlighted){$(d).css("background-color","rgb("+u.r0+","+u.g0+","+u.b0+")")}else{$(d).css("background-color",s.options.unselectedCellColor)}h.push({e:t,div:d});v(t,d);if(GeoTemConfig.allowFilter){g(t,d,l);this.checkboxes.push(l);$(r).css("text-align","center")}m++;if(m==this.resultsPerPage){break}}},show:function(){if(GeoTemConfig.allowFilter){this.parent.filterBar.appendTo(this.selectors)}this.tableDiv.style.display="block"},hide:function(){this.tableDiv.style.display="none"},resetElements:function(){for(var a=0;a<this.elements.length;a++){this.elements[a].selected=false;this.elements[a].highlighted=false}},reset:function(){this.showSelectedItems=false;this.showElementsLength=this.elements.length;this.showSelected.setAttribute("class","smallButton showSelected");this.updateIndices(this.resultsPerPage)},initialize:function(){this.tableDiv=document.createElement("div");this.tableDiv.setAttribute("class","singleTable");this.parent.gui.input.appendChild(this.tableDiv);this.initToolbar();this.tableDiv.style.display="none";this.updateIndices(this.options.initialResultsPerPage);this.update()}};function TableElement(a){this.object=a;this.selected=false;this.highlighted=false}function DataObject(c,e,a,g,f,b){this.name=c;this.description=e;this.weight=f;this.tableContent=b;this.percentage=0;this.setPercentage=function(h){this.percentage=h};this.locations=a;this.isGeospatial=false;if(this.locations.length>0){this.isGeospatial=true}this.placeDetails=[];for(var d=0;d<this.locations.length;d++){this.placeDetails.push(this.locations[d].place.split("/"))}this.getLatitude=function(h){return this.locations[h].latitude};this.getLongitude=function(h){return this.locations[h].longitude};this.getPlace=function(h,j){if(j>=this.placeDetails[h].length){return this.placeDetails[h][this.placeDetails[h].length-1]}return this.placeDetails[h][j]};this.dates=g;this.isTemporal=false;if(this.dates.length>0){this.isTemporal=true}this.getDate=function(h){return this.dates[h].date};this.getTimeGranularity=function(h){return this.dates[h].granularity};this.setIndex=function(h){this.index=h};this.getTimeString=function(){if(this.timeStart!=this.timeEnd){return(SimileAjax.DateTime.getTimeString(this.granularity,this.timeStart)+" - "+SimileAjax.DateTime.getTimeString(this.granularity,this.timeEnd))}else{return SimileAjax.DateTime.getTimeString(this.granularity,this.timeStart)+""}}}function Dataset(b,a){this.objects=b;this.label=a}function TimeDataSource(a){this.options=a;this.timeSlices=[];this.unit;this.minDate;this.maxDate;this.eventSources;this.events;this.leftSlice;this.rightSlice;this.hashMapping}TimeDataSource.prototype={findTimeUnits:function(f,a,c){var b=SimileAjax.DateTime;this.availableUnits=[];var e=SimileAjax.DateTime.gregorianUnitLengths;for(var d=0;d<e.length;d++){if(f>d){continue}var h=0;var k=new Date(this.minDate.getTime());do{b.roundDownToInterval(k,d,undefined,1,0);h++;b.incrementByInterval(k,d,undefined)}while(k.getTime()<=this.maxDate.getTime()&&h<c+2);if(h>0&&h<=c){this.availableUnits.push({unit:d,slices:h,label:SimileAjax.DateTime.Strings[GeoTemConfig.language][d]})}}var j=c+1;for(var d=0;d<this.availableUnits.length;d++){var g=Math.abs(this.availableUnits[d].slices-200);if(g<j){j=g;this.unit=this.availableUnits[d].unit}}},getUnitIndex:function(){for(var a=0;a<this.availableUnits.length;a++){if(this.unit==this.availableUnits[a].unit){return a}}return 0},setTimeUnit:function(a){this.unit=a;this.initializeSlices()},initialize:function(a,h,f,p,b,e){this.dataSources=a;this.eventSources=h;this.timeObjects=f;this.minDate=undefined;this.maxDate=undefined;this.hashMapping=[];for(var l=0;l<f.length;l++){this.hashMapping.push([]);for(var k=0;k<f[l].length;k++){var c=f[l][k];if(c.isTemporal){var m=c.dates[this.options.timeIndex].granularity;if(m==null){continue}var d=c.dates[this.options.timeIndex].date;if(this.minDate==undefined||d.getTime()<this.minDate.getTime()){this.minDate=d}if(this.maxDate==undefined||d.getTime()>this.maxDate.getTime()){this.maxDate=d}}}}if(this.minDate==undefined){this.minDate=this.options.defaultMinDate;this.maxDate=this.options.defaultMaxDate}this.findTimeUnits(p,b,e);this.initializeSlices()},initializeSlices:function(){for(var f=0;f<this.dataSources.length;f++){this.dataSources[f]._range={earliestDate:null,latestDate:null,min:0,max:0}}this.timeSlices=[];var b=SimileAjax.DateTime;var q=new Date(this.minDate.getTime()-0.9*b.gregorianUnitLengths[this.unit]);do{b.roundDownToInterval(q,this.unit,undefined,1,0);var p=new TimeSlice(SimileAjax.NativeDateUnit.cloneValue(q),this.timeObjects.length);this.timeSlices.push(p);b.incrementByInterval(q,this.unit,undefined)}while(q.getTime()<=this.maxDate.getTime()+1.1*b.gregorianUnitLengths[this.unit]);for(var f=0;f<this.timeObjects.length;f++){for(var e=0;e<this.timeObjects[f].length;e++){var a=this.timeObjects[f][e];if(a.isTemporal){var c=a.dates[this.options.timeIndex].date;for(var d=0;d<this.timeSlices.length-1;d++){var h=this.timeSlices[d].date.getTime();var g=this.timeSlices[d+1].date.getTime();var l=null;if(c>=h&&c<g){l=this.timeSlices[d].getStack(f)}if(d==this.timeSlices.length-2&&c>=g){l=this.timeSlices[d+1].getStack(f)}if(l!=null){l.addObject(a);this.hashMapping[f][a.index]=l;break}}}}}this.events=[];for(var f=0;f<this.eventSources.length;f++){var r=[];for(var e=0;e<this.timeSlices.length;e++){var m=new Array(""+this.timeSlices[e].stacks[f].value);r.push({date:this.timeSlices[e].date,value:m})}this.eventSources[f].loadData(r);this.events.push(r)}this.leftSlice=0;this.rightSlice=this.timeSlices.length-1},getSliceNumber:function(){return this.timeSlices.length},getSliceIndex:function(b){for(var a=0;a<this.timeSlices.length;a++){if(b==this.timeSlices[a].date){return a}}},getSliceTime:function(a){return this.timeSlices[a].date},setShift:function(a){if(a==1&&this.leftSlice!=0){this.leftSlice--;this.rightSlice--;return true}else{if(a==-1&&this.rightSlice!=this.timeSlices.length-1){this.leftSlice++;this.rightSlice++;return true}else{return false}}},setZoom:function(h,b,a,g){var f=0;var e=0;var c=-1;if(h>0){c=1;if(a!=null){f=this.getSliceIndex(a)-this.leftSlice;e=this.rightSlice-this.getSliceIndex(g)}else{slice=this.getSliceIndex(b);if(slice==this.leftSlice||slice==this.rightSlice){return}f=slice-1-this.leftSlice;e=this.rightSlice-slice-1}}else{if(h<0){f=this.leftSlice;e=this.timeSlices.length-1-this.rightSlice}}var d=2*h;if(Math.abs(f+e)<Math.abs(d)){d=f+e}if(f+e==0){return false}var k=Math.round(f/(f+e)*d);var j=d-k;this.leftSlice+=k;this.rightSlice-=j;return true},reset:function(a){for(var b=0;b<this.eventSources.length;b++){this.eventSources[b].loadData(this.events[b].slice(this.leftSlice,this.rightSlice+1));if(b+1<this.eventSources.length){a._earliestDate=null;a._latestDate=null}}},getZoom:function(){if(this.timeSlices==undefined){return 0}return Math.round((this.timeSlices.length-3)/2)-Math.round((this.rightSlice-this.leftSlice-2)/2)},earliest:function(){return this.timeSlices[0].date},latest:function(){return this.timeSlices[this.timeSlices.length-1].date},setOverlay:function(a){for(var d=0;d<this.timeSlices.length;d++){this.timeSlices[d].reset()}for(var c in a){for(var b in a[c]){var e=a[c][b];if(e.isTemporal){if(e.getTimeGranularity(this.options.timeIndex)==null){continue}this.hashMapping[c][e.index].overlay+=e.weight}}}},size:function(){if(this.timeSlices.length==0){return 0}return this.timeSlices[0].stacks.length}};function TimeSlice(a,c){this.date=a;this.selected=false;this.stacks=[];for(var b=0;b<c;b++){this.stacks.push(new TimeStack())}this.getStack=function(d){return this.stacks[d]};this.reset=function(){for(var d in this.stacks){this.stacks[d].overlay=0}};this.overlay=function(){var e=0;for(var d in this.stacks){if(this.stacks[d].overlay>e){e=this.stacks[d].overlay}}return e}}function TimeStack(){this.overlay=0;this.value=0;this.elements=[];this.addObject=function(a){this.elements.push(a);this.value+=a.weight}}Binning=function(b,a){this.map=b;this.options=a;this.reset()};Binning.prototype={getSet:function(){var a=this.options.binning;if(!a){return this.getExactBinning()}else{if(a=="generic"){return this.getGenericBinning()}else{if(a=="square"){return this.getSquareBinning()}else{if(a=="hexagonal"){return this.getHexagonalBinning()}else{if(a=="triangular"){return this.getTriangularBinning()}}}}}},getExactBinning:function(){if(typeof this.binnings.exact=="undefined"){this.exactBinning()}return this.binnings.exact},getGenericBinning:function(){if(typeof this.binnings.generic=="undefined"){this.genericBinning()}return this.binnings.generic},getSquareBinning:function(){if(typeof this.binnings.square=="undefined"){this.squareBinning()}return this.binnings.square},getHexagonalBinning:function(){if(typeof this.binnings.hexagonal=="undefined"){this.hexagonalBinning()}return this.binnings.hexagonal},getTriangularBinning:function(){if(typeof this.binnings.triangular=="undefined"){this.triangularBinning()}return this.binnings.triangular},reset:function(){this.zoomLevels=this.map.getNumZoomLevels();this.binnings=[];this.minimumRadius=this.options.minimumRadius;this.maximumRadius=0;this.maximumPoints=0;this.minArea=0;this.maxArea=0},getMaxRadius:function(a){return 4*Math.log(a)/Math.log(2)},setObjects:function(e){this.objects=e;for(var b=0;b<this.objects.length;b++){var d=0;for(var a=0;a<this.objects[b].length;a++){if(this.objects[b][a].isGeospatial){d+=this.objects[b][a].weight}}var c=this.getMaxRadius(d);if(c>this.maximumRadius){this.maximumRadius=c;this.maximumPoints=d;this.maxArea=Math.PI*this.maximumRadius*this.maximumRadius;this.minArea=Math.PI*this.minimumRadius*this.minimumRadius}}},dist:function(b,d,a,c){return Math.sqrt((b-a)*(b-a)+(d-c)*(d-c))},exactBinning:function(){var x=[];var d=[];var a=[];var v=[];var q=[];for(var u=0;u<this.objects.length;u++){q.push([]);v.push([]);for(var t=0;t<this.objects[u].length;t++){var m=this.objects[u][t];if(m.isGeospatial){if(typeof v[u][""+m.getLongitude(this.options.mapIndex)]=="undefined"){v[u][""+m.getLongitude(this.options.mapIndex)]=[]}if(typeof v[u][""+m.getLongitude(this.options.mapIndex)][""+m.getLatitude(this.options.mapIndex)]=="undefined"){v[u][""+m.getLongitude(this.options.mapIndex)][""+m.getLatitude(this.options.mapIndex)]=[];q[u].push(v[u][""+m.getLongitude(this.options.mapIndex)][""+m.getLatitude(this.options.mapIndex)])}v[u][""+m.getLongitude(this.options.mapIndex)][""+m.getLatitude(this.options.mapIndex)].push(m)}}}var s=[];var e=[];var w=[];for(var u=0;u<q.length;u++){s.push([]);e.push([]);w.push([]);for(var t=0;t<q[u].length;t++){var h=q[u][t];var l=new OpenLayers.Geometry.Point(h[0].getLongitude(this.options.mapIndex),h[0].getLatitude(this.options.mapIndex),null);l.transform(this.map.displayProjection,this.map.projection);var g=0;for(var f=0;f<h.length;f++){g+=h[f].weight}var b=this.options.minimumRadius;if(this.options.noBinningRadii=="dynamic"){b=this.getRadius(g)}var c=new CircleObject(l.x,l.y,0,0,h,b,u,g);s[u].push(c);for(var f=0;f<h.length;f++){e[u][h[f].index]=c;w[u][h[f].index]=false}}}for(var r=0;r<this.zoomLevels;r++){x.push(s);d.push(e);a.push(w)}this.binnings.exact={circleSets:x,hashMaps:d,selectionHashs:a}},genericClustering:function(a,h){var t=[];var G=[];var c=[];var b=[];var f=new Clustering(-20037508.34,-20037508.34,20037508.34,20037508.34);for(var D=0;D<a.length;D++){for(var A=0;A<a[D].length;A++){var m=a[D][A];if(m.isGeospatial){var l=new OpenLayers.Geometry.Point(m.getLongitude(this.options.mapIndex),m.getLatitude(this.options.mapIndex),null);l.transform(this.map.displayProjection,this.map.projection);var s=new Vertex(Math.floor(l.x),Math.floor(l.y),a.length,this);s.addElement(m,m.weight,D);f.add(s)}}}for(var D=0;D<this.zoomLevels;D++){var q=[];var x=[];var e=[];var E=[];for(var A=0;A<a.length;A++){x.push([]);e.push([]);E.push([])}var u=this.map.getResolutionForZoom(this.zoomLevels-D-1);f.mergeForResolution(u,this.options.circleGap,this.options.circleOverlap);for(var A=0;A<f.vertices.length;A++){var s=f.vertices[A];if(!s.legal){continue}var J=[];for(var w=0;w<s.elements.length;w++){if(s.elements[w].length>0){J.push({search:w,elements:s.elements[w],radius:s.radii[w],weight:s.weights[w]})}}var g=function(j,d){if(j.radius>d.radius){return -1}if(d.radius>j.radius){return 1}return 0};var I={circles:[],length:0,radius:s.radius/u,x:s.x,y:s.y};for(var w=0;w<a.length;w++){I.circles.push(false)}var H=function(L,K,p){var j=h||p.search;var o=new CircleObject(s.x,s.y,L,K,p.elements,p.radius,j,p.weight,I);x[p.search].push(o);I.circles[j]=o;I.length++;for(var d=0;d<p.elements.length;d++){e[p.search][p.elements[d].index]=o;E[p.search][p.elements[d].index]=false}};if(J.length==1){H(0,0,J[0])}else{if(J.length==2){var C=J[0].radius;var z=J[1].radius;H(-1*z,0,J[0]);H(C,0,J[1])}else{if(J.length==3){J.sort(g);var C=J[0].radius;var z=J[1].radius;var v=J[2].radius;var F=((2/3*Math.sqrt(3)-1)/2)*z;var B=s.radius/u-C-F;var y=C-B;H(-B,0,J[0]);H(y+z-3*F,z,J[1]);H(y+v-(3*F*v/z),-1*v,J[2])}else{if(J.length==4){J.sort(g);var C=J[0].radius;var z=J[1].radius;var v=J[2].radius;var r=J[3].radius;var F=(Math.sqrt(2)-1)*z;H(-1*F-z,0,J[0]);H(C-z,-1*F-r,J[3]);H(C-z,F+v,J[2]);H(F+C,0,J[1])}}}}if(I.length>1){q.push(I)}}G.push(x);t.push(q);c.push(e);b.push(E)}G.reverse();t.reverse();c.reverse();b.reverse();return{circleSets:G,binSets:t,hashMaps:c,selectionHashs:b}},genericBinning:function(){if(this.options.circlePackings||this.objects.length==1){this.binnings.generic=this.genericClustering(this.objects)}else{var a=[];var f=[];var d=[];for(var c=0;c<this.objects.length;c++){var e=this.genericClustering([this.objects[c]],c);if(c==0){a=e.circleSets;f=e.hashMaps;d=e.selectionHashs}else{for(var b=0;b<a.length;b++){a[b]=a[b].concat(e.circleSets[b]);f[b]=f[b].concat(e.hashMaps[b]);d[b]=d[b].concat(e.selectionHashs[b])}}}this.binnings.generic={circleSets:a,hashMaps:f,selectionHashs:d}}},getRadius:function(a){if(a==0){return 0}if(a==1){return this.minimumRadius}return Math.sqrt((this.minArea+(this.maxArea-this.minArea)/(this.maximumPoints-1)*(a-1))/Math.PI)},getBinRadius:function(e,b,c){if(e==0){return 0}var d=Math.PI*this.options.minimumRadius*this.options.minimumRadius;var a=Math.PI*b*b;return Math.sqrt((d+(a-d)/(c-1)*(e-1))/Math.PI)},shift:function(h,r,g,a){var c=r.x,b=0;var o=r.y,k=0;for(var f=0;f<a.length;f++){b+=a[f].x/a.length;k+=a[f].y/a.length}var l=0,j=0;if(h=="square"){var q=Math.abs(b-c);var p=Math.abs(k-o);var e=p/q;var d=o-e*c;if(q>p){l=r.x-(c+r.r-g);j=r.y-(e*r.x+d)}else{j=r.y-(o+r.r-g);l=r.x-(r.y-d)/e}}return{x:l,y:j}},binSize:function(c){var b=0;for(var a in c){b+=c[a].weight}return b},setCircleSet:function(m,o){var A=[];var d=[];var a=[];for(var w=0;w<o.length;w++){var q=[];var e=[];var y=[];for(var t=0;t<this.objects.length;t++){q.push([]);e.push([]);y.push([])}var u=[];var v=0;var b=0;var p=this.map.getResolutionForZoom(w);for(var t=0;t<o[w].length;t++){for(var s=0;s<o[w][t].bin.length;s++){var B=this.binSize(o[w][t].bin[s]);if(B>v){v=B;b=o[w][t].r/p}}}for(var t=0;t<o[w].length;t++){var l=o[w][t];for(var s=0;s<l.bin.length;s++){if(l.bin[s].length==0){continue}var g=this.binSize(l.bin[s]);var h=this.getBinRadius(g,b,v);var x=this.shift(m,l,h*p,l.bin[s],w);var c=new CircleObject(l.x-x.x,l.y-x.y,0,0,l.bin[s],h,s,g);q[s].push(c);for(var f=0;f<l.bin[s].length;f++){e[s][l.bin[s][f].index]=c;y[s][l.bin[s][f].index]=false}}}A.push(q);d.push(e);a.push(y)}this.binnings[m]={circleSets:A,hashMaps:d,selectionHashs:a}},squareBinning:function(){var f=20037508.34;var A=f*f*4;var q=this.options.binCount;var B=[];var r=[];for(var g=0;g<this.zoomLevels;g++){B.push([]);r.push([])}for(var m=0;m<this.objects.length;m++){for(var h=0;h<this.objects[m].length;h++){var e=this.objects[m][h];if(!e.isGeospatial){continue}var c=new OpenLayers.Geometry.Point(e.getLongitude(this.options.mapIndex),e.getLatitude(this.options.mapIndex),null);c.transform(this.map.displayProjection,this.map.projection);e.x=c.x;e.y=c.y;for(var g=0;g<this.zoomLevels;g++){var s=q*Math.pow(2,g);var w=2*f/s;var d=Math.floor((c.x+f)/(2*f)*s);var b=Math.floor((c.y+f)/(2*f)*s);if(typeof B[g][""+d]=="undefined"){B[g][""+d]=[]}if(typeof B[g][""+d][""+b]=="undefined"){B[g][""+d][""+b]=[];for(var t=0;t<this.objects.length;t++){B[g][""+d][""+b].push([])}var v=d*w+w/2-f;var u=b*w+w/2-f;r[g].push({bin:B[g][""+d][""+b],x:v,y:u,a:w,r:w/2})}B[g][""+d][""+b][m].push(e)}}}this.setCircleSet("square",r)},triangularBinning:function(){var A=20037508.34;var L=this.options.binCount;var K=Math.sqrt(4*L*L/Math.sqrt(3));var B=L/K*L;var v=[];var t=[];for(var C=0;C<this.zoomLevels;C++){v.push([]);t.push([])}for(var E=0;E<this.objects.length;E++){for(var D=0;D<this.objects[E].length;D++){var u=this.objects[E][D];if(!u.isGeospatial){continue}var s=new OpenLayers.Geometry.Point(u.getLongitude(this.options.mapIndex),u.getLatitude(this.options.mapIndex),null);s.transform(this.map.displayProjection,this.map.projection);u.x=s.x;u.y=s.y;for(var C=0;C<this.zoomLevels;C++){var w=B*Math.pow(2,C);var H=w*w/Math.sqrt(w*w-w*w/4);var J=2*A/w;var G=2*A/H;var c=Math.floor((s.y+A)/(2*A)*H);if(typeof v[C][""+c]=="undefined"){v[C][""+c]=[]}var F;var e=w*2;var d=Math.floor((s.x+A)/(2*A)*e);var I=J/2;var b=G;var m=s.x+A-d*J/2;var g=s.y+A-c*G;if(c%2==0&&d%2==1||c%2==1&&d%2==0){if(g+b/I*m<b){F=d}else{F=d+1}}else{if(g>b/I*m){F=d}else{F=d+1}}if(typeof v[C][""+c][""+F]=="undefined"){v[C][""+c][""+F]=[];for(var f=0;f<this.objects.length;f++){v[C][""+c][""+F].push([])}var q=Math.sqrt(3)/6*J;var m=(F-1)*J/2+J/2-A;var g;if(c%2==0&&F%2==0||c%2==1&&F%2==1){g=c*G+G-q-A}else{g=c*G+q-A}t[C].push({bin:v[C][""+c][""+F],x:m,y:g,a:J,r:q})}v[C][""+c][""+F][E].push(u)}}}this.setCircleSet("triangular",t)},hexagonalBinning:function(){var F=20037508.34;var R=this.options.binCount;var Q=Math.sqrt(4*R*R/Math.sqrt(3))/Math.sqrt(6);var G=R/Q*R;var D=[];var A=[];for(var H=0;H<this.zoomLevels;H++){D.push([]);A.push([])}for(var J=0;J<this.objects.length;J++){for(var I=0;I<this.objects[J].length;I++){var B=this.objects[J][I];if(!B.isGeospatial){continue}var w=new OpenLayers.Geometry.Point(B.getLongitude(this.options.mapIndex),B.getLatitude(this.options.mapIndex),null);w.transform(this.map.displayProjection,this.map.projection);B.x=w.x;B.y=w.y;for(var H=0;H<this.zoomLevels;H++){var E=G*Math.pow(2,H);var M=E*E/Math.sqrt(E*E-E*E/4);var O=2*F/E;var L=2*F/M;var d=Math.floor((w.y+F)/(2*F)*M);if(typeof D[H][""+d]=="undefined"){D[H][""+d]=[]}var K;var g=E*2;var f=Math.floor((w.x+F)/(2*F)*g);var N=O/2;var b=L;var t=w.x+F-f*O/2;var s=w.y+F-d*L;if(d%2==0&&f%2==1||d%2==1&&f%2==0){if(s+b/N*t<b){K=f}else{K=f+1}}else{if(s>b/N*t){K=f}else{K=f+1}}if(typeof D[H][""+d][""+K]=="undefined"){D[H][""+d][""+K]=[];for(var q=0;q<this.objects.length;q++){D[H][""+d][""+K].push([])}var u=Math.sqrt(3)/6*O;var t=(K-1)*O/2+O/2-F;var s;if(d%2==0&&K%2==0||d%2==1&&K%2==1){s=d*L+L-u-F}else{s=d*L+u-F}A[H].push({bin:D[H][""+d][""+K],x:t,y:s,a:O,r:u,h:L,binX:K,binY:d})}D[H][""+d][""+K][J].push(B)}}}var P=[];var c=[];for(var H=0;H<this.zoomLevels;H++){P.push([]);c.push([])}for(var J=0;J<A.length;J++){for(var I=0;I<A[J].length;I++){var v=A[J][I];var d=Math.floor(v.binY/2);var e=Math.floor(v.binX/3);var t,s;var O=v.a;var L=v.h;if(v.binX%6<3){if(typeof P[J][""+d]=="undefined"){P[J][""+d]=[]}s=d*2*v.h+v.h-F;t=e*1.5*v.a+O/2-F}else{if(v.binY%2==1){d++}if(typeof P[J][""+d]=="undefined"){P[J][""+d]=[]}s=d*2*v.h-F;t=e*1.5*v.a+O/2-F}if(typeof P[J][""+d][""+e]=="undefined"){P[J][""+d][""+e]=[];for(var q=0;q<this.objects.length;q++){P[J][""+d][""+e].push([])}c[J].push({bin:P[J][""+d][""+e],x:t,y:s,a:v.a,r:v.h})}for(var H=0;H<v.bin.length;H++){for(var C=0;C<v.bin[H].length;C++){P[J][""+d][""+e][H].push(v.bin[H][C])}}}}this.setCircleSet("hexagonal",c)}};function MapDataSource(b,a){this.olMap=b;this.circleSets=[];this.binning=new Binning(b,a)}MapDataSource.prototype={initialize:function(a){if(a!=this.mapObjects){this.binning.reset();this.binning.setObjects(a)}this.mapObjects=a;var b=this.binning.getSet();this.circleSets=b.circleSets;this.binSets=b.binSets;this.hashMapping=b.hashMaps},getObjectsByZoom:function(){var a=Math.floor(this.olMap.getZoom());if(this.circleSets.length<a){return null}return this.circleSets[a]},getAllObjects:function(){if(this.circleSets.length==0){return null}return this.circleSets},getAllBins:function(){if(this.binSets.length==0){return null}return this.binSets},clearOverlay:function(){var c=Math.floor(this.olMap.getZoom());var d=this.circleSets[c];for(var b in d){for(var a in d[b]){d[b][a].reset()}}},setOverlay:function(d){var c=Math.floor(this.olMap.getZoom());for(var b in d){for(var a in d[b]){var e=d[b][a];if(e.isGeospatial){this.hashMapping[c][b][e.index].overlay+=e.weight}}}},size:function(){if(this.circleSets.length==0){return 0}return this.circleSets[0].length},getCircle:function(a,c){var b=Math.floor(this.olMap.getZoom());return this.hashMapping[b][a][c]}};function Vertex(a,e,c,b){this.x=a;this.y=e;this.radius;this.size=0;this.elements=[];this.radii=[];this.weights=[];this.legal=true;this.binning=b;if(c!=undefined){for(var d=0;d<c;d++){this.elements.push([]);this.weights.push(0)}}}Vertex.prototype.merge=function(a,c){for(var b=0;b<a.elements.length;b++){this.elements[b]=a.elements[b].concat(c.elements[b]);this.weights[b]=a.weights[b]+c.weights[b];this.size+=this.weights[b]}};Vertex.prototype.CalculateRadius=function(c){this.radii=[];for(i in this.elements){this.radii.push(this.binning.getRadius(this.weights[i]))}if(this.radii.length==1){this.radius=this.radii[0]*c}else{var e=0;var b=0;var a=0;for(i in this.radii){if(this.radii[i]!=0){e++}if(this.radii[i]>b){if(b>a){a=b}b=this.radii[i]}else{if(this.radii[i]>a){a=this.radii[i]}}}if(e==1){this.radius=b*c}else{if(e==2){this.radius=(b+a)*c}else{if(e==3){var f=(2/3*Math.sqrt(3)-1)*b;this.radius=(f+b+a)*c}else{if(e==4){var f=(Math.sqrt(2)-1)*a;this.radius=(f+b+a)*c}}}}}};Vertex.prototype.addElement=function(c,b,a){this.elements[a].push(c);this.size+=b;this.weights[a]+=b};function Edge(a,b){this.v0=a;this.v1=b;this.leftFace;this.rightFace;this.legal=true;this.setLength()}Edge.prototype.setLength=function(){var b=this.v0.x-this.v1.x;var a=this.v0.y-this.v1.y;this.length=Math.sqrt(b*b+a*a)};Edge.prototype.contains=function(a){if(this.v0==a||this.v1==a){return true}return false};Edge.prototype.replaceFace=function(b,a){if(this.leftFace==b){this.leftFace=a}else{if(this.rightFace==b){this.rightFace=a}}};Edge.prototype.setFace=function(a){if(a.leftOf(this)){this.leftFace=a}else{this.rightFace=a}};Edge.prototype.setFaces=function(a,b){if(a.leftOf(this)){this.leftFace=a;this.rightFace=b}else{this.leftFace=b;this.rightFace=a}};Edge.prototype.removeFace=function(a){if(this.leftFace==a){this.leftFace=null}else{this.rightFace=null}};Edge.prototype.equals=function(a){if(this.v0==a.v0&&this.v1==a.v1||this.v0==a.v1&&this.v1==a.v0){return true}return false};function Triangle(a){this.edges=a;this.setVertices();this.descendants=[]}Triangle.prototype.getTriple=function(b){var a=arrayIndex(this.edges,b);return{e_s:this.edges[(a+1)%3],e_p:this.edges[(a+2)%3],u:this.vertices[(a+2)%3]}};Triangle.prototype.leftOf=function(b){var a=arrayIndex(this.edges,b);if(this.vertices[a].y!=this.vertices[(a+1)%3].y){return this.vertices[a].y>this.vertices[(a+1)%3].y}return this.vertices[a].y>this.vertices[(a+2)%3].y};Triangle.prototype.getNext=function(a){var b=arrayIndex(this.vertices,a);return this.vertices[(b+1)%3]};Triangle.prototype.oppositeEdge=function(a){var b=arrayIndex(this.vertices,a);return this.edges[(b+1)%3]};Triangle.prototype.contains=function(a){return arrayIndex(this.vertices,a)!=-1};Triangle.prototype.replace=function(a,b){this.edges[arrayIndex(this.edges,a)]=b};Triangle.prototype.setVertices=function(){if(this.edges[1].v0==this.edges[0].v0||this.edges[1].v1==this.edges[0].v0){this.vertices=[this.edges[0].v1,this.edges[0].v0]}else{this.vertices=[this.edges[0].v0,this.edges[0].v1]}if(this.edges[2].v0==this.vertices[0]){this.vertices.push(this.edges[2].v1)}else{this.vertices.push(this.edges[2].v0)}};Triangle.prototype.replaceBy=function(a){this.descendants=a;this.edges[0].replaceFace(this,a[0]);this.edges[1].replaceFace(this,a[1]);this.edges[2].replaceFace(this,a[2])};Triangle.prototype.CalcCircumcircle=function(){var j=this.vertices[0];var h=this.vertices[1];var g=this.vertices[2];var d=h.x-j.x;var c=h.y-j.y;var b=g.x-j.x;var a=g.y-j.y;var p=d*(j.x+h.x)+c*(j.y+h.y);var m=b*(j.x+g.x)+a*(j.y+g.y);var k=2*(d*(g.y-h.y)-c*(g.x-h.x));var f=(a*p-c*m)/k;var e=(d*m-b*p)/k;this.center=new Vertex(f,e);var o=this.center.x-j.x;var l=this.center.y-j.y;this.radius_squared=o*o+l*l};Triangle.prototype.inCircumcircle=function(c){if(this.radius_squared==undefined){this.CalcCircumcircle()}var b=this.center.x-c.x;var a=this.center.y-c.y;var d=b*b+a*a;return(d<=this.radius_squared)};Triangle.prototype.interior=function(b){var a=this.vertices[0];var g=this.vertices[1];var e=this.vertices[2];var d=(b.x-a.x)*(a.y-g.y)+(b.y-a.y)*(g.x-a.x);var f=(b.x-g.x)*(g.y-e.y)+(b.y-g.y)*(e.x-g.x);var c=(b.x-e.x)*(e.y-a.y)+(b.y-e.y)*(a.x-e.x);if(d>0||f>0||c>0){return null}else{if(d<0&&f<0&&c<0){return this}else{if(d==0){if(f==0){return this.vertices[1]}else{if(c==0){return this.vertices[0]}}return this.edges[0]}else{if(f==0){if(c==0){return this.vertices[2]}return this.edges[1]}else{if(c==0){return this.edges[2]}}}}}};function Clustering(b,a,d,c){this.triangles=[];this.newTriangles=[];this.bbox={x1:b,y1:a,x2:d,y2:c};this.CreateBoundingTriangle();this.edges=[];this.vertices=[];this.legalizes=0;this.collapses=0}Clustering.prototype.locate=function(b){if(this.boundingTriangle.descendants.length==0){return this.boundingTriangle}var d=this.boundingTriangle.descendants;while(true){for(var c=0;c<d.length;c++){var a=d[c].interior(b);if(a==null){continue}if(a instanceof Vertex||this.isLeaf(d[c])){return a}d=d[c].descendants;break}}};Clustering.prototype.legalize=function(m,j,l){if(!j.v0.legal&&!j.v1.legal){return}this.legalizes++;var g=false;var k,f;if(j.leftFace==l&&j.rightFace.inCircumcircle(m)){g=true;k=j.rightFace}else{if(j.rightFace==l&&j.leftFace.inCircumcircle(m)){g=true;k=j.leftFace}}if(g){var h=l.getTriple(j);var f=k.getTriple(j);var d=new Edge(h.u,f.u);var a=[];a.push(j.v0);a.push(d.v0);a.push(j.v1);a.push(d.v1);if(!this.JordanTest(a,d)){return}j.legal=false;this.edges.push(d);var c=new Triangle([d,h.e_p,f.e_s]);var b=new Triangle([d,f.e_p,h.e_s]);d.setFaces(c,b);h.e_p.replaceFace(l,c);f.e_s.replaceFace(k,c);f.e_p.replaceFace(k,b);h.e_s.replaceFace(l,b);l.descendants=[c,b];k.descendants=[c,b];this.legalize(m,c.edges[2],c);this.legalize(m,b.edges[1],b)}};Clustering.prototype.add=function(a){this.addVertex(a,this.locate(a))};Clustering.prototype.addVertex=function(p,q){if(q instanceof Vertex){q.merge(q,p)}else{if(q instanceof Edge){this.vertices.push(p);q.legal=false;var g=q.leftFace.getTriple(q);var e=q.rightFace.getTriple(q);var o=new Edge(p,g.u);var m=new Edge(p,q.leftFace.getNext(g.u));var l=new Edge(p,e.u);var k=new Edge(p,q.rightFace.getNext(e.u));var j=new Triangle([o,g.e_p,m]);var h=new Triangle([m,e.e_s,l]);var f=new Triangle([l,e.e_p,k]);var d=new Triangle([k,g.e_s,o]);q.leftFace.descendants=[j,d];q.rightFace.descendants=[h,f];this.edges.push(o);this.edges.push(m);this.edges.push(l);this.edges.push(k);o.setFaces(j,d);m.setFaces(j,h);l.setFaces(h,f);k.setFaces(f,d);g.e_p.replaceFace(q.leftFace,j);e.e_s.replaceFace(q.rightFace,h);e.e_p.replaceFace(q.rightFace,f);g.e_s.replaceFace(q.leftFace,d);this.legalize(p,g.e_p,j);this.legalize(p,e.e_s,h);this.legalize(p,e.e_p,f);this.legalize(p,g.e_s,d)}else{this.vertices.push(p);var c=new Edge(q.vertices[0],p);var b=new Edge(q.vertices[1],p);var a=new Edge(q.vertices[2],p);this.edges.push(c);this.edges.push(b);this.edges.push(a);var j=new Triangle([c,q.edges[0],b]);var h=new Triangle([b,q.edges[1],a]);var f=new Triangle([a,q.edges[2],c]);c.setFaces(j,f);b.setFaces(j,h);a.setFaces(h,f);q.replaceBy([j,h,f]);this.legalize(p,q.edges[0],j);this.legalize(p,q.edges[1],h);this.legalize(p,q.edges[2],f)}}};Clustering.prototype.isLeaf=function(a){return a.descendants.length==0};Clustering.prototype.CreateBoundingTriangle=function(){var j=(this.bbox.x2-this.bbox.x1)*10;var h=(this.bbox.y2-this.bbox.y1)*10;var g=new Vertex(this.bbox.x1-j,this.bbox.y1-h*3);var f=new Vertex(this.bbox.x2+j*3,this.bbox.y2+h);var e=new Vertex(this.bbox.x1-j,this.bbox.y2+h);var d=new Edge(f,g);var c=new Edge(g,e);var b=new Edge(e,f);g.legal=false;f.legal=false;e.legal=false;this.boundingTriangle=new Triangle([d,c,b]);var a=new Triangle([d,c,b]);d.setFaces(this.boundingTriangle,a);c.setFaces(this.boundingTriangle,a);b.setFaces(this.boundingTriangle,a)};Clustering.prototype.mergeVertices=function(F){this.collapses++;var g=F.v0.size;var f=F.v1.size;var s=(F.v0.x*g+F.v1.x*f)/(g+f);var q=(F.v0.y*g+F.v1.y*f)/(g+f);var w=new Vertex(s,q,F.v0.elements.length,F.v0.binning);w.merge(F.v0,F.v1);F.v0.legal=false;F.v1.legal=false;var z=[];var D=[];F.legal=false;var o=[];var E=function(b,v,e){b.legal=false;do{var j;if(b.leftFace==e){j=b.rightFace.getTriple(b);D.push(b.rightFace);j.e_s.removeFace(b.rightFace);e=b.rightFace}else{j=b.leftFace.getTriple(b);D.push(b.leftFace);j.e_s.removeFace(b.leftFace);e=b.leftFace}if(arrayIndex(z,j.e_s)==-1){z.push(j.e_s)}o.push(j.u);b=j.e_p;b.legal=false}while(b!=v)};var I=F.leftFace.getTriple(F);var H=F.rightFace.getTriple(F);D.push(F.leftFace);D.push(F.rightFace);E(I.e_p,H.e_s,F.leftFace);E(H.e_p,I.e_s,F.rightFace);var m=new Clustering(this.bbox.x1-10,this.bbox.y1-10,this.bbox.x2+10,this.bbox.y2+10);var A=[];for(var C in z){if(!(z[C].leftFace==null&&z[C].rightFace==null)){A.push(z[C].v0);A.push(z[C].v1)}}var k=[];var a=[];for(var C in o){if(arrayIndex(a,o[C])==-1){m.add(o[C]);a.push(o[C])}if(arrayIndex(A,o[C])!=-1){k.push(o[C])}}var c=[];var d=function(j){for(var b=0;b<z.length;b++){if(z[b].equals(j)){return b}}return -1};var h=new Array(z.length);var u=[];for(var C=0;C<m.edges.length;C++){var F=m.edges[C];var G=d(F);if(G!=-1){if(!F.legal){var r=F.leftFace.getTriple(F);var p=F.rightFace.getTriple(F);var l=new Edge(r.u,p.u);for(var B=0;B<m.edges.length;B++){if(m.edges[B].equals(l)&&m.edges[B].legal){m.edges[B].legal=false;break}}r.e_p.setFace(F.leftFace);r.e_s.setFace(F.leftFace);p.e_p.setFace(F.rightFace);p.e_s.setFace(F.rightFace);F.legal=true}h[G]=F}else{u.push(F)}}for(var C=0;C<h.length;C++){var F=h[C];if(z[C].leftFace==null){z[C].leftFace=F.leftFace;z[C].leftFace.replace(F,z[C]);if(arrayIndex(c,z[C].leftFace)==-1){c.push(z[C].leftFace)}}if(z[C].rightFace==null){z[C].rightFace=F.rightFace;z[C].rightFace.replace(F,z[C]);if(arrayIndex(c,z[C].rightFace)==-1){c.push(z[C].rightFace)}}}for(var C=0;C<u.length;C++){var F=u[C];if(!F.legal){continue}if(this.JordanTest(k,F)){this.edges.push(F);if(arrayIndex(c,F.rightFace)==-1){c.push(F.rightFace)}if(arrayIndex(c,F.leftFace)==-1){c.push(F.leftFace)}}}for(var C in D){D[C].descendants=c}for(var C=0;C<c.length;C++){var t=c[C].interior(w);if(t==null){continue}else{this.addVertex(w,t);break}}return w};Clustering.prototype.JordanTest=function(d,h){var g=new Vertex((h.v0.x+h.v1.x)*0.5,(h.v0.y+h.v1.y)*0.5);var a=false;var c,b=d.length-1;for(c=0;c<d.length;b=c++){var k=d[c];var f=d[b];if((((k.y<=g.y)&&(g.y<f.y))||((f.y<=g.y)&&(g.y<k.y)))&&(g.x<(f.x-k.x)*(g.y-k.y)/(f.y-k.y)+k.x)){a=!a}}return a};Clustering.prototype.mergeForResolution=function(h,g,q){this.deleteEdges=new BinaryHeap(function(k){return k.weight});this.weightEdges(h,g,q);var s=0;while(this.deleteEdges.size()>0){var t=this.deleteEdges.pop();if(t.legal){var j=this.edges.length;var u=this.mergeVertices(t);u.CalculateRadius(h);for(var m=j;m<this.edges.length;m++){var f=this.edges[m];if(f.legal){if(g!=0){f.weight=f.length/(f.v0.radius+f.v1.radius+g*h)}else{if(q.overlap==0){f.weight=f.length/(f.v0.radius+f.v1.radius)}else{var d=f.v0.radius;var c=f.v1.radius;var a=f.length;if(a<d+c){if(q.type=="diameter"){var p=(c-(a-d))/d/2;var o=(d-(a-c))/c/2;var v=Math.max(p,o);f.weight=q.overlap/v}if(q.type=="area"){if(!(a+d<c||a+c<d)){var b=c*c*Math.acos((a*a+c*c-d*d)/(2*a*c))+d*d*Math.acos((a*a+d*d-c*c)/(2*a*d))-1/2*Math.sqrt((-a+d+c)*(a-d+c)*(a+d-c)*(a+d+c));var p=b/(Math.PI*d*d);var o=b/(Math.PI*c*c);var v=Math.max(p,o);f.weight=q.overlap/v}else{f.weight=0}}}}}if(f.weight<1){this.deleteEdges.push(f)}}}}}};Clustering.prototype.weightEdges=function(g,f,l){for(var k=0;k<this.vertices.length;k++){if(this.vertices[k].legal){this.vertices[k].CalculateRadius(g)}}var p=[];for(var k=0;k<this.edges.length;k++){var m=this.edges[k];if(m.legal){if(!m.v0.legal||!m.v1.legal){m.weight=1}else{if(f!=0){m.weight=m.length/(m.v0.radius+m.v1.radius+f*g)}else{if(l.overlap==0){m.weight=m.length/(m.v0.radius+m.v1.radius)}else{var d=m.v0.radius;var c=m.v1.radius;var a=m.length;if(a<d+c){if(l.type=="diameter"){var j=(c-(a-d))/d/2;var h=(d-(a-c))/c/2;var o=Math.max(j,h);m.weight=l.overlap/o}if(l.type=="area"){if(!(a+d<c||a+c<d)){var b=c*c*Math.acos((a*a+c*c-d*d)/(2*a*c))+d*d*Math.acos((a*a+d*d-c*c)/(2*a*d))-1/2*Math.sqrt((-a+d+c)*(a-d+c)*(a+d-c)*(a+d+c));var j=b/(Math.PI*d*d);var h=b/(Math.PI*c*c);var o=Math.max(j,h);m.weight=l.overlap/o}else{m.weight=0}}}}}if(m.weight<1){this.deleteEdges.push(m)}}p.push(m)}}this.edges=p};Clustering.prototype.ValidityTest=function(){console.info("Test 1: Valid Delaunay ...");for(i in this.edges){var h=this.edges[i];if(h.leftFace==null||h.rightFace==null){console.info(h);alert()}}var a=function(r,q,m){var e=r.x-q.x;var c=r.x-m.x;var p=r.y-q.y;var o=r.y-m.y;if(e*o-p*c<0){return true}return false};var j=0;for(i in this.edges){var h=this.edges[i];var g=h.leftFace.getTriple(h);var d=h.rightFace.getTriple(h);if(h.v0.y==h.v1.y){if(g.u.y>d.u.y){console.info("equal y conflict ...");console.info(h);alert();j++}}else{var l,k;if(h.v0.y>h.v1.y){l=h.v0;k=h.v1}else{l=h.v1;k=h.v0}if(!a(l,k,g.u)){console.info("left right conflict ... left is right");console.info(h);alert();j++}if(a(l,k,d.u)){console.info("left right conflict ... right is left");console.info(h);alert();j++}}}for(i in this.edges){if(this.edges[i].legal){var h=this.edges[i];var f=h.leftFace.getTriple(h);var b=h.rightFace.getTriple(h);if(!f.e_p.legal||!f.e_s.legal||!b.e_p.legal||!b.e_s.legal){console.info(h);console.info("conflict in edge continuity");return}}}};function BinaryHeap(a){this.content=[];this.scoreFunction=a}BinaryHeap.prototype={push:function(a){this.content.push(a);this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0];var b=this.content.pop();if(this.content.length>0){this.content[0]=b;this.sinkDown(0)}return a},remove:function(d){var a=this.content.length;for(var c=0;c<a;c++){if(this.content[c]==d){var b=this.content.pop();if(c!=a-1){this.content[c]=b;if(this.scoreFunction(b)<this.scoreFunction(d)){this.bubbleUp(c)}else{this.sinkDown(c)}}return}}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(d){var a=this.content[d];while(d>0){var c=Math.floor((d+1)/2)-1,b=this.content[c];if(this.scoreFunction(a)<this.scoreFunction(b)){this.content[c]=a;this.content[d]=b;d=c}else{break}}},sinkDown:function(b){var a=this.content.length,f=this.content[b],h=this.scoreFunction(f);while(true){var e=(b+1)*2,k=e-1;var c=null;if(k<a){var j=this.content[k],l=this.scoreFunction(j);if(l<h){c=k}}if(e<a){var g=this.content[e],d=this.scoreFunction(g);if(d<(c==null?h:l)){c=e}}if(c!=null){this.content[b]=this.content[c];this.content[c]=f;b=c}else{break}}}};function Dropdown(j,a,g){var k=this;this.visibility=false;this.div=document.createElement("div");this.div.setAttribute("class","dropdown");this.selection=document.createElement("div");this.selection.setAttribute("class","dropdownSelection");j.appendChild(this.div);var b=document.createElement("div");b.setAttribute("class","dropdownLeft");this.div.appendChild(b);this.div.appendChild(this.selection);var f=document.createElement("div");this.div.appendChild(f);if(a.length>1){f.setAttribute("class","dropdownButtonEnabled")}else{f.setAttribute("class","dropdownButtonDisabled")}f.onclick=function(){if(a.length>1){k.changeVisibility()}};f.title=g;this.getValue=function(){return this.selectedEntry.innerHTML};var h=document.createElement("div");h.setAttribute("class","dropdownMenu");this.div.appendChild(h);var e=document.createElement("dl");var c=function(m){var l=document.createElement("dt");l.innerHTML=m.name;l.onclick=function(){m.onclick();k.changeVisibility();k.changeEntries(m)};e.appendChild(l);m.entry=l};for(var d=0;d<a.length;d++){c(a[d])}h.appendChild(e);this.selection.style.width=h.offsetWidth+"px";h.style.width=(h.offsetWidth+b.offsetWidth+f.offsetWidth-2)+"px";this.div.style.maxHeight=this.div.offsetHeight+"px";h.style.display="none";this.setEntry=function(l){if(typeof(l)=="undefined"){if((a)&&a.length>0){this.changeEntries(a[0])}}else{this.changeEntries(a[l])}};this.changeEntries=function(l){if(this.selectedEntry){this.selectedEntry.setAttribute("class","dropdownUnselectedEntry")}this.selectedEntry=l.entry;this.selectedEntry.setAttribute("class","dropdownSelectedEntry");this.selection.innerHTML="<div style='display:inline-block;vertical-align:middle;'>"+l.name+"</div>"};this.changeVisibility=function(){this.visibility=!this.visibility;if(this.visibility){h.style.display="block"}else{h.style.display="none"}}}function MapZoomSlider(c,b){this.parent=c;var f=this;this.div=document.createElement("div");this.div.setAttribute("class","sliderStyle-"+b);var e=document.createElement("div");e.setAttribute("class","zoomSliderContainer-"+b);var g=document.createElement("div");g.tabIndex=1;var d=document.createElement("div");g.appendChild(d);e.appendChild(g);this.slider=new Slider(g,d,b);this.div.appendChild(e);var h=document.createElement("img");h.src=GeoTemConfig.path+"zoom_in.png";h.setAttribute("class","zoomSliderIn-"+b);h.onclick=function(){f.parent.zoom(1)};this.div.appendChild(h);var a=document.createElement("img");a.src=GeoTemConfig.path+"zoom_out.png";a.setAttribute("class","zoomSliderOut-"+b);a.onclick=function(){f.parent.zoom(-1)};this.div.appendChild(a);this.slider.onclick=function(){console.info(f.slider.getValue())};this.slider.handle.onmousedown=function(){var j=f.slider.getValue();document.onmouseup=function(){if(!f.parent.zoom((f.slider.getValue()-j)/f.max*f.levels)){f.setValue(j)}document.onmouseup=null}};this.setValue=function(j){this.slider.setValue(j/this.levels*this.max)};this.setMaxAndLevels=function(j,k){this.max=j;this.levels=k;this.slider.setMaximum(j)};this.setLanguage=function(){h.title=GeoTemConfig.getString("zoomIn");a.title=GeoTemConfig.getString("zoomOut");this.slider.handle.title=GeoTemConfig.getString("zoomSlider")}}function MapPopup(a){this.parentDiv=a.gui.mapWindow;this.initialize=function(b,h,g){var c=this;this.x=b;this.y=h;this.popupDiv=document.createElement("div");this.popupDiv.setAttribute("class","ddbPopupDiv");this.parentDiv.appendChild(this.popupDiv);this.cancel=document.createElement("div");this.cancel.setAttribute("class","ddbPopupCancel");this.cancel.title=GeoTemConfig.getString("close");this.cancel.onclick=function(){if(typeof g!="undefined"){g()}c.reset()};this.input=document.createElement("div");this.input.style.maxWidth=Math.floor(this.parentDiv.offsetWidth*0.75)+"px";this.input.style.maxHeight=Math.floor(this.parentDiv.offsetHeight*0.75)+"px";this.input.setAttribute("class","ddbPopupInput");this.popupDiv.appendChild(this.input);this.popupDiv.appendChild(this.cancel);var f=document.createElement("div");f.setAttribute("class","popupPeak");this.popupDiv.appendChild(f);var e=document.createElement("div");e.setAttribute("class","popupTopRight");this.popupDiv.appendChild(e);var d=document.createElement("div");d.setAttribute("class","popupBottomRight");this.popupDiv.appendChild(d);this.popupRight=document.createElement("div");this.popupRight.setAttribute("class","popupRight");this.popupDiv.appendChild(this.popupRight);this.popupBottom=document.createElement("div");this.popupBottom.setAttribute("class","popupBottom");this.popupDiv.appendChild(this.popupBottom)};this.setContent=function(b){$(this.input).empty();this.visible=true;$(this.input).append(b);this.decorate()};this.reset=function(){$(this.popupDiv).remove();this.visible=false};this.decorate=function(){this.popupRight.style.height=(this.popupDiv.offsetHeight-14)+"px";this.popupBottom.style.width=(this.popupDiv.offsetWidth-22)+"px";this.left=this.x+9;this.top=this.y-10-this.popupDiv.offsetHeight;this.popupDiv.style.left=this.left+"px";this.popupDiv.style.top=this.top+"px";var c=0,b=0;if(this.popupDiv.offsetTop<a.gui.headerHeight+10){b=-1*(a.gui.headerHeight+10-this.popupDiv.offsetTop)}if(this.popupDiv.offsetLeft+this.popupDiv.offsetWidth>a.gui.headerWidth-10){c=-1*(a.gui.headerWidth-10-this.popupDiv.offsetLeft-this.popupDiv.offsetWidth)}a.shift(c,b)};this.shift=function(b,c){this.left=this.left-this.x+b;this.top=this.top-this.y+c;this.x=b;this.y=c;if(this.left+this.popupDiv.offsetWidth>this.parentDiv.offsetWidth){this.popupDiv.style.left="auto";this.popupDiv.style.right=(this.parentDiv.offsetWidth-this.left-this.popupDiv.offsetWidth)+"px"}else{this.popupDiv.style.right="auto";this.popupDiv.style.left=this.left+"px"}this.popupDiv.style.top=this.top+"px"}}function PlacenamePopup(a){this.parentDiv=a.gui.mapWindow;this.createPopup=function(b,g,f){this.labels=f;var e=this;var d=new MapPopup(a);var c=function(){a.deselection();e.reset()};d.initialize(b,g,c);$.extend(this,d);this.content=document.createElement("div");this.inner=document.createElement("div");this.resultsLabel=document.createElement("div");this.resultsLabel.setAttribute("class","popupDDBResults");this.content.appendChild(this.resultsLabel);this.backward=document.createElement("div");this.backward.setAttribute("class","prevItem");this.content.appendChild(this.backward);this.backward.onclick=function(){e.descriptionIndex--;e.showDescription()};this.number=document.createElement("div");this.content.appendChild(this.number);this.number.style.display="none";this.number.style.fontSize="13px";this.forward=document.createElement("div");this.forward.setAttribute("class","nextItem");this.content.appendChild(this.forward);this.forward.onclick=function(){e.descriptionIndex++;e.showDescription()};if(a.options.showDescriptions){this.descriptions=document.createElement("div");this.descriptions.setAttribute("class","descriptions");this.descriptions.onclick=function(){e.switchToDescriptionMode()}}this.back=document.createElement("div");this.back.setAttribute("class","back");this.popupDiv.appendChild(this.back);this.back.onclick=function(){e.back.style.display="none";e.backward.style.display="none";e.forward.style.display="none";e.number.style.display="none";e.showLabels()};this.content.appendChild(this.inner);this.listLabels();this.showLabels()};this.switchToDescriptionMode=function(){this.descriptionIndex=0;this.descriptionContents=this.activeLabel.descriptions;this.number.style.display="inline-block";this.inner.style.minWidth="300px";this.showDescription();this.count=this.activeLabel.weight;this.setCount();this.back.style.display="inline-block"};this.showDescription=function(){$(this.inner).empty();this.inner.appendChild(this.descriptionContents[this.descriptionIndex]);this.setContent(this.content);if(this.descriptionContents.length==1){this.backward.style.display="none";this.forward.style.display="none"}else{if(this.descriptionIndex==0){this.backward.style.display="none"}else{this.backward.style.display="inline-block"}if(this.descriptionIndex==this.descriptionContents.length-1){this.forward.style.display="none"}else{this.forward.style.display="inline-block"}}if(this.descriptionContents.length>1){this.number.innerHTML="#"+(this.descriptionIndex+1)}else{this.number.style.display="none"}this.decorate()};this.setCount=function(){var b=this.count;if(b>1){this.resultsLabel.innerHTML=b+" "+GeoTemConfig.getString("results")}else{this.resultsLabel.innerHTML=b+" "+GeoTemConfig.getString("result")}};this.listLabels=function(){var f=this;this.labelDivs=[];this.labelCount=0;this.labelsWidth=0;for(var d=0;d<this.labels.length;d++){var g=document.createElement("div");var e=document.createElement("div");this.labels[d].allStyle+="position: relative; white-space: nowrap;";e.appendChild(this.labels[d].div);e.setAttribute("class","ddbPopupLabel");g.appendChild(e);this.labels[d].div.setAttribute("style",this.labels[d].allStyle+""+this.labels[d].selectedStyle);this.input.appendChild(g);if(this.input.offsetWidth>this.labelsWidth){this.labelsWidth=this.input.offsetWidth}this.labels[d].div.setAttribute("style",this.labels[d].allStyle+""+this.labels[d].unselectedStyle);this.labelDivs.push(g);var c=[];for(var b=0;b<this.labels[d].elements.length;b++){var g=document.createElement("div");g.innerHTML=this.labels[d].elements[b].description;c.push(g)}this.labels[d].descriptions=c;if(this.labels[d].place!="all"||d==0){this.labelCount+=this.labels[d].weight}}if(typeof this.descriptions!="undefined"){this.labelsWidth+=20}};this.showLabels=function(){$(this.inner).empty();this.count=this.labelCount;this.setCount();for(var b=0;b<this.labelDivs.length;b++){this.inner.appendChild(this.labelDivs[b])}this.inner.style.width=this.labelsWidth+"px";this.inner.style.minWidth=this.labelsWidth+"px";this.setContent(this.content);this.decorate()};this.showLabelContent=function(b){for(var c=0;c<this.labels.length;c++){if(this.labels[c]==b){this.activeLabel=this.labels[c];if(typeof this.descriptions!="undefined"){this.labelDivs[c].appendChild(this.descriptions)}this.decorate();break}}};this.setLanguage=function(b){this.language=b;if(this.visible){this.updateTexts()}}}if(typeof Publisher=="undefined"){Publisher=function(){var a=[];this.Get=function(b){var c=a[b];if(!c){c=a[b]=[]}return c};this.Publish=function(b,e,d){var f=this.Get(b);for(var c=0;c<f.length;c++){if(d==null||f[c].client!=d){f[c].callback(e)}}};this.Subscribe=function(b,c,e){var d=this.Get(b);d.push({client:c,callback:e})};this.Unsubscribe=function(b,d){var e=this.Get(b);for(var c=0;c<e.length;c++){if(e[c].client==d){e.splice(c,1);return}}};return this}()}function WidgetWrapper(){var a=this;this.setWidget=function(b){this.widget=b};this.display=function(b){if(b instanceof Array){GeoTemConfig.datasets=b.length;if(typeof a.widget!="undefined"){this.widget.initWidget(b)}}};Publisher.Subscribe("highlight",this,function(b){if(b==undefined){return}if(typeof a.widget!="undefined"){a.widget.highlightChanged(b)}});Publisher.Subscribe("selection",this,function(b){if(typeof a.widget!="undefined"){a.widget.selectionChanged(b)}});Publisher.Subscribe("filterData",this,function(b){a.display(b)});Publisher.Subscribe("rise",this,function(b){if(typeof a.widget!="undefined"&&typeof a.widget.riseLayer!="undefined"){a.widget.riseLayer(b)}});Publisher.Subscribe("resizeWidget",this,function(){if(typeof a.widget!="undefined"&&typeof a.widget.gui!="undefined"&&typeof a.widget.gui.resize!="undefined"){a.widget.gui.resize()}});this.triggerRefining=function(b){Publisher.Publish("filterData",b,null)};this.triggerSelection=function(b){Publisher.Publish("selection",b,this)};this.triggerHighlight=function(b){Publisher.Publish("highlight",b,this)};this.triggerRise=function(b){Publisher.Publish("rise",b)}}OpenLayers.Util.getImagesLocation=function(){return GeoTemCoMinifier_urlPrefix+"lib/openlayers/img/"};OpenLayers._getScriptLocation=function(){return GeoTemCoMinifier_urlPrefix+"lib/openlayers/"};GeoTemConfig.configure(GeoTemCoMinifier_urlPrefix);